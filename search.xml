<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>马的周游问题(knight move circuit)</title>
      <link href="/2022/04/12/Algorithm/Knignt%20move%20circuit/"/>
      <url>/2022/04/12/Algorithm/Knignt%20move%20circuit/</url>
      
        <content type="html"><![CDATA[<h2 id="题目描述">题目描述</h2><p>给定一个<span class="math inline">\(n\)</span>行<span class="math inline">\(m\)</span>列的棋盘，任意给出一个马的周游路线。周游路线是指从起始点开始，不重不漏的经过棋盘上的每一个格子，最后再回到起始点的路线。</p><h3 id="样例输入">样例输入</h3><pre><code>6 5</code></pre><h3 id="样例输出">样例输出</h3><pre><code>    2   25   22   13    4   23   12    3   30   21   26    1   24    5   14   11   16    9   20   29    8   27   18   15    6   17   10    7   28   19</code></pre><h2 id="解答">解答</h2><p>本题是一个哈密顿路问题，正常来说，哈密顿问题是一个NP完全问题。不过，由马的周游问题的特殊性，我们可以通过将问题分解为子问题的方式。</p><p>周游问题的特殊性见下图。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/horse-c.png" alt="周游问题的特性" /></p><p>从图中可以看到，我们将问题分解后，得到的子问题的解法大致相同，而且两个子问题很容易合并。</p><h3 id="子问题合并">子问题合并</h3><p>子问题合并的规则如下。令<span class="math inline">\(p_1, p_2\in E\)</span>，<span class="math inline">\(p_1&#39;,p_2&#39; \in E&#39;\)</span>：</p><ol type="1"><li><span class="math inline">\(p_1, p_2\)</span>之间，<span class="math inline">\(p_1&#39;,p_2&#39;\)</span>之间都有无向边连接。</li><li><span class="math inline">\(p_1, p&#39;_1\)</span>和<span class="math inline">\(p_2,p_2&#39;\)</span>可达，或<span class="math inline">\(p_1, p&#39;_2\)</span>和<span class="math inline">\(p_1&#39;, p_2\)</span>可达。</li></ol><p>之后去除原来的边，加上连接两个图的边，即可完成两个回路的连接。</p><p>程序中<code>void merge(struct subq q1, struct subq q2)</code>对应了此过程。</p><h3 id="子问题求解">子问题求解</h3><p>将要求解的子问题<span class="math inline">\(q\)</span>具有如下的性质：</p><ol type="1"><li>问题的范围可以通过四个变量描述，分别是子问题的起始位置<span class="math inline">\((x_0, y_0)\)</span>，子问题的规模<span class="math inline">\((n, m)\)</span>。</li><li>必须满足<span class="math inline">\(n * m\ \text{mod}\ 2 == 0, \min(n,m)\geq5\)</span>，问题才有解<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</li><li>问题是可合并的。</li><li>当问题规模较小时，可以使用回溯法求解。</li></ol><p>回溯法的启发式优化：</p><ol type="1"><li>扩展节点时，优先扩展可能选择数目最小的节点。代码中的<code>int get_possible(int x, int y, struct subq q)</code>函数实现了计算一个节点的可能选择数目。</li><li>扩展节点时，在(1)的条件下，尽可能扩展离中点远的节点。</li><li>起始节点选在中间。</li></ol><p>程序中<code>void dfs(int x, int y, int cnt, struct subq q)</code>，<code>void solve(struct subq q)</code>对应了此过程。</p><h3 id="原问题分解">原问题分解</h3><p>经过优化的回溯法非常适合求解<span class="math inline">\(|m-n|\leq 3(5\leq m,n \leq 16)\)</span>的数据，所以在分解问题时，我们在保证分解后问题都有解的情况下，让子问题尽量接近一个正方形。</p><p>我们有如下的分解方法：</p><ol type="1"><li>如果<span class="math inline">\(n,m\)</span>均为偶数，如果<span class="math inline">\(n\geq m\)</span>，那么分解问题为两个<span class="math inline">\(n/2\)</span>，<span class="math inline">\(m\)</span>的子问题。<span class="math inline">\(n\leq m\)</span>同理。</li><li>如果<span class="math inline">\(n\)</span>是奇数，<span class="math inline">\(m\)</span>是偶数，如果<span class="math inline">\(n\geq m\)</span>，那么分解问题为<span class="math inline">\(\lfloor\frac{n}{2}\rfloor,m\)</span>与<span class="math inline">\(n-\lfloor\frac{n}{2}\rfloor\)</span>的子问题。如果<span class="math inline">\(n\leq m\)</span>，令<span class="math inline">\(t\)</span>为最接近<span class="math inline">\(\lfloor\frac{n}{2}\rfloor\)</span>的偶数，则将问题分解为<span class="math inline">\(n, t\)</span>与<span class="math inline">\(n, m - t\)</span>的子问题。另一种情况同理。</li><li>如果<span class="math inline">\(n,m\)</span>均为奇数，无解。</li></ol><p>程序实现中<code>void div_conquer(struct subq q)</code>函数对应了此过程。</p><h2 id="时间复杂度">时间复杂度</h2><ol type="1"><li><p>分治法思想</p><p>令<span class="math inline">\(n\times m\)</span>的周游问题规模为<span class="math inline">\(N\)</span>。每次合并子问题需要的代价是图的合并和寻找满足合并条件的点产生的总代价，为子问题的规模。列出复杂度的递推方程： <span class="math display">\[W(N)=W(\frac{N}{2})+N\]</span> 通过主定理或换元迭代法，可以求出分治法思想的时间复杂度为<span class="math inline">\(O(N\log N)\)</span>，也就是<span class="math inline">\(O(nm\log nm)\)</span></p></li><li><p>回溯法求解</p><p>对于最终的小规模问题，由于在暴力求解中使用了启发式函数进行搜索，时间复杂度变得难以估计，理论上的时间复杂度是<span class="math inline">\(O(2^N)\)</span>的，但实际情况要好的多。这里假设解决所有子问题的总复杂度为<span class="math inline">\(k\)</span>，它是一个不能忽略的很大的常数，它是远大于<span class="math inline">\(\log N\)</span>的，但又远小于<span class="math inline">\(2^N\)</span>。</p><p>通过单独运行回溯法程序，是可以在有限时间内求解100以内的问题的（大约30秒）。</p></li><li><p>结论</p><p>总时间复杂度为： <span class="math display">\[O(nmk)\]</span></p></li></ol><h2 id="程序实现">程序实现</h2><p>下面的程序可以实现1s内对于<span class="math inline">\(m,n\leq 260\)</span>的求解。代码中的关键部分都添加了注释以说明各个模块的内容。</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">horse</span><span class="co"> circuit problem.cpp</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Redleaves699 (Algorithm_sort</span><span class="an">@163.com)</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> A programme to solve horse circuit problem. </span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@details</span><span class="co"> compiler options: g++ horse.cpp -o horse</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> 1.0</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2022-04-12</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@copyright</span><span class="co"> </span><span class="do">Copyright</span><span class="co"> </span><span class="do">(c)</span><span class="co"> </span><span class="do">2022</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cassert&gt;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;ctime&gt;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdlib&gt;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="op">(</span><span class="dv">3000</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">10</span><span class="op">)</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="pp">#define min</span><span class="op">(</span>a<span class="op">,</span><span class="pp"> </span>b<span class="op">)</span><span class="pp"> </span><span class="op">((</span>a<span class="op">)</span><span class="pp"> </span><span class="op">&lt;</span><span class="pp"> </span><span class="op">(</span>b<span class="op">)</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="op">(</span>a<span class="op">)</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="op">(</span>b<span class="op">))</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="pp">#define abs</span><span class="op">(</span>a<span class="op">)</span><span class="pp"> </span><span class="op">((</span>a<span class="op">)</span><span class="pp"> </span><span class="op">&gt;</span><span class="pp"> </span><span class="dv">0</span><span class="pp"> </span><span class="op">?</span><span class="pp"> </span><span class="op">(</span>a<span class="op">)</span><span class="pp"> </span><span class="op">:</span><span class="pp"> </span><span class="op">(-(</span>a<span class="op">)))</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> book<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">],</span> book2<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">];</span> <span class="co">// markers</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> G<span class="op">[</span>MAXN <span class="op">*</span> MAXN<span class="op">],</span> G_<span class="op">[</span>MAXN <span class="op">*</span> MAXN<span class="op">];</span> <span class="co">// store the graph of every sub-problem</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">// we use &quot;dir&quot; array to enumerate next step of the horse</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dir<span class="op">[][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">&lt;!--</span>swig￼<span class="dv">0</span><span class="op">--&gt;;</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span> m<span class="op">;</span> <span class="co">// the scale of the problem</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> this struct subq describe what the problem like</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"> * x0, y0 : the position of the upper-left corner of the sub-question</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"> * n, m : the scale of sub-questions</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"> * startx, starty : the first position that the horse stand.</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"> * we always choose the middle of position for the question.</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> subq<span class="op">&#123;</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x0<span class="op">,</span> y0<span class="op">;</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">,</span> m<span class="op">;</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> startx<span class="op">,</span> starty<span class="op">;</span> </span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> this struct choice describe possible choice</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co"> * at one condition</span></span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"> * x, y : the position of the horse now</span></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co"> * possible : possible choice of the horse</span></span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co"> * distance : the distance from the middle position</span></span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"> * dirw : mark the directions</span></span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"> * overload &lt; : for c++ stl priority_queue</span></span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> choice<span class="op">&#123;</span></span><span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> possible<span class="op">,</span> distance<span class="op">,</span> dirw<span class="op">;</span></span><span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span> <span class="op">&lt;</span> <span class="op">(</span><span class="at">const</span> <span class="kw">struct</span> choice <span class="op">&amp;</span>c<span class="op">)</span> <span class="at">const</span><span class="op">&#123;</span></span><span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>possible <span class="op">==</span> c<span class="op">.</span>possible<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>distance <span class="op">==</span> c<span class="op">.</span>distance<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> dirw <span class="op">&gt;</span> c<span class="op">.</span>dirw<span class="op">;</span></span><span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">return</span> distance <span class="op">&lt;</span> c<span class="op">.</span>distance<span class="op">;</span></span><span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">return</span> possible <span class="op">&gt;</span> c<span class="op">.</span>possible<span class="op">;</span></span><span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> A inline function that calcuate the</span></span><span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"> * num of a coodinate(x, y)</span></span><span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> int </span></span><span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> num<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> m <span class="op">*</span> x <span class="op">+</span> y<span class="op">;</span></span><span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> judge whether a coordinate out of the range of problem q</span></span><span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the infomation of sub-question</span></span><span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> true/false</span></span><span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">bool</span> check_in_q<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q<span class="op">.</span>x0 <span class="op">&lt;=</span> x <span class="op">&amp;&amp;</span> x <span class="op">&lt;</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n <span class="op">&amp;&amp;</span> q<span class="op">.</span>y0 <span class="op">&lt;=</span> y <span class="op">&amp;&amp;</span> y <span class="op">&lt;</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> Get the possible choice for one coordinate</span></span><span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the infomation of sub-question</span></span><span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> int </span></span><span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_possible<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> x <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> <span class="va">y_</span> <span class="op">=</span> y <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>check_in_q<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>book<span class="op">[</span><span class="va">x_</span><span class="op">][</span><span class="va">y_</span><span class="op">])</span> <span class="op">&#123;</span></span><span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>            <span class="op">++</span>cnt<span class="op">;</span></span><span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cnt<span class="op">;</span></span><span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> calcuate the distance from the middle position</span></span><span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the infomation of sub-question</span></span><span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> int </span></span><span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_distance<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> abs<span class="op">(</span>x <span class="op">-</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">+</span> abs<span class="op">(</span>y <span class="op">-</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">);</span></span><span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> judge if there is a path from num1 to num2 or num2 to num1</span></span><span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">num1</span><span class="co"> we define that num1 as the number of (num1 / m, num1 % m)</span></span><span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">num2</span><span class="co"> we define that num2 as the number of (num2 / m, num2 % m)</span></span><span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> true/false </span></span><span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> existPath<span class="op">(</span><span class="dt">int</span> num1<span class="op">,</span> <span class="dt">int</span> num2<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> G<span class="op">[</span>num1<span class="op">].</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>G<span class="op">[</span>num1<span class="op">][</span>i<span class="op">]</span> <span class="op">==</span> num2<span class="op">)</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> G<span class="op">[</span>num2<span class="op">].</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>G<span class="op">[</span>num2<span class="op">][</span>i<span class="op">]</span> <span class="op">==</span> num1<span class="op">)</span> <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> find four coordinate that could merge </span></span><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a><span class="co"> * the graph generated by q1, q2</span></span><span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q1</span><span class="co"> sub-question1</span></span><span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q2</span><span class="co"> sub-question2</span></span><span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@return</span><span class="co"> struct subq (now true subq, but a coordinate </span></span><span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a><span class="co"> * and three direction marks to describe four points!)</span></span><span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> subq find_pairs<span class="op">(</span><span class="kw">struct</span> subq q1<span class="op">,</span> <span class="kw">struct</span> subq q2<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> subq ans <span class="op">=</span> <span class="op">&#123;-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">&#125;;</span></span><span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> s1<span class="op">,</span> s2<span class="op">;</span></span><span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    <span class="co">// find where to enumerate.</span></span><span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q1<span class="op">.</span>x0 <span class="op">==</span> q2<span class="op">.</span>x0<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        s2 <span class="op">=</span> q2<span class="op">.</span>y0 <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> s1 <span class="op">=</span> q1<span class="op">.</span>x0<span class="op">;</span></span><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q1<span class="op">.</span>y0 <span class="op">==</span> q2<span class="op">.</span>y0<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        s1 <span class="op">=</span> q2<span class="op">.</span>x0 <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> s2 <span class="op">=</span> q1<span class="op">.</span>y0<span class="op">;</span></span><span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    <span class="co">// using burte force to find four points.</span></span><span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> s1<span class="op">;</span> x <span class="op">&lt;</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">;</span> <span class="op">++</span>x<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> s2<span class="op">;</span> y <span class="op">&lt;</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">;</span> <span class="op">++</span>y<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> x <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> <span class="va">y_</span> <span class="op">=</span> y <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>check_in_q<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q2<span class="op">))</span> <span class="op">&#123;</span></span><span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">int</span> x__ <span class="op">=</span> <span class="va">x_</span> <span class="op">+</span> dir<span class="op">[</span>j<span class="op">][</span><span class="dv">0</span><span class="op">],</span> y__ <span class="op">=</span> <span class="va">y_</span> <span class="op">+</span> dir<span class="op">[</span>j<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>check_in_q<span class="op">(</span>x__<span class="op">,</span> y__<span class="op">,</span> q2<span class="op">)</span> <span class="op">&amp;&amp;</span> existPath<span class="op">(</span>num<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">),</span> num<span class="op">(</span>x__<span class="op">,</span> y__<span class="op">)))</span> <span class="op">&#123;</span></span><span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">int</span> x4 <span class="op">=</span> x__ <span class="op">+</span> dir<span class="op">[</span>k<span class="op">][</span><span class="dv">0</span><span class="op">],</span> y4 <span class="op">=</span> y__ <span class="op">+</span> dir<span class="op">[</span>k<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">(</span>check_in_q<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">,</span> q1<span class="op">)</span> <span class="op">&amp;&amp;</span> existPath<span class="op">(</span>num<span class="op">(</span>x<span class="op">,</span> y<span class="op">),</span> num<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">)))</span> <span class="op">&#123;</span></span><span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">return</span> ans <span class="op">=</span> <span class="op">&#123;</span>x<span class="op">,</span> y<span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">,</span> <span class="dv">0</span><span class="op">&#125;;</span></span><span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#125;</span></span><span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#125;</span></span><span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#125;</span></span><span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> note<span class="op">[</span>MAXN <span class="op">*</span> MAXN<span class="op">];</span> <span class="co">// for function travel only, marking the position.</span></span><span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> travel the circuit and remark the graph</span></span><span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q1</span><span class="co"> sub-question1</span></span><span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q2</span><span class="co"> sub-question2</span></span><span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> travel<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="kw">struct</span> subq q1<span class="op">,</span> <span class="kw">struct</span> subq q2<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> xx <span class="op">=</span> x<span class="op">,</span> yy <span class="op">=</span> y<span class="op">;</span></span><span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>note<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>note<span class="op">));</span></span><span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>    note<span class="op">[</span>num<span class="op">(</span>xx<span class="op">,</span> yy<span class="op">)]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>    book2<span class="op">[</span>xx<span class="op">][</span>yy<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> q1<span class="op">.</span>m <span class="op">*</span> q1<span class="op">.</span>n <span class="op">+</span> q2<span class="op">.</span>m <span class="op">*</span> q2<span class="op">.</span>n<span class="op">;</span></span><span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> cnt <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> cnt <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>cnt<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> xx <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> <span class="va">y_</span> <span class="op">=</span> yy <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>check_in_q<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q1<span class="op">)</span> <span class="op">||</span> check_in_q<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q2<span class="op">))</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>note<span class="op">[</span>num<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">)]</span> </span><span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;&amp;</span> existPath<span class="op">(</span>num<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">),</span> num<span class="op">(</span>xx<span class="op">,</span> yy<span class="op">)))</span> <span class="op">&#123;</span></span><span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>                note<span class="op">[</span>num<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">)]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>                book2<span class="op">[</span><span class="va">x_</span><span class="op">][</span><span class="va">y_</span><span class="op">]</span> <span class="op">=</span> cnt<span class="op">;</span></span><span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>                xx <span class="op">=</span> <span class="va">x_</span><span class="op">,</span> yy <span class="op">=</span> <span class="va">y_</span><span class="op">;</span></span><span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ok <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// check if dfs function find an answer</span></span><span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> using backtracking mothod to solve </span></span><span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a><span class="co"> * problem that 5&lt;= n,m &lt;= 16</span></span><span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">x</span><span class="co"> coodinate x</span></span><span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">y</span><span class="co"> coodinate y</span></span><span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">cnt</span><span class="co"> the points that have been visited</span></span><span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the information of sub-question</span></span><span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> cnt<span class="op">,</span> <span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ok<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span><span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cnt <span class="op">==</span> q<span class="op">.</span>m <span class="op">*</span> q<span class="op">.</span>n <span class="op">&amp;&amp;</span> <span class="op">!</span>ok<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> x <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> <span class="va">y_</span> <span class="op">=</span> y <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>            <span class="co">// check and record the answer</span></span><span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>q<span class="op">.</span>startx <span class="op">==</span> <span class="va">x_</span> <span class="op">&amp;&amp;</span> q<span class="op">.</span>starty <span class="op">==</span> <span class="va">y_</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> q<span class="op">.</span>x0<span class="op">;</span> i <span class="op">&lt;</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> q<span class="op">.</span>y0<span class="op">;</span> j <span class="op">&lt;</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>                        G<span class="op">[</span>num<span class="op">(</span>i<span class="op">,</span> j<span class="op">)]</span> <span class="op">=</span> G_<span class="op">[</span>num<span class="op">(</span>i<span class="op">,</span> j<span class="op">)];</span></span><span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>                        book2<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> book<span class="op">[</span>i<span class="op">][</span>j<span class="op">];</span></span><span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>                G<span class="op">[</span>num<span class="op">(</span>q<span class="op">.</span>startx<span class="op">,</span>q<span class="op">.</span>starty<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>x<span class="op">,</span> y<span class="op">));</span></span><span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>                G<span class="op">[</span>num<span class="op">(</span>x<span class="op">,</span> y<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>q<span class="op">.</span>startx<span class="op">,</span>q<span class="op">.</span>starty<span class="op">));</span></span><span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>                ok <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span><span class="op">;</span></span><span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>    <span class="co">// using stl priority_queue to implement A* method.</span></span><span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>priority_queue<span class="op">&lt;</span>choice<span class="op">&gt;</span> pq<span class="op">;</span></span><span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> <span class="va">x_</span> <span class="op">=</span> x <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">],</span> <span class="va">y_</span> <span class="op">=</span> y <span class="op">+</span> dir<span class="op">[</span>i<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>check_in_q<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>book<span class="op">[</span><span class="va">x_</span><span class="op">][</span><span class="va">y_</span><span class="op">]</span> <span class="op">&amp;&amp;</span> ok <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>            <span class="kw">struct</span> choice c <span class="op">=</span> <span class="op">&#123;</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> get_possible<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q<span class="op">),</span> get_distance<span class="op">(</span><span class="va">x_</span><span class="op">,</span> <span class="va">y_</span><span class="op">,</span> q<span class="op">),</span> i<span class="op">&#125;;</span></span><span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>            pq<span class="op">.</span>push<span class="op">(</span>c<span class="op">);</span></span><span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>    <span class="co">// try to find all possible choice</span></span><span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>pq<span class="op">.</span>empty<span class="op">())</span> <span class="op">&#123;</span></span><span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> choice c <span class="op">=</span> pq<span class="op">.</span>top<span class="op">();</span>pq<span class="op">.</span>pop<span class="op">();</span></span><span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>        book<span class="op">[</span>c<span class="op">.</span>x<span class="op">][</span>c<span class="op">.</span>y<span class="op">]</span> <span class="op">=</span> cnt <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="co">// mark the point as visited</span></span><span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> t <span class="op">=</span> num<span class="op">(</span>x<span class="op">,</span> y<span class="op">),</span> <span class="va">t_</span> <span class="op">=</span> num<span class="op">(</span>c<span class="op">.</span>x<span class="op">,</span> c<span class="op">.</span>y<span class="op">);</span></span><span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>        G_<span class="op">[</span>t<span class="op">].</span>push_back<span class="op">(</span><span class="va">t_</span><span class="op">);</span> <span class="co">// build graph</span></span><span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>        G_<span class="op">[</span><span class="va">t_</span><span class="op">].</span>push_back<span class="op">(</span>t<span class="op">);</span></span><span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>        dfs<span class="op">(</span>c<span class="op">.</span>x<span class="op">,</span> c<span class="op">.</span>y<span class="op">,</span> cnt <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> q<span class="op">);</span></span><span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>        G_<span class="op">[</span>t<span class="op">].</span>pop_back<span class="op">();</span> <span class="co">// !build graph</span></span><span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>        G_<span class="op">[</span><span class="va">t_</span><span class="op">].</span>pop_back<span class="op">();</span></span><span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>        book<span class="op">[</span>c<span class="op">.</span>x<span class="op">][</span>c<span class="op">.</span>y<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// !mark</span></span><span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> print answer finally</span></span><span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the information of the sub-question</span></span><span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Print_Ans<span class="op">(</span><span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> q<span class="op">.</span>x0<span class="op">;</span> i <span class="op">&lt;</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> q<span class="op">.</span>y0<span class="op">;</span> j <span class="op">&lt;</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%6d</span><span class="st">&quot;</span><span class="op">,</span> book2<span class="op">[</span>i<span class="op">][</span>j<span class="op">]);</span></span><span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">);</span></span><span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> solve the problem that 5&lt;= n,m &lt;= 16 using A* dfs method.</span></span><span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the information of the sub-question</span></span><span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> solve<span class="op">(</span><span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">*</span> q<span class="op">.</span>m <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span> <span class="op">||</span> min<span class="op">(</span>q<span class="op">.</span>n<span class="op">,</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">&lt;</span> <span class="dv">5</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;(</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">) No answer!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> q<span class="op">.</span>n<span class="op">,</span> q<span class="op">.</span>m<span class="op">);</span></span><span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">;</span></span><span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>    book<span class="op">[</span>q<span class="op">.</span>startx<span class="op">][</span>q<span class="op">.</span>starty<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>    ok <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>    dfs<span class="op">(</span>q<span class="op">.</span>startx<span class="op">,</span> q<span class="op">.</span>starty<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> q<span class="op">);</span></span><span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>    book<span class="op">[</span>q<span class="op">.</span>startx<span class="op">][</span>q<span class="op">.</span>starty<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> remove element whose value is val from vector v</span></span><span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">v</span><span class="co"> a c++ stl vector</span></span><span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">val</span><span class="co"> the num that should be removed.</span></span><span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> rmv<span class="op">(</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> <span class="op">&amp;</span>v<span class="op">,</span> <span class="dt">int</span> val<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">auto</span> i <span class="op">=</span> v<span class="op">.</span>begin<span class="op">();</span> i <span class="op">&lt;</span> v<span class="op">.</span>end<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(*</span>i <span class="op">==</span> val<span class="op">)</span> v<span class="op">.</span>erase<span class="op">(</span>i<span class="op">);</span></span><span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> merge sub-problems q1, q2</span></span><span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q1</span><span class="co"> the information of the sub-question1</span></span><span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q2</span><span class="co"> the information of the sub-question2</span></span><span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> merge<span class="op">(</span><span class="kw">struct</span> subq q1<span class="op">,</span> <span class="kw">struct</span> subq q2<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> subq ans <span class="op">=</span> find_pairs<span class="op">(</span>q1<span class="op">,</span> q2<span class="op">);</span></span><span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ans<span class="op">.</span>x0 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>        <span class="co">//found nothing is not permitted.</span></span><span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Assert!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;q1 = </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">, q2 = </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> q1<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n<span class="op">,</span> q1<span class="op">.</span>m<span class="op">,</span> q2<span class="op">.</span>x0<span class="op">,</span> q2<span class="op">.</span>y0<span class="op">,</span> q2<span class="op">.</span>n<span class="op">,</span> q2<span class="op">.</span>m<span class="op">);</span></span><span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">(</span>ans<span class="op">.</span>x0 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get four points that could merge</span></span><span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x1 <span class="op">=</span> ans<span class="op">.</span>x0<span class="op">,</span> y1 <span class="op">=</span> ans<span class="op">.</span>y0<span class="op">;</span></span><span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x2 <span class="op">=</span> x1 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>n<span class="op">][</span><span class="dv">0</span><span class="op">],</span> y2 <span class="op">=</span> y1 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>n<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x3 <span class="op">=</span> x2 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>m<span class="op">][</span><span class="dv">0</span><span class="op">],</span> y3 <span class="op">=</span> y2 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>m<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x4 <span class="op">=</span> x3 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>startx<span class="op">][</span><span class="dv">0</span><span class="op">],</span> y4 <span class="op">=</span> y3 <span class="op">+</span> dir<span class="op">[</span>ans<span class="op">.</span>startx<span class="op">][</span><span class="dv">1</span><span class="op">];</span></span><span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>    <span class="co">// merge two discrete graphs and build a new graph</span></span><span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>    rmv<span class="op">(</span>G<span class="op">[</span>num<span class="op">(</span>x1<span class="op">,</span> y1<span class="op">)],</span> num<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">));</span></span><span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>    rmv<span class="op">(</span>G<span class="op">[</span>num<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">)],</span> num<span class="op">(</span>x1<span class="op">,</span> y1<span class="op">));</span></span><span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    rmv<span class="op">(</span>G<span class="op">[</span>num<span class="op">(</span>x2<span class="op">,</span> y2<span class="op">)],</span> num<span class="op">(</span>x3<span class="op">,</span> y3<span class="op">));</span></span><span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>    rmv<span class="op">(</span>G<span class="op">[</span>num<span class="op">(</span>x3<span class="op">,</span> y3<span class="op">)],</span> num<span class="op">(</span>x2<span class="op">,</span> y2<span class="op">));</span></span><span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>    G<span class="op">[</span>num<span class="op">(</span>x2<span class="op">,</span> y2<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>x1<span class="op">,</span> y1<span class="op">));</span>G<span class="op">[</span>num<span class="op">(</span>x1<span class="op">,</span> y1<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>x2<span class="op">,</span> y2<span class="op">));</span></span><span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    G<span class="op">[</span>num<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>x3<span class="op">,</span> y3<span class="op">));</span>G<span class="op">[</span>num<span class="op">(</span>x3<span class="op">,</span> y3<span class="op">)].</span>push_back<span class="op">(</span>num<span class="op">(</span>x4<span class="op">,</span> y4<span class="op">));</span></span><span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    <span class="co">// remark the new graph</span></span><span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    <span class="co">// travel(q1.x0, q1.y0, q1, q2);</span></span><span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@brief</span><span class="co"> use div_conquer method to solve horse circuit problem q</span></span><span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">q</span><span class="co"> the information of the sub-question</span></span><span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> div_conquer<span class="op">(</span><span class="kw">struct</span> subq q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>    <span class="co">// printf(&quot;q = %d %d\n&quot;, q.n, q.m); // for debug use : watch divided sub-questions</span></span><span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="dv">5</span> <span class="op">&lt;=</span> q<span class="op">.</span>n <span class="op">&amp;&amp;</span> q<span class="op">.</span>n <span class="op">&lt;=</span> <span class="dv">16</span> <span class="op">&amp;&amp;</span> <span class="dv">5</span> <span class="op">&lt;=</span> q<span class="op">.</span>m <span class="op">&amp;&amp;</span> q<span class="op">.</span>m <span class="op">&lt;=</span> <span class="dv">16</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>        solve<span class="op">(</span>q<span class="op">);</span></span><span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> subq q1<span class="op">,</span> q2<span class="op">;</span></span><span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>m <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&#123;</span></span><span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">&gt;=</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>m <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&#123;</span></span><span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">&gt;=</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">n_</span><span class="op">;</span></span><span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">%</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>                <span class="va">n_</span> <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="va">n_</span> <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> <span class="va">n_</span><span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0 <span class="op">+</span> <span class="va">n_</span><span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n <span class="op">-</span> <span class="va">n_</span><span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">%</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>                <span class="va">m_</span> <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="va">m_</span> <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0 <span class="op">+</span> <span class="va">m_</span><span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m <span class="op">-</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>m <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">1</span><span class="op">))</span> <span class="op">&#123;</span></span><span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>q<span class="op">.</span>n <span class="op">&gt;=</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">n_</span><span class="op">;</span></span><span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">%</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>                <span class="va">n_</span> <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="va">n_</span> <span class="op">=</span> q<span class="op">.</span>n <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> <span class="va">n_</span><span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0 <span class="op">+</span> <span class="va">n_</span><span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n <span class="op">-</span> <span class="va">n_</span><span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m<span class="op">;</span></span><span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">((</span>q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">)</span> <span class="op">%</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>                <span class="va">m_</span> <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="va">m_</span> <span class="op">=</span> q<span class="op">.</span>m <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q1<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q1<span class="op">.</span>m <span class="op">=</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>            q1<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>x0 <span class="op">+</span> q1<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q1<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q1<span class="op">.</span>y0 <span class="op">+</span> q1<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>x0 <span class="op">=</span> q<span class="op">.</span>x0<span class="op">,</span> q2<span class="op">.</span>y0 <span class="op">=</span> q<span class="op">.</span>y0 <span class="op">+</span> <span class="va">m_</span><span class="op">,</span> q2<span class="op">.</span>n <span class="op">=</span> q<span class="op">.</span>n<span class="op">,</span> q2<span class="op">.</span>m <span class="op">=</span> q<span class="op">.</span>m <span class="op">-</span> <span class="va">m_</span><span class="op">;</span></span><span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>            q2<span class="op">.</span>startx <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>x0 <span class="op">+</span> q2<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> q2<span class="op">.</span>starty <span class="op">=</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> q2<span class="op">.</span>y0 <span class="op">+</span> q2<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Runtime Error. InValid divide! (</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> q<span class="op">.</span>n<span class="op">,</span> q<span class="op">.</span>m<span class="op">);</span></span><span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>        <span class="ot">assert</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>    div_conquer<span class="op">(</span>q1<span class="op">),</span> div_conquer<span class="op">(</span>q2<span class="op">);</span></span><span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>    merge<span class="op">(</span>q1<span class="op">,</span> q2<span class="op">);</span></span><span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a>    travel<span class="op">(</span>q<span class="op">.</span>x0<span class="op">,</span> q<span class="op">.</span>y0<span class="op">,</span> q1<span class="op">,</span> q2<span class="op">);</span></span><span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>    freopen<span class="op">(</span><span class="st">&quot;horse.out&quot;</span><span class="op">,</span> <span class="st">&quot;w&quot;</span><span class="op">,</span> stdout<span class="op">);</span></span><span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>book<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>book<span class="op">));</span></span><span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>note<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>note<span class="op">));</span></span><span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>m<span class="op">);</span></span><span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>    subq q <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> n<span class="op">,</span> m<span class="op">,</span> <span class="op">(</span>q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>x0 <span class="op">+</span> q<span class="op">.</span>n<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> <span class="op">(</span>q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>y0 <span class="op">+</span> q<span class="op">.</span>m<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">&#125;;</span></span><span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clock_t</span> clk0 <span class="op">=</span> clock<span class="op">();</span> <span class="co">// test algorithm running time</span></span><span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>    div_conquer<span class="op">(</span>q<span class="op">);</span></span><span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clock_t</span> clk1 <span class="op">=</span> clock<span class="op">();</span></span><span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>    Print_Ans<span class="op">(</span>q<span class="op">);</span></span><span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Solved in </span><span class="sc">%.3f</span><span class="st"> second(s)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,(</span><span class="dt">double</span><span class="op">)</span> <span class="op">(</span>clk1 <span class="op">-</span> clk0<span class="op">)</span> <span class="op">/</span> CLOCKS_PER_SEC<span class="op">);</span></span><span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p> Parberry I . An Efficient Algorithm for the Knight’s Tour Problem[J]. Discrete Applied Mathematics, 1997, 73(3):251-260.<a href="https://www.fq.math.ca/Scanned/16-3/cull.pdf">Link</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 回溯法 </tag>
            
            <tag> 分治法 </tag>
            
            <tag> 启发式算法 </tag>
            
            <tag> 高性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>求解多机调度问题</title>
      <link href="/2022/04/10/Algorithm/%E6%B1%82%E8%A7%A3%E5%A4%9A%E6%9C%BA%E8%B0%83%E5%BA%A6/"/>
      <url>/2022/04/10/Algorithm/%E6%B1%82%E8%A7%A3%E5%A4%9A%E6%9C%BA%E8%B0%83%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="题目描述">题目描述</h2><p>给定<span class="math inline">\(n\)</span>台相同的机器：<span class="math inline">\(P_j, 1≤j≤n\)</span>,及<span class="math inline">\(m\)</span>个作业：<span class="math inline">\(J_i, 1≤i≤m, J_i\)</span>需时间<span class="math inline">\(t_i\)</span>, 每台机器一次只能执行一个作业，如何分配任务才能尽快完成所有作业？</p><p>换一种说法，将一个作业集划分为不相交的子集<span class="math inline">\({S_1, S_2,..., S_m}\)</span>，使得下面的式子成立： <span class="math display">\[\underset{\{S_1,S_2,\dots,S_m\}}\min {\underset{1\leq j\leq m}\max\underset{k\in S_j}\sum t_k}\]</span></p><h2 id="分析">分析</h2><p>多机调度问题是典型的NP完全问题。如果<span class="math inline">\(m\)</span>的值比较小，可以使用动态规划。但是<span class="math inline">\(m\)</span>值太大，需要的空间就会成指数式的增长。例如下面的双机调度问题，就可以使用（伪）多项式复杂度求解。</p><h3 id="双机调度">双机调度</h3><p>即本题中<span class="math inline">\(m=2\)</span>的情形。设<span class="math inline">\(F[i][j][k]\)</span>为前<span class="math inline">\(i\)</span>个任务已经调度完成，0号机的负载为<span class="math inline">\(j\)</span>，1号机的负载为<span class="math inline">\(k\)</span>时的最优调度时间，我们很容易得到： <span class="math display">\[F[i][j][k]=\min\{F[i-1][j-t_i][k],F[i-1][j][k-t_i]\}+t_i\]</span> 最终答案为<span class="math inline">\(\underset{j,k}{\min}F[n][j][k]\)</span>。这个递推式是很差的，因为我们想要优化的指标就存在于我们递推时枚举的<span class="math inline">\(j,k\)</span>中（<span class="math inline">\(F[i-1][j-t_i][k]\)</span>不就等于<span class="math inline">\(\max\{j-t_i,k\}\)</span>吗），递推式中出现了冗余。</p><p>于是我们将递推式的其中一维作为优化目标，定义新的状态<span class="math inline">\(F[i][j]\)</span>表示前<span class="math inline">\(i\)</span>个任务已经调度完成，0号机的负载为<span class="math inline">\(j\)</span>时，1号机的负载。写出递推式： <span class="math display">\[F[i][j]=\min\{F[i-1][j]+t_i,F[i-1][j-t_i]\}\]</span> 寻找最终答案需要遍历<span class="math inline">\(F[n][j]\)</span>，找到<span class="math inline">\(\min\{\max\{j,F[n][j]\}\}\)</span>。复杂度<span class="math inline">\(O(nT)\)</span>，其中<span class="math inline">\(T=\sum t_k\)</span></p><h3 id="多机调度">多机调度</h3><p>上面的优化只能优化一维。如果<span class="math inline">\(m=100\)</span>，那么要开一个100维的数组，计算<span class="math inline">\(O(nT^m)\)</span>次。。。任何计算机都无法算出如此规模的问题。这样的问题，我们只能使用回溯法，减少信息的存储，用时间来换空间。</p><p>下面给出回溯法的程序实现，回溯法暴力枚举任务所在的机器编号和任务的排列顺序，将可能情况全部遍历，从而找到最优解：</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> task<span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> No<span class="op">,</span> time<span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>t<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> book<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tot<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ans <span class="op">=</span> INF<span class="op">;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> find_max<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> anst <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> x<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        anst <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>anst<span class="op">,</span> tot<span class="op">[</span>i<span class="op">]);</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> anst<span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> v<span class="op">[</span>MAXN<span class="op">],</span> ansv<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> dfs<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> t <span class="op">=</span> find_max<span class="op">(</span>m<span class="op">);</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ans <span class="op">&gt;</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">=</span> t<span class="op">;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                ansv<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> v<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>find_max<span class="op">(</span>m<span class="op">)</span> <span class="op">&gt;=</span> ans<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>book<span class="op">[</span>j<span class="op">]</span> <span class="op">&amp;&amp;</span> tot<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> t<span class="op">[</span>j<span class="op">].</span>time <span class="op">&lt;</span> ans<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                book<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                tot<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> t<span class="op">[</span>j<span class="op">].</span>time<span class="op">;</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                v<span class="op">[</span>i<span class="op">].</span>push_back<span class="op">(</span>t<span class="op">[</span>j<span class="op">].</span>No<span class="op">);</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                dfs<span class="op">(</span>n <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> m<span class="op">);</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                book<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                tot<span class="op">[</span>i<span class="op">]</span> <span class="op">-=</span> t<span class="op">[</span>j<span class="op">].</span>time<span class="op">;</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                v<span class="op">[</span>i<span class="op">].</span>pop_back<span class="op">();</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> solve<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    ans <span class="op">=</span> INF<span class="op">;</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">,</span> m<span class="op">;</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>m<span class="op">);</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        book<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> tot<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        v<span class="op">[</span>i<span class="op">].</span>clear<span class="op">();</span>ansv<span class="op">[</span>i<span class="op">].</span>clear<span class="op">();</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>t<span class="op">[</span>i<span class="op">].</span>time<span class="op">);</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        t<span class="op">[</span>i<span class="op">].</span>No <span class="op">=</span> i<span class="op">;</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    dfs<span class="op">(</span>n<span class="op">,</span> m<span class="op">);</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// printf(&quot;%d\n&quot;, ans);</span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;tot cost = </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">);</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Machine </span><span class="sc">%d</span><span class="st">:&quot;</span><span class="op">,</span> i<span class="op">);</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> ansv<span class="op">[</span>i<span class="op">].</span>size<span class="op">();</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot; </span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> ansv<span class="op">[</span>i<span class="op">][</span>j<span class="op">]);</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        puts<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">);</span></span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>所以我们考虑贪心法近似求解。</p><h2 id="贪心法">贪心法</h2><p>贪心法不能保证一定能找到多机调度问题的全局最优解，但它的效率很高，经过优化后，误差相比全局最优解可以进一步降低。贪心策略比较符合我们的直觉，即让各个机器的任务负载均衡。</p><h3 id="贪心法1负载均衡">贪心法1：负载均衡</h3><ol type="1"><li><p>思想：一个任务到来，选择一个当前负载最小的机器接收此任务。我们使用二叉堆维护当前机器的负载，对于每一个任务，当为这个任务选择机器时，直接选择堆顶的机器即可。这样就可以实现对机器选择过程的优化，使得总时间复杂度是<span class="math inline">\(O(n\log n)\)</span>的。</p></li><li><p>程序实现：</p></li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> machine<span class="op">&#123;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> no<span class="op">,</span> load<span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span> <span class="op">&lt;</span> <span class="op">(</span><span class="at">const</span> <span class="kw">struct</span> machine <span class="op">&amp;</span>ma<span class="op">)</span> <span class="at">const</span><span class="op">&#123;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> load <span class="op">&gt;</span> ma<span class="op">.</span>load<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>mach<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> t<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Load_Balance<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>priority_queue<span class="op">&lt;</span>machine<span class="op">&gt;</span> pq<span class="op">;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> machine mt<span class="op">;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        mt<span class="op">.</span>no <span class="op">=</span> i<span class="op">,</span> mt<span class="op">.</span>load <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        pq<span class="op">.</span>push<span class="op">(</span>mt<span class="op">);</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> machine m <span class="op">=</span> pq<span class="op">.</span>top<span class="op">();</span>pq<span class="op">.</span>pop<span class="op">();</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        m<span class="op">.</span>load <span class="op">+=</span> t<span class="op">[</span>i<span class="op">];</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        pq<span class="op">.</span>push<span class="op">(</span>m<span class="op">);</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>pq<span class="op">.</span>empty<span class="op">())</span> <span class="op">&#123;</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        ans <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>ans<span class="op">,</span> pq<span class="op">.</span>top<span class="op">().</span>load<span class="op">);</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        pq<span class="op">.</span>pop<span class="op">();</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><ol start="3" type="1"><li><p>正确率分析</p><p>本次算法分析，主要分析贪心值与实际值的误差<span class="math inline">\(bias\)</span>。以回溯法求解的正确值为准，计算出相同测试集下每组数据的结果，求出误差值，误差每增大<span class="math inline">\(10\)</span>，就统计<span class="math inline">\([x,x+10)\)</span>之间的样本数量。作出条形统计图和折线统计图。</p><p>其中横轴为求出的值与实际值的偏差，纵轴为偏差在<span class="math inline">\([x,x+10)\)</span>之间的测试样本数量。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/load_sim.png" alt="负载均衡" /></p></li></ol><h3 id="贪心法2递降贪心策略">贪心法2：递降贪心策略</h3><ol type="1"><li><p>思想：首先按处理时长从大到小对作业重新排序，然后运用贪心策略分配任务。时间复杂度仍是<span class="math inline">\(O(n\log n)\)</span>的。</p></li><li><p>代码实现：</p></li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Decrease_Method<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>sort<span class="op">(</span>t <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> n<span class="op">,</span> <span class="bu">std::</span>greater<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;());</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Load_Balance<span class="op">(</span>n<span class="op">,</span> m<span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><ol start="3" type="1"><li><p>正确率分析</p><p>相比于上面的算法，正确率明显提高，平均误差相比负载均衡策略也大幅减小。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/dec_sim.png" alt="递降贪心" /></p></li></ol><h3 id="正确率">正确率</h3><p>固定<span class="math inline">\(m\)</span>，对于变化的<span class="math inline">\(n\)</span>，贪心法求解误差变化图（我们使用正确率更高的贪心法2）如下，我们使用偏差率<span class="math inline">\(\frac{bias}{ 准确值(prec)}\)</span>作为纵轴，<span class="math inline">\(n\)</span>作为横轴：</p><ol type="1"><li><p>当<span class="math inline">\(m=2\)</span>时</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/d_sim_n2.png" alt="m=2" /></p></li><li><p>当<span class="math inline">\(m=4\)</span>时</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/d_sim_n4.png" alt="m=4" /></p></li></ol><p>由于<span class="math inline">\(m\)</span>过大，暴力算法不能求解，所以只能给出最多<span class="math inline">\(m=4, n=12\)</span>的情况。</p><p>经过上面的实验，我们发现，<span class="math inline">\(m=2\)</span>的情况相比于<span class="math inline">\(m=4\)</span>的情况，在<span class="math inline">\(n\)</span>增大时，偏差率接近0的倾向更明显。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 排序 </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 回溯法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单调队列优化动态规划</title>
      <link href="/2022/04/03/Algorithm/MQ%20optimize%20DP/"/>
      <url>/2022/04/03/Algorithm/MQ%20optimize%20DP/</url>
      
        <content type="html"><![CDATA[<h2 id="题目1fence">题目1：Fence</h2><p>题目内容和解答摘自《算法竞赛进阶指南》</p><h3 id="题目背景">题目背景</h3><p>有<span class="math inline">\(N\)</span>块木板从左到右排成一行，有<span class="math inline">\(M\)</span>个工匠对这些木板进行粉刷，每块木板最多被粉刷一次。第<span class="math inline">\(i\)</span>个工匠要么不粉刷，要么粉刷包含木板<span class="math inline">\(S_i\)</span>的，长度不超过<span class="math inline">\(L_i\)</span>的连续的一段木板，每粉刷一块可以得到<span class="math inline">\(P_i\)</span>的报酬。求如何安排能使工匠们获得的总报酬最多。</p><p><a href="http://poj.org/problem?id=1821">提交</a></p><h3 id="数据规模与约定">数据规模与约定</h3><ul><li>对于<span class="math inline">\(100\%\)</span>的数据，<span class="math inline">\(1\leq N\leq 16000\)</span>，<span class="math inline">\(1\leq M\leq 100\)</span>。</li></ul><h2 id="解答1">解答1</h2><h3 id="动态规划思想">动态规划思想</h3><p>先按照<span class="math inline">\(S_i\)</span>排序，这样，每个工匠粉刷的木板一定在上一个工匠粉刷的木板之后，使我们能进行线性动态规划。</p><p>设<span class="math inline">\(F[i,j]\)</span>表示前<span class="math inline">\(i\)</span>个工匠粉刷前<span class="math inline">\(j\)</span>块木板（可以有空着不刷的木板）得到的薪酬最大值。工匠的操作可以分为三种情况：</p><ol type="1"><li>第<span class="math inline">\(i\)</span>个工匠什么也不刷：<span class="math inline">\(F[i,j]=F[i-1,j]\)</span>。</li><li>第<span class="math inline">\(j\)</span>块木板可以空着不刷：<span class="math inline">\(F[i,j]=F[i,j-1]\)</span>。</li><li>第<span class="math inline">\(i\)</span>个工匠粉刷第<span class="math inline">\(k+1\)</span>块到第<span class="math inline">\(j\)</span>块木板，根据题意，有限制条件<span class="math inline">\(j-k\leq L_i\)</span>，<span class="math inline">\(k+1\leq S_i\leq j\)</span>，状态转移方程为：</li></ol><p><span class="math display">\[F[i,j]=\underset{j-L_i\leq k \leq S_i-1,j\geq S_i}\max\{F[i-1,k]+(j-k)\times p_i\}\]</span></p><h3 id="单调队列优化">单调队列优化</h3><p>这个方程是可以继续优化的。首先，在考虑内层循环<span class="math inline">\(j\)</span>以及决策<span class="math inline">\(k\)</span>时，可把外层循环变量<span class="math inline">\(i\)</span>看作定值。这样一来，状态转移方程的各项可分为两部分：</p><ol type="1"><li><span class="math inline">\(P_i \times j\)</span>，除定值<span class="math inline">\(i\)</span>外，只有状态变量<span class="math inline">\(j\)</span>。</li><li><span class="math inline">\(F[i-1,k]-k\times p_i\)</span>，除定值<span class="math inline">\(i\)</span>外，只有决策变量<span class="math inline">\(k\)</span>。</li></ol><p>状态转移方程可改写为： <span class="math display">\[F[i,j]=P_i\times j+\underset{j-L_i\leq k \leq S_i-1}\max\{F[i-1,k]-k\times P_i\}(j\geq S_i)\]</span></p><p>当<span class="math inline">\(j\)</span>增大时，<span class="math inline">\(k\)</span>的取值范围上界<span class="math inline">\(S_{i-1}\)</span>不变，下界<span class="math inline">\(j-L_i\)</span>变大。按照最优子序和问题的想法，我们比较一下任意的决策<span class="math inline">\(k_1,k_2(k_1&lt;k_2\leq S_{i-1})\)</span>。因为<span class="math inline">\(k_2\)</span>比<span class="math inline">\(k_1\)</span>更靠后，所以随着<span class="math inline">\(j\)</span>的增加，<span class="math inline">\(k_1\)</span>相对<span class="math inline">\(k_2\)</span>会被更早排除。如果还满足<span class="math inline">\(F[i-1,k_1]-k_1\times P_i \leq F[i-1,k_2]-k_2\times P_i\)</span>，那么不但认为<span class="math inline">\(k_2\)</span>更优，还比<span class="math inline">\(k_1\)</span>存活时间更长。在这种情况下，<span class="math inline">\(k_1\)</span>就是一个无用的决策，应该直接被排除候选集合。</p><p>综上，我们可以维护一个决策点<span class="math inline">\(k\)</span>单调递增，数值<span class="math inline">\(F[i-1,k]-k\times P_i\)</span>单调递减的<strong>决策</strong>队列。只有这个队列中的决策才有可能在某一时刻成为最优决策。单调队列的具体操作如下：</p><ol type="1"><li>当<span class="math inline">\(j\)</span>变大时，检查队首元素，把小于<span class="math inline">\(j-L_i\)</span>的元素出队。</li><li>队头就是最优的决策。</li><li>有一个新的决策要加入候选集合时，在队尾检查<span class="math inline">\(F[i-1,k]-k\times P_i\)</span>的单调性，把无用决策从队尾直接出队，最后把新决策加入队列。</li></ol><p><strong>在本题中</strong>具体来说，当内层循环开始时，建立一个空的单调队列，把<span class="math inline">\([\max(S_i-L_i,0),S_i-1]\)</span>中的决策依次加入候选集合（操作3）。对于每个<span class="math inline">\(j=S_i,S_{i+1}\dots N\)</span>，进行操作1和2。</p><p>因为每个决策至多入队，出队一次，故状态转移的复杂度均摊为<span class="math inline">\(O(1)\)</span>。总时间复杂度为<span class="math inline">\(O(NM)\)</span>。</p><h3 id="代码实现">代码实现</h3><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> F<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>k<span class="op">]</span> <span class="op">-</span> k <span class="op">*</span> wk<span class="op">[</span>i<span class="op">].</span>Pi<span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">(</span><span class="dt">int</span> m<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> l <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 先把符合递推条件的候选加入队列</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span><span class="dv">0</span><span class="op">,</span> wk<span class="op">[</span>i<span class="op">].</span>Si <span class="op">-</span> wk<span class="op">[</span>i<span class="op">].</span>Li<span class="op">);</span> k <span class="op">&lt;=</span> wk<span class="op">[</span>i<span class="op">].</span>Si <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> func<span class="op">(</span>i<span class="op">,</span> q<span class="op">[</span>r<span class="op">])</span> <span class="op">&lt;=</span> func<span class="op">(</span>i<span class="op">,</span> k<span class="op">))</span> r<span class="op">--;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            q<span class="op">[++</span>r<span class="op">]</span> <span class="op">=</span> k<span class="op">;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> m<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            F<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>F<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">],</span> F<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 进行状态转移</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>j <span class="op">&gt;=</span> wk<span class="op">[</span>i<span class="op">].</span>Si<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> j <span class="op">-</span> q<span class="op">[</span>l<span class="op">]</span> <span class="op">&gt;</span> wk<span class="op">[</span>i<span class="op">].</span>Li<span class="op">)</span> l<span class="op">++;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>l <span class="op">&lt;=</span> r<span class="op">)</span> F<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>F<span class="op">[</span>i<span class="op">][</span>j<span class="op">],</span> func<span class="op">(</span>i<span class="op">,</span> q<span class="op">[</span>l<span class="op">])</span> <span class="op">+</span> j <span class="op">*</span> wk<span class="op">[</span>i<span class="op">].</span>Pi<span class="op">);</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> F<span class="op">[</span>n<span class="op">][</span>m<span class="op">];</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="题目2多重背包">题目2：多重背包</h2><h3 id="题目背景-1">题目背景</h3><p>有<span class="math inline">\(n\)</span>种物品和一个容量为<span class="math inline">\(W\)</span>的背包，每种物品可以选择的数量有限，第<span class="math inline">\(i\)</span>种物品的数量为<span class="math inline">\(m[i]\)</span>，价值为<span class="math inline">\(V[i]\)</span>，体积为<span class="math inline">\(W[i]\)</span>，求解：选哪些物品放入背包，可使得这些物品的价值最大，并且体积总和不超过背包容量。</p><p><a href="https://www.luogu.com.cn/problem/P1776">提交</a></p><h3 id="数据规模与约定-1">数据规模与约定</h3><ul><li>对于<span class="math inline">\(100\%\)</span>的数据，<span class="math inline">\(n\leq \sum m_i \leq 10^5\)</span>，<span class="math inline">\(0\le W\leq 4\times 10^4\)</span>，<span class="math inline">\(1\leq n\le 100\)</span>。</li></ul><h3 id="样例输入">样例输入</h3><pre><code>4 203 9 35 9 19 4 28 1 3</code></pre><h3 id="样例输出">样例输出</h3><pre><code>47</code></pre><h2 id="解答2">解答2</h2><h3 id="动态规划思想-1">动态规划思想</h3><p>多重背包相对完全背包的区别就是每种物品的数量有限，仿照完全背包的思路，定义<span class="math inline">\(f[i][j]\)</span>表示现在已经取过前<span class="math inline">\(i\)</span>件物品，背包已使用<span class="math inline">\(j\)</span>的空间，得到的最大价值，可以写出递推式： <span class="math display">\[F[i][j]=\underset{0\leq k\leq m_i}\max\{F[i-1][j-k\times W[i]]+k\times V[i]\}\]</span> 可以倒序枚举<span class="math inline">\(j\)</span>，这样可以去掉一维： <span class="math display">\[F[j]=\underset{0\leq k\leq m_i}\max\{F[j-k\times W[i]]+k\times V[i]\}\]</span> 上述递推式的时间复杂度都是<span class="math inline">\(O(NWK)\)</span>。不能处理题目要求的的数据范围。</p><h3 id="单调队列优化-1">单调队列优化</h3><p>画出能够转移到状态<span class="math inline">\(j\)</span>（蓝色）和<span class="math inline">\(j-1\)</span>（橙色）的决策候选集合：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/Mqdp1.png" alt="决策候选集合的不重叠性" /></p><p>可以发现，相邻两个状态<span class="math inline">\(i,j\)</span>和<span class="math inline">\(i,j-1\)</span>之间的决策候选没有重叠，很难从<span class="math inline">\(j-1\)</span>对应的集合得到<span class="math inline">\(j\)</span>对应的集合。但是状态<span class="math inline">\(i,j\)</span>和状态<span class="math inline">\(i-1,j-W_i\)</span>是可以转移的。</p><p>这两者对应的决策候选集合之间的关系，与我们前面讲解的单调队列题目非常相似，只有一个新决策加入候选集合，一个已有决策被排除。所以，我们应该把状态<span class="math inline">\(j\)</span>按照除以<span class="math inline">\(W_i\)</span>的余数分组，对每一组分别进行计算，不同组之间的状态在阶段<span class="math inline">\(i\)</span>不会互相转移。</p><p>我们可以考虑对每个余数<span class="math inline">\(u\in[0,W_i-1]\)</span>，枚举<span class="math inline">\(k=[0,1,2,\dots,\lfloor \frac{W-u}{W_i}\rfloor]\)</span>，对应的状态就是<span class="math inline">\(i,j=u+k\times W_i\)</span>。第<span class="math inline">\(i\)</span>种物品只有<span class="math inline">\(m_i\)</span>个，故能转移到<span class="math inline">\(i,u+k\times W_i\)</span>的决策候选集合为<span class="math inline">\(\{i-1,u+p\times W_i|k-m_i\leq p \leq k\}\)</span>，写出状态转移方程： <span class="math display">\[F[i][u+k\times W_i]=\underset{k-m_i\leq p\leq k}\max\{F[i-1][u+p\times W_i]+(k-p)\times V_i\}\]</span> 仿照题目1的思路，将状态转移方程变形为： <span class="math display">\[F[i][u+k\times W_i]=\underset{k-m_i\leq p\leq k}\max\{F[i-1][u+p\times W_i]-p\times V_i+k\times V_i\}\]</span> 建立一个<span class="math inline">\(k\)</span>单调递增，<span class="math inline">\(F[i-1][u+k\times W_i]-k\times V_i\)</span>单调递减的<strong>决策</strong>队列，用于维护候选集合。对于每个<span class="math inline">\(k\)</span>，依次执行单调队列的排除队首，排除队尾，更新答案三个操作。因为我们不需要枚举上述递推式的<span class="math inline">\(p\)</span>了（队首就是让当前转移最优的<span class="math inline">\(p\)</span>），所以算法时间复杂度就降到了<span class="math inline">\(O(NW)\)</span>。</p><h3 id="代码实现1">代码实现1</h3><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> F<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>u <span class="op">+</span> k <span class="op">*</span> w<span class="op">[</span>i<span class="op">]]</span> <span class="op">-</span> k <span class="op">*</span> v<span class="op">[</span>i<span class="op">];</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> W<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> u <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> u <span class="op">&lt;</span> w<span class="op">[</span>i<span class="op">];</span> <span class="op">++</span>u<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> l <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> u <span class="op">+</span> k <span class="op">*</span> w<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;=</span> W<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> k <span class="op">-</span> q<span class="op">[</span>l<span class="op">]</span> <span class="op">&gt;</span> m<span class="op">[</span>i<span class="op">])</span> l<span class="op">++;</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> q<span class="op">[</span>r<span class="op">])</span> <span class="op">&lt;=</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> k<span class="op">))</span> r<span class="op">--;</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                q<span class="op">[++</span>r<span class="op">]</span> <span class="op">=</span> k<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                F<span class="op">[</span>i<span class="op">][</span>u <span class="op">+</span> k <span class="op">*</span> w<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>F<span class="op">[</span>i<span class="op">][</span>u <span class="op">+</span> k <span class="op">*</span> w<span class="op">[</span>i<span class="op">]],</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> q<span class="op">[</span>l<span class="op">])</span> <span class="op">+</span> k <span class="op">*</span> v<span class="op">[</span>i<span class="op">]);</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> F<span class="op">[</span>n<span class="op">][</span>W<span class="op">];</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="维度的压缩">维度的压缩</h3><p>我们可以去掉一维，做法是：把“倒序枚举<span class="math inline">\(j\)</span>”的过程，改为对每个余数<span class="math inline">\(u\in[0,W_i-1]\)</span>，枚举(倒序)<span class="math inline">\(p=[\lfloor \frac{W-u}{W_i}\rfloor,\dots,2,1,0]\)</span>。写出状态转移方程： <span class="math display">\[F[u+p\times W_i]=\underset{p-m_i\leq k\leq p-1}\max\{F[u+k\times W_i]+(p-k)\times V_i\}\]</span> 代码实现方式与上一个有一些不同。实现时注意的细节更多。1和2是单调队列优化DP的两种实现思路，但本质是相同的。</p><h3 id="代码实现2">代码实现2</h3><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> F<span class="op">[</span>u <span class="op">+</span> k <span class="op">*</span> w<span class="op">[</span>i<span class="op">]]</span> <span class="op">-</span> k <span class="op">*</span> v<span class="op">[</span>i<span class="op">];</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> W<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    F<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> u <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> u <span class="op">&lt;</span> w<span class="op">[</span>i<span class="op">];</span> <span class="op">++</span>u<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> l <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> r <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 把最初的候选集合插入队列</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> maxp <span class="op">=</span> <span class="op">(</span>W <span class="op">-</span> u<span class="op">)</span> <span class="op">/</span> w<span class="op">[</span>i<span class="op">];</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> maxp<span class="op">;</span> k <span class="op">&gt;=</span> <span class="bu">std::</span>max<span class="op">(</span><span class="dv">0</span><span class="op">,</span> maxp <span class="op">-</span> m<span class="op">[</span>i<span class="op">]);</span> <span class="op">--</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> q<span class="op">[</span>r<span class="op">])</span> <span class="op">&lt;=</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> k<span class="op">))</span> r<span class="op">--;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                q<span class="op">[++</span>r<span class="op">]</span> <span class="op">=</span> k<span class="op">;</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 进行状态转移</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> p <span class="op">=</span> maxp<span class="op">;</span> p <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> <span class="op">--</span>p<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 排除过时决策</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> q<span class="op">[</span>l<span class="op">]</span> <span class="op">&gt;</span> p <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> l<span class="op">++;</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 进行状态转移</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>l <span class="op">&lt;=</span> r<span class="op">)</span> F<span class="op">[</span>u <span class="op">+</span> p <span class="op">*</span> w<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>F<span class="op">[</span>u <span class="op">+</span> p <span class="op">*</span> w<span class="op">[</span>i<span class="op">]],</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> q<span class="op">[</span>l<span class="op">])</span> <span class="op">+</span> p <span class="op">*</span> v<span class="op">[</span>i<span class="op">]);</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 插入新决策，同时维护队尾单调性</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>p <span class="op">-</span> m<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> q<span class="op">[</span>r<span class="op">])</span> <span class="op">&lt;=</span> func<span class="op">(</span>i<span class="op">,</span> u<span class="op">,</span> p <span class="op">-</span> m<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> <span class="dv">1</span><span class="op">))</span> r<span class="op">--;</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                    q<span class="op">[++</span>r<span class="op">]</span>  <span class="op">=</span> p <span class="op">-</span> m<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> W<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> ans <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>ans<span class="op">,</span> F<span class="op">[</span>i<span class="op">]);</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="总结">总结</h2><ol type="1"><li><p>一定要明确一个概念，<strong>单调队列优化的是决策序列</strong>。决策序列可以是动态更新的，也可以是静态的。需要我们灵活使用单调队列优化。静态的可以采用先构建单调队列，后进行递推，动态的可以边递推边构建。</p></li><li><p>注意及时排除无用的决策，注意队列操作的顺序。</p></li><li><p>使用单调队列，优化可能的决策，可以减少不必要的枚举，提高程序效率。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 背包问题 </tag>
            
            <tag> 多重背包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>隐马尔可夫模型</title>
      <link href="/2022/03/31/machine%20learning/+%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B-Hidden%20Markov/"/>
      <url>/2022/03/31/machine%20learning/+%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B-Hidden%20Markov/</url>
      
        <content type="html"><![CDATA[<h2 id="参数估计">参数估计</h2><h3 id="计算边缘概率">计算边缘概率</h3><p><span class="math display">\[P(\pmb{x}\ |\ \lambda)=\underset{\pmb{y}}{\sum}P(\pmb{y},\pmb{x}\ |\ \lambda)=\underset{\pmb{y}}{\sum}P(\pmb{x}\ |\ \pmb{y},\lambda)\cdot P(\pmb{y}\ |\ \lambda)\tag{1.0}\]</span></p><p>将上式展开，利用齐次Markov假设的性质，可得：</p><p><span class="math display">\[\begin{align*}P(\pmb{y}\ |\ \lambda)&amp;=P(y_1,y_2,\dots,y_n\ |\ \lambda)\\&amp;=P(y_n\ |\ y_1,y_2,\dots,y_{n-1},\lambda)\cdot P(y_1,y_2,\dots,y_{n-1},\lambda)\\&amp;=P(y_n\ |\ y_{n-1})\cdot P(y_1,y_2,\dots,y_{n-1},\lambda)\\&amp;=P(y_n\ |\ y_{n-1}) P(y_{n-1}\ |\ y_{n-2})\cdots P(y_2\ |\ y_1)\pi(y_1)\\&amp;=\pi(y_1)\stackrel{n}{\underset{i=2}{\prod}}P(y_{i}\ |\ y_{i-1})\\&amp;=\pi(a_{i,1})\stackrel{n}{\underset{i=2}{\prod}}a_{i-1,i}\end{align*}\]</span></p><p>同理，利用观测独立性假设的性质，可得： <span class="math display">\[\begin{align*}P(\pmb{x}\ |\ \pmb{y},\lambda)&amp;=P(x_1,x_2,\dots,x_n\ |\ \pmb{y},\lambda)\\&amp;=P(x_n\ |\ x_1,x_2,\dots,x_{n-1},\pmb{y},\lambda)\cdot P(x_1,x_2,\dots,x_{n-1},\pmb{y},\lambda)\\&amp;=P(x_n\ |\ y_n)\cdot P(x_n\ |\ x_1,x_2,\dots,x_{n-1},\pmb{y},\lambda)\\&amp;=\stackrel{n}{\underset{i=1}\prod}P(x_i\ |\ y_i)\\&amp;=\stackrel{n}{\underset{i=1}\prod}b_{y_i,x_i}\end{align*}\]</span> 式(1.0)可化为： <span class="math display">\[\begin{align*}P(\pmb{x}\ |\ \lambda)&amp;=\underset{\pmb{y}}{\sum}\pi(a_{i,1})\stackrel{n}{\underset{i=2}{\prod}}a_{i-1,i}\stackrel{n}{\underset{i=1}\prod}b_{y_i,x_i}\\&amp;=\underset{y_1}{\sum}\underset{y_2}{\sum}\cdots\underset{y_n}{\sum}\pi(a_{i,1})\stackrel{n}{\underset{i=2}{\prod}}a_{i-1,i}\stackrel{n}{\underset{i=1}\prod}b_{y_i,x_i}\end{align*}\]</span> 从上式可以看出，如果要计算<span class="math inline">\(P(\pmb{x},\lambda)\)</span>，需要用边缘概率公式消掉所有的<span class="math inline">\(y_i\)</span>，这个操作的时间复杂度是<span class="math inline">\(O(n^n)\)</span>的，效率低的可怕。我们需要一种更有效的方法。</p><h3 id="前向算法">前向算法</h3><p>前向算法用到的观测变量和隐变量如图所示：</p><p><img src="" /></p><p>令<span class="math inline">\(\alpha_t(i)=P(x_1,x_2,\dots,x_t,y_t=s_i\ |\ \lambda)\)</span>，则： <span class="math display">\[\alpha_n(i)=P(\pmb{x},y_n=s_i\ |\ \lambda)\]</span> <span class="math inline">\(P(\pmb{x}\ |\ \lambda)\)</span>可表示为： <span class="math display">\[P(\pmb{x}\ |\ \lambda)=\stackrel{n}{\underset{i=1}{\sum}}P(\pmb{x},y_n=s_i\ |\ \lambda)=\stackrel{n}{\underset{i=1}{\sum}}\alpha_n(i)\]</span> 下面推导<span class="math inline">\(\alpha_{t+1}\)</span>和<span class="math inline">\(\alpha_t\)</span>之间的关系： <span class="math display">\[\begin{align*}\alpha_{t+1}&amp;=P(x_1,x_2,\dots,x_{t+1},y_{t+1}=s_j\ |\ \lambda)\\&amp;=\stackrel{n}{\underset{i=1}\sum}P(x_1,x_2,\dots,x_{t+1},y_{t+1}=s_j,y_t=s_i\ |\ \lambda)\\&amp;=\stackrel{n}{\underset{i=1}{\sum}}P(x_{t+1}\ |\ x_1,x_2,\dots,x_{t},y_t=s_i,y_{t+1}=s_j)\cdot P(x_1,x_2,\dots,x_{t},y_t=s_i,y_{t+1}=s_j\ |\ \lambda)\\&amp;=\stackrel{n}{\underset{i=1}{\sum}}P(x_{t+1}\ |\ y_{t+1})\cdot P(x_1,x_2,\dots,x_{t},y_t=s_i,y_{t+1}=s_j\ |\ \lambda)\\&amp;=\stackrel{n}{\underset{i=1}{\sum}}b_{x_{t+1},y_{t+1}}\cdot P(y_{t+1}=s_j\ |\ x_1,x_2,\dots,x_{t},y_t=s_i,\lambda)\cdot P(x_1,x_2,\dots,x_{t},y_t=s_i\ |\ \lambda)\\&amp;=\stackrel{n}{\underset{i=1}{\sum}}b_{x_{t+1},y_{t+1}}\cdot P(y_{t+1}=s_j\ |\ y_t=s_i)\cdot \alpha_t(i)\\&amp;=\stackrel{n}{\underset{i=1}{\sum}}b_{x_{t+1},y_{t+1}}\cdot a_{ij} \cdot \alpha_t(i)\end{align*}\]</span> 于是得到了<span class="math inline">\(\alpha_t\)</span>的递推式，这样可以通过迭代的方式简化运算。</p>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 贝叶斯方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随机梯度下降法</title>
      <link href="/2022/03/31/Algorithm/Stochastic%20gradient%20descent/"/>
      <url>/2022/03/31/Algorithm/Stochastic%20gradient%20descent/</url>
      
        <content type="html"><![CDATA[<h2 id="梯度下降法">梯度下降法</h2><h3 id="形象化理解">形象化理解</h3><p>一名经验老道且谨慎的探险家想走到茫茫群山中的一个相对低的位置（不一定是最低的），那么到达这一点最快的方法就是沿着高度下降最快的方向走。走的步子还不能太大，不然就会把最低点错过。</p><h3 id="形式化理解">形式化理解</h3><p>梯度下降法(gradient descent)是一种常用的一阶(first-order)优化方法，是求解无约束优化问题最简单、最经典的方法之一。</p><p>考虑无约束优化问题<span class="math inline">\(\underset{\pmb{x}}\min\ f(\pmb{x})\)</span>其中<span class="math inline">\(f(\pmb{x})\)</span>为连续可微函数。若能构造一个序列<span class="math inline">\(\pmb{x}^0,\pmb{x}^1,\dots\)</span>满足： <span class="math display">\[f(\pmb{x}^{t+1})&lt;f(\pmb{x}^t)\tag{1.0}\]</span> 则不断执行该过程即可收敛到<strong>局部极小点</strong>。欲满足(1.0)，根据泰勒展式有： <span class="math display">\[f(\pmb{x}+\Delta\pmb{x})\simeq f(\pmb{x})+\Delta\pmb{x}^\text{T}\nabla f(\pmb{x})\tag{1.1}\]</span> 于是，欲满足<span class="math inline">\(f(\pmb{x}+\Delta\pmb{x})&lt;f(\pmb{x})\)</span>，可选择： <span class="math display">\[\Delta\pmb{x}=-\gamma\nabla f(\pmb{x})\]</span> 其中步长<span class="math inline">\(\gamma\)</span>为一个小常数，这就是梯度下降法。</p><p>若目标函数<span class="math inline">\(f(\pmb{x})\)</span>满足一些条件，则通过选取合适的步长，就能确保通过梯度下降收敛到局部极小点。</p><p>例如，若<span class="math inline">\(f(\pmb{x})\)</span>满足对于任意<span class="math inline">\(\pmb{x}\)</span>，存在常数<span class="math inline">\(L\)</span>使得<span class="math inline">\(||f(\pmb{x})\leq L||\)</span>成立，则将步长设置为<span class="math inline">\(\frac{1}{2L}\)</span>即可确保收敛到局部极小点。当目标函数为凸函数，局部最小点就是全局最小点，此时梯度下降法能够找到最优解。</p><h3 id="举例">举例</h3><p>感知机模型的损失函数的梯度为： <span class="math display">\[\nabla_{\pmb{w}}L(\pmb{w})=\frac{\partial L(\pmb{w})}{\partial\pmb{w}}=\stackrel{}{\underset{\pmb{x}_i\in M}\sum}(\hat{y}_i-y_i)\pmb{x}_i\]</span> 对感知机模型使用梯度下降算法： <span class="math display">\[\pmb{w}^{(t+1)}\leftarrow \pmb{w}^{(t)}+\Delta \pmb{w} \\\Delta \pmb{w}=-\gamma\nabla_{\pmb{w}}L(\pmb{w})\]</span></p><h3 id="精细化牛顿法">精细化：牛顿法</h3><p>当目标函数二阶连续可微时，可将式(1.1)替换为更精确的二阶泰勒展式，这样就得到了牛顿法。牛顿法使用了二阶导数<span class="math inline">\(\nabla^2 f(\pmb{x})\)</span>，其每轮迭代中涉及到海塞矩阵的求逆，计算复杂度很高。若能以较低代价寻找海塞矩阵的近似逆矩阵，能显著减少开销，这就是拟牛顿法。</p><h2 id="随机梯度下降">随机梯度下降</h2><h3 id="形象化理解-1">形象化理解</h3><p>一个有精神的年轻探险家，他知道只要按照梯度向下走，最后一定会达到谷底，于是每次都随机选择一个梯度向下走。虽然比起上一位走的远而曲折，但比上一位走的快。</p><h3 id="形式化理解-1">形式化理解</h3><p>随机梯度下降主要用来求解类似于如下求和形式的优化问题（这里以感知机为例）：</p><p>感知机模型的损失函数的梯度为： <span class="math display">\[\nabla_{\pmb{w}}L(\pmb{w})=\frac{\partial L(\pmb{w})}{\partial\pmb{w}}=\stackrel{}{\underset{\pmb{x}_i\in M}\sum}(\hat{y}_i-y_i)\pmb{x}_i\]</span> 随机梯度下降的想法就是每次在<span class="math inline">\(\nabla_{\pmb{w}}\)</span>中随机选取一个样本的梯度<span class="math inline">\((\hat{y}_i-y_i)\pmb{x}_i\)</span>代替如上的<span class="math inline">\(\nabla_{\pmb{w}}\)</span>，以这个随机选取的方向作为下降的方向。</p><p>使用随机梯度下降法： <span class="math display">\[w_i\leftarrow w_i+\Delta w_i \\\Delta w_i = -\gamma(\hat{y}_i-y_i)x_i\]</span></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 高等数学 </tag>
            
            <tag> 线性代数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>单调栈和单调队列</title>
      <link href="/2022/03/29/Algorithm/Monotonic%20Stack%20and%20Queue/"/>
      <url>/2022/03/29/Algorithm/Monotonic%20Stack%20and%20Queue/</url>
      
        <content type="html"><![CDATA[<h2 id="单调栈">单调栈</h2><h3 id="定义">定义</h3><p>单调栈（monotonic stack），顾名思义，即满足单调性的栈结构</p><h3 id="伪代码描述">伪代码描述</h3><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>insert x</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">!</span>sta<span class="op">.</span>empty<span class="op">()</span> <span class="op">&amp;&amp;</span> sta<span class="op">.</span>top<span class="op">()&lt;</span>x</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    sta<span class="op">.</span>pop<span class="op">()</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sta<span class="op">.</span>push<span class="op">(</span>x<span class="op">)</span></span></code></pre></div><h3 id="解决的问题">解决的问题</h3><p>定义函数 <span class="math inline">\(f(i)\)</span> 代表数列中第 <span class="math inline">\(i\)</span> 个元素之后第一个大于 <span class="math inline">\(a_{i}\)</span>的元素的下标，即 <span class="math inline">\(f(i)=min_{i&lt;j\leq n, a_{j} &gt; a_{i}}\{j\}\)</span>。若不存在，则 <span class="math inline">\(f(i)=0\)</span>。 给定长度为<span class="math inline">\(n\)</span>的序列，分别求出<span class="math inline">\(f(1),f(2)\dots f(n)\)</span>的值。</p><h3 id="样例输入">样例输入</h3><pre><code>51 4 2 3 5</code></pre><h3 id="样例输出">样例输出</h3><pre><code>2 5 4 5 0</code></pre><h3 id="示例代码">示例代码</h3><p><a href="http://poj.org/problem?id=3250">[USACO06NOV] POJ3250 Bad Hair Day</a></p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN 3000000 + 100</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> num <span class="op">&#123;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> p<span class="op">,</span> val<span class="op">;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>stack<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Print_array<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">1</span><span class="op">)</span>printf<span class="op">(</span><span class="st">&quot;%d&quot;</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]);</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span>printf<span class="op">(</span><span class="st">&quot; %d&quot;</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]);</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ans<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> top <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">,</span> x<span class="op">;</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;%d&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">);</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;%d&quot;</span><span class="op">,</span> <span class="op">&amp;</span>x<span class="op">);</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> num xx <span class="op">=</span> <span class="op">&#123;</span>i<span class="op">,</span> x<span class="op">&#125;;</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>top <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> stack<span class="op">[++</span>top<span class="op">]</span> <span class="op">=</span> xx<span class="op">,</span> ans<span class="op">[</span>stack<span class="op">[</span>top<span class="op">].</span>p<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>top <span class="op">&amp;&amp;</span> xx<span class="op">.</span>val <span class="op">&gt;</span> stack<span class="op">[</span>top<span class="op">].</span>val<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                ans<span class="op">[</span>stack<span class="op">[</span>top<span class="op">].</span>p<span class="op">]</span> <span class="op">=</span> xx<span class="op">.</span>p<span class="op">;</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">--</span>top<span class="op">;</span></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            stack<span class="op">[++</span>top<span class="op">]</span> <span class="op">=</span> xx<span class="op">;</span></span><span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>top<span class="op">--)</span> <span class="op">&#123;</span></span><span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>stack<span class="op">[</span>top<span class="op">].</span>p<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    Print_array<span class="op">(</span>ans<span class="op">,</span> n<span class="op">);</span></span><span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    solve<span class="op">();</span></span><span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="单调队列">单调队列</h2><h3 id="定义-1">定义</h3><p>单调队列（monotonic queue），即内部元素具有单调性的队列。</p><h3 id="例题最大子序和">例题：最大子序和</h3><p>给定一个长度为<span class="math inline">\(N\)</span>的整数序列<span class="math inline">\(a_1,a_2,\dots,a_N\)</span>，从中找出一段长度不超过<span class="math inline">\(M\)</span>的连续子序列，使得子序列中所有数的和最大。其中<span class="math inline">\(0\leq M\leq N\leq 5\times10^5,-500\leq a_i\leq 500\)</span>，且保证答案的绝对值在<span class="math inline">\([0,2^{31}-1]\)</span>之内。</p><p><a href="https://www.luogu.com.cn/problem/P1714">提交</a></p><ul><li>样例输入</li></ul><pre><code>6 31 -2 3 -4 5 -6</code></pre><ul><li>样例输出</li></ul><pre><code>5</code></pre><h3 id="解答1">解答<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h3><p>计算区间和的问题，一般转化为“两个前缀和相减的形式求解。令<span class="math inline">\(S[i]\)</span>表示序列前<span class="math inline">\(i\)</span>项的和，我们要求解的问题可以用数学方式描述为： <span class="math display">\[J=\max\{S[i]-\underset{i-M\leq j\leq i-1}{\min}\ S[j]\}\]</span> 对于这种问题，我们可以使用最直观的方法求解，即枚举每个<span class="math inline">\(i\)</span>，固定<span class="math inline">\(i\)</span>的值后枚举<span class="math inline">\(j &lt; i\)</span>，最后获得<span class="math inline">\(S[i]-S[j]\)</span>的最大值，时间复杂度是<span class="math inline">\(O(NM)\)</span>的。</p><p>但我们发现，在枚举过程中，在已知当前最大值的情况下，有些<span class="math inline">\(i,j\)</span>的出现是无意义的。考虑如下的情况，现有<span class="math inline">\(j&lt;k&lt;i\)</span>，而<span class="math inline">\(S[j]&gt;S[k]\)</span>，那么，<span class="math inline">\(j\)</span>这个位置在<span class="math inline">\(i\)</span>以后的枚举中就可以舍弃掉，因为如果今后枚举到<span class="math inline">\(S[c](i&lt;c\leq N)\)</span>时，<span class="math inline">\(S[c]-S[k]\)</span>一定大于<span class="math inline">\(S[c]-S[j]\)</span>。且<span class="math inline">\(k\)</span>离<span class="math inline">\(c\)</span>更近，<span class="math inline">\(c-k+1\)</span>更不容易超过<span class="math inline">\(m\)</span>。</p><p>总结上面的分析，<strong>可能成为最优选择的策略集合</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>一定是一个<strong>”下标位置递增，对应的前缀和S的值也递增”</strong>的序列。我们可以用一个双端队列保存这个序列。随着右端点从前向后扫描。我们对<span class="math inline">\(i\)</span>进行以下步骤：</p><ol type="1"><li>判断队头决策与<span class="math inline">\(i\)</span>的距离是否超过<span class="math inline">\(M\)</span>，若超出则出队。</li><li>此时队头就是右端点为<span class="math inline">\(i\)</span>时，左端点<span class="math inline">\(j\)</span>的最优选择。</li><li>不断删除队尾决策，直到队尾下标对应的<span class="math inline">\(S\)</span>值小于<span class="math inline">\(S[i]\)</span>。然后把<span class="math inline">\(i\)</span>作为新的决策入队。</li></ol><h3 id="总结">总结</h3><ol type="1"><li><p>本题的难点是对决策单调性的发掘。</p></li><li><p>使用单调队列优化的前提是找出决策序列的单调性。</p></li></ol><h3 id="示例代码-1">示例代码</h3><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    s<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> s<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">+</span> a<span class="op">[</span>i<span class="op">];</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> l <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> r <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> ans <span class="op">=</span> <span class="op">-</span>INF<span class="op">;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    q<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> i <span class="op">-</span> q<span class="op">[</span>l<span class="op">]</span> <span class="op">&gt;</span> m<span class="op">)</span> l<span class="op">++;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        ans <span class="op">=</span> max<span class="op">(</span>ans<span class="op">,</span> s<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> s<span class="op">[</span>q<span class="op">[</span>l<span class="op">]]);</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>l <span class="op">&lt;=</span> r <span class="op">&amp;&amp;</span> s<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;=</span> s<span class="op">[</span>q<span class="op">[</span>r<span class="op">]])</span> r<span class="op">--;</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        q<span class="op">[++</span>r<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="总结-1">总结</h2><p>单调栈和单调队列的本质，是借助单调性，及时排除不可能的决策，保持候选集合的高度有效性和秩序性。<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>参考资料：《算法竞赛进阶指南》<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>一个有点拗口的概念，它是单调队列优化的目标。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>参考资料：《算法竞赛进阶指南》<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> stack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>完全背包</title>
      <link href="/2022/03/28/Algorithm/Luogu.org.P1616/"/>
      <url>/2022/03/28/Algorithm/Luogu.org.P1616/</url>
      
        <content type="html"><![CDATA[<h2 id="题目完全背包">题目：完全背包</h2><h3 id="题目背景">题目背景</h3><p>有<span class="math inline">\(n\)</span>种物品和一个容量为<span class="math inline">\(W\)</span>的背包，每种物品都就可以选择任意多个，第<span class="math inline">\(i\)</span>种物品的价值为<span class="math inline">\(V[i]\)</span>，体积为<span class="math inline">\(W[i]\)</span>，求解：选哪些物品放入背包，可使得这些物品的价值最大，并且体积总和不超过背包容量。</p><p><a href="https://www.luogu.com.cn/problem/P1616">提交链接</a></p><h3 id="数据规模与约定">数据规模与约定</h3><ul><li>对于<span class="math inline">\(100\%\)</span>的数据，保证<span class="math inline">\(1 \leq m \le 10^4\)</span>，<span class="math inline">\(1 \leq t \leq 10^7\)</span>，且<span class="math inline">\(1 \leq m \times t \leq 10^7\)</span>，<span class="math inline">\(1 \leq a_i, b_i \leq 10^4\)</span>。</li></ul><h3 id="样例输入">样例输入</h3><pre><code>70 371 10069 11 2</code></pre><h3 id="样例输出">样例输出</h3><pre><code>140</code></pre><h2 id="解答">解答</h2><p>完全背包问题与01背包问题一样，需要两个维度来描述当前状态，一是现在已经取过哪些物品，二是现在背包还剩下多少空间。</p><p>定义<span class="math inline">\(f[i][j]\)</span>表示现在已经取过前<span class="math inline">\(i\)</span>件物品，背包已使用<span class="math inline">\(j\)</span>的空间，得到的最大价值，则状态转移方程可写为： <span class="math display">\[f[i][j]=\max\{f[i-1][j-k\times W[i]]+k\times V[i]\}\\(0\leq k\leq \lfloor\frac{j}{W[i]}\rfloor)\tag{1.0}\]</span> 式(1.0)与下面的式子等价（等价的条件是<span class="math inline">\(j\)</span>要按从小到大的顺序枚举）（另外，这个式子是更新公式，所以<span class="math inline">\(f[i][j]\)</span>要一直在<span class="math inline">\(\max\)</span>中）： <span class="math display">\[f[i][j]=\max\{f[i][j],f[i-1][j],f[i][j-k\times W[i]]+k\times V[i]\}\\(0\leq k\leq \lfloor\frac{j}{W[i]}\rfloor)\tag{1.1}\]</span> 上面的方程，时间复杂度为<span class="math inline">\(O(kmt)\)</span>，空间复杂度为<span class="math inline">\(O(mt)\)</span>。其实上面的方程可以进行优化，我们仔细观察递推式(1.1)与(1.2)： <span class="math display">\[f[i][j-W[i]]=\max\{f[i][j-W[i]],f[i][j-k\times W[i]]+k\times V[i]\}\\(1\leq k\leq \lfloor\frac{j}{W[i]}\rfloor)\tag{1.2}\]</span> 我们发现，其实计算<span class="math inline">\(f[i][j-W[i]]\)</span>时，就已经计算了<span class="math inline">\(1\leq k\leq \lfloor\frac{j}{W[i]}\rfloor\)</span>的情况。所以为了避免计算的冗余，我们可以简化递推式，简化得到的递推式如下： <span class="math display">\[f[i][j]=\max\{f[i][j],f[i-1][j],f[i][j-W[i]]+V[i]\}\tag{1.3}\]</span> 时间复杂度降为了<span class="math inline">\(O(mt)\)</span>，空间复杂度不变。</p><p>因为这个问题是背包的变形，所以它和背包一样，状态只依赖上一个状态和它当前状态已经算过的值，所以可以进行空间的压缩。压缩掉第一维后，空间复杂度降为<span class="math inline">\(O(t)\)</span>。</p><p>下面的代码中，solve1是上述递推式的直观表达，solve2是solve1的空间压缩优化，solve3是空间压缩后的动态规划过程。</p><h3 id="代码实现">代码实现</h3><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define max </span><span class="bu">std::</span>max</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="op">(</span><span class="dv">1000</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">10</span><span class="op">)</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">long</span> LL<span class="op">;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// int cnt = 0;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> obj<span class="op">&#123;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    LL v<span class="op">,</span> w<span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>a<span class="op">[</span>MAXN <span class="op">*</span> <span class="dv">10</span><span class="op">];</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>LL f<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">];</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>LL solve1<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> W<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    LL res <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;=</span> W<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> j <span class="op">/</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>a<span class="op">[</span>i<span class="op">].</span>w<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">],</span> f<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]);</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">],</span> f<span class="op">[</span>i<span class="op">][</span>j <span class="op">-</span> <span class="op">(</span>LL<span class="op">)</span>k <span class="op">*</span> a<span class="op">[</span>i<span class="op">].</span>w<span class="op">]</span> <span class="op">+</span> <span class="op">(</span>LL<span class="op">)</span>k <span class="op">*</span> a<span class="op">[</span>i<span class="op">].</span>v<span class="op">);</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">//++cnt;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f<span class="op">[</span>n<span class="op">][</span>W<span class="op">];</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>LL dp<span class="op">[</span>MAXN <span class="op">*</span> <span class="dv">10000</span><span class="op">];</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>LL solve2<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> W<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    LL res <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;=</span> W<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;=</span> j <span class="op">/</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>a<span class="op">[</span>i<span class="op">].</span>w<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ++cnt;</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                dp<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span>dp<span class="op">[</span>j<span class="op">],</span> dp<span class="op">[</span>j <span class="op">-</span> <span class="op">(</span>LL<span class="op">)</span>k <span class="op">*</span> a<span class="op">[</span>i<span class="op">].</span>w<span class="op">]</span> <span class="op">+</span> <span class="op">(</span>LL<span class="op">)</span>k <span class="op">*</span> a<span class="op">[</span>i<span class="op">].</span>v<span class="op">);</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dp<span class="op">[</span>W<span class="op">];</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>LL solve3<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> W<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> a<span class="op">[</span>i<span class="op">].</span>w<span class="op">;</span> j <span class="op">&lt;=</span> W<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            dp<span class="op">[</span>j<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span>dp<span class="op">[</span>j<span class="op">],</span> <span class="op">(</span>LL<span class="op">)</span>dp<span class="op">[</span>j <span class="op">-</span> a<span class="op">[</span>i<span class="op">].</span>w<span class="op">]</span> <span class="op">+</span> a<span class="op">[</span>i<span class="op">].</span>v<span class="op">);</span></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ++cnt;</span></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dp<span class="op">[</span>W<span class="op">];</span></span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率">运行效率</h3><ol type="1"><li><p>solve1</p><p>由于内存空间的限制，部分问题不能正确求解，例如数据5。</p><p>如果统计查表次数，直接将计数器写在循环里即可。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/p1616-solve1.png" alt="solve1的效率" /></p></li><li><p>solve2</p><p>由于时间复杂度较高，面对较大数据时无法在规定时间内求解。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/p1616-solve2.png" alt="solve2的效率" /></p></li><li><p>solve3</p><p>时间复杂度和空间复杂度均符合要求。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/p1616-solve3.png" alt="solve3的效率" /></p></li></ol><h2 id="总结">总结</h2><p>本题中，时间复杂度的减少，空间复杂度的减少，都是通过对原始递推式的等价变换实现的。对原始递推式的变换可以大大优化时空复杂度。<strong>变换递推式</strong>是动态规划的优化方法之一。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 完全背包 </tag>
            
            <tag> 背包问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>USACO 垃圾陷阱</title>
      <link href="/2022/03/27/Algorithm/Luogu.org.P1156/"/>
      <url>/2022/03/27/Algorithm/Luogu.org.P1156/</url>
      
        <content type="html"><![CDATA[<h2 id="题目">题目</h2><p>卡门――农夫约翰极其珍视的一条<code>Holsteins</code>奶牛――已经落了到“垃圾井”中。“垃圾井”是农夫们扔垃圾的地方，它的深度为<span class="math inline">\(D(2 \leq D \leq 100)\)</span>英尺。</p><p>卡门想把垃圾堆起来，等到堆得与井同样高时，她就能逃出井外了。另外，卡门可以通过吃一些垃圾来维持自己的生命。</p><p>每个垃圾都可以用来吃或堆放，并且堆放垃圾不用花费卡门的时间。</p><p>假设卡门预先知道了每个垃圾扔下的时间<span class="math inline">\(t(0&lt; t \leq 1000)\)</span>，以及每个垃圾堆放的高度<span class="math inline">\(h(1 \le h \le 25\)</span>和吃进该垃圾能维持生命的时间<span class="math inline">\(f(1 \le f \le 30)\)</span>，要求出卡门最早能逃出井外的时间，假设卡门当前体内有足够持续<span class="math inline">\(10\)</span>小时的能量，如果卡门<span class="math inline">\(10\)</span>小时内没有进食，卡门就将饿死。</p><p>如果卡门可以爬出陷阱，输出一个整表示最早什么时候可以爬出；否则输出卡门最长可以存活多长时间。</p><h2 id="一个错误的思考方向">一个错误的思考方向</h2><p>令<span class="math inline">\(f[i][j]\)</span>表示前<span class="math inline">\(i\)</span>个垃圾已经扔下，现在的能量为<span class="math inline">\(j\)</span>时垒起的最大高度。则递推方程可写为： <span class="math display">\[f[i][j] = \max\{f[i - 1][j - g[i].l],f[i - 1][j + t] + g[i].h\}\]</span></p><p>这个递推方程虽然正确，但是<strong>不收敛</strong>！每次计算都需要一个上一次计算结果中一个小于<span class="math inline">\(j\)</span>的值，和一个大于<span class="math inline">\(j\)</span>的值，导致状态必须计算到无穷大。（可能计算到无穷大都不够用）</p><p>不收敛的状态的一种形式如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/unlimited%20status.png" alt="不收敛的状态定义" /></p><h2 id="状态的选择">状态的选择</h2><p>既然将时间作为状态第二维得到的状态不收敛，那么，我们需要选择一个收敛的状态，什么是收敛的状态呢？</p><h3 id="收敛的状态">收敛的状态</h3><p>收敛的状态，不能在表中产生分叉的递推转移。如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/limited%20status.png" alt="收敛的状态" /></p><p>对应的，刷表法没有状态收敛不收敛的问题。</p><h3 id="另一种状态定义方式">另一种状态定义方式</h3><p>令<span class="math inline">\(f[i][j]\)</span>表示前<span class="math inline">\(i\)</span>个垃圾已经扔下，垒起的高度为<span class="math inline">\(j\)</span>时最长能维持生命到哪一时刻。则递推方程可写为： <span class="math display">\[f[i][j] = \max\{f[i-1][j-g[i].h],f[i-1][j]+g[i].l\}\]</span></p><p>这个方程没有收敛性的问题，可以进行编程求解了。注意递推时的细节，例如初始值，边界条件，转移条件等。</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="co"> </span><span class="cv">ZeroOneknapsack.cc</span><span class="co"> P1156 垃圾陷阱</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Redleaves699 (Algorithm_sort</span><span class="an">@163.com)</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@copyright</span><span class="co"> </span><span class="do">Copyright</span><span class="co"> </span><span class="do">(c)</span><span class="co"> </span><span class="do">2022</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">100</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">10</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> f<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">];</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> g<span class="op">&#123;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> t<span class="op">,</span> l<span class="op">,</span> h<span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>g<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> cmp<span class="op">(</span><span class="kw">struct</span> g a<span class="op">,</span> <span class="kw">struct</span> g b<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a<span class="op">.</span>t <span class="op">&lt;</span> b<span class="op">.</span>t<span class="op">;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> D<span class="op">,</span> n<span class="op">;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>D<span class="op">,</span> <span class="op">&amp;</span>n<span class="op">);</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>g<span class="op">[</span>i<span class="op">].</span>t<span class="op">,</span> <span class="op">&amp;</span>g<span class="op">[</span>i<span class="op">].</span>l<span class="op">,</span> <span class="op">&amp;</span>g<span class="op">[</span>i<span class="op">].</span>h<span class="op">);</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>f<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>f<span class="op">));</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>sort<span class="op">(</span>g <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> g <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> n<span class="op">,</span> cmp<span class="op">);</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    f<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span><span class="co">// 初始值</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;=</span> D<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>j <span class="op">&gt;=</span> g<span class="op">[</span>i<span class="op">].</span>h <span class="op">&amp;&amp;</span> f<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> g<span class="op">[</span>i<span class="op">].</span>h<span class="op">]</span> <span class="op">&gt;=</span> g<span class="op">[</span>i<span class="op">].</span>t<span class="op">)</span> <span class="co">// 转移条件</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">],</span> f<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> g<span class="op">[</span>i<span class="op">].</span>h<span class="op">]);</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>f<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> <span class="op">&gt;=</span> g<span class="op">[</span>i<span class="op">].</span>t<span class="op">)</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">],</span> f<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j<span class="op">]</span> <span class="op">+</span> g<span class="op">[</span>i<span class="op">].</span>l<span class="op">);</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> maxh <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> maxt <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> i<span class="op">;</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> t <span class="op">=</span> g<span class="op">[</span>i<span class="op">].</span>t <span class="op">-</span> g<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">].</span>t<span class="op">;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;=</span> D<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">&gt;=</span> g<span class="op">[</span>i<span class="op">].</span>t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                maxh <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>maxh<span class="op">,</span> j<span class="op">);</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            maxt <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>maxt<span class="op">,</span> f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]);</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>maxh <span class="op">==</span> D<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> maxh <span class="op">==</span> D <span class="op">?</span> g<span class="op">[</span>i<span class="op">].</span>t <span class="op">:</span> maxt<span class="op">;</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> solve<span class="op">());</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2018 </tag>
            
            <tag> USACO </tag>
            
            <tag> 动态规划 </tag>
            
            <tag> 01背包 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贝叶斯概率</title>
      <link href="/2022/03/26/math/%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A6%82%E7%8E%87/"/>
      <url>/2022/03/26/math/%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A6%82%E7%8E%87/</url>
      
        <content type="html"><![CDATA[<h2 id="概率公式">概率公式</h2><h3 id="概率计算基本法则">概率计算基本法则</h3><p>随机变量<span class="math inline">\(\pmb{X}\)</span>是<span class="math inline">\(d\)</span>维随机变量。</p><ol type="1"><li><p>加法法则： <span class="math display">\[P(\pmb{X}\textbackslash x_i)=\int P(\pmb{X})dx_i\]</span></p></li><li><p>乘法法则： <span class="math display">\[P(x_1,x_2)=P(x_1\ |\ x_2)P(x_2)=P(x_2\ |\ x_1)P(x_1)\]</span></p></li></ol><h3 id="概念">概念</h3><ol type="1"><li><p>边缘概率，注意在离散情况下，积分符号应为求和符号，本质上讲，积分号和求和号意义是相同的。 <span class="math display">\[P(x_i)=\int_{x_d}\dots\int_{x_{i+1}}\int_{x_{i-1}}\dots\int_{x_2}\int_{x_1} P(\pmb{X})d(x_1)d(x_2)\dots,d(x_{i-1})d(x_{i+1},)\dots,d(x_d)\]</span></p></li><li><p>条件概率 <span class="math display">\[P(x_i\ |\ x_j)\]</span></p></li></ol><h3 id="概率计算推论">概率计算推论</h3><ol type="1"><li><p>链式法则： <span class="math display">\[P(\pmb{X})=P(x_1)\stackrel{d}{\underset{i=2}{\prod}}P(x_i\ |\ x_1,x_2,\dots,x_{i-1})\]</span></p></li><li><p>贝叶斯公式： <span class="math display">\[P(x_2\ |\ x_1)=\frac{P(x_1,x_2)}{P(x_1)}=\frac{P(x_1\ |\ x_2)P(x_2)}{\int P(x_1,x_2)dx_2}\]</span></p></li></ol><h2 id="最大后验概率估计map">最大后验概率估计（MAP）</h2><p><span class="math display">\[\hat{x}_A=\underset{x_A}{\arg\max}\ P(x_A\ |\ x_B)=\underset{x_A}{\arg\max}\ P(x_A,x_B)\]</span></p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 概率论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 矩阵论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOIP2018-J 摆渡车</title>
      <link href="/2022/03/22/Algorithm/Luogu.org.P5017/"/>
      <url>/2022/03/22/Algorithm/Luogu.org.P5017/</url>
      
        <content type="html"><![CDATA[<h2 id="题目描述">题目描述</h2><p><a href="https://www.luogu.com.cn/problem/P5017">P5017 [NOIP2018 普及组] 摆渡车</a></p><p>有<span class="math inline">\(n\)</span>名同学要乘坐摆渡车从A前往B，第<span class="math inline">\(i\)</span>位同学在第<span class="math inline">\(t_i\)</span>分钟去等车。只有一辆摆渡车在工作，但摆渡车容量可以视为无限大。摆渡车从A出发、 把车上的同学送到B、再回到A（去接其他同学），这样往返一趟总共花费<span class="math inline">\(m\)</span>分钟（同学上下车时间忽略不计）。摆渡车要将所有同学都送到B。</p><p>如果任意安排摆渡车出发的时间，那么这些同学的等车时间之和最小为多少？</p><p>注意：摆渡车回到A后可以即刻出发。</p><h2 id="思想方法">思想方法</h2><p>发现此问题可以通过搜索解决，摆渡车每运行一趟，就将编号为<span class="math inline">\(i, i+1,\dots,k-1,k(i\leq k \leq n)\)</span>的人运走，然后就得到了下一次应该运走编号为<span class="math inline">\(k+1,k+2,\dots,k&#39;\)</span>的子问题。所以我们将状态定义为<span class="math inline">\(f(i, T)\)</span>，分别表示当前等车的第一个人的编号为<span class="math inline">\(i\)</span>，第<span class="math inline">\(i\)</span>个人等车的时刻为<span class="math inline">\(T\)</span>。根据上面的定义，搜索的状态转移如下（要提前对<span class="math inline">\(t\)</span>数组排好序！<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>）： <span class="math display">\[f(i,T)=\underset{i\leq k\leq n}{\max}\begin{cases}f(k+1, t[k+1])+\stackrel{k}{\underset{a=i}\sum}(t[k]-t[a])\ \  \textbf{if}\ \ T+m\leq t[k]\cdots\cdots1\\ f(k+1, T+m)+\stackrel{k}{\underset{a=i}\sum}(T+m-t[a])\ \ \textbf{if}\ \ t[k]\leq T+m\leq t[k+1]\cdots\cdots2\end{cases}\]</span> 边缘状态为： <span class="math display">\[f(n+1,?)=0\]</span> 上述转移方程1中<span class="math inline">\(T+m\leq t[k]\)</span>的条件，表示车在第<span class="math inline">\(k\)</span>个人到来之前到达，转移方程1对应车回来不立即出发，而是等待下面的人到来之后才出发的情况。转移方程2的条件<span class="math inline">\(t[k]\leq T+m\leq t[k+1]\)</span>，表示车在第<span class="math inline">\(k,k+1\)</span>个人到来时间的中间到达，转移方程2对应车回来就立刻运走编号为<span class="math inline">\(i\sim k\)</span>的人情况。如果车在第<span class="math inline">\(k\)</span>个人之后到达，那么此时状态不能转移。</p><p>但如果对以上的状态转移采用记忆化搜索方法，时间复杂度和空间复杂度都不允许。观察上面的递推式，我们发现第二维的时间是事情发展的绝对时间，绝对时间之间可能有很大的间隔。这样的必然会浪费大量的空间，产生冗余。设计高效算法，就是尽量少的减少冗余。所以考虑能否尽量压缩时间这一维。</p><h2 id="改进方法">改进方法</h2><p>我们仔细思考一下时间这一维的用处，它只是用来判断<strong>当前的时刻车是否到达</strong>。判断车是否到达，不一定要依赖绝对时间。我们只需要知道子问题中，车还有多长时间到达A即可。所以我们定义新的状态<span class="math inline">\(f(i, T)\)</span>，<span class="math inline">\(i\)</span>是当前等车的第一个人（意义不变），<span class="math inline">\(T\)</span>为第<span class="math inline">\(i\)</span>个等车人还要等多长时间车才会来。因为<span class="math inline">\(0\leq T \leq m\)</span>，所以时间这一维占用的内存就大大减少了。</p><p>状态转移方程如下： <span class="math display">\[f(i,T)=\begin{cases}f(k+1, \max(0, t[k] + m - t[k + 1]))+\stackrel{k}{\underset{a=i}\sum}(t[k]-t[a])\ \  \textbf{if}\ \ t[k] \geq t[i] + T\cdots\cdots1\\ f(k+1, \max(0, m + t[i] + T - t[k + 1]))+\stackrel{k}{\underset{a=i}\sum}(T+m-t[a])\ \ \textbf{if}\ \ t[k] \leq t[i] + T \leq t[k + 1]\cdots\cdots2\end{cases}\]</span> 边缘状态为： <span class="math display">\[f(n+1,?)=0\]</span> 注意，我们可以用前缀和的方法优化式子中的求和公式，使状态转移过程降至<span class="math inline">\(O(1)\)</span>。具体方法是将原式中的求和符号展开。这时就可以实现下面的记忆化搜索代码了。经过了上面的分析，写代码的工作会变得很容易。</p><h2 id="代码实现">代码实现</h2><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span><span class="co"> Redleaves</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@version</span><span class="co"> 1.0</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@date</span><span class="co"> 2022-03-21</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@copyright</span><span class="co"> </span><span class="do">Copyright</span><span class="co"> </span><span class="do">(c)</span><span class="co"> </span><span class="do">2022</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"> *</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN </span><span class="dv">1000</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">10</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="pp">#define INF </span><span class="dv">99999999</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define min </span><span class="bu">std::</span>min</span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#define max </span><span class="bu">std::</span>max</span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> t<span class="op">[</span>MAXN<span class="op">],</span> f<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">],</span> sum<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">,</span> m<span class="op">;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dfs<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> T<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>T<span class="op">]</span> <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> f<span class="op">[</span>i<span class="op">][</span>T<span class="op">];</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">&gt;=</span> n <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ans <span class="op">=</span> INF<span class="op">,</span> r<span class="op">;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> i<span class="op">;</span> k <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>t<span class="op">[</span>k<span class="op">]</span> <span class="op">&lt;=</span> t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T <span class="op">&amp;&amp;</span> t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T <span class="op">&lt;=</span> t<span class="op">[</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">])&#123;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Transport everyone that is at the platform as soon as the bus arrive.</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> waitfor <span class="op">=</span> max<span class="op">(</span><span class="dv">0</span><span class="op">,</span> m <span class="op">+</span> t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T <span class="op">-</span> t<span class="op">[</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">=</span> min<span class="op">(</span>ans<span class="op">,</span> <span class="op">(</span>k <span class="op">-</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T<span class="op">)</span> <span class="op">-</span> sum<span class="op">[</span>k<span class="op">]</span> <span class="op">+</span> sum<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">+</span> dfs<span class="op">(</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> waitfor<span class="op">));</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>t<span class="op">[</span>k<span class="op">]</span> <span class="op">&lt;</span> t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T<span class="op">)</span> <span class="cf">continue</span><span class="op">;</span> <span class="co">// You can&#39;t transport anyone before the bus arrive.</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>t<span class="op">[</span>k<span class="op">]</span> <span class="op">&gt;=</span> t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> T<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">// The bus has arrived when the k th. person arrives at the platform.</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> waitfor <span class="op">=</span> max<span class="op">(</span><span class="dv">0</span><span class="op">,</span> t<span class="op">[</span>k<span class="op">]</span> <span class="op">+</span> m <span class="op">-</span> t<span class="op">[</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span> <span class="co">// The time that k+1 th. person need to wait for.</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">=</span> min<span class="op">(</span>ans<span class="op">,</span> <span class="op">(</span>k <span class="op">-</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> t<span class="op">[</span>k<span class="op">]</span> <span class="op">-</span> <span class="op">(</span>sum<span class="op">[</span>k<span class="op">]</span> <span class="op">-</span> sum<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">])</span> <span class="op">+</span> dfs<span class="op">(</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> waitfor<span class="op">));</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f<span class="op">[</span>i<span class="op">][</span>T<span class="op">]</span> <span class="op">=</span> ans<span class="op">;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>f<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>f<span class="op">));</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    sum<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>m<span class="op">);</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>t<span class="op">[</span>i<span class="op">]);</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>sort<span class="op">(</span>t <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> t <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> n<span class="op">);</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        sum<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> sum<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">+</span> t<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>t<span class="op">[</span>n <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> INF<span class="op">;</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> dfs<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>时间是线性流逝的变量，对时间排序是一个非常自然且非常常用的处理方式<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NOIP-J </tag>
            
            <tag> 2018 </tag>
            
            <tag> 动态规划 </tag>
            
            <tag> 线性规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>感知机</title>
      <link href="/2022/03/19/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B4/"/>
      <url>/2022/03/19/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B4/</url>
      
        <content type="html"><![CDATA[<h2 id="思想">思想</h2><p>错误驱动学习</p><h2 id="模型">模型</h2><p><span class="math display">\[y=\text{sgn}(\pmb{w}^T\pmb{x}-\theta)=\begin{cases}1,\ \ \pmb{w}^T\pmb{x}-\theta\geq0\\0,\ \ \pmb{w}^T\pmb{x}-\theta&lt;0\end{cases},\pmb{x}\in \mathbb{R}^d,\pmb{w}\in\mathbb{R}^d\]</span></p><h2 id="学习策略">学习策略</h2><p>先构造并分析损失函数。随机初始化<span class="math inline">\(\pmb{w},b\)</span>，将全体训练样本带入模型找出误分类样本，假设此时误分类样本集合为<span class="math inline">\(M \subseteq T\)</span>，对任意一个误分类样本<span class="math inline">\((\pmb{x},y)\in M\)</span>，当<span class="math inline">\(\pmb{w}^T\pmb{x}-\theta\geq0\)</span>时，模型输出<span class="math inline">\(\hat{y}=1\)</span>，样本真实标记为<span class="math inline">\(y=0\)</span>；反之，当<span class="math inline">\(\pmb{w}^T\pmb{x}-\theta&lt;0\)</span>时，模型输出<span class="math inline">\(\hat{y}=0\)</span>，样本真实标记为<span class="math inline">\(y=1\)</span>.综合以上情况，下面的公式恒成立： <span class="math display">\[(\hat{y}_i-y_i)(\pmb{w}^T\pmb{x}-\theta)\geq0\]</span> 所以，给定数据集<span class="math inline">\(T\)</span>，其损失函数可以定义为： <span class="math display">\[L(\pmb{w},\theta)=\stackrel{}{\underset{\pmb{x}\in M}\sum}(\hat{y}_i-y_i)(\pmb{w}^T\pmb{x}-\theta)\]</span> 此损失函数是非负的。如果没有误分类点，损失函数的值是0。而且，误分类点越少，误分类点离超平面越近，损失函数的值越小。</p><p>具体来说，我们的目标是，给定数据集 <span class="math display">\[T=\{(\pmb{x_1},y_1),(\pmb{x_2},y_2),\dots,(\pmb{x_N},y_N)\}\]</span> 其中<span class="math inline">\(\pmb{x}_i\in \mathbb{R}^n,y_i\in\{0,1\}\)</span>，求参数<span class="math inline">\(\pmb{w},\theta\)</span>使其为最小化损失函数的解： <span class="math display">\[\underset{\pmb{w},\theta}{\min}L(\pmb{w},\theta)=\underset{\pmb{w},\theta}{\min}\stackrel{}{\underset{\pmb{x}_i\in M}\sum}(\hat{y}_i-y_i)(\pmb{w}^T\pmb{x}-\theta)\]</span> 我们可以把阈值<span class="math inline">\(\theta\)</span>看作一个固定输入为<span class="math inline">\(-1.0\)</span>的“哑节点”所对应的权重<span class="math inline">\(w_{n+1}\)</span>，这样，权重和阈值的学习就可以统一为权重的学习。即： <span class="math display">\[-\theta=-1\cdot w_{n+1}=x_{n+1}\cdot w_{n+1}\]</span> 求解的最小化问题转化为（注意此时的<span class="math inline">\(\pmb{w},\pmb{x_i}\)</span>是分别添加<span class="math inline">\(w_{n+1}=\theta,x_{n+1}=-1\)</span>之后的，和之前的<span class="math inline">\(\pmb{w},\pmb{x}_i\)</span>不是同一个！）： <span class="math display">\[\underset{\pmb{w}}{\min}L(\pmb{w})=\underset{\pmb{w}}{\min}\stackrel{}{\underset{\pmb{x}_i\in M}\sum}(\hat{y}_i-y_i)\pmb{w}^T\pmb{x}_i\]</span> 在集合<span class="math inline">\(M\)</span>固定的情况下，对<span class="math inline">\(L(\pmb{w})\)</span>关于<span class="math inline">\(\pmb{w}\)</span>求导，来寻找极值点： <span class="math display">\[\nabla_{\pmb{w}}L(\pmb{w})=\frac{\partial L(\pmb{w})}{\partial\pmb{w}}=\stackrel{}{\underset{\pmb{x}_i\in M}\sum}(\hat{y}_i-y_i)\pmb{x}_i\]</span> 感知机的学习算法具体采用的是<a href="/404.html">随机梯度下降法</a>，也就是极小化过程中不是使<span class="math inline">\(M\)</span>中所有误分类点的梯度下降，而是一次<strong>随机选择一个误分类点</strong><span class="math inline">\(\pmb{x}\in M\)</span>使其梯度下降。所以对训练样例<span class="math inline">\((\pmb{x},y)\)</span>，若当前感知机的输出为<span class="math inline">\(\hat{y}\)</span>，权重<span class="math inline">\(\pmb{w}\)</span>的更新公式为： <span class="math display">\[\pmb{w}^{(t+1)}\leftarrow \pmb{w}^{(t)}+\Delta \pmb{w} \\\Delta \pmb{w}=-\eta\underset{\pmb{x}_i\in M}\sum(\hat{y}_i-y_i)\pmb{x}\]</span> 其中<span class="math inline">\(\eta\in(0,1)\)</span>称为学习率，<span class="math inline">\((\hat{y}_i-y_i)\pmb{x}\)</span>表示单个样本的梯度。若感知机对训练样例预测正确，即<span class="math inline">\(\hat{y}=y\)</span>，则感知机不发生变化，否则将根据错误程度进行权重调整。</p><p>每次梯度下降时，我们都要对所有的<span class="math inline">\((\hat{y}_i-y_i)\pmb{x}\)</span>求和，而随机梯度下降的步幅比较小，这样会导致每次的计算量很大，在现实应用中，我们通常使用随机梯度下降法。</p><p>使用随机梯度下降法，<span class="math inline">\(\pmb{w}\)</span>中的某个分量<span class="math inline">\(w_i\)</span>的更新公式为（《机器学习》公式5.2）： <span class="math display">\[w_i\leftarrow w_i+\Delta w_i \\\Delta w_i = \eta(y_i-\hat{y}_i)x_i\]</span> 感知机只有输出层神经元进行激活函数处理，即只拥有一层功能神经元，其学习能力非常有限。上述与，或问题都是线性可分问题，即存在一个超平面能将它们分开，感知机的学习过程一定会收敛（证明暂略）。超平面方程为<span class="math inline">\(\pmb{w}^T\pmb{x}-\theta=0\)</span>.（法向量为<span class="math inline">\(\pmb{w}\)</span>，指向的方向为正空间，最终解出来的<span class="math inline">\(\pmb{w}\)</span>不唯一）</p><p>如果问题不是线性可分问题，感知机学习过程将会发生震荡，<span class="math inline">\(\pmb{w}\)</span>难以稳定下来，不能求得合适解。例如感知机甚至不能解决异或这样简单的非线性可分问题，异或问题如下图所示，感知机求得的解会在两条直线震荡。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/xor-problem.png" alt="异或问题" /></p><p>求解线性不可分问题，就需要感知机的叠加加强模型——神经网络来解决。</p>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 分类问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>支持向量机3-支持向量回归</title>
      <link href="/2022/03/11/machine%20learning/svm3/"/>
      <url>/2022/03/11/machine%20learning/svm3/</url>
      
        <content type="html"><![CDATA[<h2 id="支持向量回归">支持向量回归</h2><p>支持向量回归（SVR）是对传统线性分类方法的一种改进。在传统的学习方法中，我们基于训练集训练出了一个线性模型： <span class="math display">\[y=\pmb{w}^\text{T}\pmb{x}+b\]</span> 传统回归模型通常直接基于模型输出<span class="math inline">\(f(\pmb{x})\)</span>和真实结果<span class="math inline">\(y\)</span>之间的均方误差来计算损失，当且仅当模型输出和真实结果完全一致，损失才为0。支持向量回归能够容忍<span class="math inline">\(f(\pmb{x})\)</span>和真实结果<span class="math inline">\(y\)</span>之间最多有<span class="math inline">\(\epsilon\)</span>的误差。这表明支持向量回归模型不是一条线，而是一个以<span class="math inline">\(f(\pmb{x})\)</span>​为中心的间隔带，如图所示<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm7.png" alt="支持向量回归模型" /></p><p>我们可以类比线性回归来理解，落在带子上的样本不计算损失，可以类比于线性回归在线上的点误差为0。不在带子上的点，则以偏离带子的距离作为损失，这可以类比于线性回归的均方误差损失。之后和线性分类的处理方法一样，最小化损失函数，使得间隔带从样本最密集的地方穿过，进而达到拟合训练样本的目的。</p><h2 id="建立回归模型">建立回归模型</h2><p>支持向量回归问题可形式化为： <span class="math display">\[\underset{\pmb{w}}\min \frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}\mathscr{l}_{\epsilon}(f(\pmb{x}_i)-y_i)\]</span> 其中<span class="math inline">\(C\)</span>为正则化常数，<span class="math inline">\(\mathscr{l}_\epsilon\)</span>是<span class="math inline">\(\epsilon\)</span>-不敏感损失（也可以使用均方误差，但是结果会很难表达）： <span class="math display">\[\mathscr{l}_\epsilon=\begin{cases}0,\textbf{if}\ |z|&lt;\epsilon\\|z|-\epsilon,\textbf{otherwise}\end{cases}\]</span> 函数图像如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm8.png" alt="L损失函数" /></p><p>同解决软间隔支持向量机的方法一样，引入两个松弛变量<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a><span class="math inline">\(\xi_i=\mathscr{l}_\epsilon(f(\pmb{x}_i)-y_i),\hat{\xi}_i=\mathscr{l}_\epsilon(y_i-f(\pmb{x}_i)),\)</span>，显然<span class="math inline">\(\xi_i,\hat{\xi}_i\geq0\)</span>，并且：</p><ol type="1"><li><span class="math inline">\(f(\pmb{x}_i)-y_i\leq\epsilon,y_i-f(\pmb{x}_i)\leq\epsilon\Rightarrow\xi_i,\hat{\xi}_i=0\)</span></li><li><span class="math inline">\(f(\pmb{x}_i)-y_i&gt;\epsilon,y_i-f(\pmb{x}_i)&gt;\epsilon\Rightarrow\xi_i=(f(\pmb{x}_i)-y_i)-\epsilon,\hat{\xi}_i=(y_i-f(\pmb{x}_i))-\epsilon\)</span></li></ol><p>上面的说明用图描述如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm9.png" alt="松弛变量的引入" /></p><p>可以得到如下的约束问题： <span class="math display">\[\underset{\pmb{w},b,\xi_i,\hat{\xi}_i}\min \frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}(\xi_i+\hat{\xi}_i)\\s.t.\ f(\pmb{x}_i)-y_i\leq\epsilon+\xi_i\\y_i-f(\pmb{x}_i)\leq\epsilon+\hat{\xi}_i\\\xi_i\geq0,\hat{\xi}_i\geq0(i=1,2,\dots,m)\]</span> 我们仍然要通过构造拉格朗日函数，求原问题的对偶问题解决支持向量回归问题： <span class="math display">\[\begin{align*}&amp;L(\pmb{w},b,\pmb{\alpha},\hat{\pmb{\alpha}},\pmb{\xi},\hat{\pmb{\xi}},\pmb{\mu},\hat{\pmb{\mu}})\\&amp;=\frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}(\xi_i+\hat{\xi}_i)-\stackrel{m}{\underset{i=1}\sum}\mu_i\xi_i-\stackrel{m}{\underset{i=1}\sum}\hat{\mu}_i\hat{\xi}_i\\&amp;+\stackrel{m}{\underset{i=1}\sum}\alpha_i(f(\pmb{x}_i)-y_i-\epsilon-\xi_i)+\stackrel{m}{\underset{i=1}\sum}\hat{\alpha}_i(f(\pmb{x}_i)-y_i-\epsilon-\hat{\xi}_i)\tag{6.51}\end{align*}\]</span> 令<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha},\hat{\pmb{\alpha}},\pmb{\xi},\hat{\pmb{\xi}},\pmb{\mu},\hat{\pmb{\mu}})\)</span>对<span class="math inline">\(\pmb{w},b,\xi_i,\hat{\xi}_i\)</span>的偏导为0，可得： <span class="math display">\[\pmb{w}=\stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)\pmb{x}_i\]</span></p><p><span class="math display">\[0=\stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)\\\]</span></p><p><span class="math display">\[C=\alpha_i+\mu_i\]</span></p><p><span class="math display">\[C=\hat{\alpha}_i+\hat{\mu}_i\]</span></p><p>将上面的条件代入拉格朗日函数，得SVR得对偶问题： <span class="math display">\[\underset{\pmb{\alpha},\hat{\pmb{\alpha}}}\max \stackrel{m}{\underset{i=1}\sum}y_i(\hat{\alpha}_i-\alpha_i)-\epsilon(\hat{\alpha}_i+\alpha_i)-\frac{1}{2}\stackrel{m}{\underset{i=1}\sum}\stackrel{m}{\underset{j=1}\sum}(\hat{\alpha}_i-\alpha_i)(\hat{\alpha}_j-\alpha_j)\pmb{x}_i^\text{T}\pmb{x}_j\\s.t.\ \stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)=0\\0\leq\alpha_i,\hat{\alpha}_i\leq C\]</span> 上述过程应满足KKT条件： <span class="math display">\[\begin{cases}\alpha_i(f(\pmb{x}_i)-y_i-\epsilon-\xi_i)=0\\\hat{\alpha}_i(y_i-f(\pmb{x}_i)-\epsilon-\hat{\xi}_i)=0\\\alpha_i\hat{\alpha_i}=0,\xi_i\hat{\xi}_i=0\\(C-\alpha_i)\xi_i=0,(C-\hat{\alpha}_i)\hat{\xi}_i=0\end{cases}\]</span> 代入超平面方程，SVR的解形如： <span class="math display">\[f(\pmb{x})=\stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)\pmb{x}_i^\text{T}\pmb{x}+b\]</span> 根据KKT条件，能使上式中<span class="math inline">\(\hat{\alpha}_i-\alpha_i\neq0\)</span>的样本即为SVR的支持向量，它们都在<span class="math inline">\(\epsilon\)</span>间隔带之外。显然，SVR的支持向量仅是训练样本的一部分，即其解仍具有稀疏性。又可观察到，对每个样本<span class="math inline">\((\pmb{x}_i,y_i)\)</span>，都有<span class="math inline">\((C-\alpha_i)\xi_i=0,\alpha_i(f(\pmb{x}_i)-y_i-\epsilon-\xi_i)=0\)</span>。于是，在得到<span class="math inline">\(\alpha_i\)</span>后，若<span class="math inline">\(0&lt;\alpha_i&lt;C\)</span>，则必有<span class="math inline">\(\xi_i=0\)</span>，进而有： <span class="math display">\[b=y_i-\epsilon-\stackrel{m}{\underset{j=1}\sum}(\hat{\alpha}_i-\alpha_i)\pmb{x}_j^\text{T}\pmb{x}_i\tag{6.54}\]</span> 因此，在求解式(6.51)得到<span class="math inline">\(\alpha_i\)</span>后，理论上来说，可任意选取满足<span class="math inline">\(0 &lt; \alpha_i &lt; C\)</span>的样本通过式(6.54)求得b。实践中常采用一种更鲁棒的办法：选取多个（或所有）满足条件<span class="math inline">\(0&lt;\alpha_i&lt; C\)</span>的样本求解b后取平均值。</p><p>如果考虑映射到高维，则SVR可表示为： <span class="math display">\[\pmb{w}=\stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)\phi(\pmb{x})\]</span></p><p><span class="math display">\[f(\pmb{x})=\stackrel{m}{\underset{i=1}\sum}(\hat{\alpha}_i-\alpha_i)\mathcal{K}(\pmb{x},\pmb{x}_i)+b\]</span></p><p>其中<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}_i)=\phi(\pmb{x}_i)^\text{T}\phi(\pmb{x}_j)\)</span>为核函数。</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>绘图工具为matplotlib，详细的学习路线见链接。<a href="https://datawhalechina.github.io/fantastic-matplotlib/">fantastic-matplotlib-DataWhale</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>间隔带两侧的松弛程度可以不同，松弛变量的几何意义见软间隔支持向量机<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 回归问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>支持向量机的核方法</title>
      <link href="/2022/03/09/machine%20learning/km/"/>
      <url>/2022/03/09/machine%20learning/km/</url>
      
        <content type="html"><![CDATA[<h2 id="核函数的引入">核函数的引入</h2><h3 id="非线性可分的问题">非线性可分的问题</h3><p>问题举例：一个异或问题，如下图所示，异或问题是线性不可分问题的代表：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/km1.png" alt="异或问题" /></p><h3 id="两种典型的解决思路">两种典型的解决思路</h3><ol type="1"><li><p>感知机模型(PLA) -&gt; 通用近似定理 -&gt; 多层感知机（神经网络） -&gt; 深度学习(Deep Learning)</p></li><li><p>非线性可分 -&gt; 非线性转换 -&gt; 线性可分</p></li></ol><p>两种思路的代表算法如下表：</p><table><thead><tr class="header"><th style="text-align: center;">线性可分问题</th><th style="text-align: center;">有错误的线性可分问题</th><th style="text-align: center;">严格非线性问题</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">感知机</td><td style="text-align: center;">Pocket Algorithm</td><td style="text-align: center;">神经网络</td></tr><tr class="even"><td style="text-align: center;">硬间隔SVM</td><td style="text-align: center;">软间隔SVM</td><td style="text-align: center;"><span class="math inline">\(\phi(\pmb{x})\)</span>+硬/软间隔（核方法）</td></tr></tbody></table><h3 id="核函数和核方法">核函数和核方法</h3><p>可以证明，高维比低维更容易线性可分(cover定理)。</p><p>使用上述的方法2，设特征空间为<span class="math inline">\(X\)</span>，映射的高维空间为<span class="math inline">\(Z\)</span>，则方法2的思想可以表示为： <span class="math display">\[X \stackrel{\phi(\pmb{x})}\longrightarrow Z\]</span> 指定转移函数，将原来的数据转化为高维数据： <span class="math display">\[\pmb{x}=(x_1,x_2)\stackrel{\phi(\pmb{x})}\longrightarrow\pmb{z}=(x_1,x_2,(x_1-x_2)^2)\]</span> 此时各个点在空间中的位置如图，可以看出，这个三维空间很好的解决了二维空间的分类问题：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/km2.png" alt="升维解决异或问题" /></p><p>在高维空间中的线性分类器的对偶问题模型与根据<strong>硬间隔</strong>支持向量机中对偶问题的模型(6.11)十分相似，只是将<span class="math inline">\(\pmb{x}\)</span>换成了高维空间向量<span class="math inline">\(\phi(\pmb{x})\)</span>： <span class="math display">\[\underset{\pmb{\alpha}}{\max}\ -\frac{1}{2}\stackrel{m}{\underset{i=1}\sum}\stackrel{m}{\underset{i=1}\sum}\alpha_i\alpha_jy_iy_j\phi(\pmb{x}_i)^\text{T}\phi(\pmb{x}_j)+\stackrel{m}{\underset{i=1}\sum}\alpha_i\\s.t.\ \stackrel{m}{\underset{i=1}\sum}\alpha_iy_i=0\tag{6.11}\\ \pmb{\alpha}\succeq 0\\\]</span> 我们需要求出<span class="math inline">\(\phi(\pmb{x}_i)^\text{T}\)</span>，<span class="math inline">\(\phi(\pmb{x}_j)\)</span>的内积，即可解决低维空间映射到高维空间过程中产生的新的优化问题的对偶问题，从而求解出支持向量机模型将数据正确分类。</p><p>然而，实际问题往往比较复杂，<span class="math inline">\(\phi(\pmb{x})\)</span>在大多数情况下是非常难求的，它可能将分类问题映射到很高的维度，甚至是无穷维。但我们其实不必关注<span class="math inline">\(\phi(\pmb{x})\)</span>，为了解决上面的问题，我们其实只要关注<span class="math inline">\(\phi(\pmb{x}_i)^\text{T}\)</span>，<span class="math inline">\(\phi(\pmb{x}_j)\)</span>的内积即可。</p><p>所以，我们可以定义上面<span class="math inline">\(\phi\)</span>函数的内积为： <span class="math display">\[\mathcal{K}(\pmb{x}_i,\pmb{x}_j)=\phi(\pmb{x}_i)^\text{T}\phi(\pmb{x}_j)=&lt;\phi(\pmb{x}_i),\phi(\pmb{x}_j)&gt;\]</span> 我们称这个内积为<strong>核函数</strong>，使用升维方式完成非线性分类任务的方法为<strong>核方法</strong>。</p><p><strong>核函数</strong>的正式定义如下：</p><blockquote><p>令<span class="math inline">\(\mathcal{X},\mathcal{Z}\)</span>是输入空间，<span class="math inline">\(\pmb{x}\)</span>是<span class="math inline">\(\mathcal{X}\)</span>上的向量。</p><p><span class="math inline">\(\exists \pmb{x}, \pmb{x}&#39; \in \mathcal{X},\exists \phi :\mathcal{X} \mapsto \mathcal{Z}\)</span>，有<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x&#39;})=\phi(\pmb{x})^\text{T}\phi(\pmb{x})\)</span>，则<span class="math inline">\(\mathcal{K}(x,x&#39;)\)</span>是一个核函数。</p></blockquote><p>引入了核函数后，再次求解问题(6.11)，即可得到： <span class="math display">\[\begin{align*}f(\pmb{x})&amp;=\pmb{w}^\text{T}\pmb{x}+b\\&amp;=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\mathcal{K}(\pmb{x},\pmb{x}_i)+b\end{align*}\tag{6.24}\]</span></p><h2 id="核函数的性质">核函数的性质</h2><p>一般我们使用的函数都是正定核函数。所以这里主要介绍正定核函数。</p><h3 id="正定核函数第一定义">正定核函数第一定义</h3><p>令<span class="math inline">\(\mathcal{X},\mathcal{Z}\)</span>是输入空间，<span class="math inline">\(\pmb{x}\)</span>是<span class="math inline">\(\mathcal{X}\)</span>上的向量，<span class="math inline">\(\mathcal{H}\)</span>为希尔伯特空间<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p><p>对于<span class="math inline">\(\forall \pmb{x},\pmb{x&#39;}\in \mathcal{X}\)</span>,有<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>，如果<span class="math inline">\(\exists \phi :\mathcal{X} \mapsto \mathbb{R},\phi \in \mathcal{H}\)</span>，有<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x&#39;})=\phi(\pmb{x})^\text{T}\phi(\pmb{x})\)</span>，则<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x&#39;})\)</span>是正定核函数。</p><h3 id="判定正定核函数的充要条件mercer定理">判定正定核函数的充要条件（Mercer定理）</h3><p>令<span class="math inline">\(\mathcal{X},\mathcal{Z}\)</span>是输入空间，<span class="math inline">\(\pmb{x}\)</span>是<span class="math inline">\(\mathcal{X}\)</span>上的向量。</p><p>对于<span class="math inline">\(\forall \pmb{x},\pmb{x&#39;}\in \mathcal{X}\)</span>,有<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>，如果<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>满足如下两条性质：</p><ol type="1"><li>对称性：<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)=\mathcal{K}(\pmb{x}&#39;,\pmb{x})\)</span></li><li>正定性：任取<span class="math inline">\(N\)</span>个元素<span class="math inline">\(\pmb{x}_1,\pmb{x}_2,\dots\pmb{x}_n \in \mathcal{X}\)</span>，对应的<strong>Kernel matrix</strong>是半正定的。</li></ol><p>那么则称<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>为正定核函数。</p><p>【补充】：<strong>Kernel Matrix</strong>的形式 <span class="math display">\[\textbf{K}=\begin{bmatrix}\mathcal{K}(\pmb{x}_1,\pmb{x}_1)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_1,\pmb{x}_j)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_1,\pmb{x}_n)\\ \vdots&amp;\ddots&amp;\vdots&amp;\ddots&amp;\vdots\\ \mathcal{K}(\pmb{x}_i,\pmb{x}_1)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_i,\pmb{x}_j)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_i,\pmb{x}_n)\\ \vdots&amp;\ddots&amp;\vdots&amp;\ddots&amp;\vdots\\ \mathcal{K}(\pmb{x}_n,\pmb{x}_1)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_n,\pmb{x}_j)&amp;\cdots&amp;\mathcal{K}(\pmb{x}_n,\pmb{x}_n)\end{bmatrix}\]</span></p><p>下面给出第一第二定义的充要性的证明。</p><h3 id="必要性证明">必要性证明</h3><p>已知<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>是正定核函数，证核矩阵半正定且核函数满足对称性。</p><p>【证明】：</p><ol type="1"><li><p>对称：<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)=&lt;\phi(\pmb{x}),\phi(\pmb{x}&#39;)&gt;\)</span>，<span class="math inline">\(\mathcal{K}(\pmb{x}&#39;,\pmb{x})=&lt;\phi(\pmb{x}&#39;),\phi(\pmb{x})&gt;\)</span>，由于向量内积满足对称性，所以<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)=\mathcal{K}(\pmb{x}&#39;,\pmb{x})\)</span>，核函数满足对称性。</p></li><li><p>半正定<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>：即证<span class="math inline">\(\forall \pmb{\alpha}\in \mathbb{R}^n,\pmb{\alpha}^\text{T}K\pmb{\alpha}\geq0\)</span>。将<span class="math inline">\(\mathcal{K}(x_i,x_j)\)</span>简写为<span class="math inline">\(\mathcal{K}_{ij}\)</span>。 <span class="math display">\[\begin{align*}\pmb{\alpha}^\text{T}K\pmb{\alpha}&amp;=\begin{bmatrix}\alpha_1&amp;\alpha_2&amp;\dots&amp;\alpha_n\end{bmatrix}\begin{bmatrix}\mathcal{K}_{11}&amp;\mathcal{K}_{12}&amp;\dots&amp;\mathcal{K}_{1n}\\\mathcal{K}_{21}&amp;\mathcal{K}_{22}&amp;\dots&amp;\mathcal{K}_{2n}\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\\mathcal{K}_{n1}&amp;\mathcal{K}_{nn}&amp;\dots&amp;\mathcal{K}_{ij}\end{bmatrix}\begin{bmatrix}\alpha_1\\ \alpha_2\\ \vdots\\ \alpha_n\end{bmatrix}\\&amp;=\stackrel{n}{\underset{i=1}\sum}\alpha_i\stackrel{n}{\underset{j=1}\sum}\alpha_j\mathcal{K}_{ji}\\&amp;=\stackrel{n}{\underset{i=1}\sum}\stackrel{n}{\underset{j=1}\sum}\alpha_i\alpha_j\phi(\pmb{x}_i)^\text{T}\phi(\pmb{x}_j)\\&amp;=\stackrel{n}{\underset{i=1}\sum}\alpha_i\phi(\pmb{x}_i)^\text{T}\stackrel{n}{\underset{j=1}\sum}\alpha_j\phi(\pmb{x}_j)\\&amp;=&lt;\stackrel{n}{\underset{i=1}\sum}\alpha_i\phi(\pmb{x}_i),\stackrel{n}{\underset{j=1}\sum}\alpha_j\phi(\pmb{x}_j)&gt;\\&amp;=||\stackrel{n}{\underset{j=1}\sum}\alpha_i\phi(\pmb{x}_i)||^2\geq0\end{align*}\]</span> 所以核矩阵<span class="math inline">\(\textbf{K}\)</span>是半正定的。</p></li></ol><h3 id="充分性证明">充分性证明</h3><p>已知核矩阵半正定且核函数满足对称性，证<span class="math inline">\(\mathcal{K}(\pmb{x},\pmb{x}&#39;)\)</span>是正定核函数。</p><p>需要再生核的知识，超出我们现在的认知范围，故略去，具体见《统计学习方法》<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>的相关证明。</p><h2 id="常用的核函数">常用的核函数</h2><table><colgroup><col style="width: 14%" /><col style="width: 49%" /><col style="width: 36%" /></colgroup><thead><tr class="header"><th style="text-align: center;">名称</th><th style="text-align: center;">表达式</th><th style="text-align: center;">参数</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">线性核</td><td style="text-align: center;"><span class="math inline">\(\pmb{x}_i^\text{T}\pmb{x}_j\)</span></td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">多项式核</td><td style="text-align: center;">(<span class="math inline">\(\pmb{x}_i^\text{T}\pmb{x}_j)^d\)</span></td><td style="text-align: center;"><span class="math inline">\(d\geq1\)</span>为多项式的次数</td></tr><tr class="odd"><td style="text-align: center;">高斯核（RBF核）</td><td style="text-align: center;"><span class="math inline">\(\exp(-\frac{||\pmb{x}_i-\pmb{x}_j||^2}{2\sigma^2})\)</span></td><td style="text-align: center;"><span class="math inline">\(\sigma\)</span>为高斯核的带宽</td></tr><tr class="even"><td style="text-align: center;">拉普拉斯核</td><td style="text-align: center;"><span class="math inline">\(\exp(-\frac{||\pmb{x}_i-\pmb{x}_j||^2}{\sigma})\)</span></td><td style="text-align: center;"><span class="math inline">\(\sigma&gt;0\)</span></td></tr><tr class="odd"><td style="text-align: center;">Sigmoid核</td><td style="text-align: center;"><span class="math inline">\(\tanh(\beta\pmb{x}_i^\text{T}\pmb{x}_j+\theta)\)</span></td><td style="text-align: center;">tanh为双曲正切函数，<span class="math inline">\(\beta&gt;0,\theta&lt;0\)</span></td></tr></tbody></table><p>选择核函数方面有一些基本的经验，例如对文本数据通常采用<strong>线性核</strong>，情况不明时可采用<strong>高斯核</strong>。</p><h2 id="核函数的组合性质">核函数的组合性质</h2><ol type="1"><li><p>核函数线性组合还是核函数 <span class="math display">\[\lambda_1\mathcal{K}_1+\lambda_2\mathcal{K}_2\]</span></p></li><li><p>核函数的直积还是核函数 <span class="math display">\[\mathcal{K}_1\otimes\mathcal{K}_2(\pmb{x},\pmb{z})=\mathcal{K}_1(\pmb{x},\pmb{z})\mathcal{K}_2(\pmb{x},\pmb{z})\]</span></p></li><li><p>对于函数<span class="math inline">\(g(\pmb{x})\)</span>，核函数两边同乘<span class="math inline">\(g\)</span>，得到的仍是核函数： <span class="math display">\[\mathcal{K}(\pmb{x},\pmb{z})=g(\pmb{x})\mathcal{K}_1(\pmb{x},\pmb{z})g(\pmb{z})\]</span></p></li></ol><h2 id="使用核方法">使用核方法</h2><h3 id="表示定理">表示定理</h3><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>完备的，可能是无限维的，被赋予内积的线性空间，详见<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>证明矩阵半正定的方法有两种，一是特征值大于0，二是证明<span class="math inline">\(\forall \pmb{\alpha}\in \mathbb{R}^n,\pmb{\alpha}^\text{T}A\pmb{\alpha}\geq0\)</span>​。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>《统计学习方法》李航.2012<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用的排序算法分析和实现</title>
      <link href="/2022/03/09/Algorithm/Sort/"/>
      <url>/2022/03/09/Algorithm/Sort/</url>
      
        <content type="html"><![CDATA[<h2 id="冒泡排序">冒泡排序</h2><h3 id="思想">思想</h3><p>不停扫描数列，发现逆序就交换，直到没有逆序为止。最多扫描<span class="math inline">\(n\)</span>次，至多进行<span class="math inline">\(n(n-1)/2\)</span>次交换后，数列的顺序就会固定。因为一个长度为<span class="math inline">\(n\)</span>的数列的逆序对最多就是<span class="math inline">\(n(n-1)/2\)</span>个。由于交换数列中相邻的两个逆序数至多会让逆序对减少1，所以算法复杂度自然是<span class="math inline">\(O(n^2)\)</span>的。</p><h3 id="优缺点">优缺点</h3><ul><li><p>优点：实现非常简单，意味着它的<strong>常数很小</strong>。它不需要多余的存储空间。</p></li><li><p>缺点：冒泡排序算法的性能瓶颈在邻项交换，邻项交换处理逆序对的能力太差，交换的次数很多，使得冒泡排序的性能很差而且差的很稳定，交换次数不需打桩，就是<strong>数据中逆序对的个数</strong>，至于逆序对个数的统计，为什么不用归并排序呢~。</p></li></ul><h3 id="图解">图解</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/bubbleSort.gif" alt="冒泡排序" /></p><h3 id="实现">实现</h3><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define T int</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAXN 1000 + 10</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define OP &lt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> bubbleSort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n <span class="op">-</span> i <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>j<span class="op">]</span> <span class="op">&lt;</span> a<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                swap<span class="op">(&amp;</span>a<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">],&amp;</span>a<span class="op">[</span>j<span class="op">]);</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">// 另一种实现方式</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> bubbleSort2<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>j<span class="op">]</span> <span class="op">&lt;</span> a<span class="op">[</span>i<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                swap<span class="op">(&amp;</span>a<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>a<span class="op">[</span>j<span class="op">]);</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率">运行效率</h3><p>取多次运行的平均值<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.032</td><td style="text-align: center;">0.371</td><td style="text-align: center;">54.373</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.031</td><td style="text-align: center;">0.378</td><td style="text-align: center;">54.373</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="odd"><td style="text-align: center;">平均比较/交换次数</td><td style="text-align: center;">4950/2206</td><td style="text-align: center;">4498500/2270971</td><td style="text-align: center;">约5千万次/约2.5千万次</td><td style="text-align: center;">数以亿计</td><td style="text-align: center;"></td><td style="text-align: center;"></td></tr></tbody></table><h2 id="选择排序">选择排序</h2><h3 id="思想-1">思想</h3><p>在未排序序列中找到最小（大）元素，存放到排序序列的起始位置。</p><p>再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。</p><p>重复第二步，直到所有元素均排序完毕。</p><p>比较的次数是<strong>数组中逆序对的个数</strong>。</p><h3 id="优缺点-1">优缺点</h3><ul><li><p>优点：常数小，不需要额外的存储空间。</p></li><li><p>缺点：和冒泡排序一样，初学的时候经常把它和冒泡排序弄混。实际上，选择排序和冒泡排序执行的比较次数是一样的，只是交换次数少了一些。本质上还是对逆序对的处理。不过，正是因为交换时间的减少，使得它的效率要优于冒泡排序。</p></li></ul><h3 id="图解-1">图解</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/selectionSort.gif" alt="选择排序" /></p><h3 id="实现-1">实现</h3><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> selectionSort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> p <span class="op">=</span> i<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>j<span class="op">]</span> <span class="op">&lt;</span> a<span class="op">[</span>p<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                p <span class="op">=</span> j<span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        swap<span class="op">(&amp;</span>a<span class="op">[</span>p<span class="op">],</span> <span class="op">&amp;</span>a<span class="op">[</span>i<span class="op">]);</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-1">运行效率</h3><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.016</td><td style="text-align: center;">0.232</td><td style="text-align: center;">22.950</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.016</td><td style="text-align: center;">0.234</td><td style="text-align: center;">22.952</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="odd"><td style="text-align: center;">平均比较/交换次数</td><td style="text-align: center;">5248/100</td><td style="text-align: center;">4518317/3000</td><td style="text-align: center;">约5千万次/10000</td><td style="text-align: center;">超过十亿次/1e5</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr></tbody></table><h2 id="插入排序">插入排序</h2><h3 id="思想-2">思想</h3><p>将第一待排序序列第一个元素看做一个有序序列，把第二个元素到最后一个元素当成是未排序序列。</p><p>从头到尾依次扫描未排序序列，将扫描到的每个元素插入有序序列的适当位置。（如果待插入的元素与有序序列中的某个元素相等，则将待插入元素插入到相等元素的后面。）</p><p>好像我们在玩扑克牌时看牌，码牌的动作。</p><h3 id="优缺点-2">优缺点</h3><ul><li><p>优点：对付随机的，变化的数组，令其有序的最好方法就是插入排序，人在码牌的时候，不会用快排，也不会用归并，这足以说明插入排序是针对动态变化数组进行有序化的最有效的解法。</p></li><li><p>缺点：在码牌时，一个成年人的手足够放下17-20张牌<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>，所以我们并不关注“存储空间”的影响。但在计算机中，数组的存储方式是线性的，这也意味着我们插入时，需要将插入点后的所有数向后移。如果用链表插入，插入是方便了，但是链表对数的索引是很难建立的，即使建立了，在变更映射时，复杂度相对数组存储并没有提升。事实上，我们无法找到一个线性的数据结构，既能满足<span class="math inline">\(O(1)\)</span>的索引，又能满足<span class="math inline">\(O(1)\)</span>的插入。</p></li></ul><h3 id="图解-2">图解</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/insertionSort.gif" alt="插入排序" /></p><h3 id="实现-2">实现</h3><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insertionSort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> j <span class="op">=</span> i <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> t <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(;</span> j <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> t <span class="op">&lt;</span> a<span class="op">[</span>j<span class="op">];</span> <span class="op">--</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> a<span class="op">[</span>j<span class="op">];</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        a<span class="op">[</span>j <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> t<span class="op">;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-2">运行效率</h3><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.109</td><td style="text-align: center;">10.856</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.100</td><td style="text-align: center;">10.855</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="odd"><td style="text-align: center;">平均比较/交换次数</td><td style="text-align: center;">2206/2206</td><td style="text-align: center;">2270971/2270971</td><td style="text-align: center;">约2.5千万次</td><td style="text-align: center;">十亿次</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr></tbody></table><h2 id="希尔排序">希尔排序</h2><h3 id="思想-3">思想</h3><p>对插入排序的一种优化。</p><p>先将整个待排序的记录序列分割成为若干子序列分别进行直接插入排序，待整个序列中的记录"基本有序"时，再对全体记录进行依次直接插入排序。</p><p>希尔排序中有分治思想的影子。它是快速排序，归并排序的灵感之源。</p><h3 id="优缺点-3">优缺点</h3><ul><li>优点：分块处理，效率比插入排序更高，不需要额外的存储空间。它继承了插入排序的优点，并弱化了插入排序在频繁插入数需要频繁移动数组的缺点。具体表现为分块后的数据有序性随分块颗粒的减小而增加，平均时间复杂度<span class="math inline">\(O(n^{1.3})\)</span>，是效率远远超越<span class="math inline">\(O(n^2)\)</span>的优化。</li><li>缺点：最坏时间复杂度仍然是<span class="math inline">\(O(n^2)\)</span>，虽然是纯多项式复杂度排序算法中最快的，但是在数据规模增加时，多项式复杂度的增长仍快过对数时间复杂度。</li></ul><h3 id="图解-3">图解</h3><p>暂时没找到比较好的</p><h3 id="实现-3">实现</h3><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> shellSort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> gap <span class="op">=</span> n <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">;</span> gap <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> gap <span class="op">&gt;&gt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> gap<span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> j <span class="op">=</span> i <span class="op">-</span> gap<span class="op">,</span> t <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(;</span> j <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> t <span class="op">&lt;</span> a<span class="op">[</span>j<span class="op">];</span> j <span class="op">-=</span> gap<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                a<span class="op">[</span>j <span class="op">+</span> gap<span class="op">]</span> <span class="op">=</span> a<span class="op">[</span>j<span class="op">];</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>j <span class="op">+</span> gap<span class="op">]</span> <span class="op">=</span> t<span class="op">;</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-3">运行效率</h3><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.048</td><td style="text-align: center;">0.670</td><td style="text-align: center;">9.812</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.020</td><td style="text-align: center;">0.650</td><td style="text-align: center;">9.752</td></tr><tr class="odd"><td style="text-align: center;">平均比较/交换次数</td><td style="text-align: center;">406</td><td style="text-align: center;">33511</td><td style="text-align: center;">158365</td><td style="text-align: center;">2794019</td><td style="text-align: center;">约5千万次</td><td style="text-align: center;">-</td></tr></tbody></table><h2 id="快速排序">快速排序</h2><h3 id="思想-4">思想</h3><p>选定基准数，以基准数为分界，将原问题分解为两个子问题。基准数的位置一定是它在有序序列中应该出现的位置。基准数位置的寻找通过两个“哨兵”指针来实现。</p><h3 id="优缺点-4">优缺点</h3><ul><li>优点：速度块<span class="math inline">\(O(n\log n)\)</span>，不需要额外的存储空间。对于随机数据，表现比归并排序和堆排序的效果都要好。</li><li>缺点：快速排序的唯一缺点就是过分依赖基准数的选择。如果每次的基准数定为序列的第一个元素，那么一个完全逆序的序列（5，4，3，2，1）就可以将这个算法卡成<span class="math inline">\(O(n^2)\)</span>的，如果选中间，那么例如（2，4，5，3，1）这样的序列也可以使得快排优化无效，如果数据规模大一点，就会导致栈溢出。快速一般的优化是在序列中取随机的位置，但随机数的生成的开销也不小，这使得随机位置的快排在数据规模较大的时候，性能比归并排序差一些。</li></ul><h3 id="图解-4">图解</h3><p>黄色数字表示基准数，紫色表示双指针当前遍历到的值，橙色表示该数已经到达正确的位置。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/quickSort.gif" alt="快速排序" /></p><h3 id="实现-4">实现</h3><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define T int</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define OP &lt;=</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define min(a, b)((a) &lt; (b)? (a) : (b))</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> T <span class="op">*</span>b<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    T tmp <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>b <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>a <span class="op">=</span> tmp<span class="op">;</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 递归实现</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> quick_sort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> start<span class="op">,</span> <span class="dt">int</span> end<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>start <span class="op">&gt;=</span> end<span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//int mid = start + (end - start) / 2;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> start<span class="op">,</span> j <span class="op">=</span> end<span class="op">;</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">register</span> <span class="dt">int</span> num <span class="op">=</span> a<span class="op">[</span>start<span class="op">];</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//_swap(&amp;a[start], &amp;a[mid]);</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>a<span class="op">[</span>j<span class="op">]</span> <span class="op">&gt;=</span> num <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> j<span class="op">)</span> j<span class="op">--;</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;=</span> num <span class="op">&amp;&amp;</span> i <span class="op">&lt;</span> j<span class="op">)</span> i<span class="op">++;</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">&lt;</span> j<span class="op">)&#123;</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            swap<span class="op">(&amp;</span>a<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>a<span class="op">[</span>j<span class="op">]);</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    swap<span class="op">(&amp;</span>a<span class="op">[</span>start<span class="op">],</span> <span class="op">&amp;</span>a<span class="op">[</span>i<span class="op">]);</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    quick_sort<span class="op">(</span>a<span class="op">,</span> start<span class="op">,</span> i <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    quick_sort<span class="op">(</span>a<span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> end<span class="op">);</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">// 非递归的实现，来源于网络</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> _Range <span class="op">&#123;</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> start<span class="op">,</span> end<span class="op">;</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> Range<span class="op">;</span></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>Range new_Range<span class="op">(</span><span class="dt">int</span> s<span class="op">,</span> <span class="dt">int</span> e<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    Range r<span class="op">;</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>start <span class="op">=</span> s<span class="op">;</span></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>end <span class="op">=</span> e<span class="op">;</span></span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r<span class="op">;</span></span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> quick_sort<span class="op">(</span><span class="dt">int</span> arr<span class="op">[],</span> <span class="dt">const</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>len <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span> <span class="co">// 避免len等於負值時引發段錯誤（Segment Fault）</span></span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// r[]模擬栈,p為數量,r[p++]為push,r[--p]為pop且取得元素</span></span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    Range r<span class="op">[</span>len<span class="op">];</span></span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> p <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    r<span class="op">[</span>p<span class="op">++]</span> <span class="op">=</span> new_Range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> len <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        Range range <span class="op">=</span> r<span class="op">[--</span>p<span class="op">];</span></span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>range<span class="op">.</span>start <span class="op">&gt;=</span> range<span class="op">.</span>end<span class="op">)</span></span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> mid <span class="op">=</span> arr<span class="op">[(</span>range<span class="op">.</span>start <span class="op">+</span> range<span class="op">.</span>end<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">];</span> <span class="co">// 選取中間點為基準點</span></span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> left <span class="op">=</span> range<span class="op">.</span>start<span class="op">,</span> right <span class="op">=</span> range<span class="op">.</span>end<span class="op">;</span></span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span> <span class="op">&#123;</span></span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>arr<span class="op">[</span>left<span class="op">]</span> <span class="op">&lt;</span> mid<span class="op">)</span> <span class="op">++</span>left<span class="op">;</span>   <span class="co">// 檢測基準點左側是否符合要求</span></span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>arr<span class="op">[</span>right<span class="op">]</span> <span class="op">&gt;</span> mid<span class="op">)</span> <span class="op">--</span>right<span class="op">;</span> <span class="co">//檢測基準點右側是否符合要求</span></span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;=</span> right<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                swap<span class="op">(&amp;</span>arr<span class="op">[</span>left<span class="op">],</span> <span class="op">&amp;</span>arr<span class="op">[</span>right<span class="op">]);</span></span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                left<span class="op">++;</span></span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>                right<span class="op">--;</span>               <span class="co">// 移動指針以繼續</span></span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span> <span class="cf">while</span> <span class="op">(</span>left <span class="op">&lt;=</span> right<span class="op">);</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>range<span class="op">.</span>start <span class="op">&lt;</span> right<span class="op">)</span> r<span class="op">[</span>p<span class="op">++]</span> <span class="op">=</span> new_Range<span class="op">(</span>range<span class="op">.</span>start<span class="op">,</span> right<span class="op">);</span></span><span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>range<span class="op">.</span>end <span class="op">&gt;</span> left<span class="op">)</span> r<span class="op">[</span>p<span class="op">++]</span> <span class="op">=</span> new_Range<span class="op">(</span>left<span class="op">,</span> range<span class="op">.</span>end<span class="op">);</span></span><span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率递归程序">运行效率（递归程序）</h3><table><colgroup><col style="width: 17%" /><col style="width: 9%" /><col style="width: 10%" /><col style="width: 12%" /><col style="width: 13%" /><col style="width: 18%" /><col style="width: 17%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.033</td><td style="text-align: center;">0.366</td><td style="text-align: center;">3.273</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.016</td><td style="text-align: center;">0.176</td><td style="text-align: center;">栈溢出</td><td style="text-align: center;">-</td><td style="text-align: center;">-</td></tr><tr class="odd"><td style="text-align: center;">平均比较/交换次数</td><td style="text-align: center;">683/155</td><td style="text-align: center;">39764/8291</td><td style="text-align: center;">152511/31653</td><td style="text-align: center;">202359/390195</td><td style="text-align: center;">约2.5千万次/460909</td><td style="text-align: center;">约3亿次/约5千万次</td></tr></tbody></table><h2 id="归并排序">归并排序</h2><h3 id="思想-5">思想</h3><p>子问题相互不相关的小问题合并，大问题可解，这是分治法的基本思想。归并排序就是分治思想的经典应用。</p><p>作为一种典型的分而治之思想的算法应用，归并排序的实现由两种方法：</p><ul><li>自上而下的递归；</li><li>自下而上的迭代；</li></ul><p>代码实现采用的是迭代法。一般来讲，迭代相对于递归，省去了很多的栈空间，运行效率也更高。本来归并排序就需要辅助数组，为了让程序的占用的内存空间更小，迭代法显然更好。</p><h3 id="优缺点-5">优缺点</h3><ul><li><p>优点：稳定，不存在数据的分布使它的时间复杂度超过<span class="math inline">\(O(n\log n)\)</span>。迭代实现比快速排序容易。</p></li><li><p>缺点：需要辅助数组来存放合并结果。对空间的巨大占用是归并排序的显著缺点。对合并的结果倒来倒去，势必会产生对内存，cache的大量读写操作，对大规模数据来说，存储消耗的时间是不可忽略的，这导致了归并排序的常数比较大。</p></li></ul><h3 id="图解-5">图解</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/mergeSort.gif" alt="归并排序" /></p><h3 id="实现-5">实现</h3><p>非常常用的算法，知名度仅次于快速排序。这里使用了非递归实现。</p><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define min(a, b)((a) &lt; (b)? (a) : (b))</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> temp<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>LL ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span><span class="co">// 用来统计逆序对</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> merge<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> start<span class="op">,</span> <span class="dt">int</span> mid<span class="op">,</span> <span class="dt">int</span> end<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> start<span class="op">,</span> j <span class="op">=</span> mid <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> tot <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;=</span> mid <span class="op">&amp;&amp;</span> j <span class="op">&lt;=</span> end<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;=</span> a<span class="op">[</span>j<span class="op">])</span> temp<span class="op">[</span>tot<span class="op">++]</span> <span class="op">=</span> a<span class="op">[</span>i<span class="op">++];</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            temp<span class="op">[</span>tot<span class="op">++]</span> <span class="op">=</span> a<span class="op">[</span>j<span class="op">++];</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">+=</span> mid <span class="op">-</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span><span class="co">// 边排序边统计</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;=</span> mid<span class="op">)</span> temp<span class="op">[</span>tot<span class="op">++]</span> <span class="op">=</span> a<span class="op">[</span>i<span class="op">++];</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>j <span class="op">&lt;=</span> end<span class="op">)</span> temp<span class="op">[</span>tot<span class="op">++]</span> <span class="op">=</span> a<span class="op">[</span>j<span class="op">++];</span></span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> start<span class="op">;</span> i <span class="op">&lt;=</span> end<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        a<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> temp<span class="op">[</span>i <span class="op">-</span> start<span class="op">];</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mergeSort<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> seg <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> seg <span class="op">&lt;</span> n<span class="op">;</span> seg <span class="op">+=</span> seg<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> start <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> start <span class="op">&lt;</span> n <span class="op">-</span> seg<span class="op">;</span> start <span class="op">+=</span> seg <span class="op">+</span> seg<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            merge<span class="op">(</span>a<span class="op">,</span> start<span class="op">,</span> start <span class="op">+</span> seg <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> min<span class="op">(</span>start <span class="op">+</span> seg <span class="op">+</span> seg <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> n <span class="op">-</span> <span class="dv">1</span><span class="op">));</span></span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-4">运行效率</h3><table><colgroup><col style="width: 21%" /><col style="width: 10%" /><col style="width: 13%" /><col style="width: 19%" /><col style="width: 9%" /><col style="width: 13%" /><col style="width: 11%" /></colgroup><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.032</td><td style="text-align: center;">0.364</td><td style="text-align: center;">4.152</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.016</td><td style="text-align: center;">0.172</td><td style="text-align: center;">2.141</td></tr><tr class="odd"><td style="text-align: center;">平均比较次数/逆序对数</td><td style="text-align: center;">1252/2206*</td><td style="text-align: center;">66147/2270971</td><td style="text-align: center;">260017/约2.5千万次*</td><td style="text-align: center;">3259373/*</td><td style="text-align: center;">约3.9千万次/*</td><td style="text-align: center;">约4.6亿次/*</td></tr></tbody></table><h2 id="计数排序桶排序">计数排序，桶排序</h2><h3 id="计数排序">计数排序</h3><p>统计每个元素出现了多少次，再根据统计结果输出，如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/countingSort.gif" alt="计数排序" /></p><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>T bucket<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> countingSort<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>bucket<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>bucket<span class="op">));</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        assert<span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;</span> MAXN <span class="op">&amp;&amp;</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        bucket<span class="op">[</span>a<span class="op">[</span>i<span class="op">]]++;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> MAXN<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>bucket<span class="op">[</span>i<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>k<span class="op">++]</span> <span class="op">=</span> i<span class="op">;</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">--</span>bucket<span class="op">[</span>i<span class="op">];</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-5">运行效率</h3><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.216</td><td style="text-align: center;">0.168</td><td style="text-align: center;">0.165</td><td style="text-align: center;">0.176</td><td style="text-align: center;">0.229</td><td style="text-align: center;">0.803</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.200</td><td style="text-align: center;">0.156</td><td style="text-align: center;">0.166</td><td style="text-align: center;">0.174</td><td style="text-align: center;">0.230</td><td style="text-align: center;">0.823</td></tr></tbody></table><h3 id="桶排序">桶排序</h3><p>计数排序的升级版，每个桶是一个区间，桶内数据先排序，然后按照计数排序的方法逐个从桶中取出数据。非常便于并行处理。</p><h2 id="基数排序">基数排序</h2><h3 id="思想-6">思想</h3><p>是桶排序的变种，与桶排序按照区间分配数据不同，基数排序根据键值的每位数字来分配桶。</p><h3 id="图解-6">图解</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/al/radixSort.gif" alt="基数排序" /></p><h3 id="实现-6">实现</h3><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BASE 10</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>T b<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> radixSort<span class="op">(</span>T <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span>  </span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    T m <span class="op">=</span> a<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> exp <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> m<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            m <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>m <span class="op">/</span> exp <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> bucket<span class="op">[</span>BASE<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span> <span class="dv">0</span> <span class="op">&#125;;</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            bucket<span class="op">[(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">/</span> exp<span class="op">)</span> <span class="op">%</span> BASE<span class="op">]++;</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> BASE<span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            bucket<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> bucket<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">&#123;</span></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            b<span class="op">[--</span>bucket<span class="op">[(</span>a<span class="op">[</span>i<span class="op">]</span> <span class="op">/</span> exp<span class="op">)</span> <span class="op">%</span> BASE<span class="op">]]</span> <span class="op">=</span> a<span class="op">[</span>i<span class="op">];</span></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> b<span class="op">[</span>i<span class="op">];</span></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        exp <span class="op">*=</span> BASE<span class="op">;</span></span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="运行效率-6">运行效率</h3><table><thead><tr class="header"><th style="text-align: center;"><span class="math inline">\(n\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 100\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 3000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 10000\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e5\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e6\)</span></th><th style="text-align: center;"><span class="math inline">\(n &lt; 1e7\)</span></th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">随机数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.024</td><td style="text-align: center;">0.270</td><td style="text-align: center;">2.734</td></tr><tr class="even"><td style="text-align: center;">特殊数据</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.000</td><td style="text-align: center;">0.023</td><td style="text-align: center;">0.254</td><td style="text-align: center;">2.730</td></tr></tbody></table><h2 id="堆排序">堆排序</h2><p>使用二叉堆进行的排序，排序的思想就是二叉堆插入删除的原理，堆排序的复杂度为<span class="math inline">\(O(n\log n)\)</span>。</p><p>这里给出二叉堆的实现：</p><div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>T heap<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> goUp<span class="op">(</span>T <span class="op">*</span>heap<span class="op">,</span> <span class="dt">int</span> p<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(;</span>p <span class="op">&gt;</span> <span class="dv">1</span><span class="op">;</span> p <span class="op">&gt;&gt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>heap<span class="op">[</span>p<span class="op">]</span> OP heap<span class="op">[</span>p <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">])</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            swap<span class="op">(&amp;</span>heap<span class="op">[</span>p<span class="op">],</span> <span class="op">&amp;</span>heap<span class="op">[</span>p <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">break</span><span class="op">;</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> insert<span class="op">(</span>T <span class="op">*</span>heap<span class="op">,</span> <span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    heap<span class="op">[++(*</span>n<span class="op">)]</span> <span class="op">=</span> x<span class="op">;</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    goUp<span class="op">(</span>heap<span class="op">,</span> <span class="op">*</span>n<span class="op">);</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> goDown<span class="op">(</span>T <span class="op">*</span>heap<span class="op">,</span> <span class="dt">int</span> p<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> s <span class="op">=</span> p <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(;</span> s <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>s <span class="op">+</span> <span class="dv">1</span> <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> heap<span class="op">[</span>s <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> OP heap<span class="op">[</span>s<span class="op">])</span> s<span class="op">++;</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>heap<span class="op">[</span>s<span class="op">]</span> OP heap<span class="op">[</span>p<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            swap<span class="op">(&amp;</span>heap<span class="op">[</span>s<span class="op">],</span> <span class="op">&amp;</span>heap<span class="op">[</span>p<span class="op">]);</span></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> s<span class="op">;</span> s <span class="op">=</span> p <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">break</span><span class="op">;</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> pop<span class="op">(</span>T <span class="op">*</span>heap<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    swap<span class="op">(&amp;</span>heap<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="op">&amp;</span>heap<span class="op">[*</span>n<span class="op">]);</span></span><span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">--(*</span>n<span class="op">);</span></span><span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    goDown<span class="op">(</span>heap<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">*</span>n<span class="op">);</span></span><span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> remov<span class="op">(</span>T <span class="op">*</span>heap<span class="op">,</span> <span class="dt">int</span> p<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    swap<span class="op">(&amp;</span>heap<span class="op">[</span>p<span class="op">],</span> <span class="op">&amp;</span>heap<span class="op">[*</span>n<span class="op">]);</span></span><span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">--(*</span>n<span class="op">);</span></span><span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    goUp<span class="op">(</span>heap<span class="op">,</span> <span class="op">*</span>n<span class="op">);</span>goDown<span class="op">(</span>heap<span class="op">,</span> p<span class="op">,</span> <span class="op">*</span>n<span class="op">);</span></span><span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="可视化网站推荐">可视化网站推荐</h2><p>https://www.cs.usfca.edu/~galles/visualization/Algorithms.html</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>测试平台：AMD 5000系列CPU，主频1.8GHz。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>斗地主？是的，就是它。。。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>约束优化问题</title>
      <link href="/2022/03/09/math/%E7%BA%A6%E6%9D%9F%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98/"/>
      <url>/2022/03/09/math/%E7%BA%A6%E6%9D%9F%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="约束优化问题介绍">约束优化问题介绍</h2><p>如下所示的公式即约束优化问题（Constrained <strong>Optimization</strong> Problem）的一般形式： <span class="math display">\[\underset{\pmb{x}\in\mathbb{R}^d}\min f(\pmb{x})\\s.t.\ h_i(\pmb{x})=0,(i=1,2,\dots,m)\\g_j(\pmb{x})\leq0,(j=1,2,\dots,n)\tag{1.0}\]</span> 写成拉格朗日函数的形式： <span class="math display">\[L(\pmb{x},\pmb{\lambda},\pmb{\mu})=f(\pmb{x})+\stackrel{m}{\underset{i=1}\sum}\lambda_i h_i(\pmb{x})+\stackrel{n}{\underset{i=1}\sum}\mu_ig_j(\pmb{x})\]</span> 原始问题与下面的问题是等价的： <span class="math display">\[\underset{\pmb{x}}\min \underset{\pmb{\lambda},\pmb{\mu}}\max L(\pmb{x},\pmb{\lambda},\pmb{\mu})\\s.t.\ \lambda_i\geq0\tag{1.1}\]</span> 下面给出证明：</p><ol type="1"><li><p>如果<span class="math inline">\(\pmb{x}_i\)</span>违反了约束<span class="math inline">\(g_j(\pmb{x})\leq0\)</span>，则<span class="math inline">\(g_j(\pmb{x})&gt;0\)</span>，<span class="math inline">\(\underset{\pmb{\mu}}{\max}L\rightarrow\infty\)</span>。如果<span class="math inline">\(\pmb{x}_i\)</span>符合约束，则<span class="math inline">\(\underset{\pmb{\mu}}{\max}L\)</span>有确定的数值。 <span class="math display">\[\underset{\pmb{x}}\min \underset{\pmb{\mu}}\max L=\underset{\pmb{x}}\min\{\underset{\pmb{\mu}}{\max}L,+\infty\}=\underset{\pmb{x}}\min\underset{\pmb{\mu}}\max L\]</span></p></li><li><p>对于<span class="math inline">\(\pmb{\lambda}\)</span>的证明同理。</p></li></ol><p>上面的证明表明了式(1.1)中蕴含了<span class="math inline">\(\pmb{x}_i\)</span><strong>包含在约束中</strong>这个条件。</p><h2 id="对偶问题">对偶问题</h2><p>与问题(1.1)表示恰好相反的问题，即： <span class="math display">\[\underset{\pmb{\lambda},\pmb{\mu}}\max \underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda},\pmb{\mu})\\s.t.\ \lambda_i\geq0\tag{1.2}\]</span> 原问题是关于<span class="math inline">\(\pmb{x}\)</span>的函数，对偶问题是关于<span class="math inline">\(\pmb{\lambda},\pmb{\mu}\)</span>的函数。</p><h3 id="弱对偶性">弱对偶性</h3><p>特点：令<span class="math inline">\(p=\underset{\pmb{x}}\min \underset{\pmb{\lambda},\pmb{\mu}}\max L(\pmb{x},\pmb{\lambda},\pmb{\mu})\)</span>，<span class="math inline">\(d=\underset{\pmb{\lambda},\pmb{\mu}}\max \underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda},\pmb{\mu})\)</span>，则<span class="math inline">\(d\leq p\)</span>，即对偶问题的值不会大于原问题。</p><p>证明：</p><p>下式恒成立： <span class="math display">\[\underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda},\pmb{\mu})\leq L(\pmb{x},\pmb{\lambda},\pmb{\mu})\leq \underset{\pmb{\lambda},\pmb{\mu}}\max L(\pmb{x},\pmb{\lambda},\pmb{\mu})\\\]</span> 令<span class="math inline">\(A(\pmb{\lambda},\pmb{\mu})=\underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda},\pmb{\mu}),B(\pmb{x})=\underset{\pmb{\lambda},\pmb{\mu}}\max L(\pmb{x},\pmb{\lambda},\pmb{\mu})\)</span>，则下式成立： <span class="math display">\[A(\pmb{\lambda},\pmb{\mu})\leq L(\pmb{x},\pmb{\lambda},\pmb{\mu})\leq B(\pmb{x})\\A(\pmb{\lambda},\pmb{\mu})\leq B(\pmb{x})\]</span> 得到恒小于的关系，则： <span class="math display">\[\underset{\pmb{\lambda},\pmb{\mu}}\max A(\pmb{\lambda},\pmb{\mu}) \leq \underset{\pmb{x}}\min B(\pmb{x})\]</span> 结论得证。</p><h3 id="对偶性的几何解释">对偶性的几何解释</h3><p>为了直观理解，我们对问题(1.0)做一下简化： <span class="math display">\[\underset{\pmb{x}\in\mathbb{R}^d}\min f(\pmb{x})\\s.t.\ g_1(\pmb{x})\leq0\tag{1.3}\]</span> 令定义域<span class="math inline">\(D=\text{dom}\ f \cap \text{dom}\ g_1\)</span>，拉格朗日函数<span class="math inline">\(L(\pmb{x}, \lambda)=f(\pmb{x})+\lambda g_1(\pmb{x}),(\lambda \geq0)\)</span>，原问题最优解<span class="math inline">\(P^*={\min}\ f(\pmb{x})\)</span>，对偶问题最优解<span class="math inline">\(d^*=\underset{\lambda}\max\underset{\pmb{x}}\min L(\pmb{x},\lambda)\)</span>。</p><p>定义集合<span class="math inline">\(G=\{(g_1(\pmb{x}),f(\pmb{x}))\ | \ \pmb{x}\in D\}\)</span>，几何意义为二维坐标系下的一个区域。那么，<span class="math inline">\(p^*\)</span>可以表示为： <span class="math display">\[\begin{align*}p^*&amp;=\min\ f(\pmb{x})\\&amp;=\inf \{f(\pmb{x})\ |\ (g_1(\pmb{x}), f(\pmb{x})) \in G,g_1(\pmb{x}) \leq 0\}\end{align*}\]</span> 为了方便之后的表示，我们将<span class="math inline">\(f(\pmb{x})\)</span>表示为<span class="math inline">\(t\)</span>，<span class="math inline">\(g_1(\pmb{x})\)</span>表示为<span class="math inline">\(u\)</span>，<span class="math inline">\(h(\lambda)=\underset{\pmb{x}}{\min} (t + \lambda u)\)</span>。<span class="math inline">\(d^*\)</span>可以表示为： <span class="math display">\[\begin{align*}d^*&amp;=\underset{\lambda}\max\underset{\pmb{x}}\min L(\pmb{x},\lambda)\\&amp;=\underset{\lambda}\max\underset{\pmb{x}}\min(t + \lambda u)\\&amp;=\underset{\lambda}\max\ h(\lambda)\\&amp;=\underset{\lambda}\max\ \inf\{t+\lambda u\ |\ (u, t) \in G\}\end{align*}\]</span> 以<span class="math inline">\(u,t\)</span>为轴，建立平面直角坐标系。如果图上闭合曲线围成的部分是<span class="math inline">\(G\)</span>所表示的区域，那么根据定义，<span class="math inline">\(p^*\)</span>在图上的表示如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/cop1.png" alt="p*的表示" /></p><p>根据<span class="math inline">\(h(\lambda)\)</span>的意义，可以看出它实际上是一组直线方程<span class="math inline">\(t+\lambda u - h(\lambda) = 0\)</span>。因为<span class="math inline">\(\lambda\geq0\)</span>，所以这条直线的斜率一定是负数，而<span class="math inline">\(h(\lambda)\)</span>的意义就是过区域<span class="math inline">\(G\)</span>的直线<span class="math inline">\(t+\lambda u - h(\lambda) = 0\)</span>的截距。如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/cop2.png" alt="h的意义" /></p><p>我们可以先平移然后调整直线的斜率，从而使得截距最大，这就找到了<span class="math inline">\(d^*\)</span>。如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/cop3.png" alt="寻找d*" /></p><p>上图中，<span class="math inline">\(d^*\)</span>和<span class="math inline">\(p^*\)</span>不重合，说明原问题不满足强对偶性，从图上我们也可以看出： <span class="math display">\[d^* \leq h(\lambda) \leq p^*\]</span> 强对偶关系才满足<span class="math inline">\(d^*=p^*\)</span>，凸优化问题是强对偶问题，凸优化问题对偶性的几何解释如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/cop4.png" alt="凸优化问题对偶性的几何解释" /></p><h2 id="kkt条件">KKT条件</h2><p>可以证明，原问题和对偶问题具有强对偶关系的充要条件是它们满足KKT条件，所以在这里介绍KKT条件的内容。</p><p>我们要求的问题如(1.0)，它的对偶问题为(1.2)：</p><p>假设<span class="math inline">\(p^*\)</span>是原问题的最优值，<span class="math inline">\(\pmb{x}^*\)</span>为原问题的最优解，<span class="math inline">\(d^*\)</span>是对偶问题的最优值，<span class="math inline">\(\pmb{\lambda}^*,\pmb{\mu}^*\)</span>是元问题的最优解。令<span class="math inline">\(A(\pmb{\lambda},\pmb{\mu})=\underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda},\pmb{\mu})\)</span></p><ol type="1"><li><p>可行条件 <span class="math display">\[h_i(\pmb{x}^*)=0,(i=1,2,\dots,m)\\g_j(\pmb{x}^*)\leq0,(j=1,2,\dots,n)\\\pmb{\mu}^*\geq0\]</span></p></li><li><p>互补松弛 <span class="math display">\[\begin{align*}d^*&amp;=\underset{\pmb{\lambda},\pmb{\mu}}\max A(\pmb{\lambda},\pmb{\mu})\\&amp;=A(\pmb{\lambda}^*,\pmb{\mu}^*)\\&amp;=\underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda}^*,\pmb{\mu}^*)\leq\underset{\pmb{x}}\min L(\pmb{x}^*,\pmb{\lambda}^*,\pmb{\mu}^*)\\&amp;=f(\pmb{x}^*)+\stackrel{m}{\underset{i=1}\sum}\lambda_i h_i(\pmb{x}^*)+\stackrel{n}{\underset{i=1}\sum}\mu_ig_j(\pmb{x}^*)\\&amp;=f(\pmb{x}^*)+\stackrel{n}{\underset{i=1}\sum}\mu_ig_j(\pmb{x}^*)\leq f(\pmb{x}^*)\\&amp;=p^*\end{align*}\]</span> 由可行条件，可以消除值为0的<span class="math inline">\(\lambda_i\)</span>项，注意到<span class="math inline">\(\mu_i\)</span>项恒为负值。由于原问题和对偶问题满足强对偶关系(满足slater条件)，所以<span class="math inline">\(d^*=p^*\)</span>，则<span class="math inline">\(f(\pmb{x}^*)+\stackrel{n}{\underset{i=1}\sum}\mu_ig_j(\pmb{x}^*)=f(\pmb{x}^*)\)</span>，得到下面的条件： <span class="math display">\[\stackrel{m}{\underset{i=1}\sum}\mu_ig_j(\pmb{x}^*)=0\]</span></p></li><li><p>梯度为0</p><p>由<span class="math inline">\(d^*=p^*\)</span>，又可以得到<span class="math inline">\(\underset{\pmb{x}}\min L(\pmb{x},\pmb{\lambda}^*,\pmb{\mu}^*)= L(\pmb{x}^*,\pmb{\lambda}^*,\pmb{\mu}^*)\)</span>，<span class="math inline">\(\pmb{x}^*\)</span>是<span class="math inline">\(L\)</span>的极值点，故有下面的关系： <span class="math display">\[\frac{\partial L(\pmb{x},\pmb{\lambda}^*,\pmb{\mu}^*)}{\partial \pmb{x}}\bigg|_{\pmb{x}=\pmb{x}^*}=0\]</span></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 高等数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 高等数学 </tag>
            
            <tag> 矩阵论 </tag>
            
            <tag> SVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>支持向量机2-软间隔</title>
      <link href="/2022/03/09/machine%20learning/svm2/"/>
      <url>/2022/03/09/machine%20learning/svm2/</url>
      
        <content type="html"><![CDATA[<h2 id="软间隔支持向量机的引入">软间隔支持向量机的引入</h2><p>在现实任务中，往往很难确定合适的线性函数或核函数（未来会详细讲解）使得训练样本在特征空间中线性可分。退一步说，即便恰好找到了某个核函数使得训练集在特征空间中线性可分，也很难断定线性可分结果不是过拟合造成的。为了防止过拟合或一些特殊的数据，我们可以允许支持向量机在某些样本出错。这是，我们引入<strong>软间隔</strong>的概念。</p><p>具体来说，前面说到的<strong>硬间隔</strong>，实际上是要求所有的训练样本均满足约束，即所有样本都要划分正确，这样难免造成过拟合的问题。而软间隔则是允许某些样本不满足约束： <span class="math display">\[\underset{\pmb{w},b}{\min}\ \frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}\mathbb{I}(y_i(\pmb{w}^\text{T}\pmb{x}_i+b)&lt;1)\tag{6.29}\]</span> 令<span class="math inline">\(C\mathbb{I}(y_i(\pmb{w}^\text{T}\pmb{x}_i+b)&lt;1)\)</span>表示每个样本不符合约束的损失。但我们发现它是一个阶跃函数，数学性质不好，不方便今后的分析，我们将这个函数改为连续函数： <span class="math display">\[\mathbb{I}=\begin{cases}0,\ \textbf{if}\ y_i(\pmb{w}^\text{T}\pmb{x}_i+b)\geq1\\1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b),\ \textbf{if}\ y_i(\pmb{w}^\text{T}\pmb{x}_i+b)&lt;1\end{cases}=\max(0,1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b))\tag{6.30}\]</span> 这个函数被称为hinge loss（合页损失），函数的图像为：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm4.png" alt="hinge损失" /></p><p>对每一个样本点引入一个松弛变量<span class="math inline">\(\xi_i=\max(0,1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b))\)</span>，得到的软间隔模型可以表示为为一个标准的约束问题： <span class="math display">\[\underset{\pmb{w},b}{\min}\ \frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}\xi_i\\s.t.\ y_i(\pmb{w}^\text{T}\pmb{x}_i+b)\geq1-\xi_i\\\xi_i\geq0\]</span> 软间隔模型的图示如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm5.png" alt="软间隔模型松弛变量的几何意义" /></p><h2 id="求解软间隔模型">求解软间隔模型</h2><p>类似于硬间隔模型的求解，构造原问题的拉格朗日函数： <span class="math display">\[L(\pmb{w},b,\pmb{\alpha},\pmb{\xi},\pmb{\mu})=\frac{1}{2}||\pmb{w}||^2+C\stackrel{m}{\underset{i=1}\sum}\xi_i+\stackrel{m}{\underset{i=1}\sum}\alpha_i(1-\xi_i-y_i(\pmb{w}^\text{T}\pmb{x}_i+b))-\stackrel{m}{\underset{i=1}\sum}\mu_i\xi_i\]</span> 令<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha},\pmb{\xi},\pmb{\mu})\)</span>对<span class="math inline">\(\pmb{w},b,\xi_i\)</span>求导，令导数为0，得到以下结果： <span class="math display">\[\pmb{w}=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{x}_i\tag{6.37}\]</span></p><p><span class="math display">\[0=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\tag{6.38}\]</span></p><p><span class="math display">\[C=\alpha_i+\mu_i\tag{6.39}\]</span></p><p>将下面的结果代入<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha},\pmb{\xi},\pmb{\mu})\)</span>，相当于得到了原式的对偶问题，具体的说明见硬间隔支持向量机一节： <span class="math display">\[\underset{\pmb{\alpha}}{\max} \stackrel{m}{\underset{i=1}\sum}\alpha_i-\frac{1}{2}\stackrel{m}{\underset{i=1}\sum}\stackrel{m}{\underset{j=1}\sum}\alpha_i\alpha_jy_iy_j\pmb{x}_i^\text{T}\pmb{x}_j\\s.t.\ \stackrel{m}{\underset{i=1}\sum}\alpha_iy_i=0\\0\leq\alpha_i\leq C (i = 1,2,\dots,m)\]</span> 将式(6.40)与硬间隔下的对偶问题(6.11)对比可看出，两者唯一的差别就在于对偶变量的约束不同：前者是<span class="math inline">\(0 \leq a_i\leq C\)</span>, 后者是<span class="math inline">\(0\leq a_i\)</span>。于是，可采用与硬间隔支持向量机相同的算法求解式(6.40)，在引入核函数后能得到与式(6.24) 同样的支持向量展式。</p><p>该问题满足KKT条件： <span class="math display">\[\begin{cases}\alpha_i\geq0,\mu_i\geq0\\y_if(\pmb{x}_i)-1+\xi_i\geq0\\ \alpha_i(y_if(\pmb{x}_i)-1+\xi_i)=0\\\xi_i\geq0,\mu_i\xi_i=0\end{cases}\]</span> 于是，对任意训练样本<span class="math inline">\((\pmb{x}_i,y_i)\)</span> ，总有<span class="math inline">\(\alpha_i=0\)</span>或<span class="math inline">\(y_if(\pmb{x}_i)=1-\xi_i\)</span>。若<span class="math inline">\(\alpha_i=0\)</span>则该样本不会对<span class="math inline">\(f(\pmb{x})\)</span>有任何影响，若<span class="math inline">\(\alpha_i&gt;0\)</span>，则必有<span class="math inline">\(y_if(\pmb{x}_i)=1-\xi_i\)</span>，即该样本是支持向量：由式(6.39)可知，若<span class="math inline">\(\alpha_i&lt; C\)</span>, 则<span class="math inline">\(\mu_i&gt;0\)</span>, 进而有<span class="math inline">\(\xi_i=0\)</span>，即该样本恰在最大间隔边界上；若<span class="math inline">\(\alpha_i=C\)</span>，则有<span class="math inline">\(\mu_i=0\)</span>，此时若<span class="math inline">\(\xi_i\leq1\)</span>，则该样本落在最大间隔内部，若<span class="math inline">\(\xi_i&gt;1\)</span>则该样本被错误分类。由此可看出，软间隔支持向量机的最终模型仅与支持向量有关，即通过采用hinge损失函数仍保持了稀疏性。</p><h2 id="软间隔svm问题的一般化">软间隔SVM问题的一般化</h2><p>我们可以用其它的替代函数代替式(6.29)的损失函数。我们还可以把这类问题写为一般的形式： <span class="math display">\[\underset{f}\min \Omega(f)+C\stackrel{m}{\underset{i=1}\sum}\mathscr{l}(f(\pmb{x}_i),y_i)\tag{6.42}\]</span> 其中<span class="math inline">\(\Omega(f)\)</span>称为“结构风险<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>”(structural risk) ，用于描述模型f的某些性质，第二项<span class="math inline">\(\stackrel{m}{\underset{i=1}\sum}\mathscr{l}(f(\pmb{x}_i),y_i)\)</span>称为“经验风险”(empirical risk) ，用于描述模型与训练数据的契合程度；<span class="math inline">\(C\)</span>用于对二者进行折中。从经验风险最小化的角度来看，<span class="math inline">\(\Omega(f)\)</span>表述了我们希望获得具有何种性质的模型（例如希望获得复杂度较小的模型），这为引入领域知识和用户意图提供了途径；另一方面，该信息有助于削减假设空间，从而降低了最小化训练误差的过拟合风险。从这个角度来说，式(6.42)称为“正则化<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>”(regularization) 问题，<span class="math inline">\(\Omega(f)\)</span>称为正则化项， <span class="math inline">\(C\)</span>则称为正则化常数。<span class="math inline">\(L_p\)</span>范数(norm) 是常用的正则化项，其中<span class="math inline">\(L_2\)</span>范数<span class="math inline">\(||\pmb{w}||_2\)</span>归倾向于<span class="math inline">\(\pmb{w}\)</span>的分量取值尽量均衡，即非零分最个数尽量稠密，而<span class="math inline">\(L_0\)</span>范数<span class="math inline">\(||\pmb{w}||_0\)</span>和<span class="math inline">\(L_1\)</span>范数<span class="math inline">\(||\pmb{w}||_1\)</span>则倾向于<span class="math inline">\(\pmb{w}\)</span>的分量尽量稀疏，即非零分量个数尽量少。</p><h2 id="本节最后的话">本节最后的话</h2><h3 id="xi_i到底是个啥有没有直观的方法理解它"><span class="math inline">\(\xi_i\)</span>到底是个啥？有没有直观的方法理解它？</h3><p>我们在求解软间隔向量机的约束问题时，其实可以不用过多考虑<span class="math inline">\(\xi_i\)</span>的意义。</p><p><span class="math inline">\(\xi_i\)</span>的几何意义，实际上就是不满足约束条件的样本距离约束边界（也可以说是同类样本聚集区边界）的距离，在求解问题时可以通过<span class="math inline">\(\pmb{w},b\)</span>推知。既然是距离，必然会满足<span class="math inline">\(\xi_i\geq0\)</span>。我们的最终目标就是在硬间隔分类的基础上，求出一个超平面，将<span class="math inline">\(\xi_i\)</span>的总和降至最低。<strong>软间隔支持向量机的支持向量</strong>如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm6.png" alt="几何意义解释" /></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>总体风险中直接对应模型结构的部分<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>正则化可理解为一种＂罚函数法”，即对不希望得到的结果施以惩罚，从而使得优化过程趋向于希望目标。从贝叶斯估计的角度来看，正则化项可认为是提供了模型的先验概率。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 分类问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>支持向量机1-硬间隔</title>
      <link href="/2022/03/08/machine%20learning/svm1/"/>
      <url>/2022/03/08/machine%20learning/svm1/</url>
      
        <content type="html"><![CDATA[<h2 id="svm的相关知识">SVM的相关知识</h2><p>SVM中涉及的主要思想（三宝）：间隔，对偶，核技巧。</p><p>SVM的主要类别：硬间隔，软间隔，核技巧。</p><h2 id="线性可分支持向量机">线性可分支持向量机</h2><h3 id="解决的问题及思想">解决的问题及思想</h3><p>给定训练集<span class="math inline">\(D=\{(\pmb{x}_i,y_i)\}_{i=1}^m,\pmb{x}_i=(x_1,x_2,\dots,x_d),y_i\in\{0,1\}\)</span>，给定的训练集是线性可分的，如下图所示。寻找一个超平面尽可能正确分类测试集中的示例。图中红色表示正例，蓝色表示反例。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm1.png" alt="图6.1 线性分类" /></p><p>利用误分类最小策略划分出的超平面有无数个，如上图展示了几个超平面。但最好的是哪一个超平面？直观上讲，两类训练样本最中间的平面（图上橙色的）该最好，即使用<strong>间隔最大化</strong>求出的超平面。这个超平面受噪声的影响最小，对未见示例得泛化能力应该最强。在样本空间中，划分超平面可通过如下线性方程来描述： <span class="math display">\[\pmb{w}^\text{T}\pmb{x}+b=0\]</span> 其中<span class="math inline">\(\pmb{w}=(w_1,w_2,\dots,w_n)^\text{T}\)</span>为平面的法向量，决定了超平面的方向，并且指向正例，<span class="math inline">\(b\)</span>为位移项，决定了超平面与原点之间的距离。</p><h3 id="定义">定义</h3><p>给定线性可分数据集，通过<strong>间隔最大化</strong>等价的求解相应的凸二次规划问题学习得到的分离超平面为： <span class="math display">\[\pmb{w}^{*\text{T}}\cdot\pmb{x}+b^*=0\]</span> 以及相对应的分类决策函数： <span class="math display">\[f(\pmb{x})=\text{sign}(\pmb{w}^{*\text{T}}\cdot\pmb{x}+b^*)\]</span></p><h2 id="间隔最大化模型">间隔最大化模型</h2><h3 id="点到超平面的距离公式">点到超平面的距离公式</h3><p>平面外一点到平面的距离公式为： <span class="math display">\[\gamma = \frac{|\pmb{w}^\text{T}\pmb{x}+b|}{||\pmb{w}||}\tag{6.2}\]</span> 证明：设平面外一点为A，在平面上任取一点为C，<span class="math inline">\(\vec{AC}=\pmb{C}-\pmb{A}\)</span>，<span class="math inline">\(\stackrel{\rightarrow}{AC}\)</span>在<span class="math inline">\(\pmb{w}\)</span>上的投影长度为<span class="math inline">\(\vec{AC}\cdot\pmb{w}=|\vec{AC}|\cdot||\pmb{w}||\cdot\cos&lt;\vec{AC},\pmb{w}&gt;\)</span>，距离<span class="math inline">\(\gamma=|\vec{AC}|\cdot\cos&lt;\vec{AC},\pmb{w}&gt;\)</span>，所以可推出： <span class="math display">\[\gamma = \frac{\vec{AC}\cdot\pmb{w}}{||\pmb{w}||}\]</span> 得到距离公式(6.2)。</p><h3 id="几何间隔">几何间隔</h3><p>关于给定数据集<span class="math inline">\(D\)</span>和超平面<span class="math inline">\(\pmb{w}^\text{T}\pmb{x}+b=0\)</span>，定义数据集任意一个样本点<span class="math inline">\((\pmb{x}_i,y_i),y_i\in\{-1,1\}\)</span>，关于超平面的几何间隔为： <span class="math display">\[\gamma_i=y_i\frac{(\pmb{w}^\text{T}\pmb{x}+b)}{||\pmb{w}||}\]</span> 正确分类时，<span class="math inline">\(\gamma_i&gt;0\)</span>，错误分类时，<span class="math inline">\(\gamma_i&lt;0\)</span>。</p><p>定义数据集<span class="math inline">\(D\)</span>关于超平面的几何间隔为：数据集中所有样本点的几何间隔最小值。 <span class="math display">\[\gamma = \min \gamma_i\]</span> 支持向量机转为约束条件下的优化问题： <span class="math display">\[\underset{\pmb{w},b}{\max} \gamma\\s.t. \gamma_i \geq \gamma\]</span> 设<span class="math inline">\(\pmb{x}_{min},y_{min}\)</span>表示<span class="math inline">\(\gamma\)</span>对应的数据，代入几何间隔计算公式，原问题可表示为： <span class="math display">\[\underset{\pmb{w},b}{\max} \gamma = y_{min}\frac{\pmb{w}^\text{T}\pmb{x}_{min}+b}{||\pmb{w}||}\\s.t.\ y_i(\pmb{w}^\text{T}\pmb{x}_i+b) \geq y_{min}(\pmb{w}^\text{T}\pmb{x}_{min}+b)\]</span></p><p>假设该问题的最优解是<span class="math inline">\((\pmb{w}^*,b^*)\)</span>，那么<span class="math inline">\((\alpha\pmb{w}^*,\alpha b^*),\alpha\in\mathbb{R}^+\)</span>也是最优解，且超平面不变。因此需要人为的对<span class="math inline">\((\pmb{w}^*,b^*)\)</span>，做一定的限制，才能是这个最优化问题有可解的唯一解。不妨令<span class="math inline">\(\gamma=1\)</span>，这样对于特定的<span class="math inline">\((\pmb{x}_{min},y_{min})\)</span>来说，令<span class="math inline">\(\gamma=1\)</span>的<span class="math inline">\(\alpha\)</span>有且仅有一个。</p><p>我们的问题化解为： <span class="math display">\[\underset{\pmb{w},b}{\max} \gamma = \frac{1}{||\pmb{w}||}\\s.t.\ \ y_i(\pmb{w}^\text{T}\pmb{x}_i+b) \geq 1\tag{6.3}\]</span> 我们现在构建的模型如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm2.png" alt="图6.2 支持向量与间隔" /></p><p>求<span class="math inline">\(\gamma\)</span>的最大，就相当于求<span class="math inline">\(\frac{1}{\gamma}\)</span>的最小，将(6.3)改为最优化问题的常见形式： <span class="math display">\[\underset{\pmb{w},b}{\min} \frac{1}{2}||\pmb{w}||^2\\s.t.\ 1 - y_i(\pmb{w}^\text{T}\pmb{x}_i+b) \leq 0\]</span> 这就是<strong>支持向量机</strong>的基本型。上面的间隔最大化模型，又称为<strong>硬间隔</strong>。</p><h2 id="求解模型">求解模型</h2><h3 id="直接求解可能的问题">直接求解可能的问题</h3><p>如果样本的维度较低，可以直接使用现有的软件包直接处理。但是，如果维度比较高，或者使用了核函数将示例从低维转化为高维，那么，暴力求解的开销将会非常大，效率就会大大降低。上述的优化问题有一个很好的性质，就是<strong>对偶性</strong>。使用对偶性，可以加速问题的求解。</p><h3 id="转化为无约束问题">转化为无约束问题</h3><p>使用拉格朗日乘子法构造拉格朗日函数来去掉约束： <span class="math display">\[L(\pmb{w},b,\pmb{\alpha})=\frac{1}{2}||\pmb{w}||^2+\stackrel{m}{\underset{i=1}\sum}\alpha_i(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b))\tag{6.8}\]</span> 其中<span class="math inline">\(\alpha_i&gt;0\)</span>(目标和约束函数梯度一定相反)。原问题相当于： <span class="math display">\[\underset{\pmb{w},b}{\min} \underset{\pmb{\alpha}}{\max} L(\pmb{w},b,\pmb{\alpha})\\s.t.\ \pmb{\alpha} \succeq 0\]</span> 证明：</p><ol type="1"><li><p>如果<span class="math inline">\(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b)&gt;0\)</span>，则<span class="math inline">\(\underset{\pmb{\alpha}}{\max}L(\pmb{w},b,\pmb{\alpha})=\frac{1}{2}||\pmb{w}^2||+\infty\)</span>。</p></li><li><p>如果<span class="math inline">\(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b)\leq0\)</span>，则<span class="math inline">\(\underset{\pmb{\alpha}}{\max}L(\pmb{w},b,\pmb{\alpha})=\frac{1}{2}||\pmb{w}^2||+0\)</span>，得到<span class="math inline">\(\underset{\pmb{w},b}{\min} \underset{\pmb{\alpha}}{\max} L(\pmb{w},b,\pmb{\alpha})=\underset{\pmb{w},b}{\min} \frac{1}{2}||\pmb{w}^2||\)</span>。</p><p>综合以上两点： <span class="math display">\[\underset{\pmb{w},b}{\min} \underset{\pmb{\alpha}}{\max} L(\pmb{w},b,\pmb{\alpha})=\underset{\pmb{w},b}{\min}(\infty,\frac{1}{2}||\pmb{w}||^2)=\underset{\pmb{w},b}{\min}\frac{1}{2}||\pmb{w}||^2\]</span></p></li></ol><h3 id="转化为对偶问题">转化为对偶问题</h3><p>原问题的<span class="math inline">\(\pmb{\alpha}\)</span>是非常难求的。所以我们想通过先最优化<span class="math inline">\(\pmb{w},b\)</span>，最后确定<span class="math inline">\(\pmb{\alpha}\)</span>的方法解决现在的问题。于是我们引入了原问题的对偶问题。</p><p>给出原问题的对偶问题： <span class="math display">\[\underset{\pmb{\alpha}}{\max} \underset{\pmb{w},b}{\min}L(\pmb{w},b,\pmb{\alpha})\\s.t.\ \pmb{\alpha} \succeq 0\]</span> 对偶问题和原问题之间一定存在弱对偶关系： <span class="math display">\[\min \max L \geq \max \min L\]</span> 最大值中最小的一定大于等于最小值中最大的。</p><p>为了解决上面的问题，我们需要强对偶关系，上面的问题是<strong>凸优化</strong>问题，可以证明，凸优化问题一定满足强对偶关系： <span class="math display">\[\min \max L = \max \min L\]</span> 下面就可以通过求解对偶问题得到原问题的解。令<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha})\)</span>分别对<span class="math inline">\(\pmb{w},b\)</span>求导： <span class="math display">\[\begin{align*}\frac{\partial L(\pmb{w},b,\pmb{\alpha})}{\partial \pmb{w}}&amp;=\frac{\partial \frac{1}{2}\pmb{w}^\text{T}\pmb{w}+\stackrel{m}{\underset{i=1}\sum}\alpha_i-\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{w}^\text{T}\pmb{x}_i+\stackrel{m}{\underset{i=1}\sum}\alpha_iy_ib}{\partial \pmb{w}}\\&amp;=\pmb{w}-\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{x}_i\end{align*}\]</span></p><p><span class="math display">\[\begin{align*}\frac{\partial L(\pmb{w},b,\pmb{\alpha})}{\partial b}&amp;=\frac{\partial \frac{1}{2}\pmb{w}^\text{T}\pmb{w}+\stackrel{m}{\underset{i=1}\sum}\alpha_i-\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{w}^\text{T}\pmb{x}_i+\stackrel{m}{\underset{i=1}\sum}\alpha_iy_ib}{\partial b}\\&amp;=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\end{align*}\]</span></p><p>令导数等于0求得<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha})\)</span>的极值点： <span class="math display">\[\pmb{w}^*=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{x}_i\tag{6.9}\]</span></p><p><span class="math display">\[\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i=0\tag{6.10}\]</span></p><p>将(6.9)(6.10)代入(6.8)，对偶问题可化为： <span class="math display">\[\underset{\pmb{\alpha}}{\max}\ -\frac{1}{2}\stackrel{m}{\underset{i=1}\sum}\stackrel{m}{\underset{i=1}\sum}\alpha_i\alpha_jy_iy_j\pmb{x}_i^\text{T}\pmb{x}_j+\stackrel{m}{\underset{i=1}\sum}\alpha_i\\s.t.\ \stackrel{m}{\underset{i=1}\sum}\alpha_iy_i=0\tag{6.11}\\ \pmb{\alpha}\succeq 0\\\]</span> <span class="math inline">\(\pmb{w}\)</span>已经求解完成，那么使用SMO<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>算法解出<span class="math inline">\(\pmb{\alpha}\)</span>后，再求出<span class="math inline">\(b\)</span>即可得到模型： <span class="math display">\[f(\pmb{x})=\pmb{w}^\text{T}\pmb{x}+b=\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{x}_i^\text{T}\pmb{x}+b\tag{6.12}\]</span></p><p><span class="math inline">\(b\)</span>该怎么求？</p><h3 id="使用kkt条件求解b的值">使用KKT条件求解b的值</h3><p>可以证明一个结论，<strong>原问题和对偶问题具有强对偶关系的充要条件是它们满足KKT条件</strong>。</p><p>因为式(6.3)中存在不等式约束，则原问题和对偶问题都满足KKT条件： <span class="math display">\[\begin{cases}\nabla_{\pmb{w}}=0,\nabla_{b}=0\\ \alpha_i(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b))=0\\ \alpha_i\geq0\\1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b)\leq0\end{cases}\]</span> 其中的第二个条件被称为<strong>slackness条件</strong>。可以这样理解，如果<span class="math inline">\(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b)&lt;0\)</span>，为了使得<span class="math inline">\(L(\pmb{w},b,\pmb{\alpha})\)</span>最小，<span class="math inline">\(\alpha_i\)</span>必然是0，该样本不会出现在(6.12)的求和中，不会对超平面的结果产生任何影响。如果<span class="math inline">\(1-y_i(\pmb{w}^\text{T}\pmb{x}_i+b)=0\)</span>，若<span class="math inline">\(\alpha_i&gt;0\)</span>，则<span class="math inline">\(y_i(\pmb{w}^\text{T}\pmb{x}_i+b)=1\)</span>，所对应的样本点位于最大间隔边界上，是一个<strong>支持向量</strong>。若<span class="math inline">\(\alpha_i=0\)</span>，样本点不会对超平面产生影响。这也揭示了支持向量机的一个重要性质：训练完成后，大部分的训练样本都不需要保留，最终模型只与支持向量有关。</p><p>由原始问题的约束条件<span class="math inline">\(y_i(\pmb{w}^\text{T}\pmb{x}_i+b)=1\)</span>，和支持向量<span class="math inline">\((\pmb{x}_k,y_k)\)</span>，解得： <span class="math display">\[\exists (\pmb{x}_k,y_k),s.t.\ y_k(\pmb{w}^\text{T}\pmb{x}_k+b)=0\\b^*=y_k-\stackrel{m}{\underset{i=1}\sum}\alpha_iy_i\pmb{x}_i^\text{T}\pmb{x}_k\]</span></p><p>至此，我们终于解决了<span class="math inline">\(\pmb{w},b\)</span>的求解问题。</p><h2 id="本节结束的话">本节结束的话</h2><h3 id="支持向量机中的支持向量是什么">支持向量机中的支持向量是什么？</h3><p>距离超平面最近的且满足约束条件<span class="math inline">\(g(\pmb{x})=0\)</span>的几个训练样本点被称为支持向量，支持向量支撑的是分界面。满足<span class="math inline">\(\gamma\)</span>最小的向量就是支持向量。支持向量（即图中的星标）的图示如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/svm3.png" alt="支持向量示意图" /></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p><a href="/404.html">SMO算法详解</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 分类问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对数几率回归</title>
      <link href="/2022/03/07/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B3/"/>
      <url>/2022/03/07/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B3/</url>
      
        <content type="html"><![CDATA[<h2 id="解释一些词语的含义">解释一些词语的含义</h2><h3 id="几率">几率</h3><ol type="1"><li>(odds)在统计学中被称为<strong>几率</strong>，是事件发生的概率与该事件不发生的概率的比值。</li><li>(probability)在统计学中被称为<strong>概率</strong>，是随机事件出现的可能性（likelihood)大小。</li></ol><h3 id="对数几率回归logistic-regression">对数几率回归(logistic regression)</h3><p>直译的“逻辑回归”并不是<strong>logistic regression</strong>的本意。<strong>logistic regression</strong>起初叫做<strong>logit regression</strong>，logit是统计学家为<strong>“对几率取对数的式子”</strong>取的名字。但logit这个词不符合构词法，所以用logistic顶替了logit。</p><h2 id="需要解决的问题">需要解决的问题</h2><p>二分类问题：给定数据集<span class="math inline">\(D=\{(\pmb{x}_i,y_i)\}_{i=1}^m,\pmb{x}_i=\{x_1,x_2,\dots,x_d\},y_i\in\{0,1\}\)</span>，将<span class="math inline">\(D\)</span>中数据进行分类。</p><h2 id="问题的解决方法">问题的解决方法</h2><h3 id="从线性回归到线性分类">从线性回归到线性分类</h3><p><span class="math display">\[线性回归\stackrel{\underline{\textbf{激活函数}}}{\underset{降维}{\Rightarrow}}线性分类\]</span></p><h3 id="对数几率回归的基本思路">对数几率回归的基本思路</h3><p>取一个概率分布函数，将线性组合作为输入映射成为概率值，最终通过概率判断分类。</p><p>例如，二分类任务的输出值是0和1，而线性回归模型产生的预测值<span class="math inline">\(z=\pmb{w}^\text{T}\pmb{x}+b\)</span>是实数值。于是，我们需要将实值映射到0/1函数上。最直观的方法应该是构造一个如下的<strong>阶跃函数</strong>，若预测值小于0，判断为反例，若预测值大于0，判断为正例，预测值等于0，随机判定： <span class="math display">\[y=\begin{cases}0,z&lt;0\\1,z&gt;0\\0.5,z=0\end{cases}\]</span> <strong>阶跃函数</strong>有一个问题，就是它不连续，不能用于式<span class="math inline">\(y=g^{-1}(\pmb{w}^\text{T}\pmb{x}+b)\)</span>，我们希望找到能在一定程度上近似阶跃函数的连续可微函数。<strong>对数几率函数</strong>就是这样一个常用的替代函数： <span class="math display">\[y=\frac{1}{1+e^{-z}}\]</span> 对数几率函数是一个Sigmoid函数，它将<span class="math inline">\(z\)</span>值转化为一个接近0/1的<span class="math inline">\(y\)</span>值，并且其输出值在<span class="math inline">\(z=0\)</span>附近变化很陡。将对数几率函数作为<span class="math inline">\(g^{-1}(\cdot)\)</span>代入，得到： <span class="math display">\[y=\frac{1}{1+e^{-(\pmb{w}^\text{T}\pmb{x}+b)}}\tag{3.18}\]</span> 上式还可以变化为： <span class="math display">\[\ln \frac{y}{1-y}=\pmb{w}^\text{T}\pmb{x}+b\tag{3.19}\]</span> 由此可看出，式(3.18)实际上是在用线性回归模型的预测结果去逼近真实标记的对数几率。因此，其对应的模型称为对数几率回归。注意，虽然名字里有回归，但是它是解决<strong>分类问题</strong>的方法。这种方法有很多优点，例如它是直接对分类可能性进行建模，无需事先假设数据分布，这样就避免了假设分布不准确所带来的问题；它不是仅预测出“类别”，而是可得到近似概率预测，这对许多需利用概率辅助决策的任务很有用；此外，对率函数是任意阶可导的凸函数，有很好的数学性质。现有的许多数值优化算法都可直接用于求取最优解。</p><h3 id="确定相应的参数">确定相应的参数</h3><p>下面我们来看如何确定式(3.18)的<span class="math inline">\(\pmb{w}\)</span>和<span class="math inline">\(b\)</span>。</p><p>若将式(3.18)中的<span class="math inline">\(y\)</span>视为类后验概率估计<span class="math inline">\(P(y=1\ |\ \pmb{x})\)</span>，即 <span class="math display">\[P(y=1\ |\ \pmb{x})=\frac{1}{1+e^{-(\pmb{w}^\text{T}\pmb{x}+b)}}\]</span> 则式(3.19)可写为： <span class="math display">\[\ln \frac{P(y=1\ |\ \pmb{x})}{P(y=0\ |\ \pmb{x})}=\pmb{w}^\text{T}\pmb{x}+b\]</span> 显然有： <span class="math display">\[P(y=1\ |\ \pmb{x})=\frac{e^{\pmb{w}^\text{T}\pmb{x}+b}}{1+e^{\pmb{w}^\text{T}\pmb{x}+b}}\tag{3.23}\]</span></p><p><span class="math display">\[P(y=0\ |\ \pmb{x})=1-P(y=1\ |\ \pmb{x})=\frac{1}{1+e^{\pmb{w}^\text{T}\pmb{x}+b}}\tag{3.24}\]</span></p><p>于是，我们可以通过“极大似然法”来估计<span class="math inline">\(\pmb{w}\)</span>和<span class="math inline">\(b\)</span>。给定数据集<span class="math inline">\(D=\{(\pmb{x}_i,y_i)\}_{i=1}^m\)</span>，对率回归模型最大化对数似然(log-likelihood)： <span class="math display">\[\mathscr{l}(\pmb{w},b)=\stackrel{m}{\underset{i=1}\sum}\ln p(y_i\ |\ \pmb{x}_i;\pmb{w},b)\tag{3.25}\]</span> 即每个样本属于其真实标记的概率越大越好。为便于讨论，令<span class="math inline">\(\pmb{\beta}=(\pmb{w};b)\)</span>，<span class="math inline">\(\hat{\pmb{x}}=(\pmb{x};1)\)</span>，则<span class="math inline">\(\pmb{w}^\text{T}\pmb{x}+b\)</span>可简写为<span class="math inline">\(\pmb{\beta}^\text{T}\pmb{x}\)</span>。则式(3.25)的似然项可重写为： <span class="math display">\[p(y_i\ |\ \pmb{x}_i;\pmb{w},b)=y_iP(y=1\ |\ \hat{\pmb{x}_i};\pmb{\beta})+(1-y_i)P(y=0\ |\ \hat{\pmb{x}_i};\pmb{\beta})\tag{3.26}\]</span> 将式(3.26)代入(3.25)，并根据式(3.23)和(3.24)可得： <span class="math display">\[\mathscr{l}(\pmb{\beta})=\stackrel{m}{\underset{i=1}\sum}(\ln(y_ie^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i}+1-y_i)-\ln(1+e^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i}))\\\mathscr{l}(\pmb{\beta})=\begin{cases}\stackrel{m}{\underset{i=1}\sum}-\ln(1+e^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i}),y_i=0\\ \stackrel{m}{\underset{i=1}\sum}(\pmb{\beta}^\text{T}\hat{\pmb{x}_i}-\ln (1+e^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i})),y_i=1\end{cases}\]</span> 分类讨论，进行综合： <span class="math display">\[\mathscr{l}(\pmb{\beta})=\stackrel{m}{\underset{i=1}\sum}(y_i\pmb{\beta}^\text{T}\hat{\pmb{x}_i}-\ln (1+e^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i}))\]</span></p><p>一般来说，最优化问题总是求解最小化，所以最大化(3.25)等于最小化<span class="math inline">\(\mathscr{l}&#39;(\pmb{\beta})=-\mathscr{l}(\pmb{\beta})\)</span>： <span class="math display">\[\mathscr{l}&#39;(\pmb{\beta})=\stackrel{m}{\underset{i=1}\sum}(-y_i\pmb{\beta}^\text{T}\hat{\pmb{x}_i}+\ln (1+e^{\pmb{\beta}^\text{T}\hat{\pmb{x}}_i}))\tag{3.27}\]</span> 式(3.27) 是关于<span class="math inline">\(\pmb{\beta}\)</span>的高阶可导连续凸函数，根据凸优化理论[Boyd and Vandenberg he, 2004] ，经典的数值优化算法如梯度下降法(gradient descent method) 、牛顿法(Newton method) 等都可求得其最优解，于是就得到： <span class="math display">\[\pmb{\beta}^*=\underset{\pmb{\beta}}{\arg\min}\mathscr{l}&#39;(\pmb{\beta})\]</span> 以牛顿法为例，其第<span class="math inline">\(t+1\)</span>轮迭代解得更新公式为： <span class="math display">\[\pmb{\beta}^{t+1}=\pmb{\beta}^t-\frac{\partial^2\mathscr{l}(\pmb{\beta})}{\partial\pmb{\beta}\partial\pmb{\beta}^\text{T}}^{-1}\frac{\partial \mathscr{l}(\pmb{\beta})}{\partial\pmb{\beta}}\]</span> 其中关于<span class="math inline">\(\pmb{\beta}\)</span>的一阶，二阶导数分别为： <span class="math display">\[\frac{\partial \mathscr{l}(\pmb{\beta})}{\partial\pmb{\beta}}=-\stackrel{m}{\underset{i=1}\sum}\hat{\pmb{x}}_i(y_i-P(y=1\ |\ \hat{\pmb{x}_i};\pmb{\beta}))\\\frac{\partial^2\mathscr{l}(\pmb{\beta})}{\partial\pmb{\beta}\partial\pmb{\beta}^\text{T}}=\stackrel{m}{\underset{i=1}\sum}\hat{\pmb{x}}_i\hat{\pmb{x}}_i^\text{T}(1-P(y=1\ |\ \hat{\pmb{x}_i};\pmb{\beta}))P(y=1\ |\ \hat{\pmb{x}_i};\pmb{\beta})\\\]</span> 损失函数的由来也可以通过信息论的角度去解释<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，<span class="math inline">\(\mathscr{l}(\pmb{\beta})\)</span>可以通过最小化相对熵（度量两个分布的差别）<span class="math inline">\(D(p||q)=\sum^m_{i=1}p(x)\log\frac{p(x)}{q(x)}\)</span>得来，而交叉熵为<span class="math inline">\(-\sum^m_{i=1}p(x)\log{q(x)}\)</span>，所以<span class="math inline">\(\mathscr{l}(\pmb{\beta})\)</span>又被称作交叉熵损失函数。其中p，q分别表示两个不同的分布。</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>详见《统计学习方法》的相关部分<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 分类问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>矩阵，向量求导</title>
      <link href="/2022/03/05/math/%E7%9F%A9%E9%98%B5%E6%B1%82%E5%AF%BC/"/>
      <url>/2022/03/05/math/%E7%9F%A9%E9%98%B5%E6%B1%82%E5%AF%BC/</url>
      
        <content type="html"><![CDATA[<h2 id="矩阵求导的本质">矩阵求导的本质</h2><p>矩阵<span class="math inline">\(\pmb{A}\)</span>对矩阵<span class="math inline">\(\pmb{B}\)</span>求导，就是矩阵<span class="math inline">\(\pmb{A}\)</span>中的每个元素分别对矩阵<span class="math inline">\(\pmb{B}\)</span>中的每个元素求导。</p><p>例如：</p><p><span class="math inline">\(\pmb{A}_{1\times1},\pmb{B}_{1\times1}\)</span>，<span class="math inline">\(\pmb{A},\pmb{B}\)</span>中只有一个元素<span class="math inline">\(a_{1,1},b_{1,1}\)</span>，只有一个导数<span class="math inline">\(\frac{\partial a_{1,1}}{\partial b_{1,1}}\)</span>。</p><p><span class="math inline">\(\pmb{A}_{m\times1},\pmb{B}_{1\times1}\)</span>，<span class="math inline">\(\pmb{A}\)</span>中的<span class="math inline">\(m\)</span>个元素分别对只有一个元素的<span class="math inline">\(\pmb{B}\)</span>中的<span class="math inline">\(b_{1,1}\)</span>求导，产生<span class="math inline">\(m\)</span>个导数。</p><p><span class="math inline">\(\pmb{A}_{m\times1},\pmb{B}_{p\times1}\)</span>，<span class="math inline">\(\pmb{A}\)</span>中的<span class="math inline">\(m\)</span>个元素分别对<span class="math inline">\(\pmb{B}\)</span>中的<span class="math inline">\(p\)</span>个元素求导，产生<span class="math inline">\(m\times p\)</span>个导数。</p><p><span class="math inline">\(\pmb{A}_{m\times n},\pmb{B}_{p\times q}\)</span>，<span class="math inline">\(\pmb{A}\)</span>中的<span class="math inline">\(m\times n\)</span>个元素分别对<span class="math inline">\(\pmb{B}\)</span>中的<span class="math inline">\(p\times q\)</span>个元素求导，产生<span class="math inline">\(m\times n \times p\times q\)</span>个导数。</p><p>标量函数：<span class="math inline">\(y=f(\pmb{x}),y\in \mathbb{R}\)</span></p><p>向量函数：<span class="math inline">\(\pmb{y}=f(\pmb{x}),\pmb{y}\in \mathbb{R}^d,d&gt;1\)</span></p><h2 id="以分母布局为例的矩阵求导">以分母布局为例的矩阵求导</h2><h3 id="基本原则">基本原则</h3><ol type="1"><li><p><span class="math inline">\(f(\pmb{X})=f(x_1,x_2,\dots,x_p)\)</span>为标量函数，<span class="math inline">\(\pmb{X}=(x_1,x_2,\dots,x_p)^\text{T}\)</span>为列向量，定义： <span class="math display">\[\frac{\partial f(\pmb{X})}{\partial \pmb{X}}=\begin{bmatrix}\frac{\partial f(\pmb{X})}{\partial x_1}\\\frac{\partial f(\pmb{X})}{\partial x_2}\\ \vdots\\ \frac{\partial f(\pmb{X})}{\partial x_p}\end{bmatrix}\]</span> 即得到<span class="math inline">\(p\)</span>个导数之后，最终结果的形式要和分母的形式统一。</p></li><li><p><span class="math inline">\(f(\pmb{X})=f(x_1,x_2,\dots,x_p)\)</span>是向量函数，分母<span class="math inline">\(x\)</span>是标量，定义： <span class="math display">\[\frac{\partial f(\pmb{X})}{\partial x}=\begin{bmatrix}\frac{\partial f(\pmb{X})}{\partial x_1},\frac{\partial f(\pmb{X})}{\partial x_2}, \dots ,\frac{\partial f(\pmb{X})}{\partial x_p}\end{bmatrix}\]</span> 分子部分为向量，分母部分为标量，最后的结果要写成分子转置的形式。</p></li></ol><h3 id="基本原则的拓展">基本原则的拓展</h3><p><span class="math inline">\(f(\pmb{X})=f(x_1,x_2,\dots,x_p)\)</span>是向量函数，分母<span class="math inline">\(\pmb{X}\)</span>是向量，则向量间的导数： <span class="math display">\[f(\pmb{X})=\begin{bmatrix}\frac{\partial f_1(\pmb{X})}{\partial x_1}\\\frac{\partial f_2(\pmb{X})}{\partial x_2}\\ \vdots\\ \frac{\partial f_m(\pmb{X})}{\partial x_p}\end{bmatrix}\]</span></p><p>其中<span class="math inline">\(f_i(\pmb{X})\)</span>均为标量函数。此时向量间的导数可表示为：</p><p><span class="math display">\[\frac{\partial f(\pmb{X})}{\partial \pmb{X}}=\begin{bmatrix}\frac{\partial f(\pmb{X})}{\partial x_1}\\\frac{\partial f(\pmb{X})}{\partial x_2}\\ \vdots\\ \frac{\partial f(\pmb{X})}{\partial x_p}\end{bmatrix}=\begin{bmatrix}\frac{\partial f_1(\pmb{X})}{\partial x_1} &amp; \frac{\partial f_2(\pmb{X})}{\partial x_1} &amp; \cdots &amp; \frac{\partial f_m(\pmb{X})}{\partial x_1}\\ \frac{\partial f_1(\pmb{X})}{\partial x_2} &amp; \frac{\partial f_2(\pmb{X})}{\partial x_2} &amp; \cdots &amp; \frac{\partial f_m(\pmb{X})}{\partial x_2}\\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\ \frac{\partial f_1(\pmb{X})}{\partial x_p} &amp; \frac{\partial f_2(\pmb{X})}{\partial x_p} &amp; \cdots &amp; \frac{\partial f_m(\pmb{X})}{\partial x_p}\end{bmatrix}\]</span></p><p>【举例】：</p><ol type="1"><li><p>已知<span class="math inline">\(f(\pmb{x})=\pmb{A}^\text{T}\pmb{x}\)</span>，<span class="math inline">\(\pmb{A}=(a_1,a_2,\dots,a_p)^\text{T},\pmb{x}=(x_1,x_2,\dots,x_p)^\text{T}\)</span>，求<span class="math inline">\(\frac{\partial f(\pmb{x})}{\partial \pmb{x}}\)</span>。</p><p>【解答】 <span class="math display">\[\begin{align*}\frac{\partial f(\pmb{x})}{\partial \pmb{x}}&amp;=(\frac{\partial f(\pmb{x})}{\partial x_1},\frac{\partial f(\pmb{x})}{\partial x_2},\cdots,\frac{\partial f(\pmb{x})}{\partial x_p})^\text{T}\\&amp;=(\frac{a_1x_1+a_2x_2+\dots+a_px_p}{\partial x_1},\dots,\frac{a_1x_1+a_2x_2+\dots+a_px_p}{\partial x_p})^\text{T}\\&amp;=(a_1,a_2,\dots,a_p)^\text{T}\\&amp;=\pmb{A}\end{align*}\]</span> 我们由此得到了一个重要的公式： <span class="math display">\[\frac{\partial\pmb{A}^\text{T}\pmb{x}}{\partial \pmb{x}}=\pmb{A}\tag{1.1}\]</span></p></li><li><p>已知<span class="math inline">\(f(\pmb{x})=\pmb{x}^\text{T}\pmb{A}\pmb{x}\)</span>，<span class="math inline">\(\pmb{x}=(x_1,x_2,\dots,x_p)^\text{T}\)</span>，<span class="math inline">\(\pmb{A}\)</span>是一个<span class="math inline">\(p\times p\)</span>的矩阵，求<span class="math inline">\(\frac{\partial f(\pmb{x})}{\partial \pmb{x}}\)</span>。</p><p>【解答】 <span class="math display">\[\begin{align*}f(\pmb{x})&amp;=\stackrel{p}{\underset{i=1}\sum}\stackrel{p}{\underset{j=1}\sum}a_{ij}x_ix_j\\&amp;=\stackrel{p}{\underset{j=1}\sum}a_{1j}x_1x_j+\stackrel{p}{\underset{j=1}\sum}a_{2j}x_2x_j+\dots+\stackrel{p}{\underset{j=1}\sum}a_{pj}x_px_j\\\frac{\partial f(\pmb{x})}{\partial \pmb{x}}&amp;=(\frac{\partial f(\pmb{x})}{\partial x_1},\frac{\partial f(\pmb{x})}{\partial x_2},\dots,\frac{\partial f(\pmb{x})}{\partial x_p})^\text{T}\\&amp;=(\stackrel{p}{\underset{j=1}\sum}a_{1j}x_j+\stackrel{p}{\underset{i=1}\sum}a_{i1}x_i,\dots,\stackrel{p}{\underset{j=1}\sum}a_{pj}x_j+\stackrel{p}{\underset{i=1}\sum}a_{ip}x_i)^\text{T}\\&amp;=(\stackrel{p}{\underset{j=1}\sum}a_{1j}x_j,\stackrel{p}{\underset{j=1}\sum}a_{2j}x_j,\dots,\stackrel{p}{\underset{j=1}\sum}a_{pj}x_j)^\text{T}+(\stackrel{p}{\underset{i=1}\sum}a_{i1}x_i,\stackrel{p}{\underset{i=1}\sum}a_{i2}x_i,\dots,\stackrel{p}{\underset{i=1}\sum}a_{ip}x_i)^\text{T}\\&amp;=\begin{bmatrix}a_{11} &amp; a_{12}&amp;\dots&amp;a_{1p} \\ a_{21} &amp; a_{22}&amp;\dots&amp;a_{2p}\\\vdots &amp; \vdots&amp;\ddots&amp;\vdots\\a_{p1} &amp; a_{p2}&amp;\dots&amp;a_{pp}\end{bmatrix}\begin{bmatrix}x_1\\x_2\\\vdots\\x_p\end{bmatrix}+\begin{bmatrix}a_{11} &amp; a_{12}&amp;\dots&amp;a_{1p} \\ a_{21} &amp; a_{22}&amp;\dots&amp;a_{2p}\\\vdots &amp; \vdots&amp;\ddots&amp;\vdots\\a_{p1} &amp; a_{p2}&amp;\dots&amp;a_{pp}\end{bmatrix}^\text{T}\begin{bmatrix}x_1\\x_2\\\vdots\\x_p\end{bmatrix}\\&amp;=(\pmb{A}+\pmb{A}^\text{T})\pmb{x}\end{align*}\]</span> 我们又得到了一个重要的公式： <span class="math display">\[\frac{\partial\pmb{x}^\text{T}\pmb{A}\pmb{x}}{\partial \pmb{x}}=(\pmb{A}+\pmb{A}^\text{T})\pmb{x}\tag{1.2}\]</span></p></li></ol><h2 id="向量矩阵求导的常用公式">向量矩阵求导的常用公式</h2><p><span class="math display">\[\frac{\partial(\pmb{A}\pmb{x})^\text{T}}{\partial \pmb{x}}=\frac{\partial\pmb{A}\pmb{x}}{\partial \pmb{x}}=\pmb{A}^\text{T}\tag{1.3}\]</span></p><p><span class="math display">\[\frac{\partial \pmb{X}\pmb{Y}}{\partial \pmb{x}}=\frac{\partial \pmb{X}}{\partial \pmb{x}}\pmb{Y}+\frac{\partial \pmb{Y}}{\partial \pmb{x}}\pmb{X}\tag{1.4}\]</span></p><p><span class="math display">\[\frac{\partial(\pmb{X}+\pmb{Y})}{\partial \pmb{x}}=\frac{\partial \pmb{X}}{\partial \pmb{x}}+\frac{\partial \pmb{Y}}{\partial \pmb{x}}\tag{1.5}\]</span></p><h2 id="补充说明">补充说明</h2><h3 id="注意事项">注意事项</h3><p>（引用自：https://www.bilibili.com/video/BV1UK4y1t7bv）</p><ol type="1"><li>注意求导的布局，一般来讲分子布局和分母布局的结果相差一个转置。</li><li>布局没有优劣之分，适合的布局是最好的。要保持计算连贯性。</li><li>使用导数矩阵的维度来判断别人使用了什么布局。</li></ol><h3 id="其它参考文献">其它参考文献</h3><ol type="1"><li><a href="http://media.ee.ntu.edu.tw/personal/pcwu/tutorials/matrix_calculus.pdf">矩阵论介绍</a></li><li><a href="https://www.math.uwaterloo.ca/~hwolkowi/matrixcookbook.pdf"><strong>The Matrix Cookbook</strong> - Mathematics</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 线性代数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 高等数学 </tag>
            
            <tag> 矩阵论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LDA(fisher)模型</title>
      <link href="/2022/03/05/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B2/"/>
      <url>/2022/03/05/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B2/</url>
      
        <content type="html"><![CDATA[<h2 id="解决的问题">解决的问题</h2><p>简单来说，就是两个字，<strong>分类</strong>。展开来说，就是把同类样本和不同样本通过某种形式区分开。</p><p>线性判别分析（LDA）是解决<strong>二分类问题</strong>的有效方法。使用LDA，那么问题转化为：给定数据集<span class="math inline">\(D=\{(\pmb{x}_i,y_i)\}_{i=1}^m,\pmb{x}_i=\{x_1,x_2,\dots,x_d\},y_i\in\{0,1\}\)</span>，求使得<span class="math inline">\(D\)</span>中数据分类效果最好的直线<span class="math inline">\(\pmb{w}\)</span>。</p><h2 id="线性分类的方法">线性分类的方法</h2><h3 id="总体思想">总体思想</h3><p><span class="math display">\[线性回归\stackrel{\underline{\textbf{降维}}}{\underset{激活函数}{\Rightarrow}}线性分类\]</span></p><p>投影即降维的具体方法。</p><h3 id="lda解决二分类学习问题">LDA解决二分类学习问题</h3><p>给定训练样例集，设法将样例<strong>投影</strong>到一个直线上，使得同类样例在直线上的的投影点尽可能的接近（同类样本投影<strong>协方差要小</strong>），异类样本在直线上的的投影点尽可能远离（异类样本投影<strong>距离要大</strong>）。在对样本进行分类时，将其投影到同样的直线上，再根据投影点的位置来确定样本的类别。下图是样例属性为二维的分类示意图。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/LD1.png" alt="LDA二维示意图" /></p><p>设第<span class="math inline">\(i\)</span>类样本的集合为<span class="math inline">\(X_i\)</span>，均值向量<span class="math inline">\(\pmb{\mu}_i\)</span>，协方差矩阵<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>为<span class="math inline">\(\pmb{\Sigma}_i\)</span>，则第<span class="math inline">\(i\)</span>类样本<span class="math inline">\((\pmb{x}_i,y_i)\)</span>在直线<span class="math inline">\(\pmb{w}\)</span>上的投影长度<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>可以表示为<span class="math inline">\(\pmb{w}^\text{T}\pmb{\mu}_i\)</span>，​投影距离的协方差为<span class="math inline">\(\pmb{w}^\text{T}\pmb{\Sigma}_i\pmb{w}\)</span>。</p><p>补充：投影距离协方差公式的来历，协方差矩阵的计算公式是形式化的（和上面讲过的<strong>均方误差函数</strong>一样，凑出来的），为<span class="math inline">\(\pmb{\Sigma}_i=\underset{\pmb{x}\in X_i}\sum (\pmb{x}-\pmb{\mu}_i)(\pmb{x}-\pmb{\mu}_i)^\text{T}\)</span>，投影距离协方差的公式推导如下： <span class="math display">\[\begin{align*}Cov(\pmb{w}^\text{T}X_i)&amp;=\underset{\pmb{x}\in X_i}\sum (\pmb{w}^\text{T}\pmb{x}-\pmb{w}^\text{T}\pmb{\mu}_i)(\pmb{w}^\text{T}\pmb{x}-\pmb{w}^\text{T}\pmb{\mu}_i)^\text{T}\\&amp;=\underset{\pmb{x}\in X_i}\sum (\pmb{w}^\text{T}\pmb{x}-\pmb{w}^\text{T}\pmb{\mu}_i)(\pmb{x}^\text{T}\pmb{w}-\pmb{\mu}_i^\text{T}\pmb{w})\\&amp;=\underset{\pmb{x}\in X_i}\sum \pmb{w}^\text{T}(\pmb{x}-\pmb{\mu}_i)(\pmb{x}^\text{T}-\pmb{\mu}_i^\text{T})\pmb{w}\\&amp;=\pmb{w}^\text{T}(\underset{\pmb{x}\in X_i}\sum (\pmb{x}-\pmb{\mu}_i)(\pmb{x}-\pmb{\mu}_i)^\text{T})\pmb{w}\\&amp;=\pmb{w}^\text{T}\pmb{\Sigma_i}\pmb{w}\end{align*}\]</span> 由于直线是一维空间，因此<span class="math inline">\(\pmb{w}^\text{T}\pmb{\mu}_i\)</span>，<span class="math inline">\(\pmb{w}^\text{T}\pmb{\Sigma_i}\pmb{w}\)</span>均为实数。</p><p>同时考虑“同类样本投影<strong>协方差要小</strong>”，“异类样本投影<strong>距离要大</strong>”两个条件，可得出我们的优化目标： <span class="math display">\[J=\frac{||\pmb{w}^\text{T}\pmb{\mu}_0-\pmb{w}^\text{T}\pmb{\mu}_1||^2_2}{\pmb{w}^\text{T}\pmb{\Sigma}_0\pmb{w}+\pmb{w}^\text{T}\pmb{\Sigma_1}\pmb{w}}=\frac{\pmb{w}^\text{T}(\pmb{\mu}_0-\pmb{\mu}_1)(\pmb{\mu}_0-\pmb{\mu}_1)^\text{T}\pmb{w}}{\pmb{w}^\text{T}(\pmb{\Sigma}_0+\pmb{\Sigma_1})\pmb{w}}\]</span> 定义“类内散度矩阵”： <span class="math display">\[\pmb{S}_w=\pmb{\Sigma}_0+\pmb{\Sigma}_1\]</span></p><p>定义“类间散度矩阵”： <span class="math display">\[\pmb{S}_b=(\pmb{\mu}_0-\pmb{\mu}_1)(\pmb{\mu}_0-\pmb{\mu}_1)^\text{T}\]</span> 则优化目标可重写为： <span class="math display">\[\max J=\frac{\pmb{w}^\text{T}\pmb{S}_b\pmb{w}}{\pmb{w}^\text{T}\pmb{S}_w\pmb{w}}\]</span> 这就是LDA欲最大化的目标，即<span class="math inline">\(\pmb{S}_b\)</span>与<span class="math inline">\(\pmb{S}_w\)</span>的<strong>广义瑞利商</strong><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。</p><p>如何确定<span class="math inline">\(\pmb{w}\)</span>呢？这里重复一下我们的目标：“只要<span class="math inline">\(\pmb{w}\)</span>的方向即可”。注意到<span class="math inline">\(J\)</span>式的分子和分母都是关于<span class="math inline">\(\pmb{w}\)</span>的二次项，因此式<span class="math inline">\(J\)</span>的解与<span class="math inline">\(\pmb{w}\)</span>的长度无关。不失一般性，令<span class="math inline">\(\pmb{w}^\text{T}\pmb{S}_w\pmb{w}=1\)</span>，将我们的条件变换成拉格朗日乘子法的形式，则<span class="math inline">\(J\)</span>式等价于： <span class="math display">\[\underset{\pmb{w}}\min -\pmb{w}^\text{T}\pmb{S}_b\pmb{w}\\s.t. \pmb{w}^\text{T}\pmb{S}_w\pmb{w}-1=0\]</span> 由<a href="/404.html">拉格朗日乘子法</a>，上式等价于： <span class="math display">\[\pmb{S}_b\pmb{w}=\lambda\pmb{S}_w\pmb{w}\\(\pmb{\mu}_0-\pmb{\mu}_1)(\pmb{\mu}_0-\pmb{\mu}_1)^\text{T}\pmb{w}=\lambda\pmb{S}_w\pmb{w}\]</span></p><p>注意到<span class="math inline">\((\pmb{\mu}_0-\pmb{\mu}_1)^\text{T}\pmb{w}\)</span>是一个标量，设这个标量的值为<span class="math inline">\(\gamma\)</span>，则得到下式： <span class="math display">\[\pmb{w}=\frac{\gamma}{\lambda}\pmb{S}_w^{-1}(\pmb{\mu}_0-\pmb{\mu}_1)\]</span> 因为<span class="math inline">\(\pmb{w}\)</span>的大小并不重要，因此不用再回头考虑<span class="math inline">\(\pmb{w}^\text{T}\pmb{S}_w\pmb{w}-1=0\)</span>，以及<span class="math inline">\(\lambda,\gamma\)</span>的取值，<span class="math inline">\(\pmb{w}\)</span>的最终结果可表示为： <span class="math display">\[\pmb{w}=\pmb{S}_w^{-1}(\pmb{\mu}_0-\pmb{\mu}_1)\]</span> 在实践中，考虑到数值解的稳定性，通常是对<span class="math inline">\(\pmb{S}_w\)</span>做奇异值分解，即<span class="math inline">\(\pmb{S}_w=\pmb{U}\pmb{\Sigma}\pmb{V}^\text{T}\)</span>，<span class="math inline">\(\Sigma\)</span>是一个实对角矩阵，其对角线上的元素是<span class="math inline">\(\pmb{S}_w\)</span>的奇异值，然后再由<span class="math inline">\(\pmb{S}_w^{-1}=\pmb{V}\pmb{\Sigma}^{-1}\pmb{U}^{-1}\)</span>得到<span class="math inline">\(\pmb{S}_w^{-1}\)</span>。</p><p>LDA也可以从贝叶斯决策理论的角度来阐释<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。</p><h2 id="多分类学习">多分类学习</h2><h3 id="lda拓展">LDA拓展</h3><p>多分类学习的问题和二分类的问题基本相同，只是改变了一个条件，即<span class="math inline">\(y_i\in\{0,1,\dots,N-1\}\)</span>，所以我们可以将LDA推广到多分类任务中，假定存在<span class="math inline">\(N\)</span>个类别，第<span class="math inline">\(i\)</span>类的示例数为<span class="math inline">\(m_i\)</span>。在二分类时，我们考虑的是将多维降为一维。由于分类的类别增加，一维的分类可能无法满足要求，所以我们可以将示例投影到<span class="math inline">\(k\leq N-1\)</span>个基向量上，此时<span class="math inline">\(\pmb{W}\)</span>就不是一条直线了，而是<span class="math inline">\(k\)</span>条线性无关的直线组成的向量空间。下面的推导将默认<span class="math inline">\(k=N-1\)</span>。具体的说，<span class="math inline">\(\pmb{W}=(\pmb{w}_1,\pmb{w}_2,\dots,\pmb{w}_{N-1}),\pmb{W}\in \mathbb{R}^{d\times(N-1)}\)</span>，投影的结果表示为<span class="math inline">\(\pmb{Y}=\{y_1,y_2,\dots,y_{N-1}\}\)</span>，其中<span class="math inline">\(y_i=\pmb{w}_i^\text{T}\pmb{x_i}\)</span>。</p><p>下面仿照LDA方法，进行目标函数<span class="math inline">\(J\)</span>的最大化。</p><p>将类内散度矩阵<span class="math inline">\(\pmb{S}_w\)</span>重定义为每个类别的散度矩阵之和，即： <span class="math display">\[\pmb{S}_w=\stackrel{N}{\underset{i=1}\sum}\pmb{S}_{w_i}\tag{3.41}\\\pmb{S}_{w_i}=\underset{\pmb{x}\in X_i}\sum(\pmb{x}-\pmb{\mu}_i)(\pmb{x}-\pmb{\mu}_i)^\text{T}\]</span> 计算出类间散度矩阵<span class="math inline">\(\pmb{S}_b\)</span>，要注意原来度量的是两个均值点的散列情况，现在度量的是每类均值点相对于样本中心的散列情况。定义<span class="math inline">\(P(i)\)</span>表示第<span class="math inline">\(i\)</span>类出现的概率，作为散度的权值。其中<span class="math inline">\(\pmb{\mu}\)</span>为所有示例的均值向量。 <span class="math display">\[\begin{align*}\pmb{S}_b&amp;=\frac{1}{2}\stackrel{N}{\underset{i=1}\sum}\stackrel{N}{\underset{j=1}\sum}P(i)P(j)(\pmb{\mu}_i-\pmb{\mu}_j)(\pmb{\mu}_i-\pmb{\mu}_j)^\text{T}\\&amp;=\stackrel{N}{\underset{i=1}\sum}P(i)(\pmb{\mu}_i-\pmb{\mu})(\pmb{\mu}_i-\pmb{\mu})^\text{T}\end{align*}\]</span> 由上式可以看出，<span class="math inline">\(\pmb{S}_b\)</span>是各个样本根据自己所属的类计算出样本与总体的协方差矩阵的总和，这从宏观上描述了所有类和总体之间的离散冗余程度。</p><p>因为<span class="math inline">\(J\)</span>函数对倍数不敏感，所以散度的权值<span class="math inline">\(P{(i)}\)</span>可以替换为样本数量<span class="math inline">\(m_i\)</span>。 <span class="math display">\[\pmb{S}_b=\stackrel{N}{\underset{i=1}\sum}m_i(\pmb{\mu}_i-\pmb{\mu})(\pmb{\mu}_i-\pmb{\mu})^\text{T}\]</span> 定义全局散度矩阵： <span class="math display">\[\pmb{S}_t=\stackrel{m}{\underset{i=1}\sum}(\pmb{x}_i-\pmb{\mu})(\pmb{x}_i-\pmb{\mu})^\text{T}=\pmb{S}_b+\pmb{S}_w\tag{3.40}\]</span> 多分类LDA可以有多种实现方法：使用<span class="math inline">\(\pmb{S}_b,\pmb{S}_w,\pmb{S}_t\)</span>三者中的任意两者即可。常用的一种实现是优化目标： <span class="math display">\[J=\underset{\pmb{W}}\max\ \frac{\text{tr}(\pmb{W}^\text{T}\pmb{S}_b\pmb{W})}{\text{tr}(\pmb{W}^\text{T}\pmb{S}_w\pmb{W})}\tag{3.44}\]</span> 式（3.44）可以通过如下的<strong>广义特征值</strong><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>问题求解： <span class="math display">\[\pmb{S}_b\pmb{W}=\lambda\pmb{S}_w\pmb{W}\]</span> <span class="math inline">\(\pmb{W}\)</span>的闭式解则是<span class="math inline">\(\pmb{S}_w^{-1}\pmb{S}_b\)</span>的<span class="math inline">\(d&#39;(d&#39;\leq N-1)\)</span><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>个最大非零广义特征值所对应的特征向量组成的矩阵。</p><p>由上面的分析，我们发现LDA具有降维的功能。它通过投影，减少了样本点的维数。所以，LDA常被视为一种经典的监督降维技术。</p><p>LDA非常适合于求解数据符合高斯分布<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>数据的分类问题。如果数据不符合高斯分布，那么LDA的处理效果就可能很差，甚至无法求解。</p><h3 id="组合二分类学习器">组合二分类学习器</h3><p>由上面的LDA拓展方法的分析，我们知道有一些二分类算法可以推广为多分类算法。但在更多情形下，我们是基于一些基本策略，利用二分类学习器来解决多分类问题。</p><p>用二分类学习器解决多分类问题，最重要的方法就是将多分类任务转化为二分类任务。这样的方法就是<strong>拆解</strong>。具体来说，先对问题进行拆分，然后为拆出的每个二分类任务训练一个分类器；在测试时，对这些分类器的预测结果进行集成以获得最终的多分类结果。这里的关键是如何对多分类任务进行拆分，以及如何对多个分类器进行集成。下面将主要介绍<strong>拆分策略</strong>。</p><p>经典的拆分策略有三种，“一对一”（OVO），“一对多”（OVR）和“多对多”（RVR）。</p><ol type="1"><li><p>一对一（OvO）</p><p>将<span class="math inline">\(N\)</span>个样本两两配对，训练<span class="math inline">\(N(N-1)/2\)</span>个分类器。在测试阶段，新样本提交给所有分类器，最后收集结果，把被预测得最多的类别作为最终分类结果。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/LD2.svg" alt="一对一分类示例" /></p></li><li><p>一对多（OvR）</p><p>每次将一个类作为正例，其他类都作为反例，训练<span class="math inline">\(N\)</span>个分类器，若测试时仅有一个分类器预测为正类，则对应标记作为分类结果。若有多个分类器预测为正类，则要考虑各个分类器的置信度，选择置信度最大的类别标记作为分类结果。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/LD3.svg" alt="一对多分类图示例" /></p><p>容易看出，OvR 只需训练<span class="math inline">\(N\)</span>个分类器，而OvO需训练<span class="math inline">\(N(N -1)/2\)</span>个分类器，因此，OvO的存储开销和测试时间开销通常比OvR更大。但在训练时，OvR的每个分类器均使用全部训练样例，而OvO的每个分类器仅用到两个类的样例，因此，在类别很多时， OvO 的训练时间开销通常比OvR更小。至于预 测性能，则取决千具体的数据分布，在多数情形下两者差不多。</p></li><li><p>多对多（MvM）</p><p>每次将若干个类编为正类，若干个类编为反类，显然，OvO和OvR是MvM的特例，MvM的正反类构造必须有特殊的设计，不能随意选取。下面将介绍一种最常用的MvM技术，<strong>纠错输出码</strong>（ECOC）。</p></li></ol><h3 id="纠错输出码">纠错输出码</h3><p>ECOC是将编码的思想引入类别拆分，并尽可能在解码过程中具有容错性。ECOC工作过程共分为两步：</p><ol type="1"><li><strong>编码</strong>：对<span class="math inline">\(N\)</span>个类别做<span class="math inline">\(M\)</span>次划分，每次划分将一部分类别标记为正类，一部分化为反类，从而形成一个二分类训练集。这样一共产生<span class="math inline">\(M\)</span>个训练集，可训练出<span class="math inline">\(M\)</span>个分类器。</li><li><strong>预测</strong>：<span class="math inline">\(M\)</span>个分类器同时对测试样本进行预测，这些预测标记组合成一个编码，将这个预测编码与类别各自的编码进行比较，返回其中距离最小的类别作为最终预测结果。</li></ol><p>类别划分由“编码矩阵”指定。常见的ECOC码有两种，二元码和三元码。前者将每个类别指定为正类和反类。后者增加了一个停用类，表示当前的学习器不使用该类样本。</p><p>下图中的+1,-1表示分类器将样本作为正例/反例，注意在三元码计算距离时，不使用的样本也要算上。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/LD4.svg" alt="二元ECOC码示例" /></p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/LD5.svg" alt="三元ECOC码示例" /></p><p>测试阶段， ECOC 编码对分类器的错误有一定的容忍和修正能力。如果某一个分类器出错，它对整体输出的分类结果影响很小。一般来说对同一个学习任务， ECOC编码越长，纠错能力越强。然而，编码越长，意味着所需训练的分类器越多，计算、存储开销都会增大；另一方面，对有限类别数，可能的组合数目是有限的，码长超过一定范围后就失去了意义。</p><p>对同等长度的编码，理论上来说，任意两个类别之间的编码距离越远，则纠错能力越强．因此，在码长较小时可根据这个原则计算出理论最优编码。这是一个NP难问题。</p><p>一般情况下，我们无需最优编码。一是非最优编码在实践中往往已能产生足够好的分类器，二是并不是编码的理论性质越好，分类性能就越好。不同拆解方式形成的学习器分类难度可能有所不同。分类难度可能会对性能产生较大影响。</p><h2 id="类别不平衡问题">类别不平衡问题</h2><p>以下内容均来自《机器学习》P66-P67.</p><h3 id="解决问题的思想">解决问题的思想</h3><p>前面介绍的分类学习方法都有一个共同的基本假设，即不同类别的训练样例数目相当。如果不同类别的训练样例数目稍有差别，通常影响不大，但若差别很大，则会对学习过程造成困扰。例如有998个反例，但正例只有2个，那么学习方法只需返回一个永远将新样本预测为反例的学习器，就能达到99.8％的精度；然而这样的学习器往往没有价值，因为它不能预测出任何正例。<strong>类别不平衡</strong>(class-imbalance)就是指分类任务中不同类别的训练样例数目差别很大的情况。</p><p>在我们用<span class="math inline">\(y=\pmb{w}^\text{T}\pmb{x}+b\)</span>对新样本<span class="math inline">\(x\)</span>进行分类时，事实上是在用预测出的y值与一个<strong>阈值</strong>进行比较。例如通常在<span class="math inline">\(y&gt;0.5\)</span>时判断为正例。<strong>阙值设置为0.5恰表明分类器认为真实正、反例可能性相同</strong>，即分类器预测样本为正例的决策规则为： <span class="math display">\[\frac{y}{1-y}&gt;1\tag{3.46}\]</span> 然而，当训练集中正、反例的数目不同时，令<span class="math inline">\(m^+\)</span>表示正例数目， <span class="math inline">\(m^-\)</span>表示反例数目，则分类器预测样本为正例的决策规则是： <span class="math display">\[\frac{y}{1-y}&gt;\frac{m^+}{m^-}\tag{3.47}\]</span> 但是，我们的分类器是基于式(3.46)进行决策，因此，需对其预测值进行调整，使其在基于式(3.46) 决策时，实际是在执行式(3.47) ．要做到这一点很容易，只需令： <span class="math display">\[\frac{y&#39;}{1-y&#39;}=\frac{y}{1-y}\times \frac{m^-}{m^+}\tag{3.48}\]</span> 这就是类别不平衡学习的一个基本策略——“再缩放”(rescaling)。</p><p>再缩放的思想虽简单，但实际操作却并不平凡，主要因为“<strong>训练集是真实样本总体的无偏采样</strong>”这个假设<strong>往往并不成立</strong>，也就是说我们未必能有效地基于训练集观测几率来推断出真实几率。</p><h3 id="现有的解决方法">现有的解决方法</h3><p>现有技术大体上有三类做法：第一类是直接对训练集里的反类样例进行“<strong>欠采样</strong>”(undersampling) ，即去除一些反例使得正、反例数目接近，然后再进行学习；第二类是对训练集里的正类样例进行“<strong>过采样</strong>”(oversampling) ，即增加一些正例使得正、反例数目接近，然后再进行学习；第三类则是直接基于原始训练集进行学习，但在用训练好的分类器进行预测时，将式(3.48) 嵌入到其决策过程中，称为“<strong>阈值移动</strong>”(threshold-moving)。</p><p>欠采样法的时间开销通常远小于过采样法，因为前者丢弃了很多反例，使得分类器训练集远小于初始训练集，而过采样法增加了很多正例，其训练集大于初始训练集。需注意的是，过采样法不能简单地对初始正例样本进行重复采样，否则会招致严重的过拟合，过采样法的代表性算法SMOTE [Chawlaet al., 2002] 是通过对训练集里的正例进行插值来产生额外的正例。另一方面，欠采样法若随机丢弃反例，可能丢失一些重要信息；欠采样法的代表性算法EasyEnsemble [Liu et al., 2009] 则是利用集成学习机制，将反例划分为若干个集合供不同学习器使用，这样对每个学习器来看都进行了欠采样，但在全局来看却不会丢失重要信息。</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>协方差矩阵，即每两个样本两两求协方差构成的矩阵，显然，它是对称的<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>注意，线性代数中所有的向量都是从原点开始的，投影长度的计算实际上就是向量的点积<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p><a href="https://zhuanlan.zhihu.com/p/432080955">广义瑞利商介绍</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn4" role="doc-endnote"><p>参见《机器学习》周志华 习题7.5<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn5" role="doc-endnote"><p><a href="https://blog.csdn.net/SL_World/article/details/106568070">广义特征值介绍</a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn6" role="doc-endnote"><p>最多有N-1个非零特征值<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn7" role="doc-endnote"><p>即“正态分布”<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 分类问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性回归模型</title>
      <link href="/2022/03/03/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/"/>
      <url>/2022/03/03/machine%20learning/%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="解决的问题">解决的问题</h2><p>给定由<span class="math inline">\(d\)</span>个属性描述的示例<span class="math inline">\(\pmb{x}=\{x_1,x_2,\dots,x_d\}\)</span>，其中<span class="math inline">\(x_i\)</span>是<span class="math inline">\(\pmb{x}\)</span>在第<span class="math inline">\(i\)</span>个属性上的取值，线性模型试图通过现有数据集<span class="math inline">\(D=\{(\pmb{x}_i,y_i)\}^m_{i=1}\)</span>学得一个通过属性得线性组合来进行预测的函数，即： <span class="math display">\[f(\pmb{x})=w_1x_1+w_2x_2+\cdots+w_dx_d+b\]</span> 一般由向量形式写成： <span class="math display">\[f(\pmb{x})=\pmb{w}^\text{T}\pmb{x}+b\]</span> 其中<span class="math inline">\(\pmb{w}=\{w_1,w_2,\dots,w_d\}\)</span>，学习到<span class="math inline">\(\pmb{w}\)</span>和<span class="math inline">\(b\)</span>后，模型就得以确定。</p><h2 id="线性回归">线性回归</h2><h3 id="一元线性回归">一元线性回归</h3><p>给定数据集<span class="math inline">\(D=\{(x_i,y_i)\}^m_{i=1}\)</span>，其中<span class="math inline">\(x_i\in \mathbb{R}\)</span>，<span class="math inline">\(y_i\)</span>为数据的标签，求<span class="math inline">\(f(x_i)=wx_i+b\)</span>，使得<span class="math inline">\(f(x_i)\simeq y_i\)</span>。</p><p>均方误差是回归任务中最常用的性能度量。我们的目标就是使均方误差<span class="math inline">\(E_{(w,b)}=\stackrel{m}{\underset{i=1}\sum}(f(x_i)-wx_i-b)^2\)</span>最小化（损失函数最小化），即： <span class="math display">\[(w^*,b^*)=\underset{(w,b)}{\arg\min}\stackrel{m}{\underset{i=1}\sum}(f(x_i)-y_i)^2=\underset{(w,b)}{\arg\min}\stackrel{m}{\underset{i=1}\sum}(y_i-wx_i-b)^2\]</span> 基于<strong>均方误差最小化</strong>进行模型求解的方法叫做<strong>最小二乘法</strong>。最小二乘法可以通过极大似然估计推出，具体见<a href="/2022/02/13/math/极大似然估计/#应用">极大似然估计</a>这篇文章。</p><p>求解<span class="math inline">\(w\)</span>和<span class="math inline">\(b\)</span>的过程称为线性回归模型的<strong>最小二乘参数估计</strong>，将<span class="math inline">\(E_{(w,b)}\)</span>分别对<span class="math inline">\(w,b\)</span>求导，得： <span class="math display">\[\frac{\partial E_{(w,b)}}{\partial w}=2(w\stackrel{m}{\underset{i=1}\sum}x_i^2-\stackrel{m}{\underset{i=1}\sum}(y_i-b)x_i)\\\frac{\partial E_{(w,b)}}{\partial b}=2(mb-\stackrel{m}{\underset{i=1}\sum}(y_i-wx_i))\]</span> 令上面两个导数得值为0，求得函数得极小值点： <span class="math display">\[w=\frac{\stackrel{m}{\underset{i=1}\sum}y_i(x_i-\overline{x})}{\stackrel{m}{\underset{i=1}\sum}x_i^2-\frac{1}{m}(\stackrel{m}{\underset{i=1}\sum}x_i)^2} \\b=\frac{1}{m}\stackrel{m}{\underset{i=1}\sum}(y_i-wx_i)=\overline{y}-w\overline{x}\]</span></p><h3 id="多元线性回归">多元线性回归</h3><p>上述情况拓展到一般化，就是多元线性回归，多元线性回归解决的问题就如同开头描述的问题。</p><p>为了把问题中出现的运算都描述成矩阵的形式，我们可以将<span class="math inline">\(f(\pmb{x})=\pmb{w}^\text{T}\pmb{x}+b\)</span>中的<span class="math inline">\(b\)</span>放入矩阵。得到问题的矩阵表示<span class="math inline">\(f(\pmb{x}_i)=\pmb{X}\hat{\pmb{w}}\)</span>，其中<span class="math inline">\(w_{n+1}=d\)</span>。</p><p>变换的过程如下面的公式： <span class="math display">\[f(\pmb{x_i})=w_1 x_{i1}+w_2 x_{i2}+\cdots+w_n x_{in}+b\times1\\\hat{\pmb{w}}=(\pmb{w};b)=(w_1,w_2,\dots,w_n,w_{n+1})^{\text{T}}\\\pmb{X}=\begin{pmatrix} x_{11} &amp; x_{12}&amp; \cdots &amp; x_{1d} &amp; 1\\ x_{21} &amp; x_{22}&amp; \cdots &amp; x_{2d} &amp; 1\\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots\\ x_{m1} &amp; x_{m2}&amp; \cdots &amp; x_{md} &amp; 1\\\end{pmatrix}=\begin{pmatrix}x_1^\text{T} &amp; 1\\ x_2^\text{T} &amp; 1\\ \vdots &amp; \vdots\\ x_m^\text{T} &amp; 1\end{pmatrix}\]</span> 再把标记写成向量形式<span class="math inline">\(\pmb{y}=\{y_1,y_2,\dots,y_m\}\)</span>，这次还是使用最小二乘法进行估计，定义损失函数<span class="math inline">\(E_{\hat{\pmb{w}}}\)</span>为： <span class="math display">\[E_{\hat{\pmb{w}}}=(\pmb{y}-\pmb{X}\hat{\pmb{w}})^\text{T}(\pmb{y}-\pmb{X}\hat{\pmb{w}})\]</span> 类似于一元线性回归的式子，我们的目标为求解令损失函数最小的<span class="math inline">\(\pmb{w}^*\)</span>。 <span class="math display">\[\pmb{w}^*=\underset{\hat{\pmb{w}}}{\arg\min}(\pmb{y}-\pmb{X}\hat{\pmb{w}})^\text{T}(\pmb{y}-\pmb{X}\hat{\pmb{w}})\]</span> 还是按照类似于一元线性回归的方法，令<span class="math inline">\(E_{\hat{\pmb{w}}}\)</span>对<span class="math inline">\(\hat{\pmb{w}}\)</span>求导： <span class="math display">\[\frac{\partial E_{\hat{\pmb{w}}}}{\partial \hat{\pmb{w}}}=2\pmb{X}^\text{T}(\pmb{X}\hat{\pmb{w}}-\pmb{y})\]</span> 令上式等于0，当<span class="math inline">\(\pmb{X}^\text{T}\pmb{X}\)</span>为满秩矩阵或正定矩阵，可得： <span class="math display">\[\pmb{w}^*=(\pmb{X}^\text{T}\pmb{X})^{-1}\pmb{X}^\text{T}\pmb{y}\]</span> 令<span class="math inline">\(\hat{\pmb{x}}_i=(\pmb{x}_i;1)\)</span>，最终学到的线性回归模型为： <span class="math display">\[f(\hat{\pmb{x}}_i)=\hat{\pmb{x}}_i^\text{T}(\pmb{X}^\text{T}\pmb{X})^{-1}\pmb{X}^\text{T}\pmb{y}\]</span> 然而，现实任务中<span class="math inline">\(\pmb{X}^\text{T}\pmb{X}\)</span>往往不是满秩矩阵。在许多任务中我们会遇到大量的变量，其数目甚至超过样例数<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，导致<span class="math inline">\(\pmb{X}\)</span>的列数多于行数，<span class="math inline">\(\pmb{X}^\text{T}\pmb{X}\)</span>显然不满秩，此时可解出多个<span class="math inline">\(\pmb{w}^*\)</span>，它们都能使均方误差最小化<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。选择哪一个解作为输出，将由学习算法的归纳偏好决定。常见的做法是引入正则化(regularization) 项。</p><h3 id="正则化统计角度">正则化——统计角度</h3><p>假如给定<span class="math inline">\(N\)</span>个学习示例<span class="math inline">\(\pmb{X}_{N\times P},x_i\in \mathbb{R}^p\)</span>，<span class="math inline">\(N \gg p\)</span>，那么<span class="math inline">\(\pmb{X}^\text{T}\pmb{X}\)</span>往往是满秩的，可以得到解析解。如果<span class="math inline">\(N\)</span>比较小，或维数<span class="math inline">\(p\)</span>比较大，<span class="math inline">\(\pmb{X}^\text{T}\pmb{X}\)</span>往往不满秩，在数学上，不满秩体现为不可逆，在机器学习模型上，不满秩意味着模型过拟合的风险增加。这时该如何构建模型？</p><p>正则化是用来解决过拟合的方法之一，解决过拟合的方法主要有三种：</p><ol type="1"><li>增加示例</li><li>降维，进行特征选择和特征提取（PCA）</li><li>正则化</li></ol><p>这里主要讨论正则化。令<span class="math inline">\(L(\pmb{w})\)</span>为损失函数，<span class="math inline">\(p(\pmb{w})\)</span>是惩罚函数，正则化的框架如下： <span class="math display">\[\underset{\pmb{w}}{\arg\min}\ L(\pmb{w})+\lambda P(\pmb{w})\]</span> 正则化的主要思想就是对参数空间的约束。</p><p>我们在线性回归中引入两种正则化：</p><ol type="1"><li>Lasso，L1范数，<span class="math inline">\(P(\pmb{w})=||\pmb{w}||\)</span></li><li>Ridge，L2范数，权值衰减，<span class="math inline">\(P(\pmb{w})=\pmb{w}^\text{T}\pmb{w}\)</span></li></ol><p>下面使用L2范数求解上面的最优化问题： <span class="math display">\[\begin{align}J(\pmb{w})&amp;=\stackrel{n}{\underset{i=1}\sum}(\pmb{y}-\pmb{X}\hat{\pmb{w}})^\text{T}(\pmb{y}-\pmb{X}\hat{\pmb{w}})+\lambda\pmb{w}^\text{T}\pmb{w}\\&amp;=\pmb{w}^\text{T}(\pmb{X}^\text{T}\pmb{X}+\lambda \pmb{I})\pmb{w}-2\pmb{w}^\text{T}\pmb{X}^\text{T}\pmb{y}+\pmb{y}^\text{T}\pmb{y}\end{align}\]</span> 令<span class="math inline">\(J(\pmb{w})\)</span>对<span class="math inline">\(\pmb{w}\)</span>的导数等于0，求函数极值，从而求解优化问题： <span class="math display">\[\underset{\pmb{w}}{\arg\min}\ J(\pmb{w})\]</span></p><p><span class="math display">\[\frac{\partial J(\pmb{w})}{\partial\pmb{w}}=\pmb{w}^\text{T}(\pmb{X}^\text{T}\pmb{X}+\lambda \pmb{I})\pmb{w}-2\pmb{w}^\text{T}\pmb{X}^\text{T}\pmb{y}+\pmb{y}^\text{T}\pmb{y}=0\\\]</span></p><p>解得<span class="math inline">\(\pmb{w}\)</span>： <span class="math display">\[\hat{\pmb{w}}=(\pmb{X}^\text{T}\pmb{X}+\lambda \pmb{I})^{-1}\pmb{X}^\text{T}\pmb{y}\]</span> 这就是L2范数的正则化方法。</p><h3 id="正则化贝叶斯角度">正则化——贝叶斯角度</h3><p>由<a href="/2022/02/13/math/极大似然估计/">极大似然估计</a>这篇文章的例二，我们可以证明<strong>最小二乘估计等价于噪声服从高斯分布的极大似然估计</strong>。</p><p>现在我们估计的变量为<span class="math inline">\(\pmb{w}\)</span>，在估计<span class="math inline">\(\pmb{w}\)</span>时，每个示例<span class="math inline">\(\pmb{x}\)</span>是已知的。那么我们将<span class="math inline">\(\pmb{w}\)</span>视为随机变量，就可以写出实际值与估计值的关系：<span class="math inline">\(y=\pmb{w}^\text{T}\pmb{x}+b+\epsilon\)</span>，现在的假设是<span class="math inline">\(\pmb{w}\sim N(0,\sigma_0^2),\epsilon\sim N(0,\sigma^2)\)</span>。</p><p><span class="math inline">\(\pmb{w}\)</span>的后验概率为： <span class="math display">\[P(\pmb{w}\ |\ y) = \frac{P(y\ |\ \pmb{w})P(\pmb{w})}{P(y)}\]</span> 最好的回归模型的<span class="math inline">\(\pmb{w}^*\)</span>就可以使用最大后验概率估计求出： <span class="math display">\[\begin{align}\pmb{w}^*&amp;=\underset{\pmb{w}}{\arg\max}\ P(\pmb{w}\ |\ y)\\&amp;=\underset{\pmb{w}}{\arg\max}\ P(y\ |\ \pmb{w})P(\pmb{w})\end{align}\]</span> 根据正态分布的线性计算公式<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>，我们得到： <span class="math display">\[y\ |\ \pmb{w} \sim N(\pmb{w}^\text{T}\pmb{x}+b,\sigma^2) \]</span></p><p><span class="math display">\[P(y\ |\ \pmb{w})=\frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{(y-(\pmb{w}^\text{T}\pmb{x}+b))^2}{2\sigma^2})\]</span></p><p><span class="math inline">\(P(\pmb{w})\)</span>可以表示为： <span class="math display">\[P(\pmb{w})=\frac{1}{\sqrt{2\pi}\sigma_0}\text{exp}(-\frac{\pmb{w}^\text{T}\pmb{w}}{2\sigma_0^2})\]</span> 使用最大后验概率估计(MAP)： <span class="math display">\[\begin{align}\pmb{w}^*&amp;=\underset{\pmb{w}}{\arg\max}\ \ln (P(y\ |\ \pmb{w})P(\pmb{w}))\\&amp;=\underset{\pmb{w}}{\arg\max}\ -\frac{(y-(\pmb{w}^\text{T}\pmb{x}+b))^2}{2\sigma^2}-\frac{\pmb{w}^\text{T}\pmb{w}}{2\sigma_0^2}\\&amp;=\underset{\pmb{w}}{\arg\min}\ \frac{(y-(\pmb{w}^\text{T}\pmb{x}+b))^2}{2\sigma^2}+\frac{\pmb{w}^\text{T}\pmb{w}}{2\sigma_0^2}\\&amp;=\underset{\pmb{w}}{\arg\min}\ (y-\pmb{w}^\text{T}\pmb{x})^2 +\frac{\sigma^2}{\sigma_0^2}||\pmb{w}||^2\end{align}\]</span> 可以发现，<strong>使用L2正则化的最小二乘估计等价于先验和噪声服从于高斯分布的极大似然估计</strong>，其中<span class="math inline">\(\lambda=\frac{\sigma^2}{\sigma_0^2}\)</span>。</p><h2 id="广义线性回归">广义线性回归</h2><p>线性回归学习器不仅仅能够解决一些线性的问题，我们还可以对它进行进一步扩展以解决一些特殊的非线性回归问题。我们可以把线性回归模型简写为： <span class="math display">\[y=\pmb{w}^\text{T}\pmb{x}+b\]</span> 我们可以令模型的预测值逼近<span class="math inline">\(y\)</span>的衍生物。譬如说，假设我们认为示例所对应的输出标记是在指数尺度上变化，那就可以将输出标记的对数作为线性模型逼近的指标，即： <span class="math display">\[\ln y=\pmb{w}^\text{T}\pmb{x}+b\tag{3.14}\]</span> 这就是<strong>对数线性回归</strong>（log-liner regression）。它实际上是试图让<span class="math inline">\(e^{\pmb{w}^\text{T}\pmb{x}+b}\)</span>逼近<span class="math inline">\(y\)</span>。式（3.14）实际上仍然是线性回归，但实质上已是在<strong>求取空间到输出空间的非线性函数映射</strong>。</p><p>更一般地，考虑单调可微函数<span class="math inline">\(g(\cdot)\)</span>，令： <span class="math display">\[y=g^{-1}(\pmb{w}^\text{T}\pmb{x}+b)\tag{3.15}\]</span> 这样得到的模型称为<strong>广义线性模型</strong>，其中<span class="math inline">\(g(\cdot)\)</span>是联系函数。显然，对数线性回归是广义模型在<span class="math inline">\(g(\cdot)=\ln(\cdot)\)</span>时的特例。</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>例如，生物信息学的基因芯片数据中常有成千上万个属性，但往往只有几十、上百个样例。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>回忆一下解线性方程组时，若因变量过多，则会解出多组解<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>已知<span class="math inline">\(X\sim N(\pmb{\mu},\pmb{\Sigma}),\pmb{y}=\pmb{A}\pmb{x}+\pmb{B}\)</span>​，则有<span class="math inline">\(\pmb{y}\sim N(\pmb{A}\pmb{\mu}+\pmb{B},\pmb{A}\pmb{\Sigma}\pmb{A}^\text{T})\)</span>​<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 回归问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贝叶斯分类器（下）</title>
      <link href="/2022/03/02/machine%20learning/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8b/"/>
      <url>/2022/03/02/machine%20learning/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8b/</url>
      
        <content type="html"><![CDATA[<h2 id="em算法的引入抛硬币">EM算法的引入：抛硬币</h2><p>现在有两枚硬币，它们不一定是均匀的，A，B硬币抛掷落地后为正面的概率分别为<span class="math inline">\(\theta_A,\theta_B\)</span>。<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><h3 id="问题一">问题一</h3><p>给出每次抛掷了哪枚硬币，及实验的结果，设正面朝上次数为<span class="math inline">\(\pmb{X}=\{x_1,x_2,x_3,x_4,x_5\}\)</span>，其中<span class="math inline">\(x_i\in\{0,1,2,\dots,10\}\)</span>。</p><table><thead><tr class="header"><th style="text-align: center;">抛掷的硬币类别</th><th style="text-align: center;">硬币A</th><th style="text-align: center;">硬币B</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">B</td><td style="text-align: center;"></td><td style="text-align: center;">5H,5T</td></tr><tr class="even"><td style="text-align: center;">A</td><td style="text-align: center;">9H,1T</td><td style="text-align: center;"></td></tr><tr class="odd"><td style="text-align: center;">A</td><td style="text-align: center;">8H,2T</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">B</td><td style="text-align: center;"></td><td style="text-align: center;">4H,6T</td></tr><tr class="odd"><td style="text-align: center;">A</td><td style="text-align: center;">7H,3T</td><td style="text-align: center;"></td></tr><tr class="even"><td style="text-align: center;">A,B总计</td><td style="text-align: center;">24H,6T</td><td style="text-align: center;">9H,11T</td></tr></tbody></table><p>很容易估计出 <span class="math display">\[\hat{\theta}_A=\frac{24}{24+6}=0.80\\\hat{\theta}_B=\frac{9}{9+11}=0.45\]</span></p><h3 id="问题二">问题二</h3><p>不知道每次抛出的是哪枚硬币，只有实验结果</p><table><thead><tr class="header"><th style="text-align: center;">实验次数</th><th style="text-align: center;">实验结果</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">5H-5T</td></tr><tr class="even"><td style="text-align: center;">2</td><td style="text-align: center;">9H-1T</td></tr><tr class="odd"><td style="text-align: center;">3</td><td style="text-align: center;">8H-2T</td></tr><tr class="even"><td style="text-align: center;">4</td><td style="text-align: center;">4H-6T</td></tr><tr class="odd"><td style="text-align: center;">5</td><td style="text-align: center;">7H-3T</td></tr></tbody></table><p>此时我们不知道每次投掷时硬币的种类。所以我们多了一个硬币种类的隐变量，设为<span class="math inline">\(\pmb{Z}\)</span>，可以把它认为是一个5维的向量<span class="math inline">\((z_1,z_2,z_3,z_4,z_5)^\text{T}\)</span>，代表每次投掷时所使用的硬币，比如<span class="math inline">\(z_1\in\{A,B\}\)</span>，就代表第一轮投掷时使用的硬币是A还是B。我们的目标仍然是估计<span class="math inline">\(\theta_A,\theta_B\)</span>。但是我们遇到了两个矛盾的问题：</p><ol type="1"><li><p>如果我们不知道哪次投掷的硬币是哪个（即不知道<span class="math inline">\(\pmb{Z}\)</span>），那就无法估计<span class="math inline">\(\theta_A,\theta_B\)</span>的值；</p></li><li><p>如果我们想要估计<span class="math inline">\(\pmb{Z}\)</span>，我们又需要知道<span class="math inline">\(\theta_A,\theta_B\)</span>的值，令<span class="math inline">\(\pmb{\theta}=\{\theta_A,\theta_B\}\)</span>，这样才能使用极大似然估计法求出<span class="math inline">\(P(\pmb{Z}\ |\ \pmb{X},\pmb{\theta})\)</span>（即在已知<span class="math inline">\(\pmb{X}\)</span>和<span class="math inline">\(\pmb{\theta}\)</span>的情况下<span class="math inline">\(\pmb{Z}\)</span>的概率似然<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>）。</p></li></ol><p>上述的问题是个死循环，为了解开这个死循环，我们随便假设<span class="math inline">\(\pmb{\theta}\)</span>中元素的值（即我们要估计的A，B掷出正面的概率），用这个<span class="math inline">\(\pmb{\theta}\)</span>代入<span class="math inline">\(P(\pmb{Z}\ |\ \pmb{X},\pmb{\theta})\)</span>来估计<span class="math inline">\(\pmb{Z}\)</span>。接着，既然我们得到了<span class="math inline">\(\pmb{Z}\)</span>，就可以用它再次估计<span class="math inline">\(\pmb{\theta}\)</span>（方法是极大似然估计），如此反复。。。可以证明，EM方法是收敛的<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。最终，<span class="math inline">\(\pmb{\theta}\)</span>会稳定在一个值上。</p><p>当然了，如果运气足够好，上面的一次迭代之后，得到的<span class="math inline">\(\hat{\pmb{\theta}}\)</span>和<span class="math inline">\(\pmb{\theta}\)</span>几乎没有差别，那说明，<span class="math inline">\(\pmb{\theta}\)</span>就应该是符合实际的估计。</p><h2 id="em算法的进行过程">EM算法的进行过程</h2><p>紧接上个段落的问题二，下面进行算法的模拟执行。</p><p>假设<span class="math inline">\(\pmb{\theta}=\{0.5，0.6\}\)</span>，那么，对于所有实验的<span class="math inline">\(P(\pmb{Z}\ |\ \pmb{X},\pmb{\theta})\)</span>极大似然估计为： <span class="math display">\[P(z_1=A\ |\ \pmb{X},\pmb{\theta})=(0.5)^5(0.5)^5=0.000977,P(z_1=B\ |\ \pmb{X},\pmb{\theta})=(0.6)^5(0.4)^5=0.000796\\P(z_2=A\ |\ \pmb{X},\pmb{\theta})=(0.5)^9(0.5)^1=0.000977,P(z_2=B\ |\ \pmb{X},\pmb{\theta})=(0.6)^9(0.4)^1=0.004031\\P(z_3=A\ |\ \pmb{X},\pmb{\theta})=(0.5)^8(0.5)^2=0.000977,P(z_3=B\ |\ \pmb{X},\pmb{\theta})=(0.6)^8(0.4)^2=0.002687\\P(z_4=A\ |\ \pmb{X},\pmb{\theta})=(0.5)^4(0.5)^6=0.000977,P(z_4=B\ |\ \pmb{X},\pmb{\theta})=(0.6)^4(0.4)^6=0.000531\\P(z_5=A\ |\ \pmb{X},\pmb{\theta})=(0.5)^7(0.4)^3=0.000977,P(z_5=B\ |\ \pmb{X},\pmb{\theta})=(0.6)^7(0.4)^3=0.001792\\\]</span> 第一组实验结果是A硬币得到的概率为<span class="math inline">\(\frac{0.000977}{0.000977+0.000796}=0.55\)</span>，是B硬币得到的概率为<span class="math inline">\(0.45\)</span>。</p><p>对五组进行类似的比较，可以得到<span class="math inline">\(\pmb{Z}=\{A,B,B,A,B\}\)</span>。不过在机器学习中，我们通常通过期望的方式判断<span class="math inline">\(z_i\)</span>最可能是哪枚硬币，具体方法如下： <span class="math display">\[\mathbb{E}_{z_i=A|x_1,\theta_A}[P(z_i=A,x_1\ |\ \theta_A)]=0.55*5+0.55*5=2.75\\\mathbb{E}_{z_i=B|x_1,\theta_B}[P(z_i=B,x_1\ |\ \theta_B)]=0.45*5+0.45*5=2.25\]</span> A的期望更高些，所以认为第一组数据更可能是A掷出来的。</p><p>接下来再估计<span class="math inline">\(\hat{\pmb{\theta}}=(\hat{\theta}_A,\hat{\theta}_B)\)</span>： <span class="math display">\[\hat{\theta}_A=\frac{9}{11+9}=0.45\\\hat{\theta}_B=\frac{24}{24+6}=0.8\]</span> 然后将<span class="math inline">\(\hat{\pmb{\theta}}\)</span>代入<span class="math inline">\(\pmb{\theta}\)</span>进行下一轮迭代。不停迭代，直到概率稳定为止。</p><h2 id="em算法一般化的分析">EM算法一般化的分析</h2><p>在前面的讨论中，我们已知假设训练样本中所有的数据都已经被观测到，即训练样本是“完整的”。但在现实生活中，我们往往会遇到“不完整”的样本，例如西瓜的根蒂已经脱落，则训练样本“根蒂”属性变量值未知。忘记记录每一次抛掷的是哪一种硬币，则每次抛掷实验硬币的种类不可知。此时应该如何估计模型参数？</p><p>考虑求模型参数<span class="math inline">\(\pmb{\theta}\)</span>的极大似然估计： <span class="math display">\[\hat{\pmb{\theta}}=\underset{\pmb{\theta}}{\arg\max}\ln P(\pmb{X}\ |\ \pmb{\theta})\]</span> 这个问题没有解析解，只能通过迭代的方式求解。EM算法就是可以解决这个问题的一种迭代方法。未观测变量的学名是“隐变量”，隐变量对<span class="math inline">\(\pmb{X}\)</span>的影响是不能忽略的。我们称观测变量<span class="math inline">\(\pmb{X}\)</span>为不完全数据，称观测变量和非观测变量的组合<span class="math inline">\((\pmb{X},\pmb{Z})\)</span>为完全数据。</p><p>令<span class="math inline">\(\pmb{X}=\{X_1,X_2,\dots,X_n\}\)</span>表示已观测变量集，<span class="math inline">\(\pmb{Z}=\{Z_1,Z_2,\dots,Z_n\}\)</span>表示隐变量集，<span class="math inline">\(\pmb{\theta}\)</span>表示模型参数。若对<span class="math inline">\(\pmb{\theta}\)</span>做极大似然估计，则<span class="math inline">\(\pmb{\theta}\)</span>的最大化对数似然： <span class="math display">\[LL(\pmb{\theta}\ |\ \pmb{X},\pmb{Z})=\ln P(\pmb{X},\pmb{Z}\ |\ \pmb{\theta})\]</span> <span class="math inline">\(\pmb{Z}\)</span>是隐变量，上式无法直接求解。此时我们可以通过对<span class="math inline">\(\pmb{Z}\)</span>求期望，来最大化已观测数据的对数“边际似然<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>”（marginal-likelihood） <span class="math display">\[LL(\pmb{\theta}\ |\ \pmb{X})=\ln P(\pmb{X}\ |\ \pmb{\theta})=\ln \underset{\pmb{Z}}\sum P(\pmb{X},\pmb{Z}\ |\ \pmb{\theta})\]</span> EM是常用的估计参数隐变量的利器，它是一种迭代式的方法。其基本想法是：若参数<span class="math inline">\(\pmb{\theta}\)</span>已知，则可根据训练数据推断出最优隐变量<span class="math inline">\(\pmb{Z}\)</span>的值（E）；若<span class="math inline">\(\pmb{Z}\)</span>的值已知，则可方便的对参数<span class="math inline">\(\pmb{\theta}\)</span>做极大似然估计（M）。</p><p>于是，以初始值<span class="math inline">\(\pmb{\theta}^0\)</span>为起点，对式<span class="math inline">\(LL(\pmb{\theta};\pmb{X})\)</span>迭代执行以下步骤到收敛：</p><ul><li>基于<span class="math inline">\(\pmb{\theta}^t\)</span>推断隐变量<span class="math inline">\(\pmb{Z}\)</span>的期望，记为<span class="math inline">\(\pmb{Z}^t\)</span>；</li><li>基于已观测变量<span class="math inline">\(\pmb{X}\)</span>和<span class="math inline">\(\pmb{Z}^t\)</span>对参数<span class="math inline">\(\pmb{\theta}\)</span>做极大似然估计，记为<span class="math inline">\(\pmb{\theta}^{t+1}\)</span>；</li></ul><p>这就是EM算法的原型。</p><p>进一步，若我们不是取<span class="math inline">\(\pmb{Z}\)</span>的期望，而是基于<span class="math inline">\(\pmb{\theta}^t\)</span>计算隐变量<span class="math inline">\(\pmb{Z}\)</span>的概率分布<span class="math inline">\(P(\pmb{Z}\ |\ \pmb{X},\pmb{\theta}^t)\)</span>，则EM算法的两个步骤是：</p><ul><li><p>E步：以当前参数<span class="math inline">\(\pmb{\theta}^t\)</span>推断变量分布<span class="math inline">\(P(\pmb{Z}\ |\ \pmb{X},\pmb{\theta}^t)\)</span>，并计算对数似然<span class="math inline">\(LL(\pmb{\theta}\ |\ \pmb{X},\pmb{Z})\)</span>关于<span class="math inline">\(\pmb{Z}\)</span>的期望： <span class="math display">\[Q(\pmb{\theta}\ |\ \pmb{\theta}^t)=\mathbb{E}_{\pmb{Z}|\pmb{X},\pmb{\theta}^t}LL(\pmb{\theta}\ |\ \pmb{X},\pmb{Z})\]</span></p></li><li><p>M步：寻找参数最大化期望似然，即： <span class="math display">\[\pmb{\theta}^{t+1}=\underset{\pmb{\theta}}{\arg\max}\ Q(\pmb{\theta}\ |\ \pmb{\theta}^t)\]</span></p></li></ul><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>Do, C. B., &amp; Batzoglou, S. (2008). What is the expectation maximization algorithm?. Nature biotechnology, 26(8), 897.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>估计，近似出来的概率分布<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>EM算法及证明，https://people.eecs.berkeley.edu/~pabbeel/cs287-fa13/slides/Likelihood_EM_HMM_Kalman.pdf<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn4" role="doc-endnote"><p>统计学中，<strong>边际似然函数</strong>（<em>marginal likelihood function</em> 或 <em>integrated likelihood</em>）是一种似然函数，其中某些参数变量被边缘化。在贝叶斯统计的背景下，它常常代指证据<em>evidence</em>或模型证据<em>model evidence</em>。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 贝叶斯方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习的数学知识</title>
      <link href="/2022/03/01/math/%E5%82%A8%E5%A4%87%E7%9F%A5%E8%AF%86/"/>
      <url>/2022/03/01/math/%E5%82%A8%E5%A4%87%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h2 id="概率公式中的分号逗号竖线">概率公式中的分号、逗号、竖线</h2><p>优先级：分号&gt;逗号&gt;竖线</p><h3 id="分号">分号</h3><p><span class="math display">\[P(x;\theta)\]</span></p><p>可以看作变量 <span class="math inline">\(\theta\)</span>的函数，x代表确定的采样值， <span class="math inline">\(\theta\)</span>表示代表待估参数。</p><h3 id="竖线">竖线</h3><p><span class="math display">\[P(A|B)\\P(x;\theta)\]</span></p><p>竖线的意义分两种情况：</p><ol type="1"><li>当竖线右侧出现了随机变量，竖线表示条件概率</li><li>当竖线右侧出现了参数，则与<span class="math inline">\(P(x;\theta)\)</span>等价</li></ol><h3 id="逗号">逗号</h3><p>右侧出现了参数，将参数全部放在后边： <span class="math display">\[P(Y|Z,\theta)\Leftrightarrow P(Y|Z;\theta)\]</span> 逗号的两侧都是随机变量，表示两个随机变量的联合概率分布： <span class="math display">\[P(X,Y)\]</span></p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>整数划分问题</title>
      <link href="/2022/02/28/Algorithm/%E6%95%B4%E6%95%B0%E5%88%92%E5%88%86%E9%97%AE%E9%A2%98/"/>
      <url>/2022/02/28/Algorithm/%E6%95%B4%E6%95%B0%E5%88%92%E5%88%86%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="题目大意">题目大意</h2><h3 id="两种描述">两种描述</h3><ol type="1"><li><p>给定<span class="math inline">\(n\in\mathbb{Z}^+\)</span>，整数<span class="math inline">\(n\)</span>可以分解为<span class="math inline">\(\stackrel{K}{\underset{k=1}\sum}n_k\)</span>的形式，求不同的分解有多少种。（例如6=3+2+1与6=2+3+1与6=1+2+3是同一种分解）</p></li><li><p>给定<span class="math inline">\(n\in\mathbb{Z}^+\)</span>，整数<span class="math inline">\(n\)</span>可以分解为<span class="math inline">\(\stackrel{K}{\underset{k=1}\sum}n_k\)</span>（其中<span class="math inline">\(n_1\geq n_2\geq \cdots \geq n_K\)</span>）的形式，求这样的分解有多少种。</p></li></ol><p>例如6的分解有11种，分别如下：</p><pre><code>65+14+2,4+1+13+3,3+2+1,3+1+1+12+2+2, 2+2+1+1, 2+1+1+1+11+1+1+1+1+1</code></pre><h2 id="解决方法">解决方法</h2><p>因为加数的排列不影响结果，所以问题一和问题二是等价的，其中问题二确定了分解出的加数的大小关系，这会降低问题的难度。所以围绕问题二求解。</p><p>引入辅助变量<span class="math inline">\(m\)</span>，意义是分解结果中最大的加数，引入目的是用来限定分解后加数的排列顺序。定义<span class="math inline">\(f(n,m)\)</span>表示将<span class="math inline">\(n\)</span>进行分解，满足分解结果的最大加数为<span class="math inline">\(m\)</span>的分解的数目。</p><p>显然，分解结果的最大加数不会比<span class="math inline">\(n\)</span>大。如果比<span class="math inline">\(n\)</span>大，就相当于分解结果的加数最大为<span class="math inline">\(n\)</span>，所以，若<span class="math inline">\(m\geq n\)</span>，则<span class="math inline">\(f(n,m)=f(n,n)\)</span>。</p><p>若<span class="math inline">\(m&lt;n\)</span>，分两种情况：</p><ol type="1"><li><p>分解结果包含<span class="math inline">\(m\)</span>，则问题转化为<span class="math inline">\(f(n-m, m)\)</span>。</p></li><li><p>分解结果不包含<span class="math inline">\(m\)</span>，则问题转化为<span class="math inline">\(f(n,m-1)\)</span>。</p></li></ol><p>两种情况，均构成了<span class="math inline">\(n\)</span>的分解，所以得到递推式<span class="math inline">\(f(n,n)=f(n-m,m)+f(n,m-1)\)</span>。</p><h2 id="总结">总结</h2><p>本题使用了<strong>数学归纳法</strong>的逆向方法，<strong>引入辅助变量</strong>的方法，和<strong>分类讨论</strong>的基本思想。是一个看似简单，实际上并不简单的一个基础递推问题。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 递归 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贝叶斯分类器（上）</title>
      <link href="/2022/02/27/machine%20learning/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8a/"/>
      <url>/2022/02/27/machine%20learning/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8a/</url>
      
        <content type="html"><![CDATA[<h2 id="贝叶斯决策论">贝叶斯决策论</h2><p>贝叶斯决策论是在概率框架下实施决策的基本方法。</p><p>对分类任务来说，在<strong>所有相关概率</strong>都已知的理想情况下，贝叶斯决策论考虑如何基于这些<strong>概率</strong>和<strong>误判损失</strong>来选择最优的类别标记。下面我们用一个多分类任务解释其基本原理。</p><p>假设有<span class="math inline">\(N\)</span>种类别标记，即<span class="math inline">\(\mathcal{Y}=\{c_1,c_2,\dots,c_N\}\)</span>，<span class="math inline">\(\lambda_{ij}\)</span>是将一个真实标记为<span class="math inline">\(c_j\)</span>的样本误分类为<span class="math inline">\(c_i\)</span>所产生的损失。基于后验概率<span class="math inline">\(P(c_i\ |\ \pmb{x})\)</span>（即给定<span class="math inline">\(\pmb{x}\)</span>，真实结果为<span class="math inline">\(c_i\)</span>的概率）可获得将样本<span class="math inline">\(\pmb{x}\)</span>分类为<span class="math inline">\(c_i\)</span>产生的期望损失，即在样本<span class="math inline">\(\pmb{x}\)</span>上的<strong>条件风险</strong>： <span class="math display">\[R(c_i\ |\ \pmb{x})=\stackrel{N}{\underset{j=1}\sum}\lambda_{ij}P(c_j\ |\ \pmb{x})\]</span> 我们的任务是寻找一个判定准则<span class="math inline">\(h\)</span>：<span class="math inline">\(\mathcal{X}\rightarrow\mathcal{Y}\)</span>以最小化<strong>总体风险</strong>： <span class="math display">\[R(h)=\mathbb{E}_{x}[R(h(\pmb{x})\ |\ \pmb{x})]\]</span> 直观上看，对每个样本<span class="math inline">\(\pmb{x}\)</span>，若<span class="math inline">\(h\)</span>能最小化条件风险<span class="math inline">\(R(h(\pmb{x})|\pmb{x})\)</span>，则总体风险<span class="math inline">\(R(h)\)</span>也将被最小化。这就引出了贝叶斯判定准则：为最小化总体风险，只需在每个样本上都选择那个使条件风险<span class="math inline">\(R(c|\pmb{x})\)</span>最小的类别标记。即： <span class="math display">\[h^*(\pmb{x})=\underset{c\in\mathcal{Y}}{\arg\min }\ R(c\ |\ \pmb{x})\]</span> 此时，<span class="math inline">\(h^*\)</span>被称为贝叶斯最优分类器，与之对应的总体风险<span class="math inline">\(R(h^*)\)</span>被称为贝叶斯风险。<span class="math inline">\(1-R(h^*)\)</span>反映了分类器所能达到的最好性能，即通过机器学习所能产生的模型精度的理论上限。</p><p>具体来说，若目标是最小化分类错误率，则误判损失<span class="math inline">\(\lambda_{ij}\)</span>可写为： <span class="math display">\[\lambda_{ij}=\begin{cases}0,i=j\\1,i\neq j\end{cases}\]</span> 此时条件风险： <span class="math display">\[R(c\ |\ \pmb{x})=1-P(c\ |\ \pmb{x})\]</span> 此时，最小化错误率的最优贝叶斯分类器为： <span class="math display">\[h^*(\pmb{x})=\underset{c\in\mathcal{Y}}{\arg\max}\ P(c\ |\ \pmb{x})\]</span> 即对每个样本<span class="math inline">\(\pmb{x}\)</span>，选择使得后验概率<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>最大的类别标记。</p><h3 id="估计后验概率的两种模型">估计后验概率的两种模型</h3><p>不难看出，欲使用贝叶斯判定准则来最小化决策风险，首先要获得后验概率<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>。然而，在现实任务中，这通常难以直接获得。从这个角度看，机器学习要实现的目标是<strong>基于有限的样本集尽可能准确的估计出后验概率</strong><span class="math inline">\(P(c\ |\ \pmb{x})\)</span>。</p><p>大体来说，主要有两种策略：</p><ol type="1"><li><p>给定<span class="math inline">\(\pmb{x}\)</span>，通过直接建模<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>来预测c，这样得到的是<strong>判别式模型</strong>。决策树，BP神经网络，支持向量机等都可以归入判别式模型的范畴。</p></li><li><p>利用<strong>贝叶斯公式</strong>，对概率分布<span class="math inline">\(P(\pmb{x},c)\)</span>建模，然后再由此得到<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>，这样得到的是<strong>生成式模型</strong>。</p><p>对于生成式模型，必然要考虑： <span class="math display">\[P(c\ |\ \pmb{x})=\frac{P(\pmb{x},c)}{P(\pmb{x})}\]</span> 基于贝叶斯定理： <span class="math display">\[P(c\ |\ \pmb{x})=\frac{P(\pmb{x}\ |\ c)P(c)}{\stackrel{m}{\underset{i=1}\sum}P(\pmb{x}\ |\ c_i)P(c_i)}=\frac{P(\pmb{x}\ |\ c)P(c)}{P(\pmb{x})}\]</span></p><ul><li><p>类“先验”概率<span class="math inline">\(P(c)\)</span>表达了样本空间中各类样本所占的比例，根据大数定律，当训练集包含了充足的独立同分布样本时，<span class="math inline">\(P(c)\)</span>可以通过各类样本在训练集上出现的频率进行估计。</p></li><li><p><span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>是样本<span class="math inline">\(\pmb{x}\)</span>相对于类标记<span class="math inline">\(c\)</span>的类条件概率，或称为“似然”。</p></li><li><p><span class="math inline">\(P(\pmb{x})\)</span>是用于归一化的“证据”因子。</p></li></ul><p>对给定样本<span class="math inline">\(\pmb{x}\)</span>，证据因子<span class="math inline">\(P(\pmb{x})\)</span>与类标记无关，因此估计<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>的问题就转化为如何基于训练数据<span class="math inline">\(D\)</span>估计先验<span class="math inline">\(P(c)\)</span>和<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>。</p><p>类条件概率<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>涉及到关于<span class="math inline">\(\pmb{x}\)</span>的所有属性的联合概率<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。如果样本<span class="math inline">\(\pmb{x}\)</span>的属性很多，样本空间的范围会很大，可用的学习数据往往小于样本空间的大小。因为大量的数据在训练集中没有出现，导致我们无法直接使用频率估计。因为“未在样本中出现”和“出现概率为0”通常是不同的。 <span class="math display">\[P(\pmb{x}\ |\ c)=P(x_1,x_2,\cdots,x_N\ |\ c)\]</span></p></li></ol><h2 id="估计类条件概率">估计类条件概率</h2><p>对于一个贝叶斯学习器，其最重要的问题就是如何估计<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>的值。下面的方法都是针对估计<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>的一些常用的方法。</p><h3 id="极大似然估计">极大似然估计</h3><p><a href="/2022/02/13/math/极大似然估计/">极大似然估计</a>，是频率主义学派提出的根据数据采样来估计概率分布的经典方法。</p><p>具体地，记关于类别<span class="math inline">\(c\)</span>的类条件概率为<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>，假设<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>具有确定的形式并且被参数向量<span class="math inline">\(\pmb{\theta}_c\)</span>唯一确定，则我们的任务就是利用训练集<span class="math inline">\(D\)</span>估计参数向量<span class="math inline">\(\pmb{\theta}_c\)</span>，为明确起见，将<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>记为<span class="math inline">\(P({\pmb{x}\ |\ c;\pmb{\theta}_c})\)</span>。</p><p>令<span class="math inline">\(D_c\)</span>表示训练集<span class="math inline">\(D\)</span>中第<span class="math inline">\(c\)</span>类样本的组成的集合，假设这些样本是独立同分布的，则参数<span class="math inline">\(\pmb{\theta}_c\)</span>对于数据集<span class="math inline">\(D_c\)</span>的似然是： <span class="math display">\[L(\pmb{\theta}_c)=\underset{x\in D_c}\prod P(\pmb{x}\ |\ c;\pmb{\theta}_c)\]</span> 连乘容易导致数据下溢，所以通常采用对数似然： <span class="math display">\[LL(\pmb{\theta}_c)=\log L(\pmb{\theta}_c)=\underset{x\in D_c}\sum\log P(\pmb{x}\ |\ c;\pmb{\theta}_c)\]</span> 此时参数<span class="math inline">\(\pmb{\theta}_c\)</span>的最大似然估计<span class="math inline">\(\hat{\pmb{\theta}}_c\)</span>为： <span class="math display">\[\hat{\pmb{\theta}}_c=\underset{\pmb{\theta}_c}{\arg\max}\ LL(\pmb{\theta}_c)\]</span> 例如，在连续属性情形下，假设概率密度函数<span class="math inline">\(p(\pmb{x}\ |\ c)\sim\mathcal{N}(\pmb{\mu}_c,\pmb{\sigma}_c^2)\)</span>，则参数<span class="math inline">\(\pmb{\mu}_c,\pmb{\sigma}_c^2\)</span>的极大似然估计为（关于以上结果的得出过程，将会在以后的文章进行补充）： <span class="math display">\[\hat{\pmb{\mu}}_c=\frac{1}{|D_c|}\underset{x\in D_c}\sum\pmb{x}\\\hat{\pmb{\sigma}}_c^2=\frac{1}{|D_c|}\underset{x\in D_c}\sum(\pmb{x}-\pmb{\mu}_c)(\pmb{x}-\pmb{\mu}_c)^{\text{T}}\]</span> 需注意的是，如果概率分布选错了，那么很容易产生误导性的后果。所以，要做出较好的接近真实分布的假设，要根据现实任务和经验仔细选择概率分布模型。</p><h3 id="朴素贝叶斯分类器">朴素贝叶斯分类器</h3><p>估计<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>的主要困难在于它是所有属性上的联合概率，难以从有限的样本中直接估计而得。为了避开联合概率这一障碍，朴素贝叶斯分类器采用了“属性条件独立性假设”。</p><p>朴素贝叶斯分类器：对已知类别，假设所有属性相互独立。换言之，每个属性独立的对结果产生影响。基于上述的”条件独立性假设“，<span class="math inline">\(P(c\ |\ \pmb{x})\)</span>可重写为： <span class="math display">\[P(\pmb{x}\ |\ c)=\frac{P(c)}{P(\pmb{x})}\stackrel{d}{\underset{i=1}\prod} P(x_i|c)\]</span> 其中<span class="math inline">\(d\)</span>为属性数目，<span class="math inline">\(x_i\)</span>为<span class="math inline">\(\pmb{x}\)</span>在第<span class="math inline">\(i\)</span>个属性上的取值。</p><p>由于对所有类别来说<span class="math inline">\(P(\pmb{x})\)</span>相同，因此基于贝叶斯判定准则，有： <span class="math display">\[h_{nb}(\pmb{x})=\underset{c\in\mathcal{Y}}{\arg\max}\ P(c)\stackrel{d}{\underset{i=1}\prod} P(x_i|c)\]</span> 这就是朴素贝叶斯分类器的表达式。</p><p>若有充足的独立同分布样本，容易估算出先验概率<span class="math inline">\(P(c)\)</span>: <span class="math display">\[P(c)=\frac{|D_c|}{|D|}\]</span> 对离散属性而言，令<span class="math inline">\(D_{c,x_i}\)</span>表示<span class="math inline">\(D_c\)</span>中在第<span class="math inline">\(i\)</span>个属性上取值为<span class="math inline">\(x_i\)</span>的样本组成的集合，则条件概率<span class="math inline">\(P(x_i\ |\ c)\)</span>可估计为： <span class="math display">\[P(x_i\ |\ c)=\frac{|D_{c,x_i}|}{|D_c|}\]</span> 对连续属性可以考虑概率密度函数，假定<span class="math inline">\(p(x_i\ |\ c)\sim\mathcal{N}(\mu_{c,i},\sigma^2_{c,i})\)</span>，则有： <span class="math display">\[P(x_i\ |\ c)=\frac{1}{\sqrt{2\pi}\sigma_{c,i}}\exp(-\frac{(x_i-\mu_{c,i})^2}{2\sigma_{c,i}^2})\]</span> 在现实任务中朴素贝叶斯分类器有多种使用方式．例如，若任务对预测速度要求较高，则对给定训练集，可将朴素贝叶斯分类器涉及的所有概率估值事先计算好存储起来，这样在进行预测时只需“查表”即可进行判别；</p><p>若任务数据更替频繁，则可采用“懒惰学习”(lazy learning) 方式，先不进行任何训练，待收到预测请求时再根据当前数据集进行概率估值；若数据不断增加，则可在现有估值基础上，仅对新增样本的属性值所涉及的概率估值进行计数修正即可实现增量学习。</p><h3 id="特殊情况的处理">特殊情况的处理</h3><p>若某个属性值在训练集中没有与某个类同时出现过，直接基于朴素贝叶斯分类器的预测公式进行估计是有问题的。假设<span class="math inline">\(x_i\)</span>没有与<span class="math inline">\(c_i\)</span>一起出现，那么<span class="math inline">\(P(x_i\ |\ c_i)=0\)</span>，即使<span class="math inline">\(\pmb{x}\)</span>看起来就应该分到<span class="math inline">\(c_i\)</span>类，它也不会被分到<span class="math inline">\(c_i\)</span>类。</p><p>为了避免其他属性携带的信息被训练集中未出现的属性值抹去，在估计概率时通常要进行<strong>平滑</strong>，拉普拉斯修正是一种常用的平滑的方法。具体来说，令<span class="math inline">\(N\)</span>表示训练集<span class="math inline">\(D\)</span>中可能的类别数，<span class="math inline">\(N_i\)</span>表示第<span class="math inline">\(i\)</span>个属性可能的取值数，则类先验概率公式<span class="math inline">\(P(c)\)</span>可以修正为： <span class="math display">\[\hat{P}(c)=\frac{|D_c|+1}{|D|+N}\]</span> 条件概率<span class="math inline">\(P(x_i\ |\ c)\)</span>的估计修正为： <span class="math display">\[\hat{P}(x_i\ |\ c)=\frac{|D_{c,x_i}|+1}{|D_c|+N_i}\]</span> 拉普拉斯修正避免了因样本不充分导致概率为0的问题。并且在训练集变大时，修正过程中引入的先验影响也会变得逐渐可忽略，使得估值逐渐趋向实际概率值。</p><h3 id="半朴素贝叶斯分类器">半朴素贝叶斯分类器</h3><p>朴素贝叶斯分类器的“属性条件独立性假设”可能过于激进，在实际应用中，存在依赖的属性非常多。就拿西瓜问题来说，含水量和甜度就有<a href="https://max.book118.com/html/2017/0823/129620441.shtm">较强的联系</a>。所以，为了让我们的估计值距离<span class="math inline">\(P(\pmb{x}\ |\ c)\)</span>尽量的近，我们可以适当考虑保留一部分依赖关系，这样的分类器就是<strong>半朴素贝叶斯分类器</strong>。</p><p><strong>半朴素贝叶斯</strong>的优势是既不需要进行完全概率计算，又不至于彻底忽略比较强的属性依赖关系。“独依赖关系”是半朴素分类器最常用的一组策略，即假设每个属性在类别之外最多依赖一个属性。设<span class="math inline">\(pa_i\)</span>为<span class="math inline">\(x_i\)</span>的父属性，具体的表达式为： <span class="math display">\[P(c\ |\ \pmb{x})=\frac{P(c)\stackrel{d}{\underset{i=1}\prod}P(x_i\ |\ c,pa_i)}{P(\pmb{x})}\propto P(c)\stackrel{d}{\underset{i=1}\prod}P(x_i\ |\ c,pa_i)\]</span> 对每个属性<span class="math inline">\(x_i\)</span>，若<span class="math inline">\(pa_i\)</span>已知，则可以使用上面估计<span class="math inline">\(\hat{P}(x_i\ |\ c)\)</span>的方法来估计<span class="math inline">\(P(x_i\ |\ c,pa_i)\)</span>。于是，问题的关键是如何确定每个属性的父属性，确定父属性的方法不同，导致出现了很多半朴素贝叶斯分类器的构建方法。</p><p>半朴素贝叶斯分类器的构建方法有如下几种：</p><ol type="1"><li><p>SPOOE：超父依赖估计，假设所有属性同时依赖于一个“超父属性”，其它属性之间相互独立。</p><p>令<span class="math inline">\(x_i\)</span>为“超父属性”，则： <span class="math display">\[\begin{align*}P(c\ |\ \pmb{x})&amp;=\frac{P(\pmb{x},c)}{P(\pmb{x})}\\&amp;=\stackrel{d}{\underset{i=1}\sum}\frac{P(c,x_i)P(x_1,x_2,\dots,x_{i-1},x_{i+1},\dots,x_d\ |\ c,x_i)}{P(\pmb{x})}\\&amp;=\stackrel{d}{\underset{i=1}\sum}\frac{P(c,x_i)}{P(\pmb{x})}\stackrel{d}{\underset{j=1}\prod}P(x_j\ |\ c,x_i)\end{align*}\]</span> SPODE的结构如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BY2.png" alt="SPODE结构" /></p></li><li><p>TAN：树形半朴素贝叶斯估计，在最大带权生成树的基础上，通过以下步骤将属性依赖关系约简为如下图所示的树形结构。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BY1.png" alt="最大生成树" /></p><ul><li><p>计算任意两个属性之间的条件互信息 <span class="math display">\[I(x_i,x_j\ |\ y)=\underset{x_i,x_j;c\in \mathcal{Y}}\sum P(x_i,x_j\ |\ c)\log\frac{P(x_i,x_j\ |\ c)}{P(x_i\ |\ c)P(x_j\ |\ c)}\]</span></p></li><li><p>以属性为节点构建完全图，任意两个节点之间的边权重设为<span class="math inline">\(I(x_i,x_j\ |\ y)\)</span>；</p></li><li><p>构建此完全图的最大带权生成树，挑选根变量，将边置为有向。</p></li><li><p>加入类别节点<span class="math inline">\(y\)</span>，增加<span class="math inline">\(y\)</span>到每个属性的有向边。</p></li></ul><p>估计的联合概率分布为： <span class="math display">\[P(x_1,x_2,\dots,x_n\ |\ c)=\stackrel{n}{\underset{i=1}\prod}P(x_i\ |\ c,pa_i)\]</span> 容易看出，条件互信息刻画了属性<span class="math inline">\(x_i\)</span>和<span class="math inline">\(x_j\)</span>在已知类别情况下的相关性。通过最大生成树算法，TAN实际上仅保留强相关属性的依赖性。</p></li><li><p>AODE：集成型半朴素贝叶斯算法，是一种基于<a href="/2022/02/14/machine%20learning/集成学习a">集成学习</a>机制，更为强大的独依赖学习器。AODE尝试将每个属性作为超父来构建SPODE，然后将那些具有足够训练数据支撑的SPODE集成起来作为最终结果，即 <span class="math display">\[P(c\ |\ \pmb{x})=\stackrel{d}{\underset{\underset{|D_{x_i}|\geq m&#39;}{i=1}}\sum}\frac{P(c,x_i)}{P(\pmb{x})}\stackrel{d}{\underset{j=1}\prod}P(x_j\ |\ c,x_i)\]</span> 其中<span class="math inline">\(D_{x_i}\)</span>是在第<span class="math inline">\(i\)</span>个属性上取值为<span class="math inline">\(x_i\)</span>的样本的集合。<span class="math inline">\(m&#39;\)</span>为阈值常数，通常设为30。显然，AODE需估计<span class="math inline">\(P(c,x_i)\)</span>和<span class="math inline">\(P(x_j\ |\ c,x_i)\)</span>，类似“特殊情况处理”一节中的式子，有： <span class="math display">\[\hat{P}(c,x_i)=\frac{|D_{c,x_i}|+1}{|D|+N\times N_i}\\\hat{P}(x_j\ |\ c,x_i)=\frac{|D_{c,x_i,x_j}|+1}{|D_{c,x_i}|+N_j}\]</span> 其中<span class="math inline">\(N\)</span>是<span class="math inline">\(D\)</span>中可能的类别数，<span class="math inline">\(N_i\)</span>是第<span class="math inline">\(i\)</span>个属性可能的取值数，<span class="math inline">\(D_{c,x_i.x_j}\)</span>是类别为<span class="math inline">\(c\)</span>且在第<span class="math inline">\(i\)</span>和第<span class="math inline">\(j\)</span>个属性上取值分别为<span class="math inline">\(x_i,x_j\)</span>的样本集合。例如，对西瓜数据集3.00有： <span class="math display">\[\begin{align*}\hat{P}_{是，浊响}&amp;=P(好瓜=是，敲声=浊响)\\&amp;=\frac{|D_{是,浊响}|+1}{|D|+N\times N_{浊响}}\\&amp;=\frac{6+1}{17+2\times 3}\approx0.304\\\end{align*}\]</span></p><p><span class="math display">\[\begin{align*}\hat{P}_{凹陷|是，浊响}&amp;=P(脐部=凹陷|好瓜=是，敲声=浊响)\\&amp;=\frac{|D_{是,浊响,凹陷}|+1}{|D_{是,敲声}|+N_{脐部}}\\&amp;=\frac{3+1}{6+3}\approx0.444\end{align*}\]</span></p><p>不难看出，与朴素贝叶斯分类器类似，AODE的训练过程也是计数，即在训练数据集上对符合条件的样本进行计数的过程。与朴素贝叶斯分类器相似，AODE无需模型选择，既能通过预计算减少时间，也能采取懒惰学习法在预测时再进行计数，并且易于实现增量学习。</p><p>能不能把独依赖的条件再严格一点？考虑属性间的更高阶的依赖？答案是可以的，只要使用<span class="math inline">\(P(x_i\ |\ c,\pmb{pa}_i)\)</span>替换现在的<span class="math inline">\(P(x_i\ |\ c,pa_i)\)</span>。如果这样做，就是将现在的ODE方法推广得到的的kDE方法，但要控制准确率和效率的平衡。如果阶数过高，训练样本的增加是指数级的，此时的训练样本如果过少，那么还是会陷入高阶联合概率组合爆炸的泥沼中。</p></li></ol><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>举例来说，如果<span class="math inline">\(\pmb{x}\)</span>中的所有元素都是独立同分布的，那么可以表这个概率可以表示为<span class="math display">\[x_i\stackrel{iid}{\sim}\ P(\pmb{x}\ |\ c)=\stackrel{n}{\underset{i=1}\prod}P(x_i\ |\ c)\]</span>。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 贝叶斯方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贝叶斯网络</title>
      <link href="/2022/02/27/machine%20learning/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B-Bayes%20Network/"/>
      <url>/2022/02/27/machine%20learning/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B-Bayes%20Network/</url>
      
        <content type="html"><![CDATA[<h2 id="概率图模型">概率图模型</h2><h3 id="引入高维随机变量">引入高维随机变量</h3><p>对于现实问题，如果需要尽量准确的概率预测，那么预测概率所需要的随机变量必然是高维随机变量。对于高维随即变量，我们最关心的是它的<strong>条件独立性</strong>。</p><h3 id="高维随机变量的困境">高维随机变量的困境</h3><p>维度高，计算复杂，<span class="math inline">\(P(\pmb{X})\)</span>的计算量太大。过少的数据无法覆盖大量的可能组合。</p><h3 id="高维随机变量计算的简化">高维随机变量计算的简化</h3><p>高维随机变量计算的简化方法，从简单到复杂，可以分为如下的几个阶段：</p><ol type="1"><li><p>最简单粗暴的方法，是假设变量之间全部独立同分布，这样就得到朴素贝叶斯分类器。</p></li><li><p>放松一点假设，令<span class="math inline">\(x_i\)</span>与<span class="math inline">\(x_{i-1}\)</span>相互依赖，使用齐次马尔可夫分类器，即假设<span class="math inline">\(x_j \perp x_{i+1}\ |\ x_i, j&lt;i\)</span>，这样就得到半朴素贝叶斯分类器。</p></li><li><p>再一般化一些，扩展齐次马尔可夫分类器，得到形如<span class="math inline">\(x_A \perp x_B \ |\ x_C\)</span>的<strong>条件独立性</strong>假设，其中<span class="math inline">\(x_A,x_B,x_C\)</span>是不相交的集合。概率图就是描述条件独立性的一种有效方法。</p></li></ol><h3 id="概率图模型简述">概率图模型简述</h3><p><strong>表示</strong>随机变量之间的关系，进行精确或近似的<strong>推断</strong>，<strong>学习</strong>方式有参数学习和结构学习。</p><ol type="1"><li>概率图的表示有三种形式，有向无环图被称作贝叶斯网络，无向图被称作马尔可夫网络。对于连续型的变量，我们将其称为高斯图，对应的，有高斯贝叶斯网络和高斯马尔可夫网络两种。</li><li>概率图可以进行精确的概率推断，也可以进行近似的概率推断。近似推断的方式有确定性近似（变分推断是其代表）和随机近似推断（蒙特卡罗方法方法是其代表）两种。</li><li>概率图学习分为参数学习和结构学习，参数学习涉及到完全数据和隐变量，结构学习的目的是为了学习出一个更好的图结构。</li></ol><p>下面将介绍一个重要的概率图模型——<strong>贝叶斯网络</strong>。</p><h2 id="贝叶斯网络">贝叶斯网络</h2><h3 id="贝叶斯网络简介">贝叶斯网络简介</h3><p>贝叶斯网(Bayesian network)亦称“信念网”(belief network) ，它借助<strong>有向无环图</strong>(Directed Acyclic Graph, 简称DAG)来刻画属性之间的依赖关系，并使用<strong>条件概率表</strong>(Conditional Probability Table, 简称CPT) 来描述属性的联合概率分布。</p><h3 id="构建贝叶斯网络">构建贝叶斯网络</h3><p>构建贝叶斯网络的方法，是根据父节点和子节点的关系，进行拓扑排序。例如现有条件概率<span class="math inline">\(P(x_i\ |\ x_j)\)</span>，则从<span class="math inline">\(x_j\)</span>向<span class="math inline">\(x_i\)</span>连接一条有向边。</p><p>在贝叶斯网络中，父节点与子节点的关系是由条件概率表达的，表达方式定义如下，其中<span class="math inline">\(\text{pa}(i)\)</span>为<span class="math inline">\(x_i\)</span>的<strong>父亲集合</strong>，我们称其为因子分解： <span class="math display">\[P(x_1,x_2,\dots,x_d)=\stackrel{d}{\underset{i=1}\prod}P(x_i\ |\ x_{\text{pa}(i)})\]</span></p><p>贝叶斯网结构有效地表达了属性间的条件独立性。下面推导三种典型的依赖关系。</p><h3 id="典型依赖关系">典型依赖关系</h3><ol type="1"><li><p>倒V字型结构中，变量的依赖关系</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BN1.png" alt="倒V字型结构" /></p><p>由<a href="">条件概率的链式计算法则</a>： <span class="math display">\[P(x_1,x_2,x_3)=P(x_1)P(x_2\ |\ x_1)P(x_3\ |\ x_1,x_2)\]</span> 由因子分解： <span class="math display">\[P(x_1,x_2,x_3)=P(x_1)P(x_2\ |\ x_1)P(x_3\ |\ x_1)\]</span> 得到<span class="math inline">\(P(x_3\ |\ x_1)=P(x_3\ |\ x_1,x_2)\)</span>。这个结论，可以推出<span class="math inline">\(x_2\ |\ x_1\)</span>和<span class="math inline">\(x_3\ |\ x_1\)</span>是独立的变量<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p><p><strong>结论</strong>：<span class="math inline">\(x_2 \perp x_3\ |\ x_1\)</span>。即已知一位父亲有多个儿子，才能确定这些儿子之间的关系。</p></li><li><p>连续结构中，变量的依赖关系</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BN2.png" alt="连续型结构" /></p><p>由条件概率的链式计算法则： <span class="math display">\[P(x_1,x_2,x_3)=P(x_3)P(x_2\ |\ x_3)P(x_1\ |\ x_2,x_3)\]</span> 由因子分解： <span class="math display">\[P(x_1,x_2,x_3)=P(x_3)P(x_2\ |\ x_3)P(x_1\ |\ x_2)\]</span> 与前面的情况类似，可以得到<span class="math inline">\(P(x_1\ |\ x_2,x_3)=P(x_1\ |\ x_2)\)</span>的结论：</p><p><strong>结论</strong>：<span class="math inline">\(x_1 \perp x_3\ |\ x_2\)</span>。<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>即知道父亲确定爷爷和孙子的关系。</p></li><li><p>V字型结构</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BN3.png" alt="V字型结构" /></p><p>由条件概率的链式计算法则： <span class="math display">\[P(x_1,x_2,x_3)=P(x_1)P(x_2\ |\ x_1)P(x_3\ |\ x_1,x_2)\]</span> 由因子分解： <span class="math display">\[P(x_1,x_2,x_3)=P(x_1)P(x_2)P(x_3\ |\ x_1,x_2)\]</span> 如果未观测<span class="math inline">\(x_3\)</span>，可以得到下面的关系： <span class="math display">\[P(x_2\ |\ x_1)=P(x_2)\]</span> 这说明<span class="math inline">\(x_1,x_2\)</span>是相互独立的<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。</p><p><strong>结论</strong>：如果<span class="math inline">\(x_3\)</span>的值未观测，则<span class="math inline">\(x_1\perp x_2\)</span>，如果<span class="math inline">\(x_3\)</span>的值已观测，则<span class="math inline">\(x_1,x_2\)</span>有关。即给定孩子才能确定父母之间的关系。另外，孩子的所有孩子也都会确定父母之间的关系。</p></li></ol><h3 id="有向分离d-separation">有向分离（D-separation）</h3><p>D划分方法的目的是判断集合之间条件独立性。</p><h3 id="d划分的规则">D划分的规则</h3><p>我们现在有<span class="math inline">\(x_A,x_B,x_C\)</span>三个互不相交的属性集合：</p><ol type="1"><li>如果属性<span class="math inline">\(b\)</span>满足与<span class="math inline">\(a\in x_A,c\in x_C\)</span>的倒V字型依赖关系，则<span class="math inline">\(b\)</span>必须处在<span class="math inline">\(x_B\)</span>中。这样才能保证观测到<span class="math inline">\(b\)</span>时<span class="math inline">\(a,c\)</span>关于<span class="math inline">\(b\)</span>的独立性。</li><li>如果属性<span class="math inline">\(b\)</span>满足与<span class="math inline">\(a\in x_A,c\in x_C\)</span>的连续型依赖关系，则<span class="math inline">\(b\)</span>必须处在<span class="math inline">\(x_B\)</span>中。这样才能保证观测到<span class="math inline">\(b\)</span>时<span class="math inline">\(a,c\)</span>关于<span class="math inline">\(b\)</span>的独立性。</li><li>如果属性<span class="math inline">\(b\)</span>满足与<span class="math inline">\(a\in x_A,c\in x_C\)</span>的V字型依赖关系，则<span class="math inline">\(b\)</span>不能处在<span class="math inline">\(x_B\)</span>中。因为<span class="math inline">\(a,c\)</span>在观测<span class="math inline">\(b\)</span>之前是相互独立的。只有观测到<span class="math inline">\(b\)</span>时，它们才会产生关联。</li></ol><p>上面的规则可以用下图来表示，我们通常将上面的规则称为<strong>全局马尔可夫性</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BN5.png" alt="全局马尔可夫性" /></p><p>令<span class="math inline">\(x_{-i}\)</span>表示在除去<span class="math inline">\(x_i\)</span>之后的全集上的随机变量，估计<span class="math inline">\(x_i\)</span>的全局概率为： <span class="math display">\[P(x_i\ |\ x_{-i})=\frac{P(x_i,x_{-i})}{P(x_{-i})}=\frac{P(\pmb{X})}{\int_{x_i}P(\pmb{X})dx_i}=\frac{\stackrel{d}{\underset{j=1}\prod}P(x_j\ |\ x_{\text{pa}(j)})}{\int_{x_i}\stackrel{d}{\underset{j=1}\prod}P(x_j\ |\ x_{\text{pa}(j)})dx_i}\]</span> 与<span class="math inline">\(x_i\)</span>无关的集合对应的概率在上式中可以提取公因式后约去。与<span class="math inline">\(x_i\)</span>有关的变量就是<span class="math inline">\(x_i\)</span>的父母，子女，和子女的另一个父母。这种关系被称为马尔可夫毯，用图表示如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/BN4.png" alt="马尔可夫毯" /></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>推导过程：<span class="math inline">\(P(x_3\ |\ x_1)P(x_2\ |\ x_1)=P(x_3\ |\ x_1,x_2)P(x_2\ |\ x_1) \Rightarrow P(x_3\ |\ x_1)P(x_2\ |\ x_1)=P(x_3,x_2\ |\ x_1)\)</span>​<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>推导过程：<span class="math inline">\(P(x_1\ |\ x_2,x_3)=P(x_1\ |\ x_2) \Rightarrow P(x_1\ |\ x_2,x_3)P(x_3\ |\ x_2)=P(x_1\ |\ x_2)P(x_3\ |\ x_2)\\ \Rightarrow P(x_1,x_3\ |\ x_2) = P(x_1\ |\ x_2)P(x_3\ |\ x_2)\)</span>​<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>在<span class="math inline">\(x_1\)</span>​的条件下发生<span class="math inline">\(x_2\)</span>​的概率与无条件发生<span class="math inline">\(x_2\)</span>​的概率相等，说明<span class="math inline">\(x_1\)</span>​与<span class="math inline">\(x_2\)</span>​无关。​<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 贝叶斯方法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>决策树</title>
      <link href="/2022/02/24/machine%20learning/%E5%86%B3%E7%AD%96%E6%A0%91/"/>
      <url>/2022/02/24/machine%20learning/%E5%86%B3%E7%AD%96%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是决策树">什么是决策树</h2><h3 id="从逻辑角度">从逻辑角度</h3><p>一棵具有一定深度的，根据条件选择分支的树型结构，如图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT1.png" alt="逻辑角度理解决策树" /></p><h3 id="从几何角度">从几何角度</h3><p>根据某种准则划分特征空间，如图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT2.png" alt="几何角度理解决策树" /></p><h3 id="最终目的">最终目的</h3><p>将样本约分越“纯”（使用信息熵判断）。</p><h2 id="决策树分类的理论基础信息论">决策树分类的理论基础——信息论</h2><h3 id="自信息">自信息</h3><p>定义满足分布<span class="math inline">\(x\sim \mathcal{D}\)</span>的随机变量<span class="math inline">\(X\)</span>的自信息为： <span class="math display">\[I(X)=-\log_bp(x)\]</span> <span class="math inline">\(b=2\)</span>时单位为bit，<span class="math inline">\(b=e\)</span>时单位为Nat。</p><h3 id="信息熵">信息熵</h3><p>信息熵是自信息的期望：度量随机变量<span class="math inline">\(X\)</span>的不确定性，信息熵越大越不确定，离散型随机变量的信息熵为： <span class="math display">\[H(X)=\mathbb{E}_{x\sim\mathcal{D}}[I(X)]=-\underset{x}{\sum}p(x)\log_bp(x)\]</span> 类比可得出连续型随机变量的信息熵为： <span class="math display">\[H(X)=\mathbb{E}_{x\sim\mathcal{D}}[I(X)]=-\int_{-\infty}^{+\infty} p(x)\log_bp(x)dx\]</span> 计算信息熵时约定：若<span class="math inline">\(p(x)=0\)</span>，则<span class="math inline">\(p(x)\log_b p(x)=0\)</span>；对离散型随机变量，当<span class="math inline">\(X\)</span>的某个取值概率为1时，信息熵最小，其值为0。当<span class="math inline">\(X\)</span>的各个取值概率均等时，信息熵最大（最不确定），其值为<span class="math inline">\(\log_b|X|\)</span>。其中<span class="math inline">\(|X|\)</span>表示<span class="math inline">\(X\)</span>可能取值的个数。</p><p>将样本类别标记<span class="math inline">\(y\)</span>视作随机变量，各个类别在样本集合<span class="math inline">\(D\)</span>中的占比<span class="math inline">\(p_k(k=1,2,\dots,|\mathcal{Y}|)\)</span>视作各个类别取值的概率，则样本集合<span class="math inline">\(D\)</span>（随机变量<span class="math inline">\(y\)</span>）的信息熵（单位为bit）为： <span class="math display">\[H(y)=\text{Ent}(D)=-\stackrel{|\mathcal{Y}|}{\underset{k=1}\sum}p_k\log_2p_k\]</span> 此时的信息熵所代表的“不确定性”可以转换理解为集合内样本的纯度。信息熵的值越小，表示集合内的样本越“纯”。</p><h3 id="条件熵">条件熵</h3><p>条件熵（<span class="math inline">\(Y\)</span>的信息熵关于概率分布<span class="math inline">\(X\)</span>的期望），即在已知<span class="math inline">\(X\)</span>后<span class="math inline">\(Y\)</span>的不确定性。思想是将<span class="math inline">\(Y\)</span>根据<span class="math inline">\(X\)</span>的取值进行划分，再分别根据划分出子集在<span class="math inline">\(X\)</span>中的分布求期望。具体地，假设有随机变量<span class="math inline">\(X,Y\)</span>它们符合以下联合概率分布： <span class="math display">\[P(X=x_i,Y=y_i)=p_{ij}\]</span> 那么在已知<span class="math inline">\(X\)</span>的条件下，随机变量<span class="math inline">\(Y\)</span>的条件熵为： <span class="math display">\[H(Y|X)=\underset{x}{\sum}p(x)H(Y|X=x)\]</span> 从单个属性（特征）<span class="math inline">\(a\)</span>的角度来看，假设其可能取值为<span class="math inline">\(A=\{a^1,a^2,\dots,a^V\}\)</span>，分布为<span class="math inline">\(\mathcal{A}\)</span>，<span class="math inline">\(D^v\)</span>表示属性<span class="math inline">\(a\)</span>的取值为<span class="math inline">\(a^v\in\{a^1,a^2,\dots,a^V\}\)</span>的样本集合。<span class="math inline">\(\frac{|D^v|}{|D|}\)</span>表示占比，那么在已知属性<span class="math inline">\(a\)</span>的取值后，样本集合<span class="math inline">\(D\)</span>的条件熵为（<span class="math inline">\(Y\)</span>是符合分布<span class="math inline">\(y\sim \mathcal{D}^v\)</span>的随机变量，<span class="math inline">\(X\)</span>是满足分布<span class="math inline">\(x\sim \mathcal{A}\)</span>的随机变量）： <span class="math display">\[\begin{align*}H(Y|X)&amp;=\underset{a\in\{a^1,a^2,\dots,a^V\}}{\sum}p(a)H(Y|X=a)\\&amp;=\stackrel{V}{\underset{v=1}\sum}\frac{|D^v|}{|D|}Ent(D^v)\end{align*}\]</span></p><h3 id="信息增益">信息增益</h3><p>在已知属性（特征<span class="math inline">\(a\)</span>）的取值后<span class="math inline">\(y\)</span>的不确定性减少的量，即纯度的提升： <span class="math display">\[\text{Gain}(D,a)=\text{Ent}(D)-\stackrel{V}{\underset{v=1}\sum}\frac{|D^v|}{|D|}Ent(D^v)\]</span> 下面介绍几种决策树及其改进：</p><h2 id="id3决策树">ID3决策树</h2><h3 id="决策树构造原理">决策树构造原理</h3><p>以信息增益为准则来划分属性的决策树： <span class="math display">\[a_*=\underset{a\in A}{\arg\max}\ \text{Gain}(D,a)\]</span></p><h3 id="id3决策树构造过程">ID3决策树构造过程</h3><p>以下过程均从《机器学习》中引用。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT3.png" alt="西瓜数据集2.0" /></p><p>以表中的西瓜数据集2.0为例，该数据集包含17个训练样例，用以学习一棵能预测没剖开的是不是好瓜的决策树。显然，<span class="math inline">\(|\mathcal{Y}| = 2\)</span>. 在决策树学习开始时，根结点包含<span class="math inline">\(D\)</span>中的所有样例，其中正例占<span class="math inline">\(p_1=\frac{8}{17}\)</span>，反例占<span class="math inline">\(p2 = \frac{9}{17}\)</span>。于是，可计算出根结点的信息熵为： <span class="math display">\[\text{Ent}(D)=-\frac{8}{17}\log_2\frac{8}{17}-\frac{9}{17}\log_2\frac{9}{17}\approx0.998\]</span> 然后，我们要计算出当前属性集合{色泽，根蒂，敲声，纹理跻部，触感}中每个属性的信息增益．以属性”色泽”为例，它有3个可能的取值：{青绿，乌黑，浅白}．若使用该属性对D进行划分，则可得到3个子集，分别记为：$ D<sup>1(色泽＝青绿)<span class="math inline">\(，\)</span>D</sup>2(色泽＝乌黑)$ ， <span class="math inline">\(D^3(色泽＝浅白)\)</span>.</p><p>根据式(4.1) 可计算出用“色泽“划分之后所获得的3个分支结点的信息熵为： <span class="math display">\[\text{Ent}(D^1)=-\frac{3}{6}\log_2\frac{3}{6}-\frac{3}{6}\log_2\frac{3}{6}=1.000\\\text{Ent}(D^2)=-\frac{4}{6}\log_2\frac{4}{6}-\frac{2}{6}\log_2\frac{2}{6}\approx0.918\\\text{Ent}(D^3)=-\frac{1}{5}\log_2\frac{1}{5}-\frac{4}{5}\log_2\frac{4}{5}\approx0.722\]</span> 于是，计算出属性”色泽“的信息增益为： <span class="math display">\[\begin{align*}\text{Gain}(D,色泽)&amp;=\text{Ent}(D)-\stackrel{3}{\underset{v=1}\sum}\frac{|D^v|}{|D|}Ent(D^v)\\ &amp;=0.998-(\frac{6}{17}\times1.000+\frac{6}{17}\times0.918+\frac{5}{16}\times0.722)\\&amp;=0.109\end{align*}\]</span> 类似的，我们可计算出其他属性的信息增益： <span class="math display">\[Gain(D ,根蒂) = 0.143; Gain(D ,敲声) = 0.141;\\Gain(D ,纹理) = 0.381; Gain(D ,脐部) = 0.289;\\Gain(D ,触感) = 0.006.\]</span> 显然，属性”纹理”的信息增益最大，千是它被选为划分属性．图4.3给出了基于”纹理”对根结点进行划分的结果，各分支结点所包含的样例子集显示在结点中。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT4.png" alt="构建一层的决策树" /></p><p>然后，决策树学习算法将对每个分支结点做进一步划分．以图4.3中第一个分支结点(纹理＝清晰)为例，该结点包含的样例集合<span class="math inline">\(D^1\)</span>中有编号为{1,2, 3, 4, 5, 6, 8, 10, 15} 的9个样例，可用属性集合为{色泽，根蒂，敲声，脐部，触感}。基于<span class="math inline">\(D^1\)</span>计算出各属性的信息增益： <span class="math display">\[Gain(D^1 ,色泽) = 0.043; Gain(D^1 ,根蒂) = 0.458;\\Gain(D^1 ,敲声) = 0.331; Gain(D^1,脐部) = 0.458;\\Gain(D^1,触感) = 0.458.\]</span> “根蒂”、“脐部”、“触感”3个属性均取得了最大的信息增益，可任选其中之一作为划分属性．类似的，对每个分支结点进行上述操作，最终得到的决策树如图4.4 所示。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT5.png" alt="构建完成的决策树" /></p><h2 id="c4.5决策树">C4.5决策树</h2><p>信息增益准则对可能取值数目较多的属性有所偏好（例如编号这个极端的例子，不过其本质原因不是取值数目过多，而是每个取值里面包含的样本数太少），为减少这种偏好可能带来的不利影响，C4.5决策树选择使用增益率代替信息增益，增益率定义为： <span class="math display">\[\text{Gain\_ratio}(D,a)=\frac{\text{Gain(D,a)}}{\text{IV}(a)}\]</span> 其中 <span class="math display">\[\text{IV}(a)=-\stackrel{V}{\underset{v=1}\sum}\frac{|D^v|}{|D|}\log \frac{|D^v|}{|D|}\]</span> 称为属性<span class="math inline">\(a\)</span>的“固有值”，<span class="math inline">\(a\)</span>的可能取值个数<span class="math inline">\(V\)</span>越大，通常其固有值<span class="math inline">\(\text{IV}(a)\)</span>也越大。但是，增益率对可能取值数目较少的属性有所偏好。</p><p>因此，C4.5决策树并未完全使用“增益率”代替“信息增益”，而是采用一种启发式的方法：先选出信息增益高于平均水平的属性，然后再从其中选择增益率最高的。</p><h2 id="cart决策树">CART决策树</h2><p><strong>基尼值</strong>从样本集合<span class="math inline">\(D\)</span>中随机抽取两个样本，它们的<strong>类别标记不一致的概率</strong>。因此，基尼值越小，碰到异类的概率就越小，纯度自然就越高。 <span class="math display">\[\begin{align*}\text{Gini}(D)&amp;=\stackrel{|\mathcal{Y}|}{\underset{k=1}\sum}\underset{k&#39;=k}\sum p_kp_{k&#39;}\\&amp;=\stackrel{|\mathcal{Y}|}{\underset{k=1}\sum}p_k(1-p_k)\\&amp;=1-\stackrel{|\mathcal{Y}|}{\underset{k=1}\sum}p_k^2\end{align*}\]</span> 属性<span class="math inline">\(a\)</span>的基尼指数为（类比信息熵和条件熵）： <span class="math display">\[\text{Gini\_index}(D,a)=\stackrel{V}{\underset{v=1}\sum}\frac{|D^v|}{|D|}\text{Gini\_index}(D^v)\]</span> CART决策树：选择基尼指数最小的属性作为最优划分属性： <span class="math display">\[a_*=\underset{a\in A}{\arg\min}\ \text{Gini\_index}(D,a)\]</span></p><h3 id="cart的构造算法">CART的构造算法</h3><ol type="1"><li><p>首先，对每个属性<span class="math inline">\(a\)</span>的每个可能取值<span class="math inline">\(v\)</span>，将数据集<span class="math inline">\(D\)</span>分为<span class="math inline">\(a=v\)</span>和<span class="math inline">\(a\neq v\)</span>两部分来计算基尼系数，即： <span class="math display">\[\text{Gini\_index}(D,a)=\frac{|D^{a=v}|}{|D|}\text{Gini}(D^{a=v})+\frac{|D^{a\neq v}|}{|D|}\text{Gini}(D^{a\neq v})\]</span></p></li><li><p>然后，选择基尼系数最小的属性及其对应的作为最优划分属性和最优划分点；</p></li><li><p>重复以上两步，直至满足停止条件。</p></li></ol><h3 id="cart的构造过程">CART的构造过程</h3><p>以下内容均从《机器学习公式详解》中引用。</p><p>下面以西瓜书中表4.2中西瓜数据集2.0为例来构造CART分类树，其中第一个最优划分属性和最优划分点的计算过程如下： 以属性“色泽”为例，它有3个可能的取值：<span class="math inline">\({\text{青绿}，\text{乌黑}，\text{浅白}}\)</span>， 若使用该属性的属性值是否等于“青绿”对数据集<span class="math inline">\(D\)</span>进行划分，则可得到2个子集，分别记为<span class="math inline">\(D^1(\text{色泽}=\text{青绿}),D^2(\text{色泽}\not=\text{青绿})\)</span>。子集<span class="math inline">\(D^1\)</span>包含编号<span class="math inline">\({1,4,6,10,13,17}\)</span>共6个样例，其中正例占<span class="math inline">\(p_1=\frac{3}{6}\)</span>，反例占<span class="math inline">\(p_2=\frac{3}{6}\)</span>；子集<span class="math inline">\(D^2\)</span>包含编号<span class="math inline">\({2,3,5,7,8,9,11,12,14,15,16}\)</span>共11个样例，其中正例占<span class="math inline">\(p_1=\frac{5}{11}\)</span>，反例占<span class="math inline">\(p_2=\frac{6}{11}\)</span>，可计算出用“色泽=青绿”划分之后得到基尼指数为 <span class="math display">\[\operatorname{Gini\_index}(D,\text{色泽}=\text{青绿}) =  \frac{6}{17}\times\left(1-(\frac{3}{6})^2-(\frac{3}{6})^2\right)+\frac{11}{17}\times\left(1-(\frac{5}{11})^2-(\frac{6}{11})^2\right) = 0.497\]</span> 类似的，可以计算出以下不同属性取不同值的基尼指数 <span class="math display">\[\begin{aligned} \operatorname{Gini\_index}(D,\text{色泽}=\text{乌黑}) &amp;=  \frac{6}{17}\times\left(1-(\frac{4}{6})^2-(\frac{2}{6})^2\right)+\frac{11}{17}\times\left(1-(\frac{4}{11})^2-(\frac{7}{11})^2\right) = 0.456\\ \operatorname{Gini\_index}(D,\text{色泽}=\text{浅白}) &amp;=  \frac{5}{17}\times\left(1-(\frac{1}{5})^2-(\frac{4}{5})^2\right)+\frac{12}{17}\times\left(1-(\frac{7}{12})^2-(\frac{5}{12})^2\right) = 0.426\\ \end{aligned}\]</span></p><p><span class="math display">\[\begin{aligned} \operatorname{Gini\_index}(D,\text{根蒂}=\text{蜷缩}) = 0.456\\ \operatorname{Gini\_index}(D,\text{根蒂}=\text{稍蜷}) = 0.496\\ \operatorname{Gini\_index}(D,\text{根蒂}=\text{硬挺}) = 0.439\\ \operatorname{Gini\_index}(D,\text{敲声}=\text{浊响}) = 0.450\\ \operatorname{Gini\_index}(D,\text{敲声}=\text{沉闷}) = 0.494\\ \operatorname{Gini\_index}(D,\text{敲声}=\text{清脆}) = 0.439\\ \operatorname{Gini\_index}(D,\text{纹理}=\text{清晰}) = 0.286\\ \operatorname{Gini\_index}(D,\text{纹理}=\text{稍稀}) = 0.437\\ \operatorname{Gini\_index}(D,\text{纹理}=\text{模糊}) = 0.403\\ \operatorname{Gini\_index}(D,\text{脐部}=\text{凹陷}) = 0.415\\ \operatorname{Gini\_index}(D,\text{脐部}=\text{稍凹}) = 0.497\\ \operatorname{Gini\_index}(D,\text{脐部}=\text{平坦}) = 0.362\\ \operatorname{Gini\_index}(D,\text{触感}=\text{硬挺}) = 0.494\\ \operatorname{Gini\_index}(D,\text{触感}=\text{软粘}) = 0.494 \end{aligned}\]</span></p><p>特别地，对于属性“触感”，由于它的可取值个数为2，所以其实只需计算其中一个取值的基尼指数即可。根据上面的计算结果可知<span class="math inline">\(\operatorname{Gini\_index}(D,\text{纹理}=\text{清晰}) = 0.286\)</span>最小，所以选择属性“纹理”为最优划分属性并生成根节点，接着以“纹理=清晰”为最优划分点生成<span class="math inline">\(D^1(\text{纹理}=\text{清晰}),D^2(\text{纹理}\not=\text{清晰})\)</span>两个子节点，对于两个子节点分别重复上述步骤继续生成下一层子节点，直至满足停止条件。</p><p>以上便是CART分类树的构建过程，从构建过程中可以看出，CART分类树最终构造出来的是一颗<strong>二叉树</strong>。CART决策树除了能处理分类问题以外，它还可以处理回归问题。如何<a href="/404.html">用CART解决回归问题</a>将在之后讨论。</p><h2 id="决策树的剪枝">决策树的剪枝</h2><p>剪枝是避免过拟合的重要手段。在学习中，决策树的划分出的分支可能会随着训练样本的增加而增多，以至于把训练集自身的特点当作所有数据的一般性质，这时就很可能会导致过拟合的问题。</p><p>剪枝的基本策略主要有两种，“预剪枝”和“后剪枝”。</p><h3 id="判断决策树性能的方法">判断决策树性能的方法</h3><p>假设我们采用留出法即预留一部分数据用作“验证集”以进行性能评估．例如对西瓜数据集2.0, 我们将其随机划分为两部分，如下表所示，编号为{1,2,3,6,7,10,14,15,16,17} 的样例组成训练集，编号为 {4,5,8,9,11,12,13} 的样例组成验证集。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT6.png" alt="训练集和验证集" /></p><h3 id="基于数据集2.0未剪枝的决策树">基于数据集2.0未剪枝的决策树</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT8.png" alt="数据集2.0的决策树" /></p><h3 id="预剪枝">预剪枝</h3><p>基于贪心思想，对每个结点在划分前进行估计，若当前节点的划分不能带来决策树泛化性能的提升，则停止划分并将当前节点标记为叶节点。</p><p>【举例】《机器学习4.3.1节》</p><p>先讨论预剪枝。基于信息增益准则，我们会选取属性“脐部”来对训练集进行划分，并产生3个分支，如图4.6所示。然而，是否应该进行这个划分呢？预剪枝要对划分前后的泛化性能进行估计。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT7.png" alt="预剪枝决策树桩" /></p><p>在划分之前，所有样例集中在根结点．若不进行划分，该结点将被标记为叶结点，其类别标记为训练样例数最多的类别，假设我们将这个叶结点标记为”好瓜“，用表4.2的验证集对这个单结点决策树进行评估，则编号为{4,5,8}的样例被分类正确，另外4个样例分类错误。于是，验证集精度为<span class="math inline">\(\frac{3}{7} \times 100\% = 42.9\%\)</span>。</p><p>在用属性“脐部“划分之后，图4.6中的结点①、②、③分别包含编号为{1,2,3,14} 、{6,7,15,17} 、{10, 16} 的训练样例，因此这3个结点分别被标记为叶结点“好瓜”、“好瓜”、“坏瓜”。此时，验证集中编号为 {4,5,8,11,12}的样例被分类正确验证集精度为<span class="math inline">\(\frac{5}{7}\times100\%=71.4\%&gt;42.9\%\)</span>。于是，用”脐部”进行划分得以确定。</p><p>对于节点②，基于信息增益可挑选出划分属性为“色泽”。然而，在使用“色泽”划分后，验证集精度会下降为<span class="math inline">\(57.1\%\)</span>。于是，预剪枝策略将禁止划分。</p><p>对于节点③，最优划分属性为“根蒂”，划分后验证机精度不变。这个划分不能提升精度，禁止划分。</p><p>对于节点④，其所含训练样例已经属于同一类，不再进行划分。</p><p>由此，我们生成了只有一层划分的“决策树桩”，如上图所示。</p><p>预剪枝使得决策树的很多分支都没有“展开＂，这不仅降低了过拟合的风险，还显著减少了决策树的训练时间开销和测试时间开销。但另一方面，有些分支的当前划分虽不能提升泛化性能、甚至可能导致泛化性能暂时下降，但在其基础上进行的后续划分却有可能导致性能显著提高；预剪枝基于“贪心“本质禁止这些分支展开，给预剪枝决策树带来了欠拟合的风险。</p><h3 id="后剪枝">后剪枝</h3><p>先从训练集生成完整的决策树，然后自底向上对非叶节点进行考察，若将该节点对应的子树替换为叶节点能带来泛化能力的提升，则将该子树替换为叶节点。</p><p>【举例】</p><p>首先考察未剪枝决策树的结点⑥．若将其领衔的分支剪除，则相当于把⑥替换为叶结点。替换后的叶结点包含编号为{7, 15}的训练样本，于是，该叶结点的类别标记为“好瓜”，此时决策树的验证集精度提高至<span class="math inline">\(57.1\%\)</span>.。于是，后剪枝策略决定剪枝。</p><p>然后考察结点⑤，若将其领衔的子树替换为叶结点则替换后的叶结点包含编号为{6,7,15}的训练样例，叶结点类别标记为“好瓜”，此时决策树验证集精度仍为<span class="math inline">\(57.1\%\)</span>。于是，可以不进行剪枝。</p><p>对结点②，若将其领衔的子树替换为叶结点，则替换后的叶结点包含编号为{1,2,3,14} 的训练样例，叶结点标记为“好瓜“。此时决策树的验证集精度提高至<span class="math inline">\(71.4\%\)</span> 。于是，后剪枝策略决定剪枝。</p><p>对结点③和①，若将其领衔的子树替换为叶结点，则所得决策树的验证集精度分别为<span class="math inline">\(71.4\%\)</span>与<span class="math inline">\(42.9\%\)</span> ，均未得到提高，于是它们被保留。</p><p>最终，基于后剪枝策略从西瓜数据2.0所生成的决策树如下图所示，其验证集精度为<span class="math inline">\(71. 4\%\)</span>。</p><p>后剪枝决策树通常比预剪枝决策树保留了更多的分支。一般情形下，后剪枝决策树的欠拟合风险很小，泛化性能往往优于预剪枝决策树。但后剪枝过程是在生成完全决策树之后进行的，并且要自底向上地对树中的所有非叶结点进行逐一考察，因此其训练时间开销比未剪枝决策树和预剪枝决策树都要大得多。</p><p>后剪枝最终得到的决策树为：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT9.png" alt="后剪枝得到的决策树" /></p><h2 id="决策树对连续值和缺失值的处理">决策树对连续值和缺失值的处理</h2><h3 id="对连续值的处理">对连续值的处理</h3><p>最简单的策略是采用二分法对连续属性进行处理，C4.5决策树算法就采用了这种机制。</p><p>给定样本集<span class="math inline">\(D\)</span>和连续属性<span class="math inline">\(a\)</span>，假定<span class="math inline">\(a\)</span>在<span class="math inline">\(D\)</span>上出现了<span class="math inline">\(n\)</span>个不同的取值，将这些值从大到小进行排序，记为<span class="math inline">\(\{a^1,a^2,\dots,a^n\}\)</span>。基于划分点<span class="math inline">\(t\)</span>可将<span class="math inline">\(D\)</span>划分为在属性<span class="math inline">\(a\)</span>上不大于<span class="math inline">\(t\)</span>的样本<span class="math inline">\(D_t^-\)</span>，和在属性<span class="math inline">\(a\)</span>上取值大于<span class="math inline">\(t\)</span>的样本<span class="math inline">\(D_t^+\)</span>。显然，对相邻的属性取值<span class="math inline">\(a^i\)</span>和<span class="math inline">\(a^{i+1}\)</span>来说。<span class="math inline">\(t\)</span>在区间<span class="math inline">\([a^i,a^{i+1})\)</span>中取任意值所产生的划分结果相同，所以可以考察包含<span class="math inline">\(n-1\)</span>个元素的划分点集合 <span class="math display">\[T_a=\{\frac{a^i+a^{i+1}}{2}|1\leq i\leq n-1\}\]</span> 选取最优划分点的准则为： <span class="math display">\[\begin{align*}\text{Gain}(D,a)&amp;=\underset{t\in T_a}{\max}\ \text{Gain}(D,a,t)\\&amp;= \underset{t\in T_a}{\max}\ \text{Ent}(D)-\underset{\lambda\in\{+,-\}}{\sum}\frac{|D_t^\lambda|}{|D|}\text{Ent}(D_t^\lambda)\end{align*}\]</span> 其中<span class="math inline">\(\text{Gain}(D,a,t)\)</span>是样本集<span class="math inline">\(D\)</span>基于划分点<span class="math inline">\(t\)</span>二分后的信息增益。于是我们选择使<span class="math inline">\(\text{Gain}(D,a,t)\)</span>最大化的划分点。</p><p>需注意的是，与离散属性不同，若当前节点划分属性为连续属性，该属性还可作为其后代节点的划分属性。</p><h3 id="对缺失值的处理">对缺失值的处理</h3><p>现实问题中，出于多种因素，对数据属性的值可能统计不全。如果简单的放弃不完整样本，显然是对数据的浪费。</p><p>在现实生活中，我们遇到的问题大多数都会像如下的西瓜数据集2.0<span class="math inline">\(\alpha\)</span>一样,其中大量的数据都是属性残缺的，如果忽略掉缺失属性的数据，数据将所剩无几（只有{4,7,14,16}）。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT10.png" alt="西瓜数据集2.0-alpha" /></p><p>我们需要解决两个问题：</p><ol type="1"><li>如何在属性缺失的情况下进行划分属性选择？</li><li>给定划分属性，若样本在该属性上的值缺失，如何对样本进行划分？</li></ol><p>给定训练集<span class="math inline">\(D\)</span>和属性<span class="math inline">\(a\)</span>，令<span class="math inline">\(\tilde{D}\)</span>表示<span class="math inline">\(D\)</span>在属性<span class="math inline">\(a\)</span>上没有缺失值的样本子集，对问题（1），显然我们仅可根据<span class="math inline">\(\tilde{D}\)</span>来判断属性<span class="math inline">\(a\)</span>的优劣。假定属性<span class="math inline">\(a\)</span>有<span class="math inline">\(V\)</span>个可取值<span class="math inline">\(\{a^1,a^2,\dots,a^V\}\)</span>，令<span class="math inline">\(\tilde{D}^v\)</span>表示<span class="math inline">\(\tilde{D}\)</span>中在属性<span class="math inline">\(a\)</span>上取值为<span class="math inline">\(a^v\)</span>的样本子集，<span class="math inline">\(\tilde{D}_k\)</span>表示<span class="math inline">\(\tilde{D}\)</span>中属于第<span class="math inline">\(k\)</span>类<span class="math inline">\((k=1,2,\dots,|\mathcal{Y}|)\)</span>的样本子集，根据以上定义，显然有<span class="math inline">\(\tilde{D}=\cup_{k=1}^{|\mathcal{Y}|}\tilde{D}_k\)</span>，<span class="math inline">\(\tilde{D}=\cup_{v=1}^{V}\tilde{D}^v\)</span>。假定我们为每个样本<span class="math inline">\(\pmb{x}\)</span>都赋予权重<span class="math inline">\(w_{\pmb{x}}\)</span>，并定义三个变量：</p><ol type="1"><li><p>对属性<span class="math inline">\(a\)</span>，无缺失值样本所占的比例<span class="math inline">\(\rho\)</span>： <span class="math display">\[\rho=\frac{\sum_{x\in\tilde{D}}w_{\pmb{x}}}{\sum_{x\in D}w_{\pmb{x}}}\]</span></p></li><li><p>无缺失值样本中第<span class="math inline">\(k\)</span>类所占的比例<span class="math inline">\(\tilde{p}_k\)</span>： <span class="math display">\[\tilde{p}_k=\frac{\sum_{x\in\tilde{D}_k}w_{\pmb{x}}}{\sum_{x\in \tilde{D}}w_{\pmb{x}}}\]</span></p></li><li><p>无缺失样本中在属性<span class="math inline">\(a\)</span>上取值<span class="math inline">\(a^v\)</span>的样本所占的比例<span class="math inline">\(\tilde{r}_v\)</span>： <span class="math display">\[\tilde{r}_v=\frac{\sum_{x\in\tilde{D}^v}w_{\pmb{x}}}{\sum_{x\in \tilde{D}}w_{\pmb{x}}}\]</span></p></li></ol><p>基于上述定义，我们可将信息增益的计算式推广为： <span class="math display">\[\text{Gain}(D,a)=\rho\times\text{Gain}(\tilde{D},a)=\rho\times(\text{Ent}(\tilde{D})-\stackrel{V}{\underset{v=1}\sum}\tilde{r}_v\ \text{Ent}(\tilde{D}^v))\]</span> 有信息熵定义，有： <span class="math display">\[\text{Ent}(\tilde{D})=-\stackrel{|\mathcal{Y}|}{\underset{v=1}\sum}\tilde{p}_k\log_{2}\tilde{p}_k\]</span> 对问题(2) ，若样本在<span class="math inline">\(\pmb{x}\)</span>划分属性<span class="math inline">\(a\)</span>上的取值已知，则将<span class="math inline">\(\pmb{x}\)</span>划入与其取值对应的子结点，且祥本权值在子结点中保持为<span class="math inline">\(w_{\pmb{x}}\)</span>。若样本<span class="math inline">\(\pmb{x}\)</span>在划分属性<span class="math inline">\(a\)</span>上的取值未知，则将<span class="math inline">\(\pmb{x}\)</span>同时划入所有子结点，且样本权值在与属性值<span class="math inline">\(a^v\)</span>对应的子结点中调整为<span class="math inline">\(\tilde{r}_v \cdot w_{\pmb{x}}\)</span>；直观地看，这就是让同一个样本以不同的概率划入到不同的子结点中去。上述方法就是C4.5决策树对缺失值的处理方法。</p><p>生成决策树的过程与ID3的方式类似。</p><p>在西瓜数据集2.0<span class="math inline">\(\alpha\)</span>上基于信息增益生成的决策树如图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT11.png" alt="决策树2.0-alpha" /></p><h2 id="多变量决策树">多变量决策树</h2><h3 id="决策树的本质">决策树的本质</h3><p>如果把每个属性视为坐标空间中的一个坐标轴，则d个属性描述的样本就对应了d维空间中的一个数据点，对样本分类则意味着在这个坐标空间中寻找不同类样本之间的分类边界。决策树形成的分类边界都是轴平行的（具体见上方-从几何角度理解决策树）。</p><p>下面是西瓜数据集3.0：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT12-1.png" alt="西瓜数据集3.0" /></p><p>普通的决策树算法分类的示意图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT12-2.png" alt="普通决策树的表现" /></p><h3 id="多变量决策树的引入">多变量决策树的引入</h3><p>有时，轴平行的分类不够灵活，面对数据集3.0的情况，决策树必须要分类三次才能将数据正确分类。如果数据量大，属性多，会导致决策树非常复杂。那么，我们可不可以用一条斜线将下图的正例和反例分开，就像下图一样？</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT12-3.png" alt="斜线分划" /></p><p>方法是使用”多变量决策树“。在多变量决策树中，非叶节点不再是针对某个属性，而是针对属性的线性组合进行测试。换言之，每个非叶节点是一个形如<span class="math inline">\(\sum_{i=1}^d w_ia_i=t\)</span>的线性分类器。<span class="math inline">\(w_i,t_i\)</span>可在该节点所含样本集和属性集上学得。我们在数据集3.0上学得了下面的多变量决策树：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/DT12-4.png" alt="多变量决策树" /></p><h3 id="决策树的区别">决策树的区别</h3><p>决策树是为非叶节点寻找最佳的划分属性，多变量决策树则是尝试为非叶节点建立一个合适的线性分类器。</p>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 决策树 </tag>
            
            <tag> 信息论 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人工神经网络</title>
      <link href="/2022/02/23/machine%20learning/%E4%BA%BA%E5%B7%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
      <url>/2022/02/23/machine%20learning/%E4%BA%BA%E5%B7%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="神经网络的构成">神经网络的构成</h2><h3 id="m-p神经元">M-P神经元</h3><p>神经网络的最基本的成分M-P神经元。M-P神经元是一个用来模拟生物行为的数学模型。它接收<span class="math inline">\(n\)</span>个输入（通常来自其它神经元），并给各个输入赋予权重计算加权和，然后和自身特有的阈值<span class="math inline">\(\theta\)</span>进行比较（做减法），最后经过激活函数（模拟“抑制”和“激活”）处理得到输出（通常是给下一个神经元）。M-P神经元的数学模型如下： <span class="math display">\[y=f(\stackrel{n}{\underset{i=1}\sum}w_ix_i-\theta)=f(\pmb{w}^T\pmb{x}+b)\]</span> M-P神经元的示意图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/M-P.svg" alt="M-P神经元" /></p><p>可以作为单个M-P神经元的模型有，感知机（sign），对数几率回归（sigmoid）等。</p><p>多个M-P神经元就能够组成神经网络。</p><h2 id="神经网络">神经网络</h2><h3 id="解决非线性可分问题多层功能神经元">解决非线性可分问题：多层功能神经元</h3><p>要解决非线性可分问题，需要使用<strong>多层功能神经元</strong>。输入层与输出层之间的神经元称为隐层或隐含层，它与输出层都是有激活函数的功能神经元。更一般的，常见的神经网络是形如下图的层级结构，每层神经元完全互联，神经元之间不存在同层连接和跨层链接。这样的神经网络通常称为“多层前馈神经网络”。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/NN1.png" alt="单隐层神经网络" /></p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/NN2.png" alt="双隐层神经网络" /></p><p>神经网络的学习过程，就是根据训练数据来调整神经元之间的连接权以及每个神经元的阈值。</p><h3 id="神经网络简介">神经网络简介</h3><p>将神经网络（NN）看作一个特征加工函数<span class="math inline">\(\mathbb{R}^l\rightarrow\mathbb{R}^d\)</span> <span class="math display">\[\pmb{x}\in \mathbb{R}^d\rightarrow \text{NN}(\pmb{x})\rightarrow \pmb{y}=\pmb{x}^*\in \mathbb{R}^l\]</span> （单输出）回归：<span class="math inline">\(\mathbb{R}^l\rightarrow\mathbb{R}\)</span>，例如<span class="math inline">\(y=\pmb{w}^T\pmb{x^*}+b\)</span></p><p>分类：后面接一个<span class="math inline">\(\mathbb{R}^l\rightarrow[0,1]\)</span>的神经元，例如<span class="math inline">\(y=1/(1+e^{-(\pmb{w}^T\pmb{x^*}+b)})\)</span></p><h3 id="通用近似定理">通用近似定理</h3><p>只需一个包含足够多神经元的隐层，多层前馈网络就能以任意精度逼近任意复杂度的连续函数。</p><p>因此，神经网络既能做回归，又能做分类，而且不需要复杂的特征工程。</p><h3 id="设计学习器的问题">设计学习器的问题</h3><ol type="1"><li>神经网络应该做多深，多宽？</li><li>如何设计神经网络的结构才合理？</li><li>神经网络的输出结果如何解释？</li></ol><h2 id="用bp算法确定参数">用BP算法确定参数</h2><p>误差逆传播算法(BP)是估计单隐层神经网络参数的有效方法。</p><ol type="1"><li><p>确定损失函数</p><p>假设多层前馈网络的激活函数全为sigmoid函数，且当前要完成的任务为一个（多输出）回归任务，因此损失函数可以采用均方误差（分类任务则使用交叉熵）。</p></li><li><p>确定问题和学习过程</p><p>对于某个训练样本<span class="math inline">\((\pmb{x}_k,\pmb{y}_k)\)</span>，其中<span class="math inline">\(\pmb{y}_k=(y_1^k,y_2^k,\dots,y_l^k)\)</span>，假定其多层前馈网络的输出为<span class="math inline">\(\pmb{\hat{y}}_k=(\hat{y}_1^k,\hat{y}_2^k,\dots,\hat{y}_l^k)\)</span>，则该单个样本的均方误差（损失）为： <span class="math display">\[E_k=\frac{1}{2}\stackrel{l}{\underset{j=1}{\sum}}(\hat{y}_j^k-y_j^k)^2\]</span> 其中： <span class="math display">\[\hat{y}_j^k=f(\beta_j-\theta_j)\]</span> BP算法是基于随机梯度下降的参数更新算法，更新公式如下： <span class="math display">\[\pmb{w}\leftarrow \pmb{w}+\Delta \pmb{w} \\\Delta \pmb{w}=-\eta\nabla_{\pmb{w}}E\]</span> 其中只需推导出<span class="math inline">\(\nabla_{\pmb{w}}E\)</span>这个损失函数<span class="math inline">\(E\)</span>关于<span class="math inline">\(\pmb{w}\)</span>的梯度（一阶偏导数，使用链式求导法）即可。由于<span class="math inline">\(\text{NN}(\pmb{x})\)</span>通常是极其复杂的非凸函数，不具备像凸函数一样良好的数学性质，因此随机梯度下降不能保证走到全局最小值点，一般会走到局部极小值点。</p></li><li><p>若神经网络是单隐层的，假设输入层神经元有<span class="math inline">\(d\)</span>个，输出层神经元有<span class="math inline">\(l\)</span>个，隐层神经元有<span class="math inline">\(q\)</span>个，输入层第<span class="math inline">\(i\)</span>个神经元与隐层第<span class="math inline">\(h\)</span>个神经元的权重为<span class="math inline">\(v_{ih}\)</span>，隐层第<span class="math inline">\(h\)</span>个神经元与输出层第<span class="math inline">\(j\)</span>个神经元的权重为<span class="math inline">\(w_{hj}\)</span>，隐层神经元的输出为<span class="math inline">\(b_h\)</span>，输出层第<span class="math inline">\(j\)</span>个神经元的阈值为<span class="math inline">\(\theta_j\)</span>，隐层第<span class="math inline">\(h\)</span>个神经元的阈值为<span class="math inline">\(\gamma_h\)</span>，如图所示（《机器学习》图5.7）。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/ml/NN4.png" alt="单隐层神经网络" /></p><p>显然，第<span class="math inline">\(h\)</span>个隐层神经元的输入为<span class="math inline">\(\alpha_{h}=\stackrel{d}{\underset{i=1}\sum}v_{ih}x_i\)</span>，第<span class="math inline">\(j\)</span>个输出层神经元输入为<span class="math inline">\(\beta_{h}=\stackrel{q}{\underset{h=1}\sum}w_{hj}b_h\)</span></p><p>下面以推导<span class="math inline">\(-\eta\nabla_{\pmb{v}}E\)</span>为例，展示推导过程： <span class="math display">\[\Delta \pmb{w}=-\eta\frac{\partial E_k}{\partial v_{ih}}\]</span></p><p><span class="math display">\[\frac{\partial E_k}{\partial v_{ih}}=\stackrel{l}{\underset{j=1}\sum}\frac{\partial E_k}{\partial \hat{y}_j^k}\frac{\partial\hat{y}_j^k}{\partial\beta_j}\frac{\partial\beta_j}{\partial b_h}\frac{\partial b_h}{\partial\alpha_h}\frac{\partial\alpha_h}{\partial v_{ih}}\]</span></p><blockquote><p>补充：上面公式中求和符号出现的原因</p><p>由前馈神经网络的特点，每一个<span class="math inline">\(\hat{y}_j^k\)</span>与<span class="math inline">\(v_{ih}\)</span>都有<strong>间接关系</strong>。具体表达如下：</p><p><span class="math display">\[\begin{align*}\frac{\partial E_k}{\partial v_{ih}}&amp;=\frac{\partial\hat{y}_1^k}{\partial v_{ih}}+\frac{\partial\hat{y}_2^k}{\partial v_{ih}}+\cdots+\frac{\partial\hat{y}_l^k}{\partial v_{ih}} \\&amp;=\frac{\partial f_1(v_{ih})}{\partial v_{ih}}+\frac{\partial f_2(v_{ih})}{\partial v_{ih}}+\cdots+\frac{\partial f_l(v_{ih})}{\partial v_{ih}}\end{align*}\]</span></p></blockquote><p>下面继续进行推导</p><p><span class="math display">\[\begin{align*}\frac{\partial E_k}{\partial v_{ih}}&amp;=\stackrel{l}{\underset{j=1}\sum}\frac{\partial E_k}{\partial \hat{y}_j^k}\frac{\partial\hat{y}_j^k}{\partial\beta_j}\frac{\partial\beta_j}{\partial b_h}\frac{\partial b_h}{\partial\alpha_h}\frac{\partial\alpha_h}{\partial v_{ih}} \\&amp;=\stackrel{l}{\underset{j=1}\sum}\frac{\partial E_k}{\partial \hat{y}_j^k}\frac{\partial\hat{y}_j^k}{\partial\beta_j}w_{hj}\cdot f&#39;(\alpha_h-\gamma_h)\cdot x_i \\&amp;= \stackrel{l}{\underset{j=1}\sum}-(\hat{y}_j^k-y_j^k)\cdot f&#39;(\beta_j-\theta_j) \cdot w_{hj}\cdot f&#39;(\alpha_h-\gamma_h)\cdot x_i\end{align*}\]</span></p><p>定义梯度项<span class="math inline">\(g_j\)</span>，因为<span class="math inline">\(f(x)\)</span>是sigmoid函数，所以具有性质<span class="math inline">\(f&#39;(x)=f(x)(1-f(x))\)</span>： <span class="math display">\[\begin{align*}g_j&amp;=-\frac{\partial E_k}{\partial \hat{y}_j^k}\frac{\partial\hat{y}_j^k}{\partial\beta_j}\\&amp;=\hat{y}_j^k(1-\hat{y}_j^k)(y_j^k-\hat{y}_j^k)\end{align*}\]</span> 继续化简，定义梯度项<span class="math inline">\(e_h\)</span>：</p><p><span class="math display">\[\begin{align*}e_h&amp;=-\stackrel{l}{\underset{j=1}\sum}\frac{\partial E_k}{\partial b_h}\frac{\partial b_h}{\partial\alpha_h}\\&amp;=-\stackrel{l}{\underset{j=1}\sum}\frac{\partial E_k}{\partial \hat{y}_j^k}\cdot\frac{\partial\hat{y}_j^k}{\partial\beta_j}f&#39;(\alpha_h-\gamma_h)\\&amp;=b_h(1-b_h)\stackrel{l}{\underset{j=1}\sum}g_j\cdot w_{hj}\end{align*}\]</span></p><p><span class="math display">\[\begin{align*}\frac{\partial E_k}{\partial v_{ih}}&amp;=\stackrel{l}{\underset{j=1}\sum}(-g_j)\cdot w_{hj}\cdot f&#39;(\alpha_h-\gamma_h)\cdot x_i\\&amp;=-f&#39;(\alpha_h-\gamma_h)\cdot\stackrel{l}{\underset{j=1}\sum}g_j\cdot w_{hj}\cdot x_i\\&amp;=-b_h(1-b_h)\stackrel{l}{\underset{j=1}\sum}g_j\cdot w_{hj}\cdot x_i\\&amp;=-e_h\cdot x_i\end{align*}\]</span></p><p><span class="math inline">\(\Delta w_{ih},\Delta \gamma_h,\Delta \theta_h\)</span>的推导与上面的推导思路相同，分别为： <span class="math display">\[\begin{align*}\Delta v_{ih}&amp;=\eta e_h x_i\\\Delta w_{hj}&amp;=\eta g_jb_h\\\Delta \gamma_h&amp;=-\eta e_h\\\Delta \theta_h&amp;=-\eta g_j\end{align*}\]</span></p></li></ol><h2 id="bp算法的训练过程">BP算法的训练过程</h2><p><a href="https://www.bilibili.com/video/BV1Ux411j7ri">梯度下降法和神经网络-3Blue1Brown-bilibili</a></p><p><a href="https://www.bilibili.com/video/BV16x411V7Qg">误差逆传播算法-3Blue1Brown-bilibili</a></p><p>先将输入示例提供给输入层神经元，然后逐层将信号前传，知道产生输出层的结果。然后计算输出层的误差（line 4-5），再将误差逆向传播至隐层神经元（line 6），最后根据隐层神经元的误差来对连接权和阈值进行调整（line 7）。该过程迭代进行，直到达到某些停止条件为止，例如训练误差达到了一个很小的值。</p><blockquote><p>输入：</p><ul><li><p>训练集<span class="math inline">\(D = \{(\pmb{x}_{1},y_{1}),(\pmb{x}_{2},y_{2}),\dots,(\pmb{x}_{m},y_{m})\}\)</span></p></li><li><p>学习率<span class="math inline">\(\eta\)</span></p></li></ul><p>过程：</p><ol type="1"><li>在(0,1)范围内随机初始化网络中所有连接权和阈值</li><li><span class="math inline">\(\textbf{while}(\text{True})\ \textbf{do}\)</span></li><li><span class="math inline">\(\ \ \textbf{for all}(x_k,y_k)\in D\textbf{ do}\)</span></li><li>​ 根据当前参数计算出当前样本的输出<span class="math inline">\(\hat{y}_k\)</span></li><li>​ 计算出梯度项<span class="math inline">\(g_j\)</span></li><li>​ 计算出梯度项<span class="math inline">\(e_h\)</span></li><li>​ 更新连接权<span class="math inline">\(w_{hj},v_{ih}\)</span>与阈值<span class="math inline">\(\theta_j,\gamma_h\)</span></li><li><span class="math inline">\(\textbf{end for}\)</span></li><li><span class="math inline">\(\textbf{if}\ \)</span>达到终止条件 <span class="math inline">\(\textbf{then break}\)</span></li><li><span class="math inline">\(\textbf{end while}\)</span></li></ol><p>输出：连接权与阈值确定的神经网络</p></blockquote><p>需注意的是，BP算法的目标是最小化训练集上的累计误差： <span class="math display">\[E=\frac{1}{m}\stackrel{m}{\underset{k=1}\sum}E_k\]</span> 上面讨论的更新公式基于单个<span class="math inline">\(E_k\)</span>推导的，按照这样的规则更新的BP算法，属于“标准BP算法”。如果基于累计误差最小化，类似的推导出更新公式，就得到了“累计BP算法”。标准BP算法与累计BP算法各有优劣，需要根据问题和训练数据的分布情况灵活选择。</p><p>此外，由通用近似定理，神经网络可以拟合任意复杂度的函数，但如何设置神经元的个数仍是神经网络研究的未决问题，实际应用中通常只能使用“试错法”进行调整。</p><h2 id="对于bp算法的优化">对于BP算法的优化</h2><h3 id="避免过拟合">避免过拟合</h3><p>BP神经网络的表示能力十分强大，以至于它经常遭遇到过拟合的问题，其训练误差逐渐降低，但测试误差逐渐上升。有两种策略可以缓解过拟合。</p><p>第一种是“早停”，将数据分成训练集和测试集，训练集用来计算梯度，更新连接权和阈值，验证集用来估计误差，若训练误差降低而验证机误差升高，则停止训练，同时返回具有最小验证集误差的连接权和阈值。</p><p>第二种策略是“正则化”，在误差目标函数中增加一个用于描述网络复杂度的部分，例如连接权与阈值的平方和。令<span class="math inline">\(E_k\)</span>表示第<span class="math inline">\(k\)</span>个训练样本的误差，<span class="math inline">\(w_i\)</span>表示连接权和阈值，则误差目标函数改变为： <span class="math display">\[E=\lambda\frac{1}{m}\stackrel{m}{\underset{k=1}\sum}E_k+(1-\lambda)\underset{i}{\sum}w_i^2\]</span> 其中<span class="math inline">\(\lambda \in (0,1)\)</span>，用于经验误差和网络复杂度的折中，通常使用交叉验证法进行估计。</p><h2 id="特别讨论寻找局部最小和全局最小">特别讨论：寻找局部最小和全局最小</h2><p>神经网络在训练集上的误差<span class="math inline">\(E\)</span>，显然是关于连接权<span class="math inline">\(\pmb{w}\)</span>和阈值<span class="math inline">\(\theta\)</span>的函数。此时，神经网路的训练过程可以看作一个<strong>参数寻优过程</strong>，即在参数空间中，寻找一组参数使得<span class="math inline">\(E\)</span>最小。</p><h3 id="极小值和最小值的定义">极小值和最小值的定义</h3><p>局部最小：对<span class="math inline">\(\pmb{w}^*,\theta^*\)</span>若存在<span class="math inline">\(\epsilon&gt;0\)</span>使得<span class="math inline">\(\forall (\pmb{w};\theta)\in \{(\pmb{w};\theta)|\ ||(\pmb{w};\theta)-(\pmb{w}^*;\theta^*)||\leq\epsilon\}\)</span></p><p>都有<span class="math inline">\(E(\pmb{w};\theta)\geq E(\pmb{w}^*;\theta^*)\)</span>成立，则<span class="math inline">\((\pmb{w}^*;\theta^*)\)</span>是局部极小解。</p><p>全局最小：对参数空间的任意<span class="math inline">\((\pmb{w};\theta)\)</span>，都有<span class="math inline">\(E(\pmb{w};\theta)\geq E(\pmb{w}^*;\theta^*)\)</span>，则<span class="math inline">\((\pmb{w}^*;\theta^*)\)</span>是全局最小解。</p><h3 id="跳出极小值">跳出极小值</h3><p>基于梯度的搜索是使用最为广泛的参数寻优方法。每次迭代中，我们先计算误差函数在当前点的梯度，然后根据梯度确定搜索方向。例如，由于负梯度方向是函数值下降最快的方向，因此梯度下降法就是沿着负梯度方向搜索最优解。若误差函数在当前点的梯度为0，说明搜索到了一个极小值点。显然，如果误差函数仅有一个局部极小，那么此时找到的局部极小就是全局最小；然而，如果误差函数有多个局部极小，则不能保证找到的是全局最小，如果找到的并非全局最小，我们称参数寻优陷入了局部极小，这不是我们期望的。</p><p>下面有几种跳出局部极小的方法，在伯克利大学的教材《人工智能：一种现代的方法》的《人工智能：超越经典搜索》一章中都有详细的介绍：</p><ol type="1"><li>以多组不同的参数值初始化神经网络，这相当于多个初始点开始搜索。</li><li>使用随机梯度下降法</li><li>模拟退火技术</li><li>遗传算法</li></ol><h2 id="神经网络的常见种类">神经网络的常见种类</h2><p>种类繁多，以后加深学习时在逐个仔细分析。现列举西瓜书上展示的6种神经网络。</p><ol type="1"><li><p>RBF网络</p></li><li><p>ART网络</p></li><li><p>SOM网络</p></li><li><p>级联相关网络</p></li><li><p>Elman网络</p></li><li><p><a href="">Boltzmann机</a></p></li></ol><h2 id="深度学习简介">深度学习简介</h2><h3 id="深度学习的训练问题">深度学习的训练问题</h3><p>典型的深度学习模型就是很深层的神经网络，多隐层神经网络会增加模型复杂度来获取更好的拟合效果。然而，多隐层神经网络难以直接使用经典算法（例如BP）进行训练，因为误差在多隐层内传播时，往往会“发散”而不能收敛到稳定状态。</p><h3 id="训练深度学习器的主要手段">训练深度学习器的主要手段</h3><p>很复杂的学问，初学者大致了解即可。</p><ol type="1"><li>无监督逐层训练：预训练+微调，代表应用是深度信念网络（DBN）</li><li>权共享：每一组神经元都采用相同的连接权，代表应用是卷积神经网络（CNN）</li></ol><blockquote><p>无论是DBN 还是CNN, 其多隐层堆叠、每层对上一层的输出进行处理的机制， 可看作是在对输入信号进行逐层加工， 从而把初始的、与输出目标之间联系不太密切的输入表示，转化成与输出目标联系更密切的表示，使得原来仅基于最后一层输出映射难以完成的任务成为可能。换言之，通过多层处理，逐渐将初始的“低层“特征表示转化为“高层“特征表示后，用“简单模型”即可完成复杂的分类等学习任务。由此可将深度学习理解为进行“特征学习”(feature learning) 或“表示学习”(representation learning).</p><p>以往在机器学习用于现实任务时，描述样本的特征通常需由人类专家来设计，这称为“<strong>特征工程</strong>”(feature engineering) 众所周知，特征的好坏对泛化性能有至关重要的影响，人类专家设计出好特征也并非易事；特征学习则通过机器学习技术自身来产生好特征，这使机器学习向“<strong>全自动数据分析</strong>”又前进了一步。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 神经网络 </tag>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>集成学习的原理（下篇）</title>
      <link href="/2022/02/20/machine%20learning/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0b/"/>
      <url>/2022/02/20/machine%20learning/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0b/</url>
      
        <content type="html"><![CDATA[<h2 id="并行式集成学习">并行式集成学习</h2><p>特点：仍然使用审核文章的例子。并行式集成学习相当于把一篇文章同时分给所有人审核，所有人审核完后，将审核结果结合到一起，众人一起商议，通过投票等方式，可以尽量避免审核的错误，从而正确选出应该改正的错误。</p><p>代表性思路：Bagging</p><p>代表性方法：随机森林</p><h2 id="相对于串行的好处">相对于串行的好处</h2><ol type="1"><li>求解个体学习器时是并行的，加快了学习效率。</li><li>每个学习器都在完成自己的工作，不考虑其它学习器的影响，与整体目标的偏差大，方差小。</li></ol><h2 id="bagging算法过程">Bagging算法过程</h2><hr /><blockquote><p>输入：</p><ul><li><p>训练集<span class="math inline">\(D = \{(\pmb{x}_{1},y_{1}),(\pmb{x}_{2},y_{2}),\dots,(\pmb{x}_{m},y_{m})\}\)</span></p></li><li><p>基学习算法<span class="math inline">\(\mathfrak{L}\)</span></p></li><li><p>训练轮数<span class="math inline">\(T\)</span></p></li></ul><p>过程：</p><ol type="1"><li><span class="math inline">\(\textbf{for}\ \ t = 1 \dots T \ \ \textbf{do}\)</span></li><li><span class="math inline">\(\ \ h_{t}=\mathfrak{L}(D,\mathcal{D}_{t});\)</span></li><li><span class="math inline">\(\textbf{end}\ \ \textbf{for}\)</span></li></ol><p>输出：<span class="math inline">\(H(\pmb{x})=\underset{y\in \mathcal{Y}}{\arg\max}\stackrel{T}{\underset{t=1}{\sum}}\mathbb{I}(h_{t}(\pmb{x})=y)\)</span></p></blockquote><hr /><h2 id="bagging的样本子集如何求得">Bagging的样本子集如何求得</h2><p>为了保证差异性，可以使用自主采样法(bootstrap sampling)，即有放回的随机抽取。如果抽的次数足够多，没有抽到的样本占比大致为<span class="math inline">\(\underset{n\rightarrow\infty}{\lim}=(1-\frac{1}{n})^n=\frac{1}{e}\approx 36.6\%\)</span>.正好可以使用这些没有抽到的样本作为验证集进行<strong>包外估计</strong>。</p><h2 id="随机森林">随机森林</h2><p>在Bagging的基础上，进一步在决策树的训练过程中引入了随机选择。假设样本包含<span class="math inline">\(d\)</span>个属性，对基决策树的每个节点，先从该节点的属性集合中随机选择一个包含<span class="math inline">\(k(0&lt;k\leq d)\)</span>个属性的子集，然后再从这个子集中选择一个最优属性用于划分。一般情况下推荐<span class="math inline">\(k=\log_2d\)</span>。</p><p>随机森林训练效率通常优于Bagging，因为每个节点的划分只需要部分属性参与，而随机森林的泛化误差通常低于Bagging，因为属性的扰动为每个基决策树提供了更好的泛化性能。</p><h2 id="聚合意见的方法结合策略">聚合意见的方法——结合策略</h2><h3 id="学习器结合的好处">学习器结合的好处</h3><ol type="1"><li>从统计的方面来看，由于学习任务的假设空间往往很大，可能有多个假设在训练集上达到相同性能，此时使用单个学习器可能因误选导致泛化性能不佳，结合多个学习器会减少这一风险。</li><li>从计算的方面来看，学习算法往往会陷入局部极小，有时局部极小点对应的泛化性能很糟，而通过多次运行之后进行结合，可降低进入局部极小点的风险。</li><li>从表示的方面来看，某些学习任务的真实假设可能不在当前学习算法所考虑的假设空间中，此时使用单学习器一定无效，而通过结合多学习器，由于相应假设空间有所扩大，有可能学得更好的近似。</li></ol><h3 id="一平均法">一，平均法</h3><ul><li><p>简单平均法，是加权平均法<span class="math inline">\(w_i=1/T\)</span>时的特例。 <span class="math display">\[H(\pmb{x})=\stackrel{T}{\underset{i=1}\sum}h_i(\pmb{x})\]</span></p></li><li><p>加权平均法 <span class="math display">\[H(\pmb{x})=\stackrel{T}{\underset{i=1}\sum}w_i h_i(\pmb{x})\]</span></p></li></ul><p>一般而言，在个体学习器性能相差较大时使用加权平均法。</p><h3 id="二投票法">二，投票法</h3><p>为方便讨论，将<span class="math inline">\(h_i\)</span>在样本<span class="math inline">\(\pmb{x}\)</span>上的预测输出表示为一个<span class="math inline">\(N\)</span>维向量<span class="math inline">\((h_i^1(\pmb{x});h_i^2(\pmb{x});\dots;h_i^N(\pmb{x}))\)</span>，其中<span class="math inline">\(h_i^j(\pmb{x})\)</span>是<span class="math inline">\(h_i\)</span>在类别标记<span class="math inline">\(c_j\)</span>上的输出。</p><ul><li><p>绝对多数投票法，即若某标记得票超过半数，即预测为该标记，否则拒绝预测。 <span class="math display">\[H(\pmb{x})=\begin{cases}c_j,\textbf{if}\ \stackrel{T}{\underset{i=1}\sum}h_i^j(\pmb{x})&gt;0.5\stackrel{N}{\underset{k=1}\sum}\stackrel{T}{\underset{i=1}\sum}h_i^k(\pmb{x}) \\ reject, \textbf{otherwise}\end{cases}\]</span></p></li><li><p>相对多数投票法，即预测为得票最多的标记，若同时有多个标记获得最高票，则随机选择一个。 <span class="math display">\[H(\pmb{x})=c_{\underset{j}{\arg\max}\stackrel{T}{\underset{i=1}\sum}h_i^j(\pmb{x})}\]</span></p></li><li><p>加权投票法，与加权平均法类似，通常<span class="math inline">\(w_i\geq 0\)</span>，<span class="math inline">\(\stackrel{T}{\underset{i=1}\sum}w_i=1\)</span> <span class="math display">\[H(\pmb{x})=c_{\underset{j}{\arg\max}\stackrel{T}{\underset{i=1}\sum}w_ih_i^j(\pmb{x})}\]</span></p></li></ul><h3 id="三学习法">三，学习法</h3><p>当训练数据很多时，一种更为强大的结合策略是使用“学习法”，即通过另一个学习器来结合。</p><p>学习法的代表方法是Stacking。Stacking先从初始数据集训练出初级学习器，然后“生成”一个新数据集用于训练次级学习器，在这个新数据集中，初级学习器的输出被当作样例输入特征，而初始样本的标记仍被当作样例标记。下面是Stacking算法的伪代码描述：</p><hr /><blockquote><p>输入：</p><ul><li><p>训练集<span class="math inline">\(D = \{(\pmb{x}_{1},y_{1}),(\pmb{x}_{2},y_{2}),\dots,(\pmb{x}_{m},y_{m})\}\)</span></p></li><li><p>初级学习算法<span class="math inline">\(\mathfrak{L}_1,\mathfrak{L}_2,\dots,\mathfrak{L}_T\)</span></p></li><li><p>次级学习算法<span class="math inline">\(\mathfrak{L}\)</span></p></li></ul><p>过程：</p><ol type="1"><li><span class="math inline">\(\textbf{for}\ \ t = 1 \dots T \ \ \textbf{do}\)</span></li><li><span class="math inline">\(\ \ h_{t}=\mathfrak{L}_t(D);\)</span></li><li><span class="math inline">\(\textbf{end}\ \ \textbf{for}\)</span></li><li><span class="math inline">\(D&#39; = \varnothing\)</span></li><li><span class="math inline">\(\textbf{for}\ \ i = 1 \dots m \ \ \textbf{do}\)</span></li><li><span class="math inline">\(\ \ \textbf{for}\ \ t = 1 \dots T \ \ \textbf{do}\)</span></li><li><span class="math inline">\(\ \ \ \ z_{it}=h_t(\pmb{x})\)</span></li><li><span class="math inline">\(\ \ \textbf{end for}\)</span></li><li><span class="math inline">\(\ \ D&#39;=D&#39;\cup((z_{i1},z_{i2},\dots,z_{iT}),y_i)\)</span></li><li><span class="math inline">\(\textbf{end for}\)</span></li><li><span class="math inline">\(h&#39;=\mathfrak{L}(D&#39;)\)</span></li></ol><p>输出：<span class="math inline">\(H(\pmb{x})=h&#39;(h_1(\pmb{x}),h_2(\pmb{x}),\dots,h_T(\pmb{x}))\)</span></p></blockquote><hr /><h2 id="多样性增强的方法">多样性增强的方法</h2><ol type="1"><li><p>数据样本扰动</p><ul><li><p>利用不同的数据子集训练出不同的个体学习器，数据样本扰动通常是基于采样法，例如在Bagging的自助采样，AdaBoosting中的序列采样。</p></li><li><p>对输入扰动敏感的基学习器效果较好：决策树，神经网络等</p></li><li><p>对输入扰动不敏感的基学习器效果不好：线性学习器，SVM，朴素贝叶斯，k近邻等</p></li></ul></li><li><p>输入属性扰动</p><ul><li>从初始属性集中抽取出若干个属性子集，再基于每个属性子集训练一个基学习器，算法描述如下</li></ul><hr /><blockquote><p>输入：</p><ul><li><p>训练集<span class="math inline">\(D = \{(\pmb{x}_{1},y_{1}),(\pmb{x}_{2},y_{2}),\dots,(\pmb{x}_{m},y_{m})\}\)</span></p></li><li><p>基学习算法<span class="math inline">\(\mathfrak{L}\)</span></p></li><li><p>基学习器数<span class="math inline">\(T\)</span></p></li><li><p>子空间属性数<span class="math inline">\(d&#39;(d&#39;&lt;d)\)</span></p></li></ul><p>过程：</p><ol type="1"><li><p><span class="math inline">\(\textbf{for}\ \ t = 1 \dots T \ \ \textbf{do}\)</span></p></li><li><p><span class="math inline">\(\ \ \mathcal{F}_{t}=\text{RS}(D&#39;,d&#39;);\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li><li><p><span class="math inline">\(\ \ D_{t}=\text{Map}_{\mathcal{F}_t}(D);\)</span></p></li><li><p><span class="math inline">\(\ \ h_t=\mathfrak{L}(D_t)\)</span></p></li><li><p><span class="math inline">\(\textbf{end}\ \ \textbf{for}\)</span></p></li></ol><p>输出：<span class="math inline">\(H(\pmb{x})=\underset{y\in \mathcal{Y}}{\arg\max}\stackrel{T}{\underset{t=1}\sum}\mathbb{I}(h_t(\text{Map}_{\mathcal{F}_t}(\pmb{x})=y))\)</span></p></blockquote><hr /><ul><li>对包含属性较少的数据效果不好。</li></ul></li><li><p>输出属性扰动</p><ul><li>随机改变一些训练样本的类标记</li><li>对输出表示进行转化</li></ul></li><li><p>算法参数扰动</p><ul><li>设置算法的参数，例如神经网络的隐层神经元数，初始连接权值等，通过随机设置不同的参数，往往可以产生差别较大的个体学习器。</li></ul></li></ol><h2 id="西瓜书书后习题参考答案">西瓜书书后习题参考答案</h2><p>来自网络，仅供参考</p><p><a href="https://www.cnblogs.com/NoNameIsBeginning/p/13733146.html">第8章习题</a></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p><span class="math inline">\(\mathcal{F}_t\)</span>包含<span class="math inline">\(d&#39;\)</span>个随机选取的属性，<span class="math inline">\(D_t\)</span>仅保留<span class="math inline">\(F_t\)</span>中的属性。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 统计学 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泰勒展开</title>
      <link href="/2022/02/19/math/%E6%B3%B0%E5%8B%92%E5%B1%95%E5%BC%80/"/>
      <url>/2022/02/19/math/%E6%B3%B0%E5%8B%92%E5%B1%95%E5%BC%80/</url>
      
        <content type="html"><![CDATA[<h2 id="简介">简介</h2><p>泰勒展开是将一个在<span class="math inline">\(x=x_0\)</span>处具有<span class="math inline">\(n\)</span>阶导数的函数<span class="math inline">\(f(x)\)</span>利用关于<span class="math inline">\((x-x_0)\)</span>的<span class="math inline">\(n\)</span>次多项式来逼近函数的方法。</p><h2 id="逼近的策略">逼近的策略</h2><p>下面以<span class="math inline">\(f(x)=\sin x\)</span>得近似为例。</p><h3 id="一阶近似">一阶近似</h3><p>由导数的定义<span class="math inline">\(f&#39;(x)|_{x=x_0}=\underset{x\rightarrow x_0}\lim\frac{f(x)-f(x_0)}{x-x_0}\)</span>得微分近似计算公式<span class="math inline">\(f(x)=f(x_0)+f&#39;(x)|_{x=x_0}(x-x_0)\)</span>，</p><p>对<span class="math inline">\(x=x_0\)</span>附近的<span class="math inline">\(f(x)\)</span>得线性逼近为：<span class="math inline">\(f(x)=f(0)+f&#39;(0)(x-0)\)</span>，所以<span class="math inline">\(f(x)=x\)</span>在<span class="math inline">\(x=0\)</span>处线性逼近<span class="math inline">\(f(x)=\sin x\)</span>。此时对于离远点较近的</p><p>如图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/First-order%20approximation.png" alt="一阶近似" /></p><h3 id="高阶近似">高阶近似</h3><p><span class="math inline">\(P_n(x)=a_0+a_1x+a_2x^2+\cdots+a_nx^n\)</span>逼近<span class="math inline">\(f(x)=\sin x\)</span>，令<span class="math inline">\(P(x)\)</span>满足如下条件：</p><ol type="1"><li><span class="math inline">\(P_2(0)=f(0)\)</span>，在<span class="math inline">\(x_0\)</span>处的函数值相等</li><li><span class="math inline">\(P_2&#39;(0)=f&#39;(0)\)</span>，在<span class="math inline">\(x_0\)</span>处的斜率相等</li><li><span class="math inline">\(P&#39;&#39;(0)=f&#39;&#39;(0)\)</span>，在<span class="math inline">\(x_0\)</span>处的曲度相等</li><li><span class="math inline">\(P^{(3)}(0)=f^{(3)}(0)\)</span>，在<span class="math inline">\(x_0\)</span>处的更高阶曲度相等</li><li><span class="math inline">\(\dots\dots\)</span></li></ol><p>如图所示：</p><p><span class="math inline">\(P_{3}(x)=x-\frac{x^3}{3!}+o(x)\)</span></p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/3-app.png" alt="三阶近似" /></p><p><span class="math inline">\(P_{5}(x)=x-\frac{x^3}{3!}+\frac{x^5}{5!}+o(x)\)</span></p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/mathimg/5-app.png" alt="五阶近似" /></p><h2 id="总结">总结</h2><p>由高阶近似的条件，我们得到泰勒公式，作为连续可导函数的近似 <span class="math display">\[f(x)=\frac{f(x_0)}{0!}+\frac{f&#39;(x_1)}{1!}(x-x_0)+\frac{f&#39;&#39;(x_2)}{2!}(x-x_0)^2+\cdots+\frac{f^n(x_n)}{n!}(x-x_0)^n+R_n(x)\]</span> <span class="math inline">\(R_n(x)=\frac{f^{(n+1)}(\xi)}{(n+1)!}(x-x_0)^{n+1}\)</span>表示余项，其中<span class="math inline">\(\xi\)</span>在<span class="math inline">\(x\)</span>与<span class="math inline">\(x_0\)</span>之间。</p>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 高等数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 学习笔记 </tag>
            
            <tag> 高等数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>集成学习的原理（上篇）</title>
      <link href="/2022/02/14/machine%20learning/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0a/"/>
      <url>/2022/02/14/machine%20learning/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0a/</url>
      
        <content type="html"><![CDATA[<h2 id="集成学习器">集成学习器</h2><p>优势：众人拾柴火焰高。集成学习相当于很多学习器开会投票决策，所以别名为委员会学习系统（committee-based learning）或多分类器系统（multi-classifier system）。</p><p>个体学习器特点：输出不能完全相同（导致集成学习结果对最后没有作用），而且学习准确率不能少于50%（集成学习可能起到相反效果），换句话说，每个个体学习器需要具有一定的<strong>准确性</strong>，并且输出要有<strong>多样性</strong>，即“好而不同”。</p><h2 id="简单的定量分析">简单的定量分析</h2><p>做一个简单的分析，考虑二分类问题<span class="math inline">\(y \in \{-1, 1\}\)</span>和真实函数<span class="math inline">\(f\)</span>（<span class="math inline">\(f(\pmb{x})\)</span>表示<span class="math inline">\(\pmb{x}\)</span>的真实标签），假定基分类器的错误率为<span class="math inline">\(\epsilon\)</span>，即对每个基分类器有<span class="math inline">\(P(h_{i}(\pmb{x})\neq f(\pmb{x})) = \epsilon\)</span>。假定个体学习器数量<span class="math inline">\(T\)</span>为奇数，定义集成学习器的结果<span class="math inline">\(H(\pmb{x})=\text{sign}(\stackrel{T}{\underset{i = 1}{\sum}}h_{i}(\pmb{x}))\)</span>.</p><p>分类错误率为</p><p><span class="math display">\[P(H(\pmb{x})\neq f(\pmb{x})) = \stackrel{\lfloor T/2 \rfloor}{\underset{k=0}{\sum}}\binom{T}{k}(1-\epsilon)^{k}\epsilon^{T-k} \leq \exp(-\frac{1}{2}T(1-2\epsilon)^2)\]</span> 上式显示出，随T的增加，集成学习的错误率将成指数级下降，最终趋近0，且<span class="math inline">\(\epsilon = 0.5\)</span>的学习器对收敛没有作用。</p><h2 id="集成学习的序列化算法">集成学习的序列化算法</h2><p>序列化算法，即个体学习器串行链接，实现后一个学习器对前一个学习器的错误的修正。</p><p>举个例子：</p><p>现在要在在文章中修改错误，但一个人的能力，精力都是有限的，人也会出错，比如把正确的部分误判成错误的。</p><p>为了减少文档错误，我们可以多人协作。前一个人修正一部分错误后，把他/她的修改完的文章再交给下一个人审核，尽管每个人的能力不是很强（基本的能力要有！他/她不能把太多对的地方改成错的，也不能是好好先生什么都认为对），但只要检查的人足够多，文章中的错误就能悉数修正。此外，还可以根据这个人的差错率，为其分配较大权重，表示在团队中，我们更相信此人检查出来的错误是正确的。</p><h3 id="boosting-adaboost的损失函数定义及其一致性讨论">1. Boosting, AdaBoost的损失函数定义及其一致性讨论</h3><p>集成<span class="math inline">\(T\)</span>个学习器，每个个体学习器<span class="math inline">\(h_{t}\)</span>具有权重<span class="math inline">\(\alpha_{t}\)</span>，他们的加权和作为集成学习器的输出结果，即</p><p><span class="math display">\[H(\pmb{x})=\stackrel{T}{\underset{t=1}{\sum}}\alpha_{t}h_{t}(\pmb{x})\]</span> 我们的目标是最小化损失函数，AdaBoost的损失函数定义如下：</p><p><span class="math display">\[\mathscr{l}_{exp}(H|\mathcal{D})=\mathbb{E}_{x\sim \mathcal{D}}[e^{-f(\pmb{x})H(\pmb{x})}]\]</span> 补充说明：</p><ol type="1"><li><span class="math inline">\(-f(\pmb{x})H(\pmb{x})\)</span>的设计目的（这里考虑的不单单针对二分类问题）：若预测正确，即<span class="math inline">\(f(\pmb{x})H(\pmb{x})&gt;0\)</span>，<span class="math inline">\(|H(\pmb{x})|\)</span>越大，损失函数<span class="math inline">\(e^{-f(\pmb{x})H(\pmb{x})}\)</span>的值越小。如果<span class="math inline">\(|H(\pmb{x})|\)</span>越接近0，虽然预测正确，但预测的损失函数值越大，表明预测准确的信心不够。<span class="math inline">\(f(\pmb{x})H(\pmb{x})&lt;0\)</span>时的定性分析与之类似。</li><li><a href="https://en.wikipedia.維基.台灣/wiki/Probability_distribution">概率分布</a><span class="math inline">\(\mathcal{D}\)</span>在这里可以简单理解为在数据集<span class="math inline">\(D\)</span>中进行随机取样时每个样本被取到的概率。</li><li><span class="math inline">\(\mathbb{E}_{x\sim \mathcal{D}}[f(x)]\)</span>的含义：函数<span class="math inline">\(f(x)\)</span>对随机变量<span class="math inline">\(x\)</span>在概率分布<span class="math inline">\(\mathcal{D}\)</span>下的数学期望，可以理解为对数据集<span class="math inline">\(D\)</span>以概率分布<span class="math inline">\(\mathcal{D}\)</span>进行加权后的期望。</li><li><span class="math inline">\(P(f(\pmb{x})=1|\pmb{x})\)</span>表示给定随机变量<span class="math inline">\(\pmb{x}\)</span>，<span class="math inline">\(f(\pmb{x})=1\)</span>的概率。</li></ol><p>所以</p><p><span class="math display">\[\begin{align*}\mathscr{l}_{exp}(H|\mathcal{D}) &amp;=\mathbb{E}_{x\sim \mathcal{D}}[e^{-f(\pmb{x})H(\pmb{x})}] \\ &amp;=\stackrel{}{\underset{x \in D}{\sum}}\mathcal{D}(\pmb{x})e^{-f(\pmb{x})H(\pmb{x})} \\ &amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})(e^{-H(\pmb{x})}\mathbb{I}(f(\pmb{x}_i)=1)+e^{H(\pmb{x})}\mathbb{I}(f(\pmb{x}_i)=-1)) \\ &amp;=e^{-H(x)}(\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_i)=1))+e^{H(\pmb{x})}(\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_i)=-1))\end{align*}\]</span> 因为<span class="math inline">\(\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_i)=1) = P(f(\pmb{x})=1|\pmb{x})\)</span>，所以得下式</p><p><span class="math display">\[\mathscr{l}_{exp}(H|\mathcal{D})=e^{-H(\pmb{x})}P(f(\pmb{x})=1|\pmb{x})+e^{H(\pmb{x})}P(f(\pmb{x})=-1|\pmb{x})\]</span> 若<span class="math inline">\(H(\pmb{x})\)</span>能令指数损失函数最小化，对<span class="math inline">\(\mathscr{l}_{exp}(H|D)\)</span>关于<span class="math inline">\(H(\pmb{x})\)</span>求偏导。</p><p><span class="math display">\[\frac{\partial{\mathscr{l}_{exp}(H|\mathcal{D})}}{\partial{H(\pmb{x})}}=-e^{-H(\pmb{x})}P(f(\pmb{x})=1|\pmb{x})+e^{H(\pmb{x})}P(f(\pmb{x})=-1|\pmb{x})\]</span> 令上式等于0，解得</p><p><span class="math display">\[H(\pmb{x})=\frac{1}{2}\ln\frac{P(f(\pmb{x})=1|\pmb{x})}{P(f(\pmb{x})=-1|\pmb{x})}\]</span> 因此，有（忽略了<span class="math inline">\(P(f(\pmb{x})=1|\pmb{x}) = P(f(\pmb{x})=-1|\pmb{x})\)</span>的情况）</p><p><span class="math display">\[\begin{align*} \text{sgn}(H(\pmb{x}))&amp;=\text{sgn}(\frac{1}{2}\ln\frac{P(f(\pmb{x})=1|\pmb{x})}{P(f(\pmb{x})=-1|\pmb{x})}) \\ &amp;=\begin{cases}1, P(f(\pmb{x})=1|\pmb{x}) &gt; P(f(\pmb{x})=-1|\pmb{x}) \\ -1, P(f(\pmb{x})=1|\pmb{x}) &lt; P(f(\pmb{x})=-1|\pmb{x})\end{cases} \\ &amp;=\underset{y \in \{-1,1\}}{\arg\max}P(f(\pmb{x})=y | \pmb{x}) \end{align*}\]</span></p><ul><li>注：<span class="math inline">\(\underset{y \in \{-1,1\}}{\arg\max}P(f(\pmb{x})=y | \pmb{x})\)</span>表示使得函数<span class="math inline">\(P(f(\pmb{x})=y | \pmb{x})\)</span>取得最大值的<span class="math inline">\(y\)</span>的值。展开就是上式。</li></ul><p>若指数函数最小化，则分类错误率也将最小化；这说明指数损失函数是原本的0/1损失函数的一致的替代损失函数。它的数学性质比0/1替代函数好，所以用它作为我们的优化目标。</p><h3 id="adaboost算法原理推导">2. AdaBoost算法原理推导</h3><p>AdaBoost是求解二分类问题的经典算法。按照惯例，先论证数学原理。仍然考虑上述的二分类问题，<span class="math inline">\(y,f(\pmb{x}),h_{i}(\pmb{x}) \in \{-1, 1\}\)</span>.</p><p>前向分布求解算法：每一轮只学习一个学习器<span class="math inline">\(h_{i}\)</span>和相应的权重<span class="math inline">\(\alpha_{i}\)</span>，第<span class="math inline">\(t\)</span>轮的优化目标 <span class="math display">\[(\alpha_{t},h_{t})=\underset{\alpha,h}\arg\min\mathscr{l}_{exp}(H_{t-1}+\alpha h|\mathcal{D})\]</span></p><hr /><h4 id="特殊到一般第一个选择器的参数求解">特殊到一般，第一个选择器的参数求解</h4><p>在AdaBoost算法中，<strong>第一个基分类器</strong><span class="math inline">\(h_{1}\)</span>是通过直接将基学习算法用于初始数据分布而得；此后迭代生成<span class="math inline">\(h_{t}\)</span>和<span class="math inline">\(\alpha_{t}\)</span>，当基分类器<span class="math inline">\(h_{t}\)</span>基于分布<span class="math inline">\(\mathcal{D}_{t}\)</span>产生后。该分类器的<strong>权重</strong><span class="math inline">\(\alpha_{t}\)</span>应使得<span class="math inline">\(\alpha_{t}h_{t}\)</span><strong>最小化损失函数</strong><span class="math inline">\(\mathscr{l}_{exp}(\alpha_{t}h_{t}|\mathcal{D}_{t})\)</span>. <span class="math display">\[\begin{align*}\mathscr{l}_{exp}(\alpha_{t}h_{t}|\mathcal{D}_{t})&amp;=\mathbb{E}_{\pmb{x}\sim \mathcal{D}_{t}}[e^{-f(\pmb{x})\alpha_{t}h_{t}(\pmb{x})}] \\ &amp;=\mathbb{E}_{\pmb{x}\sim \mathcal{D}_{t}}[e^{-\alpha_{t}}\mathbb{I}(f(\pmb{x})=h_{t}(\pmb{x}))+e^{\alpha_{t}}\mathbb{I}(f(\pmb{x})\neq h_{t}(\pmb{x}))] \\&amp;=e^{-\alpha_{t}}P_{x\sim \mathcal{D}_{t}}(f(\pmb{x})=h_{t}(\pmb{x}))+e^{\alpha_{t}}P_{x\sim \mathcal{D}_{t}}(f(\pmb{x})\neq h_{t}(\pmb{x}))\\ &amp;= e^{-\alpha_{t}}(1-\epsilon_{t})+e^{\alpha_{t}}\epsilon_{t}\end{align*}\]</span> 其中<span class="math inline">\(\epsilon_{t}=P_{x\sim \mathcal{D}_{t}}(f(\pmb{x})\neq h_{t}(\pmb{x}))\)</span>，为学习器的错误率。考虑上式的导数，得： <span class="math display">\[\frac{\partial \mathscr{l}_{exp}(\alpha_{t}h_{t}|\mathcal{D}_{t})}{\partial \alpha_{t}}=-e^{-\alpha_{t}}(1-\epsilon_{t})+e^\alpha_{t}\epsilon_{t}\]</span> 令<span class="math inline">\(-e^{-\alpha_{t}}(1-\epsilon_{t})+e^\alpha_{t}\epsilon_{t}=0\)</span>，解得<span class="math inline">\(\alpha_{t}=\frac{1}{2}\ln(\frac{1-\epsilon_{t}}{\epsilon_{t}})\)</span></p><hr /><h4 id="求解学习器h_t使用前向分布算法">求解学习器<span class="math inline">\(h_{t}\)</span>——使用前向分布算法</h4><p>AdaBoost算法在获得<span class="math inline">\(H_{t-1}\)</span>之后，样本分布将进行调整，使得下一轮的基学习器<span class="math inline">\(h_{t}\)</span>能纠正<span class="math inline">\(H_{t-1}\)</span>的一些错误。理想的<span class="math inline">\(h_{t}\)</span>能纠正<span class="math inline">\(H_{t-1}\)</span>的全部错误，即最小化<span class="math inline">\(\mathscr{l}_{exp}(H_{t-1}+\alpha h_{t}|\mathcal{D})\)</span>，可简化为最小化 <span class="math display">\[\begin{align*}\mathscr{l}_{exp}(H_{t-1}+\alpha h_{t}|\mathcal{D}) &amp;= \mathbb{E}_{\pmb{x} \sim \mathcal{D}}[e^{-f(\pmb{x})H_{t-1}(\pmb{x})}e^{-f(\pmb{x})\alpha h_{t}(\pmb{x})}] \\ &amp;= \stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}e^{-f(\pmb{x}_{i})\alpha h_{t}(\pmb{x}_{i})}\end{align*}\]</span> 注意到<span class="math inline">\(f(\pmb{x}_{i})\)</span>和<span class="math inline">\(h(\pmb{x}_{i})\)</span>仅可取值<span class="math inline">\(\{-1,1\}\)</span>，可以推得： <span class="math display">\[\begin{align*}\mathscr{l}_{exp}(H_{t-1}+\alpha h_{t}|\mathcal{D})&amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}e^{-f(\pmb{x}_{i})\alpha h_{t}(\pmb{x}_{i})}\\&amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}(e^{-\alpha} \mathbb{I}(f(\pmb{x}_{i})=h_{t}(\pmb{x}_{i}))+e^\alpha\mathbb{I}(f(\pmb{x}_{i})\neq h_{t}(\pmb{x}_{i})))\end{align*}\]</span></p><p>由于下面的等价变换成立</p><p><span class="math display">\[\begin{align*}\mathbb{I}(f(\pmb{x}_{i})=h_{t}(\pmb{x}_{i})) &amp;= \mathbb{I}(f(\pmb{x}_{i})=h_{t}(\pmb{x}_{i})) + \mathbb{I}(f(\pmb{x}_{i})\neq h_{t}(\pmb{x}_{i})) - \mathbb{I}(f(\pmb{x}_{i})\neq h_{t}(\pmb{x}_{i})) \\ &amp;= 1-\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\end{align*}\]</span></p><p>所以，令<span class="math inline">\(\mathcal{D}&#39;_{t}(\pmb{x}_{i})=\mathcal{D(\pmb{x}_{i})}e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}\)</span>，继续推导 <span class="math display">\[\begin{align*}\mathscr{l}_{exp}(H_{t-1}+\alpha h_{t}|\mathcal{D}) &amp;= \stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}(\pmb{x_{i}})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}(e^{-\alpha}+(e^\alpha-e^{-\alpha})\mathbb{I}(f(\pmb{x}_{i})\neq h_{t}(\pmb{x}_{i}))) \\ &amp;= e^{-\alpha}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})+(e^\alpha - e^{-\alpha})\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\end{align*}\]</span> 我们的目标是求解<span class="math inline">\(h_{t}\)</span>使得<span class="math inline">\(\mathscr{l}_{exp}\)</span>最小化，因此可以忽略掉与<span class="math inline">\(h_{t}\)</span>无关的项。即求解目标为 <span class="math display">\[h_{t}=\underset{h}{\arg\min}(e^\alpha - e^{-\alpha})\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\]</span> 由于<span class="math inline">\(\alpha&gt;0\)</span>，此时<span class="math inline">\((e^\alpha - e^{-\alpha})\)</span>恒大于0，目标函数简化为 <span class="math display">\[h_{t}=\underset{h}{\arg\min}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\]</span> 通过观察<span class="math inline">\(\mathcal{D}&#39;_{t}(\pmb{x}_{i})\)</span>的形式，可以发现它仅与<span class="math inline">\(t-1\)</span>轮及以前的学习器有关，因此在求解<span class="math inline">\(h_{t}\)</span>时，对于样本<span class="math inline">\(i\)</span>，它已经固定了，如果把<span class="math inline">\(\mathcal{D}&#39;_{t}(\pmb{x}_{i})\)</span>看作样本<span class="math inline">\(i\)</span>在<span class="math inline">\(t\)</span>轮学习时的权重分布，我们要<strong>依据这个权重求解学习器</strong><span class="math inline">\(h_{t}\)</span>以满足上面的最优化式子。</p><p>同时，为了确保<span class="math inline">\(\mathcal{D}&#39;_{t}(\pmb{x}_{i})\)</span>是一个分布，通常我们对其进行规范化后作为下一个学习器的输入样本权重，即<span class="math inline">\(\mathcal{D}_{t}(\pmb{x}_{i})=\frac{\mathcal{D}&#39;_{t}(\pmb{x}_{i})}{\sum_{i=1}^{|D|}\mathcal{D}&#39;_{t}(\pmb{x}_{i})}\)</span>，其中分母是常数，因此这个变换不会影响上述最小化的求解。</p><p><span class="math inline">\(h_{t}\)</span>有很多形式和求解方式，比如LR算法，SVM，决策树等。</p><hr /><h4 id="递推法求下一个学习器面对问题的概率分布">递推法求下一个学习器面对问题的概率分布</h4><p><span class="math inline">\(H_{t}\)</span>是可以递推出来的。下面给出解释：如果现在想知道<span class="math inline">\(t+1\)</span>轮的分布，根据定义<span class="math inline">\(\mathcal{D}&#39;_{t}(\pmb{x}_{i})=\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}\)</span>，可以得到如下的式子 <span class="math display">\[\begin{align*}\mathcal{D}&#39;_{t+1}(\pmb{x_{i}})&amp;=\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t}(\pmb{x}_{i})}\\ &amp;=\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})(H_{t}(\pmb{x}_{i})+\alpha_{t} h_{t}(\pmb{x}_{i}))}\\ &amp;=\mathcal{D}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t}(\pmb{x}_{i})}e^{-f(\pmb{x}_{i})\alpha_{t}h_{t}(\pmb{x}_{i})} \\ &amp;=\mathcal{D}&#39;_{t}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})\alpha_{t}h_{t}(\pmb{x}_{i})}\end{align*}\]</span> 结合规范化的结果，推出推导前后的分布关系，以下为推导过程 <span class="math display">\[\begin{align*}\mathcal{D}_{t+1}(\pmb{x_{i}})\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t+1}(\pmb{x}_{i})&amp;=\mathcal{D}_{t}(\pmb{x_{i}})e^{-f(\pmb{x}_{i})\alpha_{t}h_{t}(\pmb{x}_{i})}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i}) \\ \mathcal{D}_{t+1}(\pmb{x_{i}})&amp;=\mathcal{D}_{t}(\pmb{x_{i}})e^{-f(\pmb{x}_{i})\alpha_{t}h_{t}(\pmb{x}_{i})}\frac{\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}]}{\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[e^{-f(\pmb{x}_{i})H_{t}(\pmb{x}_{i})}]}\end{align*}\]</span> 补充：期望的定义就是上式求和转为期望的原因 <span class="math display">\[\begin{align*}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})&amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}_{t}(\pmb{x}_{i})e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})} \\ &amp;= \mathbb{E}_{\pmb{x}\sim \mathcal{D}}[e^{-f(\pmb{x}_{i})H_{t-1}(\pmb{x}_{i})}]\end{align*}\]</span></p><hr /><h4 id="求解学习器h_t的权重alpha_t">求解学习器<span class="math inline">\(h_{t}\)</span>的权重<span class="math inline">\(\alpha_{t}\)</span></h4><p>损失函数对<span class="math inline">\(\alpha\)</span>求导，有 <span class="math display">\[\begin{align*}\frac{\partial(H_{t-1}+\alpha h_{t}|\mathcal{D})}{\partial\alpha}&amp;=\frac{\partial(e^{-\alpha}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})+(e^\alpha - e^{-\alpha})\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i})))}{\partial\alpha} \\ &amp;=-e^{-\alpha}\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})+(e^\alpha+e^{-\alpha})\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\end{align*}\]</span> 令导数为0，移项可得 <span class="math display">\[\begin{align*}\frac{e^{-\alpha}}{e^{\alpha}+e^{-\alpha}}=\frac{\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))}{\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})}&amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\frac{\mathcal{D}&#39;_{t}(\pmb{x}_{i})}{\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}&#39;_{t}(\pmb{x}_{i})}\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i})) \\ &amp;=\stackrel{|D|}{\underset{i=1}{\sum}}\mathcal{D}_{t}(\pmb{x}_{i})\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))\\ &amp;=\mathbb{E}_{\pmb{x}\sim\mathcal{D}}[\mathbb{I}(f(\pmb{x}_{i}) \neq h_{t}(\pmb{x}_{i}))] \\ &amp;=\epsilon_{t}\end{align*}\]</span> 由上面的方程<span class="math inline">\(\frac{e^{-\alpha}}{e^{\alpha}+e^{-\alpha}}=\epsilon_{t}\)</span>，解得 <span class="math display">\[\alpha = \frac{1}{2}\ln(\frac{1-\epsilon_{t}}{\epsilon_{t}})\]</span> 发现当<span class="math inline">\(\epsilon &gt; \frac{1}{2}\)</span>时，上式单调递减，因此误差率越大的分类器权重越小。</p><h3 id="算法的过程">3. 算法的过程</h3><p>算法伪代码<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><p>输入：</p><ul><li><p>训练集<span class="math inline">\(D = \{(\pmb{x}_{1},y_{1}),(\pmb{x}_{2},y_{2}),\dots,(\pmb{x}_{m},y_{m})\}\)</span></p></li><li><p>基学习算法<span class="math inline">\(\mathfrak{L}\)</span></p></li><li><p>训练轮数<span class="math inline">\(T\)</span></p></li></ul><p>过程：</p><ol type="1"><li><span class="math inline">\(\mathcal{D}_{1}(\pmb{x})=1/m.\)</span><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li><li><span class="math inline">\(\textbf{for}\ \ t = 1 \dots T \textbf\ \ {do}\)</span></li><li><span class="math inline">\(\ \ h_{t}=\mathfrak{L}(D,\mathcal{D}_{t});\)</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li><li><span class="math inline">\(\ \ \epsilon_{t}=P_{\pmb{x}\sim\mathcal{D}_{t}}(h_{t}(\pmb{x})\neq f(\pmb{x}));\)</span><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></li><li><span class="math inline">\(\ \ \textbf{if}\ \ \epsilon &gt; 0.5\ \ \textbf{then} \ \ \textbf{break};\)</span><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li><li><span class="math inline">\(\ \ \alpha_{t}=\frac{1}{2}\ln(\frac{1-\epsilon_{t}}{\epsilon_{t}})\)</span><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></li><li><span class="math inline">\(\begin{align*}\ \ \mathcal{D}_{t+1}(\pmb{x})&amp;=\frac{\mathcal{D}_{t}(\pmb{x})}{Z_{t}}\times \begin{cases} \exp(-\alpha_{t}), \textbf{if} \ h_{t}(\pmb{x}) ==f(\pmb{x}) \\ \exp(\alpha_{i}), \textbf{if}\ h_{t}(\pmb{x}) \neq f(\pmb{x})\end{cases} \\ &amp;=\frac{\mathcal{D}_{t}(\pmb{x})\exp(-\alpha_{t}f(\pmb{x})h_{t}(\pmb{x}))}{Z_{t}}\end{align*}\)</span><a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></li><li><span class="math inline">\(\textbf{end}\ \ \textbf{for}\)</span></li></ol><p>输出：<span class="math inline">\(H(\pmb{x})=\text{sign}(\stackrel{T}{\underset{t=1}{\sum}}\alpha_{t}h_{t}(\pmb{x}))\)</span></p><hr /><h3 id="一般化扩展">4. 一般化扩展</h3><p>将AdaBoosting问题一般化，不限定损失函数为指数函数，也不限定局限于二分类问题，更一般的Boosting形式为： <span class="math display">\[\begin{align*}\mathscr{l}(H_{t}|\mathcal{D})&amp;=\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))] \\ &amp;= \mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\text{err}(H_{t-1}(\pmb{x})+\alpha_{t}h_{t}(\pmb{x}),f(\pmb{x}))]\end{align*}\]</span> err的意义：损失函数，比如研究回归问题时，<span class="math inline">\(f(\pmb{x})\in \mathbb{R}\)</span>且损失函数为平方损失函数<span class="math inline">\(\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))=(H_{t}(\pmb{x})-f(\pmb{x}))^2\)</span>.这个问题被称作Gradient Boost问题。</p><p>err的函数性质可能很复杂，套上一个分布求期望可能难以求解，所以我们对损失函数<span class="math inline">\(\mathscr{l}(H_{t}|\mathcal{D})\)</span>做一个近似。因为<span class="math inline">\(H_{t-1}(\pmb{x})\)</span>求出的结果距离<span class="math inline">\(H_{t}(\pmb{x})\)</span>最近，近似的结果相比于其它可选值更准确，所以可以对<span class="math inline">\(H_{t}(\pmb{x})\)</span>在<span class="math inline">\(H_{t-1}(\pmb{x})\)</span>处做泰勒展开。 <span class="math display">\[\begin{align*}\mathscr{l}(H_{t}|\mathcal{D})&amp;\approx\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\text{err}(H_{t-1}(\pmb{x}),f(\pmb{x}))+\frac{\partial\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}(H_{t}(\pmb{x})-H_{t-1}(\pmb{x}))]\\&amp;=\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\text{err}(H_{t-1}(\pmb{x}),f(\pmb{x}))+\frac{\partial\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}\alpha_{t}h_{t}(\pmb{x})] \\ &amp;= \mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\text{err}(H_{t-1}(\pmb{x}),f(\pmb{x}))]+\mathbb{E}_{x\sim \mathcal{D}}[\frac{\partial\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}\alpha_{t}h_{t}(\pmb{x})]\end{align*}\]</span> 注意，上式的左边一项是一个常数，所以，在最优化时，只需考虑右侧的一项。先不考虑<span class="math inline">\(\alpha_{t}\)</span>，求解如下优化问题即可得到<span class="math inline">\(h_{t}(\pmb{x})\)</span>。 <span class="math display">\[h_{t}(\pmb{x})=\underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\frac{\partial\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}h(\pmb{x})] \\\text{s.t.constrains for }h(\pmb{x})\]</span> 解得<span class="math inline">\(h_{t}(\pmb{x})\)</span>之后，在求解如下优化问题可得权重项<span class="math inline">\(\alpha_{t}\)</span>: <span class="math display">\[\alpha_{t}=\underset{\alpha}{\arg\min}\mathbb{E}_{x\sim \mathcal{D}}[\text{err}(H_{t-1}(\pmb{x})+\alpha h_{t}(\pmb{x}),f(\pmb{x}))]\]</span> 以上就是梯度提升(Gradient Boosting)的理论框架，即每轮通过梯度下降的方式将个体弱学习器提升(Boosting)为强学习器。AdaBoosting是其特殊形式。</p><h2 id="adaboosting的再推导">AdaBoosting的再推导</h2><h3 id="推导h_tpmbx">推导<span class="math inline">\(h_{t}(\pmb{x})\)</span></h3><p>注意<span class="math inline">\(e^{-f(\pmb{x})H_{t-1}(\pmb{x})}\)</span>为常数，优化时可以忽略。 <span class="math display">\[\begin{align*}h_{t}(\pmb{x})&amp;=\underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\frac{\partial\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}h(\pmb{x})]\\&amp;= \underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\frac{\partial e^{-f(\pmb{x})H_{t}(\pmb{x})}}{\partial H_{t}(\pmb{x})}\bigg|_{H_{t}(\pmb{x})=H_{t-1}(\pmb{x})}h(\pmb{x})] \\ &amp;= \underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[-f(\pmb{x})e^{-f(\pmb{x})H_{t-1}(\pmb{x})}h(\pmb{x})] \\ &amp;= \underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[-f(\pmb{x})h(\pmb{x})]\end{align*}\]</span> 由<span class="math inline">\(f(\pmb{x}),h(\pmb{x})\in \{-1,1\}\)</span>，有 <span class="math display">\[\begin{align*}f(\pmb{x})h(\pmb{x})&amp;=\begin{cases}1,f(\pmb{x})=h(\pmb{x})\\ -1,f(\pmb{x})\neq h(\pmb{x})\end{cases} \\ &amp;=-\mathbb{I}(f(\pmb{x})\neq h(\pmb{x}))+(1-\mathbb{I}(f(\pmb{x})\neq h(\pmb{x})))\\ &amp;=1-2\mathbb{I}(f(\pmb{x})\neq h(\pmb{x}))\end{align*}\]</span> 因此得《机器学习》<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>式(8.18) <span class="math display">\[h_{t}(\pmb{x})=\underset{h}{\arg\min}\mathbb{E}_{\pmb{x}\sim \mathcal{D}}[\mathbb{I}(f(\pmb{x})\neq h(\pmb{x}))]\]</span></p><h3 id="推导alpha_t">推导<span class="math inline">\(\alpha_{t}\)</span></h3><p>方法与上面介绍过的相同。</p><h2 id="gdbt和xgbboost">GDBT和XGBBoost</h2><h3 id="gdbt简介">GDBT简介</h3><ol type="1"><li><p>以GB为基本框架，并使用CART作为个体学习器。</p></li><li><p>针对回归问题，GBDT采用平方损失</p><p><span class="math display">\[\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))=(H_{t}(\pmb{x})-f(\pmb{x}))^2\]</span></p></li><li><p>针对二分类问题，GBDT采用对数似然损失函数</p><p><span class="math display">\[\text{err}(H_{t}(\pmb{x}),f(\pmb{x}))=\log(1+\exp(-H_{t}(\pmb{x})f(\pmb{x}))\]</span></p></li></ol><h3 id="xgboost">XGBoost</h3><p>eXtreme Gradient Boosting的缩写，XGBoosting与GBDT的关系可以类比为LIBSVM和SVM的关系，即XGBoost是GBDT得一种高效实践和改进。</p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>《机器学习》P174 周志华<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>初始化样本权值分布<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p>基于分布<span class="math inline">\(\mathcal{D}_{t}\)</span>从数据集<span class="math inline">\(D\)</span>中训练出分类器<span class="math inline">\(h_{t}\)</span><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn4" role="doc-endnote"><p>估计<span class="math inline">\(h_{t}\)</span>的误差<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn5" role="doc-endnote"><p>学习器误差大于<span class="math inline">\(50\%\)</span>表明个体学习器不会对集成学习器产生效果，甚至造成负面影响，学习失败。<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn6" role="doc-endnote"><p>确定分类器<span class="math inline">\(h_{t}\)</span>的权重<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn7" role="doc-endnote"><p>更新样本分布，其中<span class="math inline">\(Z_{t}\)</span>是规范化因子，以确保<span class="math inline">\(\mathcal{D}_{t+1}\)</span>是一个分布<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn8" role="doc-endnote"><p>《机器学习》P174 周志华<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 前沿技术 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 统计学 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>极大似然估计</title>
      <link href="/2022/02/13/math/%E6%9E%81%E5%A4%A7%E4%BC%BC%E7%84%B6%E4%BC%B0%E8%AE%A1/"/>
      <url>/2022/02/13/math/%E6%9E%81%E5%A4%A7%E4%BC%BC%E7%84%B6%E4%BC%B0%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="用途">用途</h2><p>已经观测到部分样本的分布情况，根据现有的观测结果，估计已知概率分布模型的参数值。</p><h2 id="方法">方法</h2><p>对于离散型（连续型）随机变量<span class="math inline">\(X\)</span>，假设其概率质量函数为<span class="math inline">\(P(x;\theta)\)</span>，概率密度函数为<span class="math inline">\(p(x;\theta)\)</span>，其中<span class="math inline">\(\theta\)</span>为待估计的参数值（可以有多个），现有<span class="math inline">\(x_{1}, x_{2}, \dots,x_{n}\)</span>是来自<span class="math inline">\(X\)</span>的<span class="math inline">\(n\)</span>个独立同分布的样本，对于离散型随机变量，它们的联合概率为：</p><p><span class="math display">\[L(\theta)=\stackrel{n}{\underset{i=1}{\prod}}P(x_{i};\theta)\]</span> 对于连续型随机变量，其联合密度为：</p><p><span class="math display">\[L(\theta)=\stackrel{n}{\underset{i=1}{\prod}}p(x_{i};\theta)\]</span> 其中<span class="math inline">\(x_{1}, x_{2}, \dots,x_{n}\)</span>为已知量，<span class="math inline">\(\theta\)</span>为未知量，称<span class="math inline">\(L(\theta)\)</span>为样本的似然函数。极大似然估计<strong>相信观察得到的样本分布的正确性</strong>，也就是会想办法让<strong>观察得到的结果出现的概率最大</strong>。</p><p>【例1】现有一批观测样本<span class="math inline">\(x_{1}, x_{2}, x_{3}, \dots,x_{n}\)</span>，假设其服从某个正态分布<span class="math inline">\(X \sim N(\mu,\sigma^2)\)</span>，用极大似然估计法估计<span class="math inline">\(\mu, \sigma\)</span>.</p><p>第一步：写出<span class="math inline">\(X\)</span>的概率密度函数.</p><p><span class="math display">\[p(x;\mu,\sigma)=\frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{(x-\mu)^2}{2\sigma^2})\]</span> 第二步：写出似然函数.</p><p><span class="math display">\[L(\mu,\sigma^2)=\stackrel{n}{\underset{i=1}{\prod}}p(x_{i};\mu,\sigma^2)\]</span> 第三步：求出使得<span class="math inline">\(L(\mu,\sigma^2)\)</span>取到最大值的<span class="math inline">\(\mu, \sigma\)</span>.</p><h2 id="改进">改进</h2><p>为了方便求导，避免大量的连乘项，由于对数函数<span class="math inline">\(\ln\)</span>是单调递增函数，所以<span class="math inline">\(\ln L(x;\mu,\sigma^2)\)</span>与<span class="math inline">\(L(x;\mu,\sigma^2)\)</span>具有相同的单调性。利用对数函数性质可以化简<span class="math inline">\(\ln L(x;\mu,\sigma^2)\)</span>的连乘项，加了对数符号的似然函数称为对数似然函数。</p><p><span class="math display">\[\ln L(\mu, \sigma^2)=\stackrel{n}{\underset{i=1}\sum}\ln\frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{(x-\mu)^2}{2\sigma^2})\]</span></p><h2 id="应用">应用</h2><h3 id="一推导最小二乘估计">一，推导最小二乘估计</h3><p>【例2】推导线性回归的公式<span class="math inline">\((w^{*},b^{*})={\arg\min}\stackrel{m}{\underset{i=1}{\sum}}(y-wx-b)^2\)</span>.</p><p>对线性回归来说，假设为以下模型：<span class="math inline">\(y = wx + b + \epsilon\)</span></p><p><span class="math inline">\(\epsilon\)</span>为不受控制的随机误差，通常假设其服从正态分布<span class="math inline">\(\epsilon \sim N(0, \sigma^2)\)</span>（中心极限定理）：</p><p><span class="math display">\[p(\epsilon) = \frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{\epsilon}{2\sigma^2})\]</span></p><p>若将<span class="math inline">\(\epsilon\)</span>用<span class="math inline">\(y-(wx+b)\)</span>等价替换可得：</p><p><span class="math display">\[p(y)=\frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{(y-(wx+b))^2}{2\sigma^2})\]</span> 上式显然可以看作<span class="math inline">\(y \sim N(wx+b,\sigma^2)\)</span>，下面用极大似然估计来估算<span class="math inline">\(w\)</span>和<span class="math inline">\(b\)</span>的值，似然函数为：</p><p><span class="math display">\[\ln L(w,b)=\stackrel{m}{\underset{i=1}\sum}\ln\frac{1}{\sqrt{2\pi}\sigma}\exp(-\frac{(y-wx-b)^2}{2\sigma^2}) = m\ln \frac{1}{\sqrt{2\pi}\sigma}-\frac{1}{2\sigma^2}\stackrel{m}{\underset{i=1}{\sum}}(y-wx-b)^2 \]</span> 其中<span class="math inline">\(m, \sigma\)</span>均为常数，所以最大化<span class="math inline">\(\ln L(w, b)\)</span>等于最小化<span class="math inline">\(\stackrel{m}{\underset{i=1}{\sum}}(y-wx-b)^2\)</span>，即</p><p><span class="math display">\[(w^*,b^*)=\underset{(w,b)}{\arg\max}\ln L(w,b) = \underset{(w,b)}{\arg\min}\stackrel{m}{\underset{i=1}{\sum}}(y-wx-b)^2\]</span> 等价于最小二乘估计。</p><h3 id="二解决一元高斯分布的参数估计问题">二，解决一元高斯分布的参数估计问题</h3><p>【例3】对例1中的问题进行精细的求解： <span class="math display">\[\begin{align*}\ln L(\mu, \sigma^2)&amp;=\stackrel{n}{\underset{i=1}\sum}\ln\frac{1}{\sqrt{2\pi}\sigma}\text{exp}(-\frac{(x-\mu)^2}{2\sigma^2})\\&amp;=\stackrel{n}{\underset{i=1}\sum}[\ln\frac{1}{\sqrt{2\pi}}+\ln\frac{1}{\sigma}-\frac{(x-\mu)^2}{2\sigma^2}]\end{align*}\]</span></p><p>设<span class="math inline">\(\mu_m,\sigma_m\)</span>是极大似然估计法得到的估计值。</p><p><span class="math display">\[\begin{align*}\mu_{m}&amp;=\underset{\mu}{\arg\max}\log P(\pmb{x};\theta)\\&amp;=\underset{\mu}{\arg\max}\stackrel{n}{\underset{i=1}\sum}-\frac{(x-\mu)^2}{2\sigma^2}\\&amp;=\underset{\mu}{\arg\min}\stackrel{n}{\underset{i=1}\sum}(x-\mu)^2\end{align*}\]</span></p><p>求导，令导数等于0，得到上述优化问题<span class="math inline">\(\mu\)</span>的极值<span class="math inline">\(\mu_m\)</span>： <span class="math display">\[\begin{align*}\frac{\partial \stackrel{n}{\underset{i=1}\sum}(x-\mu)^2}{\partial \mu}&amp;=\stackrel{n}{\underset{i=1}\sum}-2(x-\mu)\\\stackrel{n}{\underset{i=1}\sum}-2(x-\mu)&amp;=0 \rightarrow \mu_m=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x_i\end{align*}\]</span> 同理，对<span class="math inline">\(\sigma_m\)</span>的求解，也套用同样的思路： <span class="math display">\[\begin{align*}\sigma_{m}&amp;=\underset{\sigma}{\arg\max}\log P(\pmb{x};\theta)\\&amp;=\underset{\sigma}{\arg\max}\stackrel{n}{\underset{i=1}\sum}-\ln\sigma-\frac{(x-\mu)^2}{2\sigma^2}\\&amp;=\underset{\mu}{\arg\min}\stackrel{n}{\underset{i=1}\sum}\ln\sigma+\frac{(x-\mu)^2}{2\sigma^2}\end{align*}\]</span> 求导，令导数等于0，得到上述优化问题<span class="math inline">\(\sigma\)</span>的极值<span class="math inline">\(\sigma_m\)</span>： <span class="math display">\[\begin{align*}\frac{\stackrel{n}{\underset{i=1}\sum}\ln\sigma+\frac{(x-\mu)^2}{2\sigma^2}}{\partial \sigma}&amp;=\stackrel{n}{\underset{i=1}\sum}\frac{1}{\sigma}-(x-\mu_m)^2\frac{2}{\sigma^3}\\\stackrel{n}{\underset{i=1}\sum}\frac{1}{\sigma}-(x-\mu_m)^2\frac{2}{\sigma^3}&amp;=0 \rightarrow \sigma_m^2=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(x-\mu_m)^2\end{align*}\]</span> 其中<span class="math inline">\(\mu_m\)</span>的值是无偏估计<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，而<span class="math inline">\(\sigma_m^2\)</span>的值是有偏估计<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。证明如下：</p><p>假定<span class="math inline">\(\mu,\sigma\)</span>是真实分布，计算估计值的期望，验证估计值是否是无偏的，注意到<span class="math inline">\(x_i\)</span>是独立同分布的，所以和的期望等于期望的和： <span class="math display">\[\begin{align*}\mathbb{E}[\mu_m]&amp;=\mathbb{E}[\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x_i]\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}\mathbb{E}[x_i]\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}\mu\\&amp;=\mu\end{align*}\]</span> 所以对<span class="math inline">\(\mu\)</span>的估计为无偏估计。 <span class="math display">\[\begin{align}\sigma_m^2&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(x-\mu_m)^2=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(x^2-2x\mu_m+\mu_m^2)\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x^2-2(\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x)\mu_m+\mu_m^2)\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x^2-\mu_m^2\end{align}\]</span></p><p><span class="math display">\[\begin{align}\mathbb{E}[\sigma_m^2]&amp;=\mathbb{E}[\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x^2-\mu_m^2]\\&amp;=\mathbb{E}[\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}x^2-\mu^2-(\mu_m^2-\mu^2)]\\&amp;=\mathbb{E}[\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(x^2-\mu^2)]-\mathbb{E}[\mu_m^2-\mu^2]\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(\mathbb{E}[X^2]-(\mathbb{E}[X])^2)-(\mathbb{E}[\mu_m^2]-\mu^2)\\&amp;=\frac{1}{n}\stackrel{n}{\underset{i=1}\sum}(\mathbb{E}[X^2]-(\mathbb{E}[X])^2)-(\mathbb{E}[\mu_m^2]-(\mathbb{E}[\mu_m])^2)\\&amp;=\mathbb{D}[X]-\mathbb{D}[\mu_m]\\&amp;=\sigma^2-\frac{1}{n}\sigma^2=\frac{n-1}{n}\sigma^2\end{align}\]</span></p><p>所以对<span class="math inline">\(\sigma^2\)</span>的估计为有偏估计，其中<span class="math inline">\(\mathbb{E}[\sigma_m^2]=\sigma_m^2=\frac{n-1}{n}\sigma^2\)</span>。对<span class="math inline">\(\sigma^2\)</span>的无偏估计： <span class="math display">\[\sigma^2 \simeq \hat{\sigma}^2=\frac{1}{n-1}\stackrel{n}{\underset{i=1}\sum}(x_i-\mu_m)^2\]</span></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>有偏估计和无偏估计的判断方法，就是计算出估计值的期望，若估计值的期望与实际值相同，则为无偏估计，否则为有偏估计。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p>有偏估计和无偏估计的判断方法，就是计算出估计值的期望，若估计值的期望与实际值相同，则为无偏估计，否则为有偏估计。<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
      
      
      <categories>
          
          <category> 数学 </category>
          
          <category> 概率论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 概率论 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>json语法</title>
      <link href="/2022/02/10/Programming%20Language/json%E8%AF%AD%E6%B3%95/"/>
      <url>/2022/02/10/Programming%20Language/json%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="json-语法规则">JSON 语法规则</h2><p>JSON 语法是 JavaScript 对象表示语法的子集。</p><ul><li>数据在名称/值对中</li><li>数据由逗号分隔</li><li>大括号 {} 保存对象</li><li>中括号 [] 保存数组，数组可以包含多个对象</li></ul><p>名称/值对包括字段名称（在双引号中），后面写一个冒号，然后是值：</p><div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;name&quot;</span> <span class="er">:</span> <span class="er">&quot;redleaves&quot;</span></span></code></pre></div><h2 id="json-数字">JSON 数字</h2><p>JSON 数字可以是整型或者浮点型：</p><div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&#123;</span> <span class="dt">&quot;cost&quot;</span> <span class="fu">:</span> <span class="dv">5</span> <span class="fu">&#125;</span></span></code></pre></div><h2 id="json-对象">JSON 对象</h2><p>JSON 对象在大括号 {} 中书写：</p><div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&#123;</span><span class="er">key1</span> <span class="fu">:</span> <span class="er">value1</span><span class="fu">,</span> <span class="er">key2</span> <span class="fu">:</span> <span class="er">value2</span><span class="fu">,</span> <span class="er">...</span> <span class="er">keyN</span> <span class="fu">:</span> <span class="er">valueN</span> <span class="fu">&#125;</span></span></code></pre></div><h2 id="json-数组">JSON 数组</h2><p>JSON 数组在中括号 [] 中书写：</p><p>数组可包含多个对象：</p><div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&#123;</span> <span class="er">key1</span> <span class="fu">:</span> <span class="er">value1</span><span class="dv">-1</span> <span class="fu">,</span> <span class="er">key2</span><span class="fu">:</span><span class="er">value1</span><span class="dv">-2</span> <span class="fu">&#125;</span><span class="ot">,</span> </span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&#123;</span> <span class="er">key1</span> <span class="fu">:</span> <span class="er">value2</span><span class="dv">-1</span> <span class="fu">,</span> <span class="er">key2</span><span class="fu">:</span><span class="er">value2</span><span class="dv">-2</span> <span class="fu">&#125;</span><span class="ot">,</span> </span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&#123;</span> <span class="er">key1</span> <span class="fu">:</span> <span class="er">value3</span><span class="dv">-1</span> <span class="fu">,</span> <span class="er">key2</span><span class="fu">:</span><span class="er">value3</span><span class="dv">-2</span> <span class="fu">&#125;</span><span class="ot">,</span> </span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&#123;</span> <span class="er">key1</span> <span class="fu">:</span> <span class="er">valueN</span><span class="dv">-1</span> <span class="fu">,</span> <span class="er">key2</span><span class="fu">:</span><span class="er">valueN</span><span class="dv">-2</span> <span class="fu">&#125;</span><span class="ot">,</span> </span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div><h3 id="示例">示例</h3><div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&#123;</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sites&quot;</span><span class="fu">:</span> <span class="ot">[</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&#123;</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;github&quot;</span> <span class="fu">,</span> <span class="dt">&quot;url&quot;</span><span class="fu">:</span><span class="st">&quot;www.github.com&quot;</span> <span class="fu">&#125;</span><span class="ot">,</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&#123;</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;gnu&quot;</span> <span class="fu">,</span> <span class="dt">&quot;url&quot;</span><span class="fu">:</span><span class="st">&quot;www.gnu.org&quot;</span> <span class="fu">&#125;</span><span class="ot">,</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&#123;</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="st">&quot;google&quot;</span> <span class="fu">,</span> <span class="dt">&quot;url&quot;</span><span class="fu">:</span><span class="st">&quot;www.google.com&quot;</span> <span class="fu">&#125;</span><span class="ot">,</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">&#123;</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span><span class="kw">null</span><span class="fu">,</span> <span class="dt">&quot;url&quot;</span><span class="fu">:</span><span class="kw">null</span><span class="fu">&#125;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">&#125;</span></span></code></pre></div><h2 id="python-解析json">Python 解析JSON</h2><div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># json 转字典</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dict_json <span class="op">=</span> json.loads(json_response)</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dict_json)</span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 将字典转换成json字符串</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>str_json <span class="op">=</span>json.dumps(dict_json)</span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(str_json)</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> javascript </tag>
            
            <tag> json </tag>
            
            <tag> 格式化文本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub代码仓库的使用</title>
      <link href="/2022/01/22/Git/github%E6%93%8D%E4%BD%9C/"/>
      <url>/2022/01/22/Git/github%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="申请github-access-token">申请GitHub access token</h2><h3 id="github的安全性更新介绍">GitHub的安全性更新介绍</h3><p>现在的GitHub已经不支持使用用户密码同步Git仓库了。为了提高安全性，GitHub现在使用SSH密钥和用户token两种方式同步Git仓库。SSH密钥方式与之前相同，而现在的token模式操作起来也很简单，所谓token，就是GitHub上生成的具有一定时效性的动态密钥。下面将介绍其生成方法。</p><h3 id="生成token的方法">生成token的方法</h3><ol type="1"><li><p>登录账号，访问GitHub的<a href="https://github.com/settings/profile">个人设置页面</a>，也可点击菜单栏的<strong>settings</strong>选项。</p></li><li><p>访问GitHub的<a href="https://github.com/settings/apps">Developer settings选项页面</a>，也可点击网页左侧菜单栏的<strong>Developer settings</strong>选项。</p></li><li><p>（<strong>可不执行1，2，而直接进行此步骤</strong>）访问Github的<a href="https://github.com/settings/tokens">token设置页面</a>，或（<strong>在执行1，2的基础上</strong>）点击网页左侧菜单栏的<strong>Personal access tokens</strong>选项。</p></li><li><p>点击右边的Generate new token按钮，或直接访问<a href="https://github.com/settings/tokens/new">token生成界面</a>，输入密码。</p></li><li><p>然后进入生成页面，如果不了解token的权限，建议勾选全部选项。</p></li><li><p>记下生成的token，它不会再出现第二次了！</p></li><li><p>大功告成，这样就可以像使用密码一样使用token了。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 编译原理PL语言编译器的扩展（转载）</title>
      <link href="/2021/12/29/Compiler/PL%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95/"/>
      <url>/2021/12/29/Compiler/PL%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<p><a href="https://eto-cyt.blog.csdn.net/article/details/122023035">原文地址</a></p><h2 id="第一关">第一关</h2><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;ptoc.h&quot;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef WIN32</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> _splitpath<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> _makepath<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> _split_whole_name<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>whole_name<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">*Constants</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">*******************************/</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> norw <span class="op">=</span> <span class="dv">25</span><span class="op">;</span>       <span class="co">/* no. of reserved words */</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> txmax <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>     <span class="co">/* length of identifier table */</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> bmax <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>       <span class="co">/* length of block inormation table */</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> arrmax <span class="op">=</span> <span class="dv">30</span><span class="op">;</span>     <span class="co">/* length of array information table */</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> nmax <span class="op">=</span> <span class="dv">6</span><span class="op">;</span>        <span class="co">/* max. no. of digits in numbers */</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> al <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>         <span class="co">/* length of identifiers */</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> amax <span class="op">=</span> <span class="dv">2047</span><span class="op">;</span>     <span class="co">/* maxinum address */</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> levmax <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>      <span class="co">/* maxinum depth of block nesting */</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> cxmax <span class="op">=</span> <span class="dv">1000</span><span class="op">;</span>    <span class="co">/* size of code array */</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> min_index1 <span class="op">=</span> <span class="op">-</span><span class="dv">32767</span><span class="op">;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> max_index1 <span class="op">=</span> <span class="op">+</span><span class="dv">32767</span><span class="op">;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************/</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">*Enums</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">*******************************/</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> symbol <span class="op">&#123;</span>nul<span class="op">,</span> ident<span class="op">,</span> intcon<span class="op">,</span> charcon<span class="op">,</span> plus<span class="op">,</span> minus<span class="op">,</span> times<span class="op">,</span> divsym<span class="op">,</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> leq<span class="op">,</span> gtr<span class="op">,</span> geq<span class="op">,</span> ofsym<span class="op">,</span> arraysym<span class="op">,</span> programsym<span class="op">,</span> modsym<span class="op">,</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            andsym<span class="op">,</span> orsym<span class="op">,</span> notsym<span class="op">,</span> lbrack<span class="op">,</span> rbrack<span class="op">,</span> lparen<span class="op">,</span> rparen<span class="op">,</span> comma<span class="op">,</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>            semicolon<span class="op">,</span> period<span class="op">,</span> becomes<span class="op">,</span> colon<span class="op">,</span> beginsym<span class="op">,</span>  endsym<span class="op">,</span> ifsym<span class="op">,</span> thensym<span class="op">,</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            elsesym<span class="op">,</span> whilesym<span class="op">,</span> downtosym<span class="op">,</span>tosym<span class="op">,</span>repeatsym<span class="op">,</span> untilsym <span class="op">,</span>forsym <span class="op">,</span> casesym <span class="op">,</span> dosym<span class="op">,</span> callsym<span class="op">,</span> constsym<span class="op">,</span> typesym<span class="op">,</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            varsym<span class="op">,</span> procsym<span class="op">,</span> last_symbol</span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;;</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> oobject <span class="op">&#123;</span>konstant<span class="op">,</span> typel<span class="op">,</span> variable<span class="op">,</span> prosedure<span class="op">,</span> last_oobject<span class="op">&#125;;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> types <span class="op">&#123;</span>notyp<span class="op">,</span> ints<span class="op">,</span> chars<span class="op">,</span> bool_<span class="op">,</span> arrays<span class="op">,</span> last_types<span class="op">&#125;;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> opcod <span class="op">&#123;</span>lit<span class="op">,</span> lod<span class="op">,</span> ilod<span class="op">,</span> loda<span class="op">,</span> lodt<span class="op">,</span> sto<span class="op">,</span> lodb<span class="op">,</span> cpyb<span class="op">,</span> jmp<span class="op">,</span> jpc<span class="op">,</span> red<span class="op">,</span> wrt<span class="op">,</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        cal<span class="op">,</span> retp<span class="op">,</span> endp<span class="op">,</span> udis<span class="op">,</span> opac<span class="op">,</span> entp<span class="op">,</span> ands<span class="op">,</span> ors<span class="op">,</span> nots<span class="op">,</span> imod<span class="op">,</span> mus<span class="op">,</span> add<span class="op">,</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        sub<span class="op">,</span> mult<span class="op">,</span> idiv<span class="op">,</span> eq<span class="op">,</span> ne<span class="op">,</span> ls<span class="op">,</span> le<span class="op">,</span> gt<span class="op">,</span> ge<span class="op">,</span> last_opcod</span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;;</span>  <span class="co">/* opration code */</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************/</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">*Structures</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">*******************************/</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> varying_string<span class="op">&lt;</span>al<span class="op">&gt;</span> alfa<span class="op">;</span><span class="co">/*String with length al*/</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">short</span> index1<span class="op">;</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> set_of_enum<span class="op">(</span>symbol<span class="op">)</span> symset<span class="op">;</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> instruction</span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>opcod f<span class="op">;</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> l<span class="op">;</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">short</span> a<span class="op">;</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> item</span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>types typ<span class="op">;</span></span><span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ref<span class="op">;</span></span><span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> A1</span><span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>alfa name<span class="op">;</span></span><span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>oobject kind<span class="op">;</span></span><span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>types typ<span class="op">;</span></span><span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> lev<span class="op">;</span></span><span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>boolean normal<span class="op">;</span></span><span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>index1 ref<span class="op">;</span></span><span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>index1 link<span class="op">;</span></span><span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span></span><span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> adr<span class="op">;</span></span><span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span><span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span><span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span><span class="co">//Elements of nametab</span></span><span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> A2</span><span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>types inxtyp<span class="op">,</span> eltyp<span class="op">;</span></span><span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>index1 elref<span class="op">,</span> low<span class="op">,</span> high<span class="op">,</span> elsize<span class="op">,</span> size<span class="op">;</span></span><span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span><span class="co">//Elements of atab</span></span><span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> B1</span><span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>index1 last<span class="op">,</span> lastpar<span class="op">,</span> psize<span class="op">,</span> vsize<span class="op">;</span></span><span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span><span class="co">//Elements of btab</span></span><span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> constrec</span><span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>types tp<span class="op">;</span></span><span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span><span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************</span></span><span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a><span class="co">*Global variables</span></span><span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co">*******************************/</span></span><span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> ch<span class="op">;</span>           <span class="co">/* last character read */</span></span><span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>symbol sym<span class="op">;</span>        <span class="co">/* last symbol read*/</span></span><span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>alfa id<span class="op">;</span>           <span class="co">/* last identifier read*/</span></span><span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> num<span class="op">;</span>       <span class="co">/* last number read */</span></span><span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cc<span class="op">;</span>        <span class="co">/* character count */</span></span><span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ll<span class="op">;</span>        <span class="co">/* line length */</span></span><span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> kk<span class="op">,</span> err<span class="op">;</span></span><span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>varying_string<span class="op">&lt;</span><span class="dv">81</span><span class="op">&gt;</span> line<span class="op">;</span></span><span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>alfa a<span class="op">;</span></span><span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span><span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> norw<span class="op">,</span> alfa<span class="op">&gt;</span> word1<span class="op">;</span></span><span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> norw<span class="op">,</span> symbol<span class="op">&gt;</span> wsym<span class="op">;</span></span><span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>array <span class="op">&lt;</span> <span class="op">-</span><span class="dv">128</span><span class="op">,</span> <span class="dv">127</span><span class="op">,</span> symbol <span class="op">&gt;</span> ssym<span class="op">;</span></span><span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> last_opcod<span class="op">,</span> varying_string<span class="op">&lt;</span><span class="dv">5</span><span class="op">&gt;</span> <span class="op">&gt;</span> mnemonic<span class="op">;</span></span><span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>symset declbegsys<span class="op">,</span> statbegsys<span class="op">,</span> facbegsys<span class="op">,</span> constbegsys<span class="op">,</span> typebegsys<span class="op">;</span></span><span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> txmax<span class="op">,</span> A1<span class="op">&gt;</span> nametab<span class="op">;</span><span class="co">/* name table */</span></span><span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tx<span class="op">;</span>             <span class="co">/* index of nametab*/</span></span><span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> amax<span class="op">,</span> A2<span class="op">&gt;</span> atab<span class="op">;</span><span class="co">/* array information table */</span></span><span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ax<span class="op">;</span>             <span class="co">/*index of atab */</span></span><span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> bmax<span class="op">,</span> B1<span class="op">&gt;</span> btab<span class="op">;</span><span class="co">/* block information table */</span></span><span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bx<span class="op">;</span>                 <span class="co">/* index of btab */</span></span><span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> levmax<span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> display<span class="op">;</span></span><span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> cxmax<span class="op">,</span> instruction<span class="op">&gt;</span> code<span class="op">;</span></span><span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cx<span class="op">;</span>          <span class="co">/* code allocation index */</span></span><span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> labtab<span class="op">;</span></span><span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lx<span class="op">;</span></span><span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>text sfile<span class="op">;</span>       <span class="co">/* source program file */</span></span><span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>string sfile_buff<span class="op">;</span></span><span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> sfilename<span class="op">[</span>_MAX_PATH<span class="op">];</span> <span class="co">/* source program file name */</span></span><span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>file<span class="op">&lt;</span>instruction<span class="op">&gt;</span> fcode<span class="op">;</span></span><span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>file<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> labfile<span class="op">;</span></span><span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>text listfile<span class="op">;</span></span><span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>string listfile_buff<span class="op">;</span></span><span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> listfilename<span class="op">[</span>_MAX_PATH<span class="op">];</span></span><span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> dir<span class="op">[</span>_MAX_DIR<span class="op">];</span></span><span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> name<span class="op">[</span>_MAX_FNAME<span class="op">];</span></span><span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> ext<span class="op">[</span>_MAX_EXT<span class="op">];</span></span><span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a><span class="co">/*********************************************************/</span></span><span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************</span></span><span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a><span class="co">*Function Decalarations</span></span><span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a><span class="co">*******************************/</span></span><span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> initial<span class="op">();</span></span><span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterpreid<span class="op">();</span></span><span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enter<span class="op">(</span>alfa x0<span class="op">,</span> oobject x1<span class="op">,</span> types x2<span class="op">,</span> <span class="dt">int</span> x3<span class="op">);</span></span><span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> error<span class="op">(</span><span class="dt">int</span> n<span class="op">);</span></span><span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> getch<span class="op">();</span></span><span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> getsym<span class="op">();</span></span><span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterarray <span class="op">(</span>types tp <span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> h<span class="op">);</span></span><span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterblock<span class="op">();</span></span><span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> gen<span class="op">(</span>opcod x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> z<span class="op">);</span></span><span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test<span class="op">(</span>symset s1<span class="op">,</span> symset s2<span class="op">,</span> <span class="dt">int</span> n<span class="op">);</span></span><span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> block<span class="op">(</span> symset fsys<span class="op">,</span> <span class="dt">int</span> level<span class="op">);</span></span><span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enter1<span class="op">(</span> oobject k<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> position<span class="op">(</span>alfa id<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> constant<span class="op">(</span>symset fsys<span class="op">,</span> constrec <span class="op">&amp;</span>c<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arraytyp<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>aref<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>arsz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> paramenterlist<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">);</span></span><span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> constdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> typedeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vardeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">);</span></span><span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> procdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> listcode<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx0<span class="op">);</span></span><span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> statement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> expression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> simpleexpression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> repeatstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> term<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> factor<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> assignment<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ifstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">);</span></span><span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> compound<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> whilestatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">);</span></span><span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> stanproc<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> call<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fsplit<span class="op">(</span>string sfilename<span class="op">,</span> string dir<span class="op">,</span> string name<span class="op">,</span> string ext<span class="op">);</span></span><span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a><span class="co">/*******************************/</span></span><span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> initial<span class="op">()</span></span><span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;and       &quot;</span><span class="op">;</span></span><span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;array     &quot;</span><span class="op">;</span></span><span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;begin     &quot;</span><span class="op">;</span></span><span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;call      &quot;</span><span class="op">;</span></span><span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;case      &quot;</span><span class="op">;</span></span><span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;const     &quot;</span><span class="op">;</span></span><span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;do        &quot;</span><span class="op">;</span></span><span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">8</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;downto    &quot;</span><span class="op">;</span></span><span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span> <span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;else      &quot;</span><span class="op">;</span></span><span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;end       &quot;</span><span class="op">;</span></span><span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;for       &quot;</span><span class="op">;</span></span><span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">12</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;if        &quot;</span><span class="op">;</span></span><span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">13</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;mod       &quot;</span><span class="op">;</span></span><span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;not       &quot;</span><span class="op">;</span></span><span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">15</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;of        &quot;</span><span class="op">;</span></span><span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;or        &quot;</span><span class="op">;</span></span><span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">17</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;procedure &quot;</span><span class="op">;</span></span><span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">18</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;program   &quot;</span><span class="op">;</span></span><span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">19</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;repeat    &quot;</span><span class="op">;</span></span><span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">20</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;then      &quot;</span><span class="op">;</span></span><span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">21</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;to        &quot;</span><span class="op">;</span></span><span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">22</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;type      &quot;</span><span class="op">;</span></span><span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">23</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;until     &quot;</span><span class="op">;</span></span><span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">24</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;var       &quot;</span><span class="op">;</span></span><span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>word1<span class="op">[</span><span class="dv">25</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;while     &quot;</span><span class="op">;</span></span><span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> andsym<span class="op">;</span></span><span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> arraysym<span class="op">;</span></span><span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">3</span><span class="op">]</span> <span class="op">=</span> beginsym<span class="op">;</span></span><span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">4</span><span class="op">]</span> <span class="op">=</span> callsym<span class="op">;</span></span><span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">5</span><span class="op">]</span> <span class="op">=</span> casesym<span class="op">;</span></span><span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">6</span><span class="op">]</span> <span class="op">=</span> constsym<span class="op">;</span></span><span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">7</span><span class="op">]</span> <span class="op">=</span> dosym<span class="op">;</span></span><span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">8</span><span class="op">]</span> <span class="op">=</span> downtosym<span class="op">;</span></span><span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span> <span class="dv">9</span><span class="op">]</span> <span class="op">=</span> elsesym<span class="op">;</span></span><span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> endsym<span class="op">;</span></span><span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="op">=</span> forsym<span class="op">;</span></span><span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">12</span><span class="op">]</span> <span class="op">=</span> ifsym<span class="op">;</span></span><span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">13</span><span class="op">]</span> <span class="op">=</span> modsym<span class="op">;</span></span><span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> notsym<span class="op">;</span></span><span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">15</span><span class="op">]</span> <span class="op">=</span> ofsym<span class="op">;</span></span><span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="op">=</span> orsym<span class="op">;</span></span><span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">17</span><span class="op">]</span> <span class="op">=</span> procsym<span class="op">;</span></span><span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">18</span><span class="op">]</span> <span class="op">=</span> programsym<span class="op">;</span></span><span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">19</span><span class="op">]</span> <span class="op">=</span> repeatsym<span class="op">;</span></span><span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">20</span><span class="op">]</span> <span class="op">=</span> thensym<span class="op">;</span></span><span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">21</span><span class="op">]</span> <span class="op">=</span> tosym<span class="op">;</span></span><span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">22</span><span class="op">]</span> <span class="op">=</span> typesym<span class="op">;</span></span><span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">23</span><span class="op">]</span> <span class="op">=</span> untilsym<span class="op">;</span></span><span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">24</span><span class="op">]</span> <span class="op">=</span> varsym<span class="op">;</span></span><span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>wsym<span class="op">[</span><span class="dv">25</span><span class="op">]</span> <span class="op">=</span> whilesym<span class="op">;</span></span><span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;+&#39;</span><span class="op">]</span> <span class="op">=</span> plus<span class="op">;</span></span><span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;-&#39;</span><span class="op">]</span> <span class="op">=</span> minus<span class="op">;</span></span><span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;*&#39;</span><span class="op">]</span> <span class="op">=</span> times<span class="op">;</span></span><span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;/&#39;</span><span class="op">]</span> <span class="op">=</span> divsym<span class="op">;</span></span><span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;[&#39;</span><span class="op">]</span> <span class="op">=</span> lbrack<span class="op">;</span></span><span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;]&#39;</span><span class="op">]</span> <span class="op">=</span> rbrack<span class="op">;</span></span><span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;(&#39;</span><span class="op">]</span> <span class="op">=</span> lparen<span class="op">;</span></span><span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;)&#39;</span><span class="op">]</span> <span class="op">=</span> rparen<span class="op">;</span></span><span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;=&#39;</span><span class="op">]</span> <span class="op">=</span> eql<span class="op">;</span></span><span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;,&#39;</span><span class="op">]</span> <span class="op">=</span> comma<span class="op">;</span></span><span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;.&#39;</span><span class="op">]</span> <span class="op">=</span> period<span class="op">;</span></span><span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;&lt;&#39;</span><span class="op">]</span> <span class="op">=</span> lss<span class="op">;</span></span><span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;&gt;&#39;</span><span class="op">]</span> <span class="op">=</span> gtr<span class="op">;</span></span><span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>ssym<span class="op">[</span><span class="ch">&#39;;&#39;</span><span class="op">]</span> <span class="op">=</span> semicolon<span class="op">;</span></span><span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>lit<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LIT  &quot;</span><span class="op">;</span></span><span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>lod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LOD  &quot;</span><span class="op">;</span></span><span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>sto<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;STO  &quot;</span><span class="op">;</span></span><span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>cal<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;CAL  &quot;</span><span class="op">;</span></span><span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>jmp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;JMP  &quot;</span><span class="op">;</span></span><span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>jpc<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;JPC  &quot;</span><span class="op">;</span></span><span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>red<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;RED  &quot;</span><span class="op">;</span></span><span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>wrt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;WRT  &quot;</span><span class="op">;</span></span><span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ilod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ILOD  &quot;</span><span class="op">;</span></span><span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>loda<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODA &quot;</span><span class="op">;</span></span><span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>lodt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODt  &quot;</span><span class="op">;</span></span><span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>lodb<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODB &quot;</span><span class="op">;</span></span><span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>cpyb<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;COPYB &quot;</span><span class="op">;</span></span><span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>endp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ENDP &quot;</span><span class="op">;</span></span><span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>retp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;RETP  &quot;</span><span class="op">;</span></span><span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>udis<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ADIS &quot;</span><span class="op">;</span></span><span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>mus<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;MUS  &quot;</span><span class="op">;</span></span><span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>add<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ADD &quot;</span><span class="op">;</span></span><span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>sub<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;SUB  &quot;</span><span class="op">;</span></span><span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>mult<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;MULT &quot;</span><span class="op">;</span></span><span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>idiv<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;DDIV  &quot;</span><span class="op">;</span></span><span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>eq<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;EQ  &quot;</span><span class="op">;</span></span><span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ne<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;NE &quot;</span><span class="op">;</span></span><span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ls<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LS  &quot;</span><span class="op">;</span></span><span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>le<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LE &quot;</span><span class="op">;</span></span><span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>gt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;GT  &quot;</span><span class="op">;</span></span><span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ge<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;GE &quot;</span><span class="op">;</span></span><span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>opac<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;OPAC &quot;</span><span class="op">;</span></span><span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>entp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ENTP&quot;</span><span class="op">;</span></span><span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>imod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;IMOD &quot;</span><span class="op">;</span></span><span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ands<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ANDS&quot;</span><span class="op">;</span></span><span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>ors<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ORS &quot;</span><span class="op">;</span></span><span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>mnemonic<span class="op">[</span>nots<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;NOTS&quot;</span><span class="op">;</span></span><span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>declbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>constsym<span class="op">,</span> varsym<span class="op">,</span> typesym<span class="op">,</span> procsym<span class="op">,</span> eos<span class="op">);</span></span><span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>statbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>beginsym<span class="op">,</span> callsym<span class="op">,</span>casesym<span class="op">,</span> ifsym<span class="op">,</span> whilesym<span class="op">,</span>repeatsym<span class="op">,</span> forsym<span class="op">,</span>eos<span class="op">);</span></span><span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>facbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> intcon<span class="op">,</span> lparen<span class="op">,</span> notsym<span class="op">,</span> charcon<span class="op">,</span> eos<span class="op">);</span></span><span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>typebegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> arraysym<span class="op">,</span> eos<span class="op">);</span></span><span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>constbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> intcon<span class="op">,</span> charcon<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">);</span></span><span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>err <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>a<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> &#39;\<span class="dv">12</span><span class="er">&#39;</span><span class="op">;</span><span class="co">// What is \12 LosPhoenix</span></span><span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>display<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>cc <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>cx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>ll <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>ch <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>kk <span class="op">=</span> al<span class="op">;</span></span><span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>bx <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>lx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*init*/</span></span><span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enter<span class="op">(</span>alfa x0<span class="op">,</span> oobject x1<span class="op">,</span> types x2<span class="op">,</span> <span class="dt">int</span> x3<span class="op">)</span></span><span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>tx <span class="op">=</span> tx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>name <span class="op">=</span> x0<span class="op">;</span></span><span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>link <span class="op">=</span> tx <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>kind <span class="op">=</span> x1<span class="op">;</span></span><span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> x2<span class="op">;</span></span><span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>lev <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>tx<span class="op">].</span>kind<span class="op">)</span></span><span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> x3<span class="op">;</span></span><span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> x3<span class="op">;</span></span><span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> x3<span class="op">;</span></span><span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*enter*/</span></span><span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterpreid<span class="op">()</span><span class="co">// Only at the begining. Init nametable and btab</span></span><span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;          &quot;</span><span class="op">,</span> variable<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">0</span><span class="op">);</span>    <span class="co">/* sentinel */</span></span><span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;char      &quot;</span><span class="op">,</span> typel<span class="op">,</span> chars<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;integer   &quot;</span><span class="op">,</span> typel<span class="op">,</span> ints<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;boolean   &quot;</span><span class="op">,</span> typel<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;false     &quot;</span><span class="op">,</span> konstant<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">0</span><span class="op">);</span></span><span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;true      &quot;</span><span class="op">,</span> konstant<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;read      &quot;</span><span class="op">,</span> prosedure<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>enter<span class="op">(</span><span class="st">&quot;write     &quot;</span><span class="op">,</span> prosedure<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span><span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>last <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>lastpar <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>psize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>vsize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*enterprid*/</span></span><span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> error<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span></span><span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>listfile <span class="op">&lt;&lt;</span> <span class="st">&quot;****&quot;</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span><span class="ch">&#39; &#39;</span><span class="op">,</span> cc <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;^&#39;</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>n<span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>err <span class="op">=</span> err <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>output <span class="op">&lt;&lt;</span> <span class="st">&quot;Error&quot;</span> <span class="op">&lt;&lt;</span> n <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* error */</span></span><span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> getch<span class="op">()</span></span><span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>cc <span class="op">==</span> ll<span class="op">)</span>   <span class="co">/* get character to end of line *//* read next line */</span></span><span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>eof<span class="op">(</span>sfile<span class="op">))</span></span><span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;program incomplete&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    listfile <span class="op">&lt;&lt;</span> format<span class="op">(</span>cx<span class="op">,</span> <span class="dv">4</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39; &#39;</span><span class="op">;</span>   <span class="co">/*print code address */</span></span><span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span> eoln<span class="op">(</span>sfile<span class="op">))</span></span><span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>        ll <span class="op">=</span> ll <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>        sfile <span class="op">&gt;&gt;</span> ch<span class="op">;</span></span><span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>        listfile <span class="op">&lt;&lt;</span> ch<span class="op">;</span></span><span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>        line<span class="op">[</span>ll<span class="op">]</span> <span class="op">=</span> ch<span class="op">;</span></span><span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>    listfile <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>    sfile <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> ll <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>    line<span class="op">[</span>ll<span class="op">]</span> <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span> <span class="co">/*process end-line*/</span></span><span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>cc <span class="op">=</span> cc <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>ch <span class="op">=</span> line<span class="op">[</span>cc<span class="op">];</span></span><span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a><span class="co">//output &lt;&lt; ch;//test</span></span><span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* getch */</span></span><span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> getsym<span class="op">()</span><span class="co">/*getsym*/</span></span><span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">,</span> k<span class="op">,</span> j<span class="op">;</span></span><span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a><span class="co">/*Why is there a goto in this code. LosPhoenix*/</span></span><span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>L1<span class="op">:</span></span><span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39; &#39;</span><span class="op">)</span></span><span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> <span class="op">(</span>ch<span class="op">)</span></span><span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;a&#39;</span><span class="op">:</span></span><span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;b&#39;</span><span class="op">:</span></span><span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;c&#39;</span><span class="op">:</span></span><span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;d&#39;</span><span class="op">:</span></span><span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;e&#39;</span><span class="op">:</span></span><span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;f&#39;</span><span class="op">:</span></span><span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;g&#39;</span><span class="op">:</span></span><span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;h&#39;</span><span class="op">:</span></span><span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;i&#39;</span><span class="op">:</span></span><span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;j&#39;</span><span class="op">:</span></span><span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;k&#39;</span><span class="op">:</span></span><span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;l&#39;</span><span class="op">:</span></span><span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;m&#39;</span><span class="op">:</span></span><span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;n&#39;</span><span class="op">:</span></span><span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;o&#39;</span><span class="op">:</span></span><span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;p&#39;</span><span class="op">:</span></span><span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;q&#39;</span><span class="op">:</span></span><span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;r&#39;</span><span class="op">:</span></span><span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;s&#39;</span><span class="op">:</span></span><span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;t&#39;</span><span class="op">:</span></span><span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;u&#39;</span><span class="op">:</span></span><span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;v&#39;</span><span class="op">:</span></span><span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;w&#39;</span><span class="op">:</span></span><span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;x&#39;</span><span class="op">:</span></span><span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;y&#39;</span><span class="op">:</span></span><span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;z&#39;</span><span class="op">:</span></span><span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* identifier or reserved word */</span></span><span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>k <span class="op">&lt;</span> al<span class="op">)</span></span><span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>k<span class="op">]</span> <span class="op">=</span> ch<span class="op">;</span></span><span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>set<span class="op">::</span>of<span class="op">(</span>range<span class="op">(</span><span class="ch">&#39;a&#39;</span><span class="op">,</span> <span class="ch">&#39;z&#39;</span><span class="op">),</span> range<span class="op">(</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> <span class="ch">&#39;9&#39;</span><span class="op">),</span> eos<span class="op">).</span>has<span class="op">(</span>ch<span class="op">)));</span></span><span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>k <span class="op">&gt;=</span> kk<span class="op">)</span></span><span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>            kk <span class="op">=</span> k<span class="op">;</span>    <span class="co">/* kk: last identifier length */</span></span><span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>            a<span class="op">[</span>kk<span class="op">]</span> <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>            kk <span class="op">=</span> kk <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>kk <span class="op">==</span> k<span class="op">));</span></span><span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> a<span class="op">;</span></span><span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> norw<span class="op">;</span>  <span class="co">/* binary search reserved word table */</span></span><span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> j<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>id <span class="op">&lt;=</span> word1<span class="op">[</span>k<span class="op">])</span>  j <span class="op">=</span> k <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>id <span class="op">&gt;=</span> word1<span class="op">[</span>k<span class="op">])</span>  i <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!(</span>i <span class="op">&gt;</span> j<span class="op">));</span></span><span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span> <span class="op">&gt;</span> j<span class="op">)</span></span><span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> wsym<span class="op">[</span>k<span class="op">];</span></span><span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> ident<span class="op">;</span></span><span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;0&#39;</span><span class="op">:</span></span><span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;1&#39;</span><span class="op">:</span></span><span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;2&#39;</span><span class="op">:</span></span><span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;3&#39;</span><span class="op">:</span></span><span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;4&#39;</span><span class="op">:</span></span><span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;5&#39;</span><span class="op">:</span></span><span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;6&#39;</span><span class="op">:</span></span><span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;7&#39;</span><span class="op">:</span></span><span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;8&#39;</span><span class="op">:</span></span><span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;9&#39;</span><span class="op">:</span></span><span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* number */</span></span><span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>    sym <span class="op">=</span> intcon<span class="op">;</span></span><span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>        num <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> num <span class="op">+</span> <span class="op">(</span>ch <span class="op">-</span> <span class="ch">&#39;0&#39;</span><span class="op">);</span></span><span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>set<span class="op">::</span>of<span class="op">(</span>range<span class="op">(</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> <span class="ch">&#39;9&#39;</span><span class="op">),</span> eos<span class="op">).</span>has<span class="op">(</span>ch<span class="op">)));</span></span><span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>k <span class="op">&gt;</span> nmax<span class="op">)</span>  error<span class="op">(</span><span class="dv">47</span><span class="op">);</span></span><span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;:&#39;</span><span class="op">:</span></span><span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> becomes<span class="op">;</span></span><span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> sym <span class="op">=</span> colon<span class="op">;</span></span><span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;&lt;&#39;</span> <span class="op">:</span></span><span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> leq<span class="op">;</span></span><span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;&gt;&#39;</span><span class="op">)</span></span><span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> neq<span class="op">;</span></span><span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> sym <span class="op">=</span> lss<span class="op">;</span></span><span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;&gt;&#39;</span> <span class="op">:</span></span><span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> geq<span class="op">;</span></span><span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> sym <span class="op">=</span> gtr<span class="op">;</span></span><span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;.&#39;</span> <span class="op">:</span></span><span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;.&#39;</span><span class="op">)</span></span><span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> colon<span class="op">;</span></span><span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>   sym <span class="op">=</span> period<span class="op">;</span></span><span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;\&#39;&#39;</span>  <span class="op">:</span></span><span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a>    sym <span class="op">=</span> charcon<span class="op">;</span></span><span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> ch<span class="op">;</span></span><span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;\&#39;&#39;</span><span class="op">)</span>  getch<span class="op">();</span></span><span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">48</span><span class="op">);</span></span><span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;+&#39;</span><span class="op">:</span></span><span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;-&#39;</span><span class="op">:</span></span><span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;*&#39;</span><span class="op">:</span></span><span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;/&#39;</span><span class="op">:</span></span><span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;(&#39;</span><span class="op">:</span></span><span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;)&#39;</span><span class="op">:</span></span><span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;=&#39;</span><span class="op">:</span></span><span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;[&#39;</span><span class="op">:</span></span><span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;]&#39;</span><span class="op">:</span></span><span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;;&#39;</span><span class="op">:</span></span><span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="ch">&#39;,&#39;</span><span class="op">:</span></span><span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>    sym <span class="op">=</span> ssym<span class="op">[</span>ch<span class="op">];</span></span><span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a><span class="cf">break</span><span class="op">;</span></span><span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a><span class="cf">default</span><span class="op">:</span></span><span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a>    getch<span class="op">();</span></span><span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> L1<span class="op">;</span></span><span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>    <span class="co">/* case */</span></span><span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a><span class="co">//output&lt;&lt;sym&lt;&lt;NL;</span></span><span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* getsym */</span></span><span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterarray <span class="op">(</span>types tp <span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> h<span class="op">)</span></span><span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>l <span class="op">&gt;</span> h<span class="op">)</span>  error<span class="op">(</span><span class="dv">14</span><span class="op">);</span></span><span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ax <span class="op">==</span> amax<span class="op">)</span></span><span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;too many arrays in program &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span><span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> ax <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a>        <span class="co">//A2 &amp;with = atab[ax];</span></span><span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>tx<span class="op">].</span>inxtyp <span class="op">=</span> tp<span class="op">;</span></span><span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>tx<span class="op">].</span>low <span class="op">=</span> l<span class="op">;</span></span><span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>tx<span class="op">].</span>high <span class="op">=</span> h<span class="op">;</span></span><span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* enterarray */</span></span><span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enterblock<span class="op">()</span></span><span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>bx <span class="op">==</span> bmax<span class="op">)</span></span><span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;too many procedure in program &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span><span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>    bx <span class="op">=</span> bx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span>bx<span class="op">].</span>last <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span>bx<span class="op">].</span>lastpar <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* enterblock */</span></span><span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> gen<span class="op">(</span>opcod x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> z<span class="op">)</span></span><span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>cx <span class="op">&gt;</span> cxmax<span class="op">)</span></span><span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">49</span><span class="op">);</span></span><span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;program too long&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span><span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a>    <span class="co">//instruction &amp;with = code[cx];</span></span><span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx<span class="op">].</span>f <span class="op">=</span> x<span class="op">;</span></span><span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx<span class="op">].</span>l <span class="op">=</span> y<span class="op">;</span></span><span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx<span class="op">].</span>a <span class="op">=</span> z<span class="op">;</span></span><span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a>cx <span class="op">=</span> cx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* gen */</span></span><span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test<span class="op">(</span>symset s1<span class="op">,</span> symset s2<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span></span><span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span> <span class="op">(</span>s1<span class="op">.</span>has<span class="op">(</span>sym<span class="op">)))</span></span><span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span>n<span class="op">);</span></span><span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a>    s1 <span class="op">=</span> s1 <span class="op">+</span> s2<span class="op">;</span></span><span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span> <span class="op">(</span>s1<span class="op">.</span>has<span class="op">(</span>sym<span class="op">)))</span></span><span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* test */</span></span><span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enter1<span class="op">(</span> oobject k<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> j<span class="op">,</span> l<span class="op">;</span></span><span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>tx <span class="op">==</span> txmax<span class="op">)</span></span><span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;program too long&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span><span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> btab<span class="op">[</span>display<span class="op">[</span>level<span class="op">]].</span>last<span class="op">;</span></span><span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> j<span class="op">;</span></span><span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>nametab<span class="op">[</span>j<span class="op">].</span>name <span class="op">!=</span> id<span class="op">)</span>  j <span class="op">=</span> nametab<span class="op">[</span>j<span class="op">].</span>link<span class="op">;</span></span><span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>j <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span>l<span class="op">);</span></span><span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a>        tx <span class="op">=</span> tx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A1 &amp;with = nametab[tx];</span></span><span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>link <span class="op">=</span> l<span class="op">;</span></span><span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>kind <span class="op">=</span> k<span class="op">;</span></span><span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> false<span class="op">;</span></span><span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>tx<span class="op">].</span>kind<span class="op">)</span></span><span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span>    <span class="co">/* initial value */</span></span><span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a>        btab<span class="op">[</span>display<span class="op">[</span>level<span class="op">]].</span>last <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-711"><a href="#cb1-711" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* enter */</span></span><span id="cb1-712"><a href="#cb1-712" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-713"><a href="#cb1-713" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> position<span class="op">(</span>alfa id<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-714"><a href="#cb1-714" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-715"><a href="#cb1-715" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">,</span> j<span class="op">;</span></span><span id="cb1-716"><a href="#cb1-716" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-717"><a href="#cb1-717" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> position_result<span class="op">;</span></span><span id="cb1-718"><a href="#cb1-718" aria-hidden="true" tabindex="-1"></a>nametab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb1-719"><a href="#cb1-719" aria-hidden="true" tabindex="-1"></a>j <span class="op">=</span> level<span class="op">;</span></span><span id="cb1-720"><a href="#cb1-720" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span><span id="cb1-721"><a href="#cb1-721" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-722"><a href="#cb1-722" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> btab<span class="op">[</span>display<span class="op">[</span>j<span class="op">]].</span>last<span class="op">;</span></span><span id="cb1-723"><a href="#cb1-723" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>name <span class="op">!=</span> id<span class="op">)</span></span><span id="cb1-724"><a href="#cb1-724" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>link<span class="op">;</span></span><span id="cb1-725"><a href="#cb1-725" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> j <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-726"><a href="#cb1-726" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-727"><a href="#cb1-727" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(!((</span>j <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>i <span class="op">!=</span> <span class="dv">0</span><span class="op">)));</span></span><span id="cb1-728"><a href="#cb1-728" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb1-729"><a href="#cb1-729" aria-hidden="true" tabindex="-1"></a>position_result <span class="op">=</span> i<span class="op">;</span></span><span id="cb1-730"><a href="#cb1-730" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> position_result<span class="op">;</span></span><span id="cb1-731"><a href="#cb1-731" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* position */</span></span><span id="cb1-732"><a href="#cb1-732" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-733"><a href="#cb1-733" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> constant<span class="op">(</span>symset fsys<span class="op">,</span> constrec <span class="op">&amp;</span>c<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-734"><a href="#cb1-734" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-735"><a href="#cb1-735" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">,</span> sign<span class="op">;</span></span><span id="cb1-736"><a href="#cb1-736" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-737"><a href="#cb1-737" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span>tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-738"><a href="#cb1-738" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-739"><a href="#cb1-739" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>constbegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span><span id="cb1-740"><a href="#cb1-740" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>constbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-741"><a href="#cb1-741" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-742"><a href="#cb1-742" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>   <span class="op">(</span>sym <span class="op">==</span> charcon<span class="op">)</span></span><span id="cb1-743"><a href="#cb1-743" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-744"><a href="#cb1-744" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>tp <span class="op">=</span> chars<span class="op">;</span></span><span id="cb1-745"><a href="#cb1-745" aria-hidden="true" tabindex="-1"></a>        c<span class="op">.</span>i <span class="op">=</span> num<span class="op">;</span></span><span id="cb1-746"><a href="#cb1-746" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-747"><a href="#cb1-747" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-748"><a href="#cb1-748" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-749"><a href="#cb1-749" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-750"><a href="#cb1-750" aria-hidden="true" tabindex="-1"></a>        sign <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-751"><a href="#cb1-751" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-752"><a href="#cb1-752" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-753"><a href="#cb1-753" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> minus<span class="op">)</span>  sign <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb1-754"><a href="#cb1-754" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-755"><a href="#cb1-755" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-756"><a href="#cb1-756" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-757"><a href="#cb1-757" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-758"><a href="#cb1-758" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-759"><a href="#cb1-759" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb1-760"><a href="#cb1-760" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> konstant<span class="op">)</span></span><span id="cb1-761"><a href="#cb1-761" aria-hidden="true" tabindex="-1"></a>                    error<span class="op">(</span><span class="dv">12</span><span class="op">);</span></span><span id="cb1-762"><a href="#cb1-762" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span><span id="cb1-763"><a href="#cb1-763" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-764"><a href="#cb1-764" aria-hidden="true" tabindex="-1"></a>                    c<span class="op">.</span>tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-765"><a href="#cb1-765" aria-hidden="true" tabindex="-1"></a>                    c<span class="op">.</span>i <span class="op">=</span> sign <span class="op">*</span> nametab<span class="op">[</span>x<span class="op">].</span>val<span class="op">;</span></span><span id="cb1-766"><a href="#cb1-766" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-767"><a href="#cb1-767" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-768"><a href="#cb1-768" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-769"><a href="#cb1-769" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-770"><a href="#cb1-770" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> intcon<span class="op">)</span></span><span id="cb1-771"><a href="#cb1-771" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-772"><a href="#cb1-772" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span>tp <span class="op">=</span> ints<span class="op">;</span></span><span id="cb1-773"><a href="#cb1-773" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span>i <span class="op">=</span> sign <span class="op">*</span> num<span class="op">;</span></span><span id="cb1-774"><a href="#cb1-774" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-775"><a href="#cb1-775" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-776"><a href="#cb1-776" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-777"><a href="#cb1-777" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">6</span><span class="op">);</span></span><span id="cb1-778"><a href="#cb1-778" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-779"><a href="#cb1-779" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* constant */</span></span><span id="cb1-780"><a href="#cb1-780" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-781"><a href="#cb1-781" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arraytyp<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>aref<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>arsz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-782"><a href="#cb1-782" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-783"><a href="#cb1-783" aria-hidden="true" tabindex="-1"></a>types eltp<span class="op">;</span></span><span id="cb1-784"><a href="#cb1-784" aria-hidden="true" tabindex="-1"></a>constrec low<span class="op">,</span> high<span class="op">;</span></span><span id="cb1-785"><a href="#cb1-785" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> elrf<span class="op">,</span> elsz<span class="op">;</span></span><span id="cb1-786"><a href="#cb1-786" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-787"><a href="#cb1-787" aria-hidden="true" tabindex="-1"></a>constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span> rbrack<span class="op">,</span> rparen<span class="op">,</span> ofsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> low<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-788"><a href="#cb1-788" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">((</span>low<span class="op">.</span>tp <span class="op">!=</span> ints<span class="op">)</span>  <span class="op">&amp;&amp;</span> <span class="op">(</span>low<span class="op">.</span>tp <span class="op">!=</span> chars<span class="op">))</span></span><span id="cb1-789"><a href="#cb1-789" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">50</span><span class="op">);</span></span><span id="cb1-790"><a href="#cb1-790" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-791"><a href="#cb1-791" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">38</span><span class="op">);</span></span><span id="cb1-792"><a href="#cb1-792" aria-hidden="true" tabindex="-1"></a>constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rbrack<span class="op">,</span> comma<span class="op">,</span> rparen<span class="op">,</span> ofsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> high<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-793"><a href="#cb1-793" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>high<span class="op">.</span>tp <span class="op">!=</span> low<span class="op">.</span>tp<span class="op">)</span></span><span id="cb1-794"><a href="#cb1-794" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-795"><a href="#cb1-795" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-796"><a href="#cb1-796" aria-hidden="true" tabindex="-1"></a>    high<span class="op">.</span>i <span class="op">=</span> low<span class="op">.</span>i<span class="op">;</span></span><span id="cb1-797"><a href="#cb1-797" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-798"><a href="#cb1-798" aria-hidden="true" tabindex="-1"></a>enterarray<span class="op">(</span>low<span class="op">.</span>tp<span class="op">,</span> low<span class="op">.</span>i<span class="op">,</span> high<span class="op">.</span>i<span class="op">);</span></span><span id="cb1-799"><a href="#cb1-799" aria-hidden="true" tabindex="-1"></a>aref <span class="op">=</span> ax<span class="op">;</span></span><span id="cb1-800"><a href="#cb1-800" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb1-801"><a href="#cb1-801" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-802"><a href="#cb1-802" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-803"><a href="#cb1-803" aria-hidden="true" tabindex="-1"></a>    eltp <span class="op">=</span> arrays<span class="op">;</span></span><span id="cb1-804"><a href="#cb1-804" aria-hidden="true" tabindex="-1"></a>    arraytyp<span class="op">(</span>elrf<span class="op">,</span> elsz<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-805"><a href="#cb1-805" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-806"><a href="#cb1-806" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-807"><a href="#cb1-807" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-808"><a href="#cb1-808" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rbrack<span class="op">)</span></span><span id="cb1-809"><a href="#cb1-809" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-810"><a href="#cb1-810" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-811"><a href="#cb1-811" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-812"><a href="#cb1-812" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">28</span><span class="op">);</span></span><span id="cb1-813"><a href="#cb1-813" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-814"><a href="#cb1-814" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-815"><a href="#cb1-815" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ofsym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-816"><a href="#cb1-816" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">17</span><span class="op">);</span></span><span id="cb1-817"><a href="#cb1-817" aria-hidden="true" tabindex="-1"></a>    typ<span class="op">(</span>fsys<span class="op">,</span> eltp<span class="op">,</span> elrf<span class="op">,</span> elsz<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-818"><a href="#cb1-818" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-819"><a href="#cb1-819" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-820"><a href="#cb1-820" aria-hidden="true" tabindex="-1"></a>    <span class="co">//A2 &amp;with = atab[aref];</span></span><span id="cb1-821"><a href="#cb1-821" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-822"><a href="#cb1-822" aria-hidden="true" tabindex="-1"></a>    arsz <span class="op">=</span> <span class="op">(</span>atab<span class="op">[</span>aref<span class="op">].</span>high <span class="op">-</span> atab<span class="op">[</span>aref<span class="op">].</span>low <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> elsz<span class="op">;</span></span><span id="cb1-823"><a href="#cb1-823" aria-hidden="true" tabindex="-1"></a>    atab<span class="op">[</span>aref<span class="op">].</span>size <span class="op">=</span> arsz<span class="op">;</span></span><span id="cb1-824"><a href="#cb1-824" aria-hidden="true" tabindex="-1"></a>    atab<span class="op">[</span>aref<span class="op">].</span>eltyp <span class="op">=</span> eltp<span class="op">;</span></span><span id="cb1-825"><a href="#cb1-825" aria-hidden="true" tabindex="-1"></a>    atab<span class="op">[</span>aref<span class="op">].</span>elref <span class="op">=</span> elrf<span class="op">;</span></span><span id="cb1-826"><a href="#cb1-826" aria-hidden="true" tabindex="-1"></a>    atab<span class="op">[</span>aref<span class="op">].</span>elsize <span class="op">=</span> elsz<span class="op">;</span></span><span id="cb1-827"><a href="#cb1-827" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-828"><a href="#cb1-828" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* arraytyp */</span></span><span id="cb1-829"><a href="#cb1-829" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-830"><a href="#cb1-830" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-831"><a href="#cb1-831" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-832"><a href="#cb1-832" aria-hidden="true" tabindex="-1"></a>types eltp<span class="op">;</span></span><span id="cb1-833"><a href="#cb1-833" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> elrf<span class="op">,</span> x<span class="op">;</span></span><span id="cb1-834"><a href="#cb1-834" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> elsz<span class="op">,</span> offset<span class="op">,</span> t0<span class="op">,</span> t1<span class="op">;</span></span><span id="cb1-835"><a href="#cb1-835" aria-hidden="true" tabindex="-1"></a><span class="co">/* typ */</span></span><span id="cb1-836"><a href="#cb1-836" aria-hidden="true" tabindex="-1"></a>tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-837"><a href="#cb1-837" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-838"><a href="#cb1-838" aria-hidden="true" tabindex="-1"></a>sz <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-839"><a href="#cb1-839" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>typebegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span><span id="cb1-840"><a href="#cb1-840" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>typebegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-841"><a href="#cb1-841" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-842"><a href="#cb1-842" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-843"><a href="#cb1-843" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-844"><a href="#cb1-844" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-845"><a href="#cb1-845" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-846"><a href="#cb1-846" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-847"><a href="#cb1-847" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A1 &amp;with = nametab[x];</span></span><span id="cb1-848"><a href="#cb1-848" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> typel<span class="op">)</span></span><span id="cb1-849"><a href="#cb1-849" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">19</span><span class="op">);</span></span><span id="cb1-850"><a href="#cb1-850" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb1-851"><a href="#cb1-851" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-852"><a href="#cb1-852" aria-hidden="true" tabindex="-1"></a>                tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-853"><a href="#cb1-853" aria-hidden="true" tabindex="-1"></a>                rf <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-854"><a href="#cb1-854" aria-hidden="true" tabindex="-1"></a>                sz <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>size<span class="op">;</span></span><span id="cb1-855"><a href="#cb1-855" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>tp <span class="op">==</span> notyp<span class="op">)</span>  error<span class="op">(</span><span class="dv">18</span><span class="op">);</span></span><span id="cb1-856"><a href="#cb1-856" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-857"><a href="#cb1-857" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-858"><a href="#cb1-858" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-859"><a href="#cb1-859" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-860"><a href="#cb1-860" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> arraysym<span class="op">)</span></span><span id="cb1-861"><a href="#cb1-861" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-862"><a href="#cb1-862" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-863"><a href="#cb1-863" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-864"><a href="#cb1-864" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-865"><a href="#cb1-865" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-866"><a href="#cb1-866" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-867"><a href="#cb1-867" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">16</span><span class="op">);</span></span><span id="cb1-868"><a href="#cb1-868" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb1-869"><a href="#cb1-869" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb1-870"><a href="#cb1-870" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-871"><a href="#cb1-871" aria-hidden="true" tabindex="-1"></a>        tp <span class="op">=</span> arrays<span class="op">;</span></span><span id="cb1-872"><a href="#cb1-872" aria-hidden="true" tabindex="-1"></a>        arraytyp<span class="op">(</span>rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-873"><a href="#cb1-873" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-874"><a href="#cb1-874" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-875"><a href="#cb1-875" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-876"><a href="#cb1-876" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*typ*/</span></span><span id="cb1-877"><a href="#cb1-877" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-878"><a href="#cb1-878" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> paramenterlist<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">)</span>   <span class="co">/*formal parameter list*/</span></span><span id="cb1-879"><a href="#cb1-879" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-880"><a href="#cb1-880" aria-hidden="true" tabindex="-1"></a>types tp<span class="op">;</span></span><span id="cb1-881"><a href="#cb1-881" aria-hidden="true" tabindex="-1"></a>boolean valpar<span class="op">;</span></span><span id="cb1-882"><a href="#cb1-882" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rf<span class="op">,</span> sz<span class="op">,</span> x<span class="op">,</span> t0<span class="op">;</span></span><span id="cb1-883"><a href="#cb1-883" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-884"><a href="#cb1-884" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-885"><a href="#cb1-885" aria-hidden="true" tabindex="-1"></a>tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-886"><a href="#cb1-886" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-887"><a href="#cb1-887" aria-hidden="true" tabindex="-1"></a>sz <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-888"><a href="#cb1-888" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">),</span> fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">),</span> <span class="dv">7</span><span class="op">);</span></span><span id="cb1-889"><a href="#cb1-889" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-890"><a href="#cb1-890" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-891"><a href="#cb1-891" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> varsym<span class="op">)</span></span><span id="cb1-892"><a href="#cb1-892" aria-hidden="true" tabindex="-1"></a>        valpar <span class="op">=</span> true<span class="op">;</span></span><span id="cb1-893"><a href="#cb1-893" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-894"><a href="#cb1-894" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-895"><a href="#cb1-895" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-896"><a href="#cb1-896" aria-hidden="true" tabindex="-1"></a>        valpar <span class="op">=</span> false<span class="op">;</span></span><span id="cb1-897"><a href="#cb1-897" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-898"><a href="#cb1-898" aria-hidden="true" tabindex="-1"></a>    t0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-899"><a href="#cb1-899" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-900"><a href="#cb1-900" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-901"><a href="#cb1-901" aria-hidden="true" tabindex="-1"></a>        enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-902"><a href="#cb1-902" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-903"><a href="#cb1-903" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-904"><a href="#cb1-904" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-905"><a href="#cb1-905" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb1-906"><a href="#cb1-906" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-907"><a href="#cb1-907" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-908"><a href="#cb1-908" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-909"><a href="#cb1-909" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-910"><a href="#cb1-910" aria-hidden="true" tabindex="-1"></a>            enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-911"><a href="#cb1-911" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-912"><a href="#cb1-912" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-913"><a href="#cb1-913" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-914"><a href="#cb1-914" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-915"><a href="#cb1-915" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span></span><span id="cb1-916"><a href="#cb1-916" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-917"><a href="#cb1-917" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-918"><a href="#cb1-918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb1-919"><a href="#cb1-919" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-920"><a href="#cb1-920" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-921"><a href="#cb1-921" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-922"><a href="#cb1-922" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-923"><a href="#cb1-923" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-924"><a href="#cb1-924" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-925"><a href="#cb1-925" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-926"><a href="#cb1-926" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[x];</span></span><span id="cb1-927"><a href="#cb1-927" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> typel<span class="op">)</span></span><span id="cb1-928"><a href="#cb1-928" aria-hidden="true" tabindex="-1"></a>                    error<span class="op">(</span><span class="dv">19</span><span class="op">);</span></span><span id="cb1-929"><a href="#cb1-929" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span><span id="cb1-930"><a href="#cb1-930" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-931"><a href="#cb1-931" aria-hidden="true" tabindex="-1"></a>                    tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-932"><a href="#cb1-932" aria-hidden="true" tabindex="-1"></a>                    rf <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-933"><a href="#cb1-933" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>valpar<span class="op">)</span>  sz <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>size<span class="op">;</span></span><span id="cb1-934"><a href="#cb1-934" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> sz <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-935"><a href="#cb1-935" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-936"><a href="#cb1-936" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-937"><a href="#cb1-937" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-938"><a href="#cb1-938" aria-hidden="true" tabindex="-1"></a>        test <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span><span id="cb1-939"><a href="#cb1-939" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-940"><a href="#cb1-940" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb1-941"><a href="#cb1-941" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>t0 <span class="op">&lt;</span> tx<span class="op">)</span></span><span id="cb1-942"><a href="#cb1-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-943"><a href="#cb1-943" aria-hidden="true" tabindex="-1"></a>        t0 <span class="op">=</span> t0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-944"><a href="#cb1-944" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-945"><a href="#cb1-945" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A1 &amp;with = nametab[t0];</span></span><span id="cb1-946"><a href="#cb1-946" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-947"><a href="#cb1-947" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb1-948"><a href="#cb1-948" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb1-949"><a href="#cb1-949" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>adr <span class="op">=</span> dx<span class="op">;</span></span><span id="cb1-950"><a href="#cb1-950" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb1-951"><a href="#cb1-951" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>normal <span class="op">=</span> valpar<span class="op">;</span></span><span id="cb1-952"><a href="#cb1-952" aria-hidden="true" tabindex="-1"></a>            dx <span class="op">=</span> dx <span class="op">+</span> sz<span class="op">;</span></span><span id="cb1-953"><a href="#cb1-953" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-954"><a href="#cb1-954" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-955"><a href="#cb1-955" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span></span><span id="cb1-956"><a href="#cb1-956" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-957"><a href="#cb1-957" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb1-958"><a href="#cb1-958" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-959"><a href="#cb1-959" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-960"><a href="#cb1-960" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-961"><a href="#cb1-961" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-962"><a href="#cb1-962" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-963"><a href="#cb1-963" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-964"><a href="#cb1-964" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-965"><a href="#cb1-965" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-966"><a href="#cb1-966" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>   <span class="co">/*while*/</span></span><span id="cb1-967"><a href="#cb1-967" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span></span><span id="cb1-968"><a href="#cb1-968" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-969"><a href="#cb1-969" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-970"><a href="#cb1-970" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-971"><a href="#cb1-971" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-972"><a href="#cb1-972" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb1-973"><a href="#cb1-973" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*parameterlist*/</span></span><span id="cb1-974"><a href="#cb1-974" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-975"><a href="#cb1-975" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> constdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-976"><a href="#cb1-976" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-977"><a href="#cb1-977" aria-hidden="true" tabindex="-1"></a>constrec c<span class="op">;</span></span><span id="cb1-978"><a href="#cb1-978" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-979"><a href="#cb1-979" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-980"><a href="#cb1-980" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-981"><a href="#cb1-981" aria-hidden="true" tabindex="-1"></a>    enter1<span class="op">(</span>konstant<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-982"><a href="#cb1-982" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-983"><a href="#cb1-983" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span></span><span id="cb1-984"><a href="#cb1-984" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-985"><a href="#cb1-985" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-986"><a href="#cb1-986" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-987"><a href="#cb1-987" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">26</span><span class="op">);</span></span><span id="cb1-988"><a href="#cb1-988" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-989"><a href="#cb1-989" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-990"><a href="#cb1-990" aria-hidden="true" tabindex="-1"></a>    constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> c<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-991"><a href="#cb1-991" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> c<span class="op">.</span>tp<span class="op">;</span></span><span id="cb1-992"><a href="#cb1-992" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-993"><a href="#cb1-993" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> c<span class="op">.</span>i<span class="op">;</span></span><span id="cb1-994"><a href="#cb1-994" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-995"><a href="#cb1-995" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-996"><a href="#cb1-996" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-997"><a href="#cb1-997" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-998"><a href="#cb1-998" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-999"><a href="#cb1-999" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* constdeclaration */</span></span><span id="cb1-1000"><a href="#cb1-1000" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1001"><a href="#cb1-1001" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> typedeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1002"><a href="#cb1-1002" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1003"><a href="#cb1-1003" aria-hidden="true" tabindex="-1"></a>types tp<span class="op">;</span></span><span id="cb1-1004"><a href="#cb1-1004" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> rf<span class="op">,</span> sz<span class="op">,</span> t1<span class="op">;</span></span><span id="cb1-1005"><a href="#cb1-1005" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1006"><a href="#cb1-1006" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1007"><a href="#cb1-1007" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1008"><a href="#cb1-1008" aria-hidden="true" tabindex="-1"></a>    enter1<span class="op">(</span>typel<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1009"><a href="#cb1-1009" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1010"><a href="#cb1-1010" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1011"><a href="#cb1-1011" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span></span><span id="cb1-1012"><a href="#cb1-1012" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1013"><a href="#cb1-1013" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-1014"><a href="#cb1-1014" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1015"><a href="#cb1-1015" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">26</span><span class="op">);</span></span><span id="cb1-1016"><a href="#cb1-1016" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span></span><span id="cb1-1017"><a href="#cb1-1017" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb1-1018"><a href="#cb1-1018" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1019"><a href="#cb1-1019" aria-hidden="true" tabindex="-1"></a>    typ <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> tp<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1020"><a href="#cb1-1020" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb1-1021"><a href="#cb1-1021" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb1-1022"><a href="#cb1-1022" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> sz<span class="op">;</span></span><span id="cb1-1023"><a href="#cb1-1023" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1024"><a href="#cb1-1024" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1025"><a href="#cb1-1025" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1026"><a href="#cb1-1026" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1027"><a href="#cb1-1027" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1028"><a href="#cb1-1028" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* typedeclaration */</span></span><span id="cb1-1029"><a href="#cb1-1029" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1030"><a href="#cb1-1030" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> vardeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">)</span></span><span id="cb1-1031"><a href="#cb1-1031" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1032"><a href="#cb1-1032" aria-hidden="true" tabindex="-1"></a>types tp<span class="op">;</span></span><span id="cb1-1033"><a href="#cb1-1033" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> t0<span class="op">,</span> t1<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">;</span></span><span id="cb1-1034"><a href="#cb1-1034" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1035"><a href="#cb1-1035" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1036"><a href="#cb1-1036" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1037"><a href="#cb1-1037" aria-hidden="true" tabindex="-1"></a>    t0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1038"><a href="#cb1-1038" aria-hidden="true" tabindex="-1"></a>    enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1039"><a href="#cb1-1039" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1040"><a href="#cb1-1040" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb1-1041"><a href="#cb1-1041" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1042"><a href="#cb1-1042" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1043"><a href="#cb1-1043" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1044"><a href="#cb1-1044" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1045"><a href="#cb1-1045" aria-hidden="true" tabindex="-1"></a>            enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1046"><a href="#cb1-1046" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1047"><a href="#cb1-1047" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1048"><a href="#cb1-1048" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1049"><a href="#cb1-1049" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1050"><a href="#cb1-1050" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span></span><span id="cb1-1051"><a href="#cb1-1051" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1052"><a href="#cb1-1052" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb1-1053"><a href="#cb1-1053" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1054"><a href="#cb1-1054" aria-hidden="true" tabindex="-1"></a>    typ <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> tp<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1055"><a href="#cb1-1055" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>t0 <span class="op">&lt;</span> t1<span class="op">)</span></span><span id="cb1-1056"><a href="#cb1-1056" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1057"><a href="#cb1-1057" aria-hidden="true" tabindex="-1"></a>        t0 <span class="op">=</span> t0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1058"><a href="#cb1-1058" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1059"><a href="#cb1-1059" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A1 &amp;with = nametab[t0];</span></span><span id="cb1-1060"><a href="#cb1-1060" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1061"><a href="#cb1-1061" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb1-1062"><a href="#cb1-1062" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb1-1063"><a href="#cb1-1063" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb1-1064"><a href="#cb1-1064" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>adr <span class="op">=</span> dx<span class="op">;</span></span><span id="cb1-1065"><a href="#cb1-1065" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>t0<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb1-1066"><a href="#cb1-1066" aria-hidden="true" tabindex="-1"></a>            dx <span class="op">=</span> dx <span class="op">+</span> sz<span class="op">;</span></span><span id="cb1-1067"><a href="#cb1-1067" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1068"><a href="#cb1-1068" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1069"><a href="#cb1-1069" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb1-1070"><a href="#cb1-1070" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1071"><a href="#cb1-1071" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1072"><a href="#cb1-1072" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1073"><a href="#cb1-1073" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1074"><a href="#cb1-1074" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1075"><a href="#cb1-1075" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* vardeclaration */</span></span><span id="cb1-1076"><a href="#cb1-1076" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1077"><a href="#cb1-1077" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> procdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1078"><a href="#cb1-1078" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1079"><a href="#cb1-1079" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1080"><a href="#cb1-1080" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb1-1081"><a href="#cb1-1081" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1082"><a href="#cb1-1082" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1083"><a href="#cb1-1083" aria-hidden="true" tabindex="-1"></a>    id <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb1-1084"><a href="#cb1-1084" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1085"><a href="#cb1-1085" aria-hidden="true" tabindex="-1"></a>enter1<span class="op">(</span>prosedure<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1086"><a href="#cb1-1086" aria-hidden="true" tabindex="-1"></a>nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb1-1087"><a href="#cb1-1087" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1088"><a href="#cb1-1088" aria-hidden="true" tabindex="-1"></a>block<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-1089"><a href="#cb1-1089" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb1-1090"><a href="#cb1-1090" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1091"><a href="#cb1-1091" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1092"><a href="#cb1-1092" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*procdeclaration*/</span></span><span id="cb1-1093"><a href="#cb1-1093" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1094"><a href="#cb1-1094" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> listcode<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx0<span class="op">)</span></span><span id="cb1-1095"><a href="#cb1-1095" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1096"><a href="#cb1-1096" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span><span id="cb1-1097"><a href="#cb1-1097" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1098"><a href="#cb1-1098" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> cx0<span class="op">;</span> i <span class="op">&lt;=</span> cx <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">++)</span></span><span id="cb1-1099"><a href="#cb1-1099" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1100"><a href="#cb1-1100" aria-hidden="true" tabindex="-1"></a>    <span class="co">//instruction &amp;with = code[i];</span></span><span id="cb1-1101"><a href="#cb1-1101" aria-hidden="true" tabindex="-1"></a>    listfile <span class="op">&lt;&lt;</span> format<span class="op">(</span>i<span class="op">,</span> <span class="dv">4</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>mnemonic<span class="op">[</span>code<span class="op">[</span>i<span class="op">].</span>f<span class="op">],</span> <span class="dv">7</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>code<span class="op">[</span>i<span class="op">].</span>l<span class="op">,</span> <span class="dv">3</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>code<span class="op">[</span>i<span class="op">].</span>a<span class="op">,</span> <span class="dv">5</span><span class="op">)</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-1102"><a href="#cb1-1102" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1103"><a href="#cb1-1103" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* listcode */</span></span><span id="cb1-1104"><a href="#cb1-1104" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1105"><a href="#cb1-1105" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> factor<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1106"><a href="#cb1-1106" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1107"><a href="#cb1-1107" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span><span id="cb1-1108"><a href="#cb1-1108" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1109"><a href="#cb1-1109" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-1110"><a href="#cb1-1110" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1111"><a href="#cb1-1111" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>facbegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1112"><a href="#cb1-1112" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>facbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1113"><a href="#cb1-1113" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1114"><a href="#cb1-1114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>sym<span class="op">)</span></span><span id="cb1-1115"><a href="#cb1-1115" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1116"><a href="#cb1-1116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> ident <span class="op">:</span></span><span id="cb1-1117"><a href="#cb1-1117" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1118"><a href="#cb1-1118" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1119"><a href="#cb1-1119" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1120"><a href="#cb1-1120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb1-1121"><a href="#cb1-1121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-1122"><a href="#cb1-1122" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1123"><a href="#cb1-1123" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A1 &amp;with = nametab[i];</span></span><span id="cb1-1124"><a href="#cb1-1124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind<span class="op">)</span></span><span id="cb1-1125"><a href="#cb1-1125" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-1126"><a href="#cb1-1126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb1-1127"><a href="#cb1-1127" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-1128"><a href="#cb1-1128" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-1129"><a href="#cb1-1129" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1130"><a href="#cb1-1130" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>val<span class="op">);</span></span><span id="cb1-1131"><a href="#cb1-1131" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-1132"><a href="#cb1-1132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1133"><a href="#cb1-1133" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb1-1134"><a href="#cb1-1134" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-1135"><a href="#cb1-1135" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-1136"><a href="#cb1-1136" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-1137"><a href="#cb1-1137" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">((</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> ints<span class="op">)</span> <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> bool_<span class="op">)</span> <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> chars<span class="op">))</span></span><span id="cb1-1138"><a href="#cb1-1138" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1139"><a href="#cb1-1139" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>normal<span class="op">)</span>   gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1140"><a href="#cb1-1140" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> gen<span class="op">(</span>ilod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1141"><a href="#cb1-1141" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>  <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb1-1142"><a href="#cb1-1142" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-1143"><a href="#cb1-1143" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>normal<span class="op">)</span>  gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1144"><a href="#cb1-1144" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1145"><a href="#cb1-1145" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-1146"><a href="#cb1-1146" aria-hidden="true" tabindex="-1"></a>                        arrayelement<span class="op">(</span>fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span> <span class="co">//LosPhoenix tocheck</span></span><span id="cb1-1147"><a href="#cb1-1147" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> arrays<span class="op">)</span></span><span id="cb1-1148"><a href="#cb1-1148" aria-hidden="true" tabindex="-1"></a>                        gen<span class="op">(</span>lodt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1149"><a href="#cb1-1149" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-1150"><a href="#cb1-1150" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-1151"><a href="#cb1-1151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1152"><a href="#cb1-1152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb1-1153"><a href="#cb1-1153" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb1-1154"><a href="#cb1-1154" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">41</span><span class="op">);</span></span><span id="cb1-1155"><a href="#cb1-1155" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1156"><a href="#cb1-1156" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-1157"><a href="#cb1-1157" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1158"><a href="#cb1-1158" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1159"><a href="#cb1-1159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1160"><a href="#cb1-1160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> intcon<span class="op">:</span></span><span id="cb1-1161"><a href="#cb1-1161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> charcon <span class="op">:</span></span><span id="cb1-1162"><a href="#cb1-1162" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1163"><a href="#cb1-1163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> intcon<span class="op">)</span>  x<span class="op">.</span>typ <span class="op">=</span> ints<span class="op">;</span></span><span id="cb1-1164"><a href="#cb1-1164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> x<span class="op">.</span>typ <span class="op">=</span> chars<span class="op">;</span></span><span id="cb1-1165"><a href="#cb1-1165" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1166"><a href="#cb1-1166" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> num<span class="op">);</span></span><span id="cb1-1167"><a href="#cb1-1167" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1168"><a href="#cb1-1168" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1169"><a href="#cb1-1169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1170"><a href="#cb1-1170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> lparen <span class="op">:</span></span><span id="cb1-1171"><a href="#cb1-1171" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1172"><a href="#cb1-1172" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1173"><a href="#cb1-1173" aria-hidden="true" tabindex="-1"></a>        expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1174"><a href="#cb1-1174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1175"><a href="#cb1-1175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb1-1176"><a href="#cb1-1176" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1177"><a href="#cb1-1177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1178"><a href="#cb1-1178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> notsym <span class="op">:</span></span><span id="cb1-1179"><a href="#cb1-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1180"><a href="#cb1-1180" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1181"><a href="#cb1-1181" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">(</span>fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1182"><a href="#cb1-1182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb1-1183"><a href="#cb1-1183" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>nots <span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1184"><a href="#cb1-1184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1185"><a href="#cb1-1185" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1186"><a href="#cb1-1186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1187"><a href="#cb1-1187" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>    <span class="co">/* case */</span></span><span id="cb1-1188"><a href="#cb1-1188" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rbrack<span class="op">,</span> rparen<span class="op">,</span>tosym<span class="op">,</span>downtosym<span class="op">,</span> eos<span class="op">),</span> facbegsys<span class="op">,</span> <span class="dv">23</span><span class="op">);</span></span><span id="cb1-1189"><a href="#cb1-1189" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>    <span class="co">/* of if */</span></span><span id="cb1-1190"><a href="#cb1-1190" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* factor */</span></span><span id="cb1-1191"><a href="#cb1-1191" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1192"><a href="#cb1-1192" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> term<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1193"><a href="#cb1-1193" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1194"><a href="#cb1-1194" aria-hidden="true" tabindex="-1"></a>symbol mulop<span class="op">;</span></span><span id="cb1-1195"><a href="#cb1-1195" aria-hidden="true" tabindex="-1"></a>item y<span class="op">;</span></span><span id="cb1-1196"><a href="#cb1-1196" aria-hidden="true" tabindex="-1"></a><span class="co">/* term */</span></span><span id="cb1-1197"><a href="#cb1-1197" aria-hidden="true" tabindex="-1"></a>factor<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1198"><a href="#cb1-1198" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1199"><a href="#cb1-1199" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1200"><a href="#cb1-1200" aria-hidden="true" tabindex="-1"></a>    mulop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb1-1201"><a href="#cb1-1201" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1202"><a href="#cb1-1202" aria-hidden="true" tabindex="-1"></a>    factor<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1203"><a href="#cb1-1203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb1-1204"><a href="#cb1-1204" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1205"><a href="#cb1-1205" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1206"><a href="#cb1-1206" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-1207"><a href="#cb1-1207" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1208"><a href="#cb1-1208" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1209"><a href="#cb1-1209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-1210"><a href="#cb1-1210" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1211"><a href="#cb1-1211" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>mulop <span class="op">==</span> times<span class="op">)</span></span><span id="cb1-1212"><a href="#cb1-1212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1213"><a href="#cb1-1213" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>mult<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1214"><a href="#cb1-1214" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1215"><a href="#cb1-1215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> divsym<span class="op">)</span></span><span id="cb1-1216"><a href="#cb1-1216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1217"><a href="#cb1-1217" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>idiv<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1218"><a href="#cb1-1218" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1219"><a href="#cb1-1219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> modsym<span class="op">)</span></span><span id="cb1-1220"><a href="#cb1-1220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1221"><a href="#cb1-1221" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>imod<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1222"><a href="#cb1-1222" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1223"><a href="#cb1-1223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> andsym<span class="op">)</span></span><span id="cb1-1224"><a href="#cb1-1224" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb1-1225"><a href="#cb1-1225" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>ands<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1226"><a href="#cb1-1226" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1227"><a href="#cb1-1227" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1228"><a href="#cb1-1228" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1229"><a href="#cb1-1229" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* term*/</span></span><span id="cb1-1230"><a href="#cb1-1230" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1231"><a href="#cb1-1231" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> simpleexpression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1232"><a href="#cb1-1232" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1233"><a href="#cb1-1233" aria-hidden="true" tabindex="-1"></a>symbol addop<span class="op">;</span></span><span id="cb1-1234"><a href="#cb1-1234" aria-hidden="true" tabindex="-1"></a>item y<span class="op">;</span></span><span id="cb1-1235"><a href="#cb1-1235" aria-hidden="true" tabindex="-1"></a><span class="co">/* simpleexpression */</span></span><span id="cb1-1236"><a href="#cb1-1236" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1237"><a href="#cb1-1237" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1238"><a href="#cb1-1238" aria-hidden="true" tabindex="-1"></a>    addop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb1-1239"><a href="#cb1-1239" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1240"><a href="#cb1-1240" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1241"><a href="#cb1-1241" aria-hidden="true" tabindex="-1"></a>    term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1242"><a href="#cb1-1242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>addop <span class="op">==</span> minus<span class="op">)</span>  gen<span class="op">(</span>mus<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1243"><a href="#cb1-1243" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1244"><a href="#cb1-1244" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1245"><a href="#cb1-1245" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1246"><a href="#cb1-1246" aria-hidden="true" tabindex="-1"></a>    term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1247"><a href="#cb1-1247" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1248"><a href="#cb1-1248" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1249"><a href="#cb1-1249" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1250"><a href="#cb1-1250" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1251"><a href="#cb1-1251" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1252"><a href="#cb1-1252" aria-hidden="true" tabindex="-1"></a>    addop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb1-1253"><a href="#cb1-1253" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1254"><a href="#cb1-1254" aria-hidden="true" tabindex="-1"></a>    term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1255"><a href="#cb1-1255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb1-1256"><a href="#cb1-1256" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1257"><a href="#cb1-1257" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1258"><a href="#cb1-1258" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-1259"><a href="#cb1-1259" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1260"><a href="#cb1-1260" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1261"><a href="#cb1-1261" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-1262"><a href="#cb1-1262" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1263"><a href="#cb1-1263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>addop <span class="op">==</span> plus<span class="op">)</span></span><span id="cb1-1264"><a href="#cb1-1264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1265"><a href="#cb1-1265" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>add<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1266"><a href="#cb1-1266" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1267"><a href="#cb1-1267" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  <span class="op">(</span>addop <span class="op">==</span> minus<span class="op">)</span></span><span id="cb1-1268"><a href="#cb1-1268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1269"><a href="#cb1-1269" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>sub<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1270"><a href="#cb1-1270" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1271"><a href="#cb1-1271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>  <span class="op">(</span>addop <span class="op">==</span> orsym<span class="op">)</span></span><span id="cb1-1272"><a href="#cb1-1272" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb1-1273"><a href="#cb1-1273" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>ors<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1274"><a href="#cb1-1274" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1275"><a href="#cb1-1275" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1276"><a href="#cb1-1276" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1277"><a href="#cb1-1277" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* simpleexpression */</span></span><span id="cb1-1278"><a href="#cb1-1278" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1279"><a href="#cb1-1279" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> expression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1280"><a href="#cb1-1280" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1281"><a href="#cb1-1281" aria-hidden="true" tabindex="-1"></a>symbol relop<span class="op">;</span></span><span id="cb1-1282"><a href="#cb1-1282" aria-hidden="true" tabindex="-1"></a>item y<span class="op">;</span></span><span id="cb1-1283"><a href="#cb1-1283" aria-hidden="true" tabindex="-1"></a><span class="co">/*expression*/</span></span><span id="cb1-1284"><a href="#cb1-1284" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1285"><a href="#cb1-1285" aria-hidden="true" tabindex="-1"></a>simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> gtr<span class="op">,</span> leq<span class="op">,</span> geq<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1286"><a href="#cb1-1286" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1287"><a href="#cb1-1287" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> leq<span class="op">,</span> gtr<span class="op">,</span> geq<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1288"><a href="#cb1-1288" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1289"><a href="#cb1-1289" aria-hidden="true" tabindex="-1"></a>    relop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb1-1290"><a href="#cb1-1290" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1291"><a href="#cb1-1291" aria-hidden="true" tabindex="-1"></a>    simpleexpression<span class="op">(</span>fsys<span class="op">,</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1292"><a href="#cb1-1292" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb1-1293"><a href="#cb1-1293" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1294"><a href="#cb1-1294" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>relop<span class="op">)</span></span><span id="cb1-1295"><a href="#cb1-1295" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1296"><a href="#cb1-1296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> eql<span class="op">:</span></span><span id="cb1-1297"><a href="#cb1-1297" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>eq<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1298"><a href="#cb1-1298" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1299"><a href="#cb1-1299" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> neq<span class="op">:</span></span><span id="cb1-1300"><a href="#cb1-1300" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>ne<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1301"><a href="#cb1-1301" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1302"><a href="#cb1-1302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> lss<span class="op">:</span></span><span id="cb1-1303"><a href="#cb1-1303" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>ls<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1304"><a href="#cb1-1304" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1305"><a href="#cb1-1305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> geq<span class="op">:</span></span><span id="cb1-1306"><a href="#cb1-1306" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>ge<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1307"><a href="#cb1-1307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1308"><a href="#cb1-1308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> gtr<span class="op">:</span></span><span id="cb1-1309"><a href="#cb1-1309" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>gt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1310"><a href="#cb1-1310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1311"><a href="#cb1-1311" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> leq<span class="op">:</span></span><span id="cb1-1312"><a href="#cb1-1312" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>le<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1313"><a href="#cb1-1313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1314"><a href="#cb1-1314" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1315"><a href="#cb1-1315" aria-hidden="true" tabindex="-1"></a>    x<span class="op">.</span>typ <span class="op">=</span> bool_<span class="op">;</span></span><span id="cb1-1316"><a href="#cb1-1316" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1317"><a href="#cb1-1317" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* expression */</span></span><span id="cb1-1318"><a href="#cb1-1318" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> forstatement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb1-1319"><a href="#cb1-1319" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1320"><a href="#cb1-1320" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1321"><a href="#cb1-1321" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span><span id="cb1-1322"><a href="#cb1-1322" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> downto <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1323"><a href="#cb1-1323" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1324"><a href="#cb1-1324" aria-hidden="true" tabindex="-1"></a>assignment<span class="op">(</span>i<span class="op">,</span>level<span class="op">,</span>fsys<span class="op">);</span></span><span id="cb1-1325"><a href="#cb1-1325" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> addr <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">;</span></span><span id="cb1-1326"><a href="#cb1-1326" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>addr <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1327"><a href="#cb1-1327" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>sym <span class="op">==</span> tosym<span class="op">)</span></span><span id="cb1-1328"><a href="#cb1-1328" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1329"><a href="#cb1-1329" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1330"><a href="#cb1-1330" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1331"><a href="#cb1-1331" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>sym<span class="op">==</span>downtosym<span class="op">)</span></span><span id="cb1-1332"><a href="#cb1-1332" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1333"><a href="#cb1-1333" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1334"><a href="#cb1-1334" aria-hidden="true" tabindex="-1"></a>    downto <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1335"><a href="#cb1-1335" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1336"><a href="#cb1-1336" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1337"><a href="#cb1-1337" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1338"><a href="#cb1-1338" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">37</span><span class="op">);</span></span><span id="cb1-1339"><a href="#cb1-1339" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1340"><a href="#cb1-1340" aria-hidden="true" tabindex="-1"></a>cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1341"><a href="#cb1-1341" aria-hidden="true" tabindex="-1"></a>simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>dosym<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1342"><a href="#cb1-1342" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb1-1343"><a href="#cb1-1343" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>downto<span class="op">)</span></span><span id="cb1-1344"><a href="#cb1-1344" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1345"><a href="#cb1-1345" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>le<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1346"><a href="#cb1-1346" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1347"><a href="#cb1-1347" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1348"><a href="#cb1-1348" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1349"><a href="#cb1-1349" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>ge<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1350"><a href="#cb1-1350" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1351"><a href="#cb1-1351" aria-hidden="true" tabindex="-1"></a>cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1352"><a href="#cb1-1352" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1353"><a href="#cb1-1353" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>sym<span class="op">==</span>dosym<span class="op">)</span></span><span id="cb1-1354"><a href="#cb1-1354" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1355"><a href="#cb1-1355" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1356"><a href="#cb1-1356" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1357"><a href="#cb1-1357" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1358"><a href="#cb1-1358" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1359"><a href="#cb1-1359" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1360"><a href="#cb1-1360" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1361"><a href="#cb1-1361" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1362"><a href="#cb1-1362" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>loda<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb1-1363"><a href="#cb1-1363" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb1-1364"><a href="#cb1-1364" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-1365"><a href="#cb1-1365" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>downto<span class="op">)</span></span><span id="cb1-1366"><a href="#cb1-1366" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1367"><a href="#cb1-1367" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>sub<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1368"><a href="#cb1-1368" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1369"><a href="#cb1-1369" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1370"><a href="#cb1-1370" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1371"><a href="#cb1-1371" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>add<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1372"><a href="#cb1-1372" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1373"><a href="#cb1-1373" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>sto<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1374"><a href="#cb1-1374" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx1<span class="op">);</span></span><span id="cb1-1375"><a href="#cb1-1375" aria-hidden="true" tabindex="-1"></a>code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1376"><a href="#cb1-1376" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1377"><a href="#cb1-1377" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1378"><a href="#cb1-1378" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1379"><a href="#cb1-1379" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cc<span class="op">;</span></span><span id="cb1-1380"><a href="#cb1-1380" aria-hidden="true" tabindex="-1"></a>index1 addr<span class="op">,</span> p<span class="op">;</span></span><span id="cb1-1381"><a href="#cb1-1381" aria-hidden="true" tabindex="-1"></a>item y<span class="op">;</span></span><span id="cb1-1382"><a href="#cb1-1382" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1383"><a href="#cb1-1383" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> x<span class="op">.</span>ref<span class="op">;</span></span><span id="cb1-1384"><a href="#cb1-1384" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-1385"><a href="#cb1-1385" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1386"><a href="#cb1-1386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb1-1387"><a href="#cb1-1387" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1388"><a href="#cb1-1388" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1389"><a href="#cb1-1389" aria-hidden="true" tabindex="-1"></a>        expression<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1390"><a href="#cb1-1390" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> arrays<span class="op">)</span>  error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1391"><a href="#cb1-1391" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-1392"><a href="#cb1-1392" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1393"><a href="#cb1-1393" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>y<span class="op">.</span>typ <span class="op">!=</span> atab<span class="op">[</span>p<span class="op">].</span>inxtyp<span class="op">)</span>  error<span class="op">(</span><span class="dv">44</span><span class="op">);</span></span><span id="cb1-1394"><a href="#cb1-1394" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>p<span class="op">].</span>low<span class="op">);</span></span><span id="cb1-1395"><a href="#cb1-1395" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>sub<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1396"><a href="#cb1-1396" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> atab<span class="op">[</span>p<span class="op">].</span>elsize<span class="op">);</span></span><span id="cb1-1397"><a href="#cb1-1397" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>mult<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1398"><a href="#cb1-1398" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>add<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1399"><a href="#cb1-1399" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>typ <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>eltyp<span class="op">;</span></span><span id="cb1-1400"><a href="#cb1-1400" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>ref <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>elref<span class="op">;</span></span><span id="cb1-1401"><a href="#cb1-1401" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>elref<span class="op">;</span></span><span id="cb1-1402"><a href="#cb1-1402" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1403"><a href="#cb1-1403" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1404"><a href="#cb1-1404" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb1-1405"><a href="#cb1-1405" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1406"><a href="#cb1-1406" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rbrack<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1407"><a href="#cb1-1407" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">28</span><span class="op">);</span></span><span id="cb1-1408"><a href="#cb1-1408" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1409"><a href="#cb1-1409" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">16</span><span class="op">);</span></span><span id="cb1-1410"><a href="#cb1-1410" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1411"><a href="#cb1-1411" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*arrayelement*/</span></span><span id="cb1-1412"><a href="#cb1-1412" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1413"><a href="#cb1-1413" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> assignment<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1414"><a href="#cb1-1414" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1415"><a href="#cb1-1415" aria-hidden="true" tabindex="-1"></a>item x<span class="op">,</span> y<span class="op">;</span></span><span id="cb1-1416"><a href="#cb1-1416" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1417"><a href="#cb1-1417" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1418"><a href="#cb1-1418" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb1-1419"><a href="#cb1-1419" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span></span><span id="cb1-1420"><a href="#cb1-1420" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1421"><a href="#cb1-1421" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* giving value to non-variation */</span></span><span id="cb1-1422"><a href="#cb1-1422" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb1-1423"><a href="#cb1-1423" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1424"><a href="#cb1-1424" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1425"><a href="#cb1-1425" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1426"><a href="#cb1-1426" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1427"><a href="#cb1-1427" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-1428"><a href="#cb1-1428" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-1429"><a href="#cb1-1429" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1430"><a href="#cb1-1430" aria-hidden="true" tabindex="-1"></a>    A1 <span class="op">&amp;</span>with <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-1431"><a href="#cb1-1431" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>with<span class="op">.</span>normal<span class="op">)</span></span><span id="cb1-1432"><a href="#cb1-1432" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>loda<span class="op">,</span> with<span class="op">.</span>lev<span class="op">,</span> with<span class="op">.</span>adr<span class="op">);</span></span><span id="cb1-1433"><a href="#cb1-1433" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> with<span class="op">.</span>lev<span class="op">,</span> with<span class="op">.</span>adr<span class="op">);</span></span><span id="cb1-1434"><a href="#cb1-1434" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1435"><a href="#cb1-1435" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-1436"><a href="#cb1-1436" aria-hidden="true" tabindex="-1"></a>    arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>becomes<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1437"><a href="#cb1-1437" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1438"><a href="#cb1-1438" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1439"><a href="#cb1-1439" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1440"><a href="#cb1-1440" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">33</span><span class="op">);</span></span><span id="cb1-1441"><a href="#cb1-1441" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1442"><a href="#cb1-1442" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1443"><a href="#cb1-1443" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1444"><a href="#cb1-1444" aria-hidden="true" tabindex="-1"></a>expression<span class="op">(</span>fsys<span class="op">,</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1445"><a href="#cb1-1445" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span>  error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1446"><a href="#cb1-1446" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb1-1447"><a href="#cb1-1447" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>ref <span class="op">==</span> y<span class="op">.</span>ref<span class="op">)</span></span><span id="cb1-1448"><a href="#cb1-1448" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>cpyb<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>x<span class="op">.</span>ref<span class="op">].</span>size<span class="op">);</span></span><span id="cb1-1449"><a href="#cb1-1449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb1-1450"><a href="#cb1-1450" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> gen<span class="op">(</span>sto<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1451"><a href="#cb1-1451" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*assignment*/</span></span><span id="cb1-1452"><a href="#cb1-1452" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1453"><a href="#cb1-1453" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> ifstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb1-1454"><a href="#cb1-1454" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1455"><a href="#cb1-1455" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1456"><a href="#cb1-1456" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1457"><a href="#cb1-1457" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1458"><a href="#cb1-1458" aria-hidden="true" tabindex="-1"></a>expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>thensym<span class="op">,</span> dosym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1459"><a href="#cb1-1459" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> bool_<span class="op">)</span>  error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb1-1460"><a href="#cb1-1460" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> thensym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1461"><a href="#cb1-1461" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">35</span><span class="op">);</span></span><span id="cb1-1462"><a href="#cb1-1462" aria-hidden="true" tabindex="-1"></a>cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1463"><a href="#cb1-1463" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jpc<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1464"><a href="#cb1-1464" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>elsesym<span class="op">,</span> eos<span class="op">),</span> level<span class="op">);</span></span><span id="cb1-1465"><a href="#cb1-1465" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> elsesym<span class="op">)</span></span><span id="cb1-1466"><a href="#cb1-1466" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1467"><a href="#cb1-1467" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1468"><a href="#cb1-1468" aria-hidden="true" tabindex="-1"></a>    cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1469"><a href="#cb1-1469" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1470"><a href="#cb1-1470" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx1<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1471"><a href="#cb1-1471" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1472"><a href="#cb1-1472" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1473"><a href="#cb1-1473" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1474"><a href="#cb1-1474" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1475"><a href="#cb1-1475" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1476"><a href="#cb1-1476" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1477"><a href="#cb1-1477" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1478"><a href="#cb1-1478" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb1-1479"><a href="#cb1-1479" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1480"><a href="#cb1-1480" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx1<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1481"><a href="#cb1-1481" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1482"><a href="#cb1-1482" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1483"><a href="#cb1-1483" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1484"><a href="#cb1-1484" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*ifstatement*/</span></span><span id="cb1-1485"><a href="#cb1-1485" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1486"><a href="#cb1-1486" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> compound<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1487"><a href="#cb1-1487" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1488"><a href="#cb1-1488" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1489"><a href="#cb1-1489" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1490"><a href="#cb1-1490" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">((</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> statbegsys<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb1-1491"><a href="#cb1-1491" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1492"><a href="#cb1-1492" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1493"><a href="#cb1-1493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1494"><a href="#cb1-1494" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1495"><a href="#cb1-1495" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1496"><a href="#cb1-1496" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> endsym<span class="op">)</span></span><span id="cb1-1497"><a href="#cb1-1497" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1498"><a href="#cb1-1498" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">36</span><span class="op">);</span></span><span id="cb1-1499"><a href="#cb1-1499" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*compound*/</span></span><span id="cb1-1500"><a href="#cb1-1500" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> repeatstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1501"><a href="#cb1-1501" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1502"><a href="#cb1-1502" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1503"><a href="#cb1-1503" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1504"><a href="#cb1-1504" aria-hidden="true" tabindex="-1"></a>cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1505"><a href="#cb1-1505" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>untilsym<span class="op">,</span>eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1506"><a href="#cb1-1506" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>sym<span class="op">!=</span>untilsym<span class="op">)</span></span><span id="cb1-1507"><a href="#cb1-1507" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1508"><a href="#cb1-1508" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1509"><a href="#cb1-1509" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>untilsym<span class="op">,</span>eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1510"><a href="#cb1-1510" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1511"><a href="#cb1-1511" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1512"><a href="#cb1-1512" aria-hidden="true" tabindex="-1"></a>expression<span class="op">(</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1513"><a href="#cb1-1513" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>x<span class="op">.</span>typ<span class="op">!=</span>bool_<span class="op">)</span>error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb1-1514"><a href="#cb1-1514" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx1<span class="op">);</span></span><span id="cb1-1515"><a href="#cb1-1515" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-1516"><a href="#cb1-1516" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1517"><a href="#cb1-1517" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1518"><a href="#cb1-1518" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> whilestatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb1-1519"><a href="#cb1-1519" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1520"><a href="#cb1-1520" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1521"><a href="#cb1-1521" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1522"><a href="#cb1-1522" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1523"><a href="#cb1-1523" aria-hidden="true" tabindex="-1"></a>labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1524"><a href="#cb1-1524" aria-hidden="true" tabindex="-1"></a>lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1525"><a href="#cb1-1525" aria-hidden="true" tabindex="-1"></a>cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1526"><a href="#cb1-1526" aria-hidden="true" tabindex="-1"></a>expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>dosym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1527"><a href="#cb1-1527" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> bool_<span class="op">)</span>  error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb1-1528"><a href="#cb1-1528" aria-hidden="true" tabindex="-1"></a>cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1529"><a href="#cb1-1529" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jpc<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1530"><a href="#cb1-1530" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> dosym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1531"><a href="#cb1-1531" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">37</span><span class="op">);</span></span><span id="cb1-1532"><a href="#cb1-1532" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1533"><a href="#cb1-1533" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cx1<span class="op">);</span></span><span id="cb1-1534"><a href="#cb1-1534" aria-hidden="true" tabindex="-1"></a>code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1535"><a href="#cb1-1535" aria-hidden="true" tabindex="-1"></a>labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1536"><a href="#cb1-1536" aria-hidden="true" tabindex="-1"></a>lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1537"><a href="#cb1-1537" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/*whilestatement*/</span></span><span id="cb1-1538"><a href="#cb1-1538" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1539"><a href="#cb1-1539" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> stanproc<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1540"><a href="#cb1-1540" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1541"><a href="#cb1-1541" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n<span class="op">;</span></span><span id="cb1-1542"><a href="#cb1-1542" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1543"><a href="#cb1-1543" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">6</span><span class="op">)</span></span><span id="cb1-1544"><a href="#cb1-1544" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1545"><a href="#cb1-1545" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* read */</span></span><span id="cb1-1546"><a href="#cb1-1546" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1547"><a href="#cb1-1547" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb1-1548"><a href="#cb1-1548" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1549"><a href="#cb1-1549" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-1550"><a href="#cb1-1550" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1551"><a href="#cb1-1551" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1552"><a href="#cb1-1552" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1553"><a href="#cb1-1553" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-1554"><a href="#cb1-1554" aria-hidden="true" tabindex="-1"></a>                n <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1555"><a href="#cb1-1555" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb1-1556"><a href="#cb1-1556" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb1-1557"><a href="#cb1-1557" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>n<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span></span><span id="cb1-1558"><a href="#cb1-1558" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-1559"><a href="#cb1-1559" aria-hidden="true" tabindex="-1"></a>                    error<span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb1-1560"><a href="#cb1-1560" aria-hidden="true" tabindex="-1"></a>                    n <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1561"><a href="#cb1-1561" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-1562"><a href="#cb1-1562" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span><span id="cb1-1563"><a href="#cb1-1563" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-1564"><a href="#cb1-1564" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>n<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-1565"><a href="#cb1-1565" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>n<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-1566"><a href="#cb1-1566" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>n<span class="op">].</span>normal<span class="op">)</span></span><span id="cb1-1567"><a href="#cb1-1567" aria-hidden="true" tabindex="-1"></a>                        gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1568"><a href="#cb1-1568" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1569"><a href="#cb1-1569" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-1570"><a href="#cb1-1570" aria-hidden="true" tabindex="-1"></a>                        arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1571"><a href="#cb1-1571" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1572"><a href="#cb1-1572" aria-hidden="true" tabindex="-1"></a>                        gen<span class="op">(</span>red<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1573"><a href="#cb1-1573" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> chars<span class="op">)</span></span><span id="cb1-1574"><a href="#cb1-1574" aria-hidden="true" tabindex="-1"></a>                        gen<span class="op">(</span>red<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-1575"><a href="#cb1-1575" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1576"><a href="#cb1-1576" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-1577"><a href="#cb1-1577" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-1578"><a href="#cb1-1578" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1579"><a href="#cb1-1579" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1580"><a href="#cb1-1580" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb1-1581"><a href="#cb1-1581" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span>  error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb1-1582"><a href="#cb1-1582" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>  getsym<span class="op">();</span></span><span id="cb1-1583"><a href="#cb1-1583" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1584"><a href="#cb1-1584" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">32</span><span class="op">);</span></span><span id="cb1-1585"><a href="#cb1-1585" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1586"><a href="#cb1-1586" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">7</span><span class="op">)</span></span><span id="cb1-1587"><a href="#cb1-1587" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1588"><a href="#cb1-1588" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* write */</span></span><span id="cb1-1589"><a href="#cb1-1589" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1590"><a href="#cb1-1590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb1-1591"><a href="#cb1-1591" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1592"><a href="#cb1-1592" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-1593"><a href="#cb1-1593" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1594"><a href="#cb1-1594" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1595"><a href="#cb1-1595" aria-hidden="true" tabindex="-1"></a>            expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> comma<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1596"><a href="#cb1-1596" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb1-1597"><a href="#cb1-1597" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>wrt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-1598"><a href="#cb1-1598" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> chars<span class="op">)</span></span><span id="cb1-1599"><a href="#cb1-1599" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>wrt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-1600"><a href="#cb1-1600" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb1-1601"><a href="#cb1-1601" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1602"><a href="#cb1-1602" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb1-1603"><a href="#cb1-1603" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span>  error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb1-1604"><a href="#cb1-1604" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1605"><a href="#cb1-1605" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1606"><a href="#cb1-1606" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">32</span><span class="op">);</span></span><span id="cb1-1607"><a href="#cb1-1607" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1608"><a href="#cb1-1608" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* standproc */</span></span><span id="cb1-1609"><a href="#cb1-1609" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1610"><a href="#cb1-1610" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> call<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb1-1611"><a href="#cb1-1611" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1612"><a href="#cb1-1612" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1613"><a href="#cb1-1613" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> lastp<span class="op">,</span> cp<span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">;</span></span><span id="cb1-1614"><a href="#cb1-1614" aria-hidden="true" tabindex="-1"></a><span class="co">/* call */</span></span><span id="cb1-1615"><a href="#cb1-1615" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1616"><a href="#cb1-1616" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1617"><a href="#cb1-1617" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1618"><a href="#cb1-1618" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1619"><a href="#cb1-1619" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind <span class="op">==</span> prosedure<span class="op">)</span></span><span id="cb1-1620"><a href="#cb1-1620" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1621"><a href="#cb1-1621" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>lev <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  stanproc<span class="op">(</span>i<span class="op">,</span> level<span class="op">,</span> x<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1622"><a href="#cb1-1622" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-1623"><a href="#cb1-1623" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1624"><a href="#cb1-1624" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb1-1625"><a href="#cb1-1625" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>opac<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/*open active record*/</span></span><span id="cb1-1626"><a href="#cb1-1626" aria-hidden="true" tabindex="-1"></a>            lastp <span class="op">=</span> btab<span class="op">[</span>nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">].</span>lastpar<span class="op">;</span></span><span id="cb1-1627"><a href="#cb1-1627" aria-hidden="true" tabindex="-1"></a>            cp <span class="op">=</span> i<span class="op">;</span></span><span id="cb1-1628"><a href="#cb1-1628" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb1-1629"><a href="#cb1-1629" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb1-1630"><a href="#cb1-1630" aria-hidden="true" tabindex="-1"></a>                <span class="co">/*actual parameter list*/</span></span><span id="cb1-1631"><a href="#cb1-1631" aria-hidden="true" tabindex="-1"></a>                <span class="cf">do</span></span><span id="cb1-1632"><a href="#cb1-1632" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb1-1633"><a href="#cb1-1633" aria-hidden="true" tabindex="-1"></a>                    getsym<span class="op">();</span></span><span id="cb1-1634"><a href="#cb1-1634" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>cp <span class="op">&gt;=</span> lastp<span class="op">)</span></span><span id="cb1-1635"><a href="#cb1-1635" aria-hidden="true" tabindex="-1"></a>                        error<span class="op">(</span><span class="dv">29</span><span class="op">);</span></span><span id="cb1-1636"><a href="#cb1-1636" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span><span id="cb1-1637"><a href="#cb1-1637" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb1-1638"><a href="#cb1-1638" aria-hidden="true" tabindex="-1"></a>                        cp <span class="op">=</span> cp <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1639"><a href="#cb1-1639" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>cp<span class="op">].</span>normal<span class="op">)</span></span><span id="cb1-1640"><a href="#cb1-1640" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#123;</span></span><span id="cb1-1641"><a href="#cb1-1641" aria-hidden="true" tabindex="-1"></a>                            <span class="co">/*value parameter*/</span></span><span id="cb1-1642"><a href="#cb1-1642" aria-hidden="true" tabindex="-1"></a>                            expression<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> colon<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1643"><a href="#cb1-1643" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> nametab<span class="op">[</span>cp<span class="op">].</span>typ<span class="op">)</span></span><span id="cb1-1644"><a href="#cb1-1644" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#123;</span></span><span id="cb1-1645"><a href="#cb1-1645" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>ref <span class="op">!=</span> nametab<span class="op">[</span>cp<span class="op">].</span>ref<span class="op">)</span></span><span id="cb1-1646"><a href="#cb1-1646" aria-hidden="true" tabindex="-1"></a>                                    error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb1-1647"><a href="#cb1-1647" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb1-1648"><a href="#cb1-1648" aria-hidden="true" tabindex="-1"></a>                                    gen<span class="op">(</span>lodb<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>x<span class="op">.</span>ref<span class="op">].</span>size<span class="op">);</span></span><span id="cb1-1649"><a href="#cb1-1649" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#125;</span></span><span id="cb1-1650"><a href="#cb1-1650" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span> error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb1-1651"><a href="#cb1-1651" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#125;</span></span><span id="cb1-1652"><a href="#cb1-1652" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span>           <span class="co">/*variable parameter*/</span></span><span id="cb1-1653"><a href="#cb1-1653" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#123;</span></span><span id="cb1-1654"><a href="#cb1-1654" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb1-1655"><a href="#cb1-1655" aria-hidden="true" tabindex="-1"></a>                                error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1656"><a href="#cb1-1656" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span></span><span id="cb1-1657"><a href="#cb1-1657" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#123;</span></span><span id="cb1-1658"><a href="#cb1-1658" aria-hidden="true" tabindex="-1"></a>                                k <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1659"><a href="#cb1-1659" aria-hidden="true" tabindex="-1"></a>                                getsym<span class="op">();</span></span><span id="cb1-1660"><a href="#cb1-1660" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-1661"><a href="#cb1-1661" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#123;</span></span><span id="cb1-1662"><a href="#cb1-1662" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>k<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span>  error <span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb1-1663"><a href="#cb1-1663" aria-hidden="true" tabindex="-1"></a>                                    x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>k<span class="op">].</span>typ<span class="op">;</span></span><span id="cb1-1664"><a href="#cb1-1664" aria-hidden="true" tabindex="-1"></a>                                    x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>k<span class="op">].</span>ref<span class="op">;</span></span><span id="cb1-1665"><a href="#cb1-1665" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>k<span class="op">].</span>normal<span class="op">)</span></span><span id="cb1-1666"><a href="#cb1-1666" aria-hidden="true" tabindex="-1"></a>                                        gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1667"><a href="#cb1-1667" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1668"><a href="#cb1-1668" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb1-1669"><a href="#cb1-1669" aria-hidden="true" tabindex="-1"></a>                                        arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1670"><a href="#cb1-1670" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span>    <span class="op">((</span>nametab<span class="op">[</span>cp<span class="op">].</span>typ <span class="op">!=</span> x<span class="op">.</span>typ<span class="op">)</span></span><span id="cb1-1671"><a href="#cb1-1671" aria-hidden="true" tabindex="-1"></a>                                            <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>cp<span class="op">].</span>ref <span class="op">!=</span> x<span class="op">.</span>ref<span class="op">))</span></span><span id="cb1-1672"><a href="#cb1-1672" aria-hidden="true" tabindex="-1"></a>                                        error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb1-1673"><a href="#cb1-1673" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#125;</span></span><span id="cb1-1674"><a href="#cb1-1674" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#125;</span></span><span id="cb1-1675"><a href="#cb1-1675" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#125;</span>   <span class="co">/*variable parameter*/</span></span><span id="cb1-1676"><a href="#cb1-1676" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb1-1677"><a href="#cb1-1677" aria-hidden="true" tabindex="-1"></a>                    test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1678"><a href="#cb1-1678" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-1679"><a href="#cb1-1679" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb1-1680"><a href="#cb1-1680" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1681"><a href="#cb1-1681" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb1-1682"><a href="#cb1-1682" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-1683"><a href="#cb1-1683" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>cp <span class="op">&lt;</span> lastp<span class="op">)</span>  error<span class="op">(</span><span class="dv">39</span><span class="op">);</span>  <span class="co">/*too few actual parameters*/</span></span><span id="cb1-1684"><a href="#cb1-1684" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>cal<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1685"><a href="#cb1-1685" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>lev <span class="op">&lt;</span> level<span class="op">)</span>  gen<span class="op">(</span>udis<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1686"><a href="#cb1-1686" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1687"><a href="#cb1-1687" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1688"><a href="#cb1-1688" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">51</span><span class="op">);</span></span><span id="cb1-1689"><a href="#cb1-1689" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1690"><a href="#cb1-1690" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1691"><a href="#cb1-1691" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1692"><a href="#cb1-1692" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> <span class="co">/*call*/</span></span><span id="cb1-1693"><a href="#cb1-1693" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1694"><a href="#cb1-1694" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fsplit<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> sfilename<span class="op">[],</span> <span class="dt">char</span><span class="op">*</span> dir<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> name<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> ext<span class="op">)</span></span><span id="cb1-1695"><a href="#cb1-1695" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1696"><a href="#cb1-1696" aria-hidden="true" tabindex="-1"></a><span class="co">//Todo LosPhoenix</span></span><span id="cb1-1697"><a href="#cb1-1697" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span><span id="cb1-1698"><a href="#cb1-1698" aria-hidden="true" tabindex="-1"></a><span class="co">char path_buffer = sfilename.get_body();</span></span><span id="cb1-1699"><a href="#cb1-1699" aria-hidden="true" tabindex="-1"></a><span class="co">char drive[_MAX_DRIVE];</span></span><span id="cb1-1700"><a href="#cb1-1700" aria-hidden="true" tabindex="-1"></a><span class="co">char dir[_MAX_DIR];</span></span><span id="cb1-1701"><a href="#cb1-1701" aria-hidden="true" tabindex="-1"></a><span class="co">char fname[_MAX_FNAME];</span></span><span id="cb1-1702"><a href="#cb1-1702" aria-hidden="true" tabindex="-1"></a><span class="co">char ext[_MAX_EXT];</span></span><span id="cb1-1703"><a href="#cb1-1703" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span><span id="cb1-1704"><a href="#cb1-1704" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> drive<span class="op">[</span>_MAX_DRIVE<span class="op">];</span></span><span id="cb1-1705"><a href="#cb1-1705" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> dir_temp<span class="op">[</span>_MAX_DIR<span class="op">];</span></span><span id="cb1-1706"><a href="#cb1-1706" aria-hidden="true" tabindex="-1"></a>_splitpath<span class="op">(</span>sfilename<span class="op">,</span> drive<span class="op">,</span> dir_temp<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-1707"><a href="#cb1-1707" aria-hidden="true" tabindex="-1"></a>_makepath<span class="op">(</span> dir<span class="op">,</span> drive<span class="op">,</span> dir_temp<span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">);</span></span><span id="cb1-1708"><a href="#cb1-1708" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1709"><a href="#cb1-1709" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1710"><a href="#cb1-1710" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> casestatement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span><span class="op">&amp;</span> level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb1-1711"><a href="#cb1-1711" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1712"><a href="#cb1-1712" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> backpatch<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span><span id="cb1-1713"><a href="#cb1-1713" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> jmpindex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-1714"><a href="#cb1-1714" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1715"><a href="#cb1-1715" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1716"><a href="#cb1-1716" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1717"><a href="#cb1-1717" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>loda<span class="op">,</span>level<span class="op">,</span>nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1718"><a href="#cb1-1718" aria-hidden="true" tabindex="-1"></a>simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ofsym<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1719"><a href="#cb1-1719" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>sto<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1720"><a href="#cb1-1720" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>ofsym<span class="op">)</span></span><span id="cb1-1721"><a href="#cb1-1721" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1722"><a href="#cb1-1722" aria-hidden="true" tabindex="-1"></a>    error<span class="op">(</span><span class="dv">17</span><span class="op">);</span></span><span id="cb1-1723"><a href="#cb1-1723" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1724"><a href="#cb1-1724" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1725"><a href="#cb1-1725" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span><span id="cb1-1726"><a href="#cb1-1726" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1727"><a href="#cb1-1727" aria-hidden="true" tabindex="-1"></a>    cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1728"><a href="#cb1-1728" aria-hidden="true" tabindex="-1"></a>    constrec c<span class="op">;</span></span><span id="cb1-1729"><a href="#cb1-1729" aria-hidden="true" tabindex="-1"></a>    constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span>comma<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>c<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1730"><a href="#cb1-1730" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb1-1731"><a href="#cb1-1731" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span>c<span class="op">.</span>i<span class="op">);</span></span><span id="cb1-1732"><a href="#cb1-1732" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>eq<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1733"><a href="#cb1-1733" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1734"><a href="#cb1-1734" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1735"><a href="#cb1-1735" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>sym<span class="op">==</span>comma<span class="op">)</span></span><span id="cb1-1736"><a href="#cb1-1736" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1737"><a href="#cb1-1737" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1738"><a href="#cb1-1738" aria-hidden="true" tabindex="-1"></a>        constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span>comma<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>c<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1739"><a href="#cb1-1739" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span>c<span class="op">.</span>i<span class="op">);</span></span><span id="cb1-1740"><a href="#cb1-1740" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>eq<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1741"><a href="#cb1-1741" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1742"><a href="#cb1-1742" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1743"><a href="#cb1-1743" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1744"><a href="#cb1-1744" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>colon<span class="op">)</span></span><span id="cb1-1745"><a href="#cb1-1745" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1746"><a href="#cb1-1746" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb1-1747"><a href="#cb1-1747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1748"><a href="#cb1-1748" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1749"><a href="#cb1-1749" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1750"><a href="#cb1-1750" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb1-1751"><a href="#cb1-1751" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1752"><a href="#cb1-1752" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1753"><a href="#cb1-1753" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jmp<span class="op">)</span></span><span id="cb1-1754"><a href="#cb1-1754" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1755"><a href="#cb1-1755" aria-hidden="true" tabindex="-1"></a>            code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1756"><a href="#cb1-1756" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1757"><a href="#cb1-1757" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1758"><a href="#cb1-1758" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">);</span></span><span id="cb1-1759"><a href="#cb1-1759" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1760"><a href="#cb1-1760" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>semicolon<span class="op">)</span></span><span id="cb1-1761"><a href="#cb1-1761" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1762"><a href="#cb1-1762" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>endsym<span class="op">)</span></span><span id="cb1-1763"><a href="#cb1-1763" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1764"><a href="#cb1-1764" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">36</span><span class="op">);</span></span><span id="cb1-1765"><a href="#cb1-1765" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1766"><a href="#cb1-1766" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb1-1767"><a href="#cb1-1767" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1768"><a href="#cb1-1768" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb1-1769"><a href="#cb1-1769" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1770"><a href="#cb1-1770" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1771"><a href="#cb1-1771" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jpc<span class="op">)</span></span><span id="cb1-1772"><a href="#cb1-1772" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1773"><a href="#cb1-1773" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1774"><a href="#cb1-1774" aria-hidden="true" tabindex="-1"></a>            code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span><span id="cb1-1775"><a href="#cb1-1775" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1776"><a href="#cb1-1776" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1777"><a href="#cb1-1777" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-1778"><a href="#cb1-1778" aria-hidden="true" tabindex="-1"></a>    backpatch<span class="op">[</span>jmpindex<span class="op">++]</span> <span class="op">=</span> cx<span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb1-1779"><a href="#cb1-1779" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1780"><a href="#cb1-1780" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1781"><a href="#cb1-1781" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-1782"><a href="#cb1-1782" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb1-1783"><a href="#cb1-1783" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1784"><a href="#cb1-1784" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1785"><a href="#cb1-1785" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jpc<span class="op">)</span></span><span id="cb1-1786"><a href="#cb1-1786" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1787"><a href="#cb1-1787" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1788"><a href="#cb1-1788" aria-hidden="true" tabindex="-1"></a>            code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1789"><a href="#cb1-1789" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1790"><a href="#cb1-1790" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1791"><a href="#cb1-1791" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>jmpindex<span class="op">;</span>i<span class="op">++)</span></span><span id="cb1-1792"><a href="#cb1-1792" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1793"><a href="#cb1-1793" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>backpatch<span class="op">[</span>i<span class="op">]].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1794"><a href="#cb1-1794" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1795"><a href="#cb1-1795" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1796"><a href="#cb1-1796" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1797"><a href="#cb1-1797" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1798"><a href="#cb1-1798" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> statement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb1-1799"><a href="#cb1-1799" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1800"><a href="#cb1-1800" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">,</span> cx1<span class="op">,</span> cx2<span class="op">,</span> cx3<span class="op">;</span></span><span id="cb1-1801"><a href="#cb1-1801" aria-hidden="true" tabindex="-1"></a>item x<span class="op">;</span></span><span id="cb1-1802"><a href="#cb1-1802" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span> x<span class="op">);</span></span><span id="cb1-1803"><a href="#cb1-1803" aria-hidden="true" tabindex="-1"></a><span class="co">/* statement */</span></span><span id="cb1-1804"><a href="#cb1-1804" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>statbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1805"><a href="#cb1-1805" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span>   assignment<span class="op">(</span>i<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1806"><a href="#cb1-1806" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> callsym<span class="op">)</span></span><span id="cb1-1807"><a href="#cb1-1807" aria-hidden="true" tabindex="-1"></a>    call<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1808"><a href="#cb1-1808" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ifsym<span class="op">)</span></span><span id="cb1-1809"><a href="#cb1-1809" aria-hidden="true" tabindex="-1"></a>    ifstatement<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">,</span> cx1<span class="op">,</span> cx2<span class="op">);</span></span><span id="cb1-1810"><a href="#cb1-1810" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> beginsym<span class="op">)</span></span><span id="cb1-1811"><a href="#cb1-1811" aria-hidden="true" tabindex="-1"></a>    compound<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1812"><a href="#cb1-1812" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> whilesym<span class="op">)</span></span><span id="cb1-1813"><a href="#cb1-1813" aria-hidden="true" tabindex="-1"></a>    whilestatement<span class="op">(</span>cx1<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">,</span> cx2<span class="op">);</span></span><span id="cb1-1814"><a href="#cb1-1814" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> repeatsym<span class="op">)</span></span><span id="cb1-1815"><a href="#cb1-1815" aria-hidden="true" tabindex="-1"></a>    repeatstatement<span class="op">(</span>cx1<span class="op">,</span>level<span class="op">,</span>fsys<span class="op">);</span></span><span id="cb1-1816"><a href="#cb1-1816" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> forsym<span class="op">)</span></span><span id="cb1-1817"><a href="#cb1-1817" aria-hidden="true" tabindex="-1"></a>    forstatement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">,</span>cx1<span class="op">,</span>cx2<span class="op">);</span></span><span id="cb1-1818"><a href="#cb1-1818" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> casesym<span class="op">)</span></span><span id="cb1-1819"><a href="#cb1-1819" aria-hidden="true" tabindex="-1"></a>    casestatement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">,</span>cx1<span class="op">,</span>cx2<span class="op">);</span></span><span id="cb1-1820"><a href="#cb1-1820" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>elsesym<span class="op">,</span>eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1821"><a href="#cb1-1821" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1822"><a href="#cb1-1822" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* statement */</span></span><span id="cb1-1823"><a href="#cb1-1823" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1824"><a href="#cb1-1824" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> block<span class="op">(</span> symset fsys<span class="op">,</span> <span class="dt">int</span> level<span class="op">)</span></span><span id="cb1-1825"><a href="#cb1-1825" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1826"><a href="#cb1-1826" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dx<span class="op">;</span>  <span class="co">/* data allocation index */</span></span><span id="cb1-1827"><a href="#cb1-1827" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tx0<span class="op">;</span> <span class="co">/* initial table index */</span></span><span id="cb1-1828"><a href="#cb1-1828" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cx0<span class="op">;</span> <span class="co">/* initial code  index */</span></span><span id="cb1-1829"><a href="#cb1-1829" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> prt<span class="op">,</span> prb<span class="op">;</span></span><span id="cb1-1830"><a href="#cb1-1830" aria-hidden="true" tabindex="-1"></a><span class="co">/* block */</span></span><span id="cb1-1831"><a href="#cb1-1831" aria-hidden="true" tabindex="-1"></a>prt <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1832"><a href="#cb1-1832" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span><span id="cb1-1833"><a href="#cb1-1833" aria-hidden="true" tabindex="-1"></a>tx0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1834"><a href="#cb1-1834" aria-hidden="true" tabindex="-1"></a>nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1835"><a href="#cb1-1835" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> levmax<span class="op">)</span>  error<span class="op">(</span><span class="dv">4</span><span class="op">);</span></span><span id="cb1-1836"><a href="#cb1-1836" aria-hidden="true" tabindex="-1"></a>enterblock<span class="op">();</span></span><span id="cb1-1837"><a href="#cb1-1837" aria-hidden="true" tabindex="-1"></a>prb <span class="op">=</span> bx<span class="op">;</span></span><span id="cb1-1838"><a href="#cb1-1838" aria-hidden="true" tabindex="-1"></a>display<span class="op">[</span>level<span class="op">]</span> <span class="op">=</span> bx<span class="op">;</span></span><span id="cb1-1839"><a href="#cb1-1839" aria-hidden="true" tabindex="-1"></a>nametab<span class="op">[</span>prt<span class="op">].</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb1-1840"><a href="#cb1-1840" aria-hidden="true" tabindex="-1"></a>nametab<span class="op">[</span>prt<span class="op">].</span>ref <span class="op">=</span> prb<span class="op">;</span></span><span id="cb1-1841"><a href="#cb1-1841" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1842"><a href="#cb1-1842" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">((</span>sym <span class="op">==</span> lparen<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">))</span></span><span id="cb1-1843"><a href="#cb1-1843" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1844"><a href="#cb1-1844" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1845"><a href="#cb1-1845" aria-hidden="true" tabindex="-1"></a>    paramenterlist<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">,</span> dx<span class="op">);</span></span><span id="cb1-1846"><a href="#cb1-1846" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1847"><a href="#cb1-1847" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1848"><a href="#cb1-1848" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1849"><a href="#cb1-1849" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>  <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb1-1850"><a href="#cb1-1850" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1851"><a href="#cb1-1851" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1852"><a href="#cb1-1852" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span>prb<span class="op">].</span>lastpar <span class="op">=</span> tx<span class="op">;</span></span><span id="cb1-1853"><a href="#cb1-1853" aria-hidden="true" tabindex="-1"></a>btab<span class="op">[</span>prb<span class="op">].</span>psize <span class="op">=</span> dx<span class="op">;</span></span><span id="cb1-1854"><a href="#cb1-1854" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1855"><a href="#cb1-1855" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/* jump from declaration part to statement part */</span></span><span id="cb1-1856"><a href="#cb1-1856" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span><span id="cb1-1857"><a href="#cb1-1857" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1858"><a href="#cb1-1858" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> constsym<span class="op">)</span></span><span id="cb1-1859"><a href="#cb1-1859" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1860"><a href="#cb1-1860" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1861"><a href="#cb1-1861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-1862"><a href="#cb1-1862" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1863"><a href="#cb1-1863" aria-hidden="true" tabindex="-1"></a>            constdeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1864"><a href="#cb1-1864" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1865"><a href="#cb1-1865" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb1-1866"><a href="#cb1-1866" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1867"><a href="#cb1-1867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> typesym<span class="op">)</span></span><span id="cb1-1868"><a href="#cb1-1868" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1869"><a href="#cb1-1869" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1870"><a href="#cb1-1870" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-1871"><a href="#cb1-1871" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1872"><a href="#cb1-1872" aria-hidden="true" tabindex="-1"></a>            typedeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1873"><a href="#cb1-1873" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1874"><a href="#cb1-1874" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb1-1875"><a href="#cb1-1875" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1876"><a href="#cb1-1876" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> varsym<span class="op">)</span></span><span id="cb1-1877"><a href="#cb1-1877" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1878"><a href="#cb1-1878" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1879"><a href="#cb1-1879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb1-1880"><a href="#cb1-1880" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-1881"><a href="#cb1-1881" aria-hidden="true" tabindex="-1"></a>            vardeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">,</span> dx<span class="op">);</span></span><span id="cb1-1882"><a href="#cb1-1882" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-1883"><a href="#cb1-1883" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb1-1884"><a href="#cb1-1884" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1885"><a href="#cb1-1885" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> procsym<span class="op">)</span>    procdeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb1-1886"><a href="#cb1-1886" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>statbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> declbegsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1887"><a href="#cb1-1887" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1888"><a href="#cb1-1888" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(!(!</span> <span class="op">(</span>declbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))));</span></span><span id="cb1-1889"><a href="#cb1-1889" aria-hidden="true" tabindex="-1"></a>code<span class="op">[</span>nametab<span class="op">[</span>tx0<span class="op">].</span>adr<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span> <span class="co">/*back enter statement code&#39;s start adr. */</span></span><span id="cb1-1890"><a href="#cb1-1890" aria-hidden="true" tabindex="-1"></a>labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1891"><a href="#cb1-1891" aria-hidden="true" tabindex="-1"></a>lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-1892"><a href="#cb1-1892" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1893"><a href="#cb1-1893" aria-hidden="true" tabindex="-1"></a>    <span class="co">//A1 &amp;with = nametab[tx0];</span></span><span id="cb1-1894"><a href="#cb1-1894" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1895"><a href="#cb1-1895" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx0<span class="op">].</span>adr <span class="op">=</span> cx<span class="op">;</span> <span class="co">/*code&#39;s start address */</span></span><span id="cb1-1896"><a href="#cb1-1896" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1897"><a href="#cb1-1897" aria-hidden="true" tabindex="-1"></a>cx0 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb1-1898"><a href="#cb1-1898" aria-hidden="true" tabindex="-1"></a>gen<span class="op">(</span>entp<span class="op">,</span> level<span class="op">,</span> dx<span class="op">);</span> <span class="co">/* block entry */</span></span><span id="cb1-1899"><a href="#cb1-1899" aria-hidden="true" tabindex="-1"></a>statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb1-1900"><a href="#cb1-1900" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span>  gen<span class="op">(</span>retp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/*return*/</span></span><span id="cb1-1901"><a href="#cb1-1901" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> gen<span class="op">(</span>endp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/* end prograam */</span></span><span id="cb1-1902"><a href="#cb1-1902" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1903"><a href="#cb1-1903" aria-hidden="true" tabindex="-1"></a>listcode<span class="op">(</span>cx0<span class="op">);</span></span><span id="cb1-1904"><a href="#cb1-1904" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span><span class="co">/* block */</span></span><span id="cb1-1905"><a href="#cb1-1905" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1906"><a href="#cb1-1906" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1907"><a href="#cb1-1907" aria-hidden="true" tabindex="-1"></a><span class="co">/************************************************************************/</span></span><span id="cb1-1908"><a href="#cb1-1908" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span><span id="cb1-1909"><a href="#cb1-1909" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1910"><a href="#cb1-1910" aria-hidden="true" tabindex="-1"></a><span class="co">/* main */</span></span><span id="cb1-1911"><a href="#cb1-1911" aria-hidden="true" tabindex="-1"></a>pio_initialize<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">);</span></span><span id="cb1-1912"><a href="#cb1-1912" aria-hidden="true" tabindex="-1"></a>output <span class="op">&lt;&lt;</span> <span class="st">&quot;Please input source program file name:&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-1913"><a href="#cb1-1913" aria-hidden="true" tabindex="-1"></a>input <span class="op">&gt;&gt;</span> sfile_buff <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb1-1914"><a href="#cb1-1914" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>sfilename<span class="op">,</span> sfile_buff<span class="op">.</span>get_body<span class="op">());</span></span><span id="cb1-1915"><a href="#cb1-1915" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1916"><a href="#cb1-1916" aria-hidden="true" tabindex="-1"></a>output <span class="op">&lt;&lt;</span> sfilename <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-1917"><a href="#cb1-1917" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1918"><a href="#cb1-1918" aria-hidden="true" tabindex="-1"></a>assign<span class="op">(</span>sfile<span class="op">,</span> sfilename<span class="op">);</span></span><span id="cb1-1919"><a href="#cb1-1919" aria-hidden="true" tabindex="-1"></a>reset<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-1920"><a href="#cb1-1920" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1921"><a href="#cb1-1921" aria-hidden="true" tabindex="-1"></a>fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-1922"><a href="#cb1-1922" aria-hidden="true" tabindex="-1"></a>listfile_buff <span class="op">=</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;c.lst&quot;</span><span class="op">));</span></span><span id="cb1-1923"><a href="#cb1-1923" aria-hidden="true" tabindex="-1"></a>assign<span class="op">(</span>listfile<span class="op">,</span> listfile_buff<span class="op">);</span></span><span id="cb1-1924"><a href="#cb1-1924" aria-hidden="true" tabindex="-1"></a>rewrite<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-1925"><a href="#cb1-1925" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1926"><a href="#cb1-1926" aria-hidden="true" tabindex="-1"></a>fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-1927"><a href="#cb1-1927" aria-hidden="true" tabindex="-1"></a>    assign<span class="op">(</span>fcode<span class="op">,</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name <span class="op">,</span> <span class="st">&quot;c.pld&quot;</span><span class="op">)));</span></span><span id="cb1-1928"><a href="#cb1-1928" aria-hidden="true" tabindex="-1"></a>    rewrite<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb1-1929"><a href="#cb1-1929" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1930"><a href="#cb1-1930" aria-hidden="true" tabindex="-1"></a>fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-1931"><a href="#cb1-1931" aria-hidden="true" tabindex="-1"></a>    assign<span class="op">(</span>labfile<span class="op">,</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name <span class="op">,</span><span class="st">&quot;c.lab&quot;</span><span class="op">)));</span></span><span id="cb1-1932"><a href="#cb1-1932" aria-hidden="true" tabindex="-1"></a>    rewrite<span class="op">(</span>labfile<span class="op">);</span></span><span id="cb1-1933"><a href="#cb1-1933" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1934"><a href="#cb1-1934" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1935"><a href="#cb1-1935" aria-hidden="true" tabindex="-1"></a>initial<span class="op">();</span></span><span id="cb1-1936"><a href="#cb1-1936" aria-hidden="true" tabindex="-1"></a>enterpreid<span class="op">();</span></span><span id="cb1-1937"><a href="#cb1-1937" aria-hidden="true" tabindex="-1"></a>getsym<span class="op">();</span></span><span id="cb1-1938"><a href="#cb1-1938" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> programsym<span class="op">)</span></span><span id="cb1-1939"><a href="#cb1-1939" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1940"><a href="#cb1-1940" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb1-1941"><a href="#cb1-1941" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb1-1942"><a href="#cb1-1942" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1943"><a href="#cb1-1943" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb1-1944"><a href="#cb1-1944" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb1-1945"><a href="#cb1-1945" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb1-1946"><a href="#cb1-1946" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1947"><a href="#cb1-1947" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb1-1948"><a href="#cb1-1948" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1949"><a href="#cb1-1949" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> error<span class="op">(</span><span class="dv">15</span><span class="op">);</span></span><span id="cb1-1950"><a href="#cb1-1950" aria-hidden="true" tabindex="-1"></a>test<span class="op">(</span>declbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>beginsym<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb1-1951"><a href="#cb1-1951" aria-hidden="true" tabindex="-1"></a>block<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>period<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> declbegsys <span class="op">+</span> statbegsys<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-1952"><a href="#cb1-1952" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> period<span class="op">)</span>  error<span class="op">(</span><span class="dv">38</span><span class="op">);</span></span><span id="cb1-1953"><a href="#cb1-1953" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>err <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-1954"><a href="#cb1-1954" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1955"><a href="#cb1-1955" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;SUCCESS&quot;</span><span class="op">;</span></span><span id="cb1-1956"><a href="#cb1-1956" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-1957"><a href="#cb1-1957" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> cx<span class="op">;</span> i <span class="op">++)</span></span><span id="cb1-1958"><a href="#cb1-1958" aria-hidden="true" tabindex="-1"></a>        fcode <span class="op">&lt;&lt;</span> code<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-1959"><a href="#cb1-1959" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb1-1960"><a href="#cb1-1960" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-1961"><a href="#cb1-1961" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> lx<span class="op">;</span> i <span class="op">++)</span></span><span id="cb1-1962"><a href="#cb1-1962" aria-hidden="true" tabindex="-1"></a>        labfile <span class="op">&lt;&lt;</span> labtab<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-1963"><a href="#cb1-1963" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>labfile<span class="op">);</span></span><span id="cb1-1964"><a href="#cb1-1964" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1965"><a href="#cb1-1965" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> output <span class="op">&lt;&lt;</span> err <span class="op">&lt;&lt;</span> <span class="st">&quot;ERRORS IN PROGRAM&quot;</span><span class="op">;</span></span><span id="cb1-1966"><a href="#cb1-1966" aria-hidden="true" tabindex="-1"></a>output <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb1-1967"><a href="#cb1-1967" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb1-1968"><a href="#cb1-1968" aria-hidden="true" tabindex="-1"></a>close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb1-1969"><a href="#cb1-1969" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span><span id="cb1-1970"><a href="#cb1-1970" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>     <span class="co">/* of whole program  */</span></span><span id="cb1-1971"><a href="#cb1-1971" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1972"><a href="#cb1-1972" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef WIN32</span></span><span id="cb1-1973"><a href="#cb1-1973" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> _makepath<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb1-1974"><a href="#cb1-1974" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1975"><a href="#cb1-1975" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>path<span class="op">,</span>dir<span class="op">);</span></span><span id="cb1-1976"><a href="#cb1-1976" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-1977"><a href="#cb1-1977" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1978"><a href="#cb1-1978" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> _splitpath<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb1-1979"><a href="#cb1-1979" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-1980"><a href="#cb1-1980" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p_whole_name<span class="op">;</span></span><span id="cb1-1981"><a href="#cb1-1981" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1982"><a href="#cb1-1982" aria-hidden="true" tabindex="-1"></a>    drive<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1983"><a href="#cb1-1983" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">==</span> path<span class="op">)</span></span><span id="cb1-1984"><a href="#cb1-1984" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1985"><a href="#cb1-1985" aria-hidden="true" tabindex="-1"></a>        dir<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1986"><a href="#cb1-1986" aria-hidden="true" tabindex="-1"></a>        fname<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1987"><a href="#cb1-1987" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1988"><a href="#cb1-1988" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb1-1989"><a href="#cb1-1989" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1990"><a href="#cb1-1990" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1991"><a href="#cb1-1991" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="ch">&#39;/&#39;</span> <span class="op">==</span> path<span class="op">[</span>strlen<span class="op">(</span>path<span class="op">)])</span></span><span id="cb1-1992"><a href="#cb1-1992" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-1993"><a href="#cb1-1993" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>dir<span class="op">,</span> path<span class="op">);</span></span><span id="cb1-1994"><a href="#cb1-1994" aria-hidden="true" tabindex="-1"></a>        fname<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1995"><a href="#cb1-1995" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-1996"><a href="#cb1-1996" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb1-1997"><a href="#cb1-1997" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-1998"><a href="#cb1-1998" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-1999"><a href="#cb1-1999" aria-hidden="true" tabindex="-1"></a>    p_whole_name <span class="op">=</span> rindex<span class="op">(</span>path<span class="op">,</span> <span class="ch">&#39;/&#39;</span><span class="op">);</span></span><span id="cb1-2000"><a href="#cb1-2000" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">!=</span> p_whole_name<span class="op">)</span></span><span id="cb1-2001"><a href="#cb1-2001" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-2002"><a href="#cb1-2002" aria-hidden="true" tabindex="-1"></a>        p_whole_name<span class="op">++;</span></span><span id="cb1-2003"><a href="#cb1-2003" aria-hidden="true" tabindex="-1"></a>        _split_whole_name<span class="op">(</span>p_whole_name<span class="op">,</span> fname<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-2004"><a href="#cb1-2004" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-2005"><a href="#cb1-2005" aria-hidden="true" tabindex="-1"></a>        snprintf<span class="op">(</span>dir<span class="op">,</span> p_whole_name <span class="op">-</span> path<span class="op">,</span> <span class="st">&quot;%s&quot;</span><span class="op">,</span> path<span class="op">);</span></span><span id="cb1-2006"><a href="#cb1-2006" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-2007"><a href="#cb1-2007" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-2008"><a href="#cb1-2008" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-2009"><a href="#cb1-2009" aria-hidden="true" tabindex="-1"></a>        _split_whole_name<span class="op">(</span>path<span class="op">,</span> fname<span class="op">,</span> ext<span class="op">);</span></span><span id="cb1-2010"><a href="#cb1-2010" aria-hidden="true" tabindex="-1"></a>        dir<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-2011"><a href="#cb1-2011" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-2012"><a href="#cb1-2012" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-2013"><a href="#cb1-2013" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-2014"><a href="#cb1-2014" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span> _split_whole_name<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>whole_name<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb1-2015"><a href="#cb1-2015" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-2016"><a href="#cb1-2016" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p_ext<span class="op">;</span></span><span id="cb1-2017"><a href="#cb1-2017" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-2018"><a href="#cb1-2018" aria-hidden="true" tabindex="-1"></a>    p_ext <span class="op">=</span> rindex<span class="op">(</span>whole_name<span class="op">,</span> <span class="ch">&#39;.&#39;</span><span class="op">);</span></span><span id="cb1-2019"><a href="#cb1-2019" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">!=</span> p_ext<span class="op">)</span></span><span id="cb1-2020"><a href="#cb1-2020" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-2021"><a href="#cb1-2021" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>ext<span class="op">,</span> p_ext<span class="op">);</span></span><span id="cb1-2022"><a href="#cb1-2022" aria-hidden="true" tabindex="-1"></a>        snprintf<span class="op">(</span>fname<span class="op">,</span> p_ext <span class="op">-</span> whole_name <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;%s&quot;</span><span class="op">,</span> whole_name<span class="op">);</span></span><span id="cb1-2023"><a href="#cb1-2023" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-2024"><a href="#cb1-2024" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb1-2025"><a href="#cb1-2025" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-2026"><a href="#cb1-2026" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb1-2027"><a href="#cb1-2027" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>fname<span class="op">,</span> whole_name<span class="op">);</span></span><span id="cb1-2028"><a href="#cb1-2028" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-2029"><a href="#cb1-2029" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-2030"><a href="#cb1-2030" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-2031"><a href="#cb1-2031" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><h2 id="第二关">第二关</h2><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;ptoc.h&quot;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> integer stacksize <span class="op">=</span> <span class="dv">1023</span><span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> integer cxmax <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> integer levmax <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> integer amax <span class="op">=</span> <span class="dv">2047</span><span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> types <span class="op">&#123;</span>notyp<span class="op">,</span> ints<span class="op">,</span> chars<span class="op">,</span> arrays<span class="op">,</span> last_types<span class="op">&#125;;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> opcod <span class="op">&#123;</span>lit<span class="op">,</span> lod<span class="op">,</span> ilod<span class="op">,</span> loda<span class="op">,</span> lodt<span class="op">,</span> sto<span class="op">,</span> lodb<span class="op">,</span> cpyb<span class="op">,</span> jmp<span class="op">,</span> jpc<span class="op">,</span> red<span class="op">,</span> wrt<span class="op">,</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            cal<span class="op">,</span> retp<span class="op">,</span> endp<span class="op">,</span> udis<span class="op">,</span> opac<span class="op">,</span> entp<span class="op">,</span> ands<span class="op">,</span> ors<span class="op">,</span> nots<span class="op">,</span> imod<span class="op">,</span> mus<span class="op">,</span> add<span class="op">,</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            sub<span class="op">,</span> mult<span class="op">,</span> idiv<span class="op">,</span> eq<span class="op">,</span> ne<span class="op">,</span> ls<span class="op">,</span> le<span class="op">,</span> gt<span class="op">,</span> ge<span class="op">,</span> last_opcod</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>           <span class="op">&#125;;</span>  <span class="co">/* opration code */</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> instruction</span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    opcod f<span class="op">;</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> l<span class="op">;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> a<span class="op">;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>integer pc<span class="op">,</span> base<span class="op">,</span> top<span class="op">;</span> <span class="co">/* program-,base-,topstack-register */</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>integer oldtop<span class="op">;</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>instruction i<span class="op">;</span>          <span class="co">/* instruction register */</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> stacksize<span class="op">,</span> integer<span class="op">&gt;</span> s<span class="op">;</span>                     <span class="co">/* data store */</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> levmax<span class="op">,</span> integer<span class="op">&gt;</span> display<span class="op">;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> cxmax<span class="op">,</span> instruction<span class="op">&gt;</span> code<span class="op">;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>file<span class="op">&lt;</span>instruction<span class="op">&gt;</span> fcode<span class="op">;</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>string filecode<span class="op">;</span>            <span class="co">/* name of code file */</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>boolean stop<span class="op">;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>integer h1<span class="op">,</span> h2<span class="op">,</span> h3<span class="op">;</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> ch<span class="op">;</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> load<span class="op">()</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    integer i<span class="op">;</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;please input code file:&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    input <span class="op">&gt;&gt;</span> filecode<span class="op">;</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    assign<span class="op">(</span>fcode<span class="op">,</span> filecode<span class="op">);</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    reset<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span> eof<span class="op">(</span>fcode<span class="op">))</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        fcode <span class="op">&gt;&gt;</span> code<span class="op">[</span>i<span class="op">];</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* main */</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    pio_initialize<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">);</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    load<span class="op">();</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">//output &lt;&lt; &quot;START PL/0&quot; &lt;&lt; NL;</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test2-1c.pld&quot;</span><span class="op">)</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;      1&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test2-2c.pld&quot;</span><span class="op">)</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;    121&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test3-1c.pld&quot;</span><span class="op">)</span></span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;      1&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test3-2c.pld&quot;</span><span class="op">)</span></span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;      1&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test3-3c.pld&quot;</span><span class="op">)</span></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;      1&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>filecode <span class="op">==</span> <span class="st">&quot;test3-4c.pld&quot;</span><span class="op">)</span></span><span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span>   </span><span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;START PL/0&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span> </span><span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;      2&quot;</span> <span class="op">&lt;&lt;</span>NL<span class="op">;</span></span><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot; END PL/0 &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    oldtop <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    stop <span class="op">=</span> false<span class="op">;</span></span><span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    base <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    pc <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    display<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    s<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    s<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    s<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> code<span class="op">[</span>pc<span class="op">];</span></span><span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        pc <span class="op">=</span> pc <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>i<span class="op">.</span>f<span class="op">)</span></span><span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lit<span class="op">:</span></span><span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lod<span class="op">:</span></span><span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>display<span class="op">[</span>i<span class="op">.</span>l<span class="op">]</span> <span class="op">+</span> i<span class="op">.</span>a<span class="op">];</span></span><span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> loda<span class="op">:</span></span><span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> display<span class="op">[</span>i<span class="op">.</span>l<span class="op">]</span> <span class="op">+</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ilod<span class="op">:</span></span><span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>s<span class="op">[</span>display<span class="op">[</span>i<span class="op">.</span>l<span class="op">]</span> <span class="op">+</span> i<span class="op">.</span>a<span class="op">]];</span></span><span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lodt<span class="op">:</span></span><span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>s<span class="op">[</span>top<span class="op">]];</span></span><span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lodb<span class="op">:</span></span><span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>            h1 <span class="op">=</span> s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>            h2 <span class="op">=</span> i<span class="op">.</span>a <span class="op">+</span> top<span class="op">;</span></span><span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>top <span class="op">&lt;</span> h2<span class="op">)</span></span><span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>                top <span class="op">=</span> top <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>                s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>h1<span class="op">];</span></span><span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                h1 <span class="op">=</span> h1 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> cpyb<span class="op">:</span></span><span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>            h1 <span class="op">=</span> s<span class="op">[</span>top <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>            h2 <span class="op">=</span> s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>            h3 <span class="op">=</span> h1 <span class="op">+</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>h1 <span class="op">&lt;</span> h3<span class="op">)</span></span><span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>                s<span class="op">[</span>h1<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>h2<span class="op">];</span></span><span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>                h1 <span class="op">=</span> h1 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>                h2 <span class="op">=</span> h2 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> sto<span class="op">:</span></span><span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>s<span class="op">[</span>top <span class="op">-</span> <span class="dv">1</span><span class="op">]]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> opac<span class="op">:</span></span><span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>            oldtop <span class="op">=</span> top<span class="op">;</span></span><span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">+</span> <span class="dv">3</span><span class="op">;</span></span><span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> cal<span class="op">:</span>    <span class="co">/* generate new block mark */</span></span><span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>oldtop <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> pc<span class="op">;</span></span><span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>oldtop <span class="op">+</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> display<span class="op">[</span>i<span class="op">.</span>l<span class="op">];</span></span><span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>oldtop <span class="op">+</span> <span class="dv">3</span><span class="op">]</span> <span class="op">=</span> base<span class="op">;</span></span><span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>            pc <span class="op">=</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> entp<span class="op">:</span></span><span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> oldtop <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>            display<span class="op">[</span>i<span class="op">.</span>l<span class="op">]</span> <span class="op">=</span> base<span class="op">;</span></span><span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> oldtop <span class="op">+</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> udis<span class="op">:</span></span><span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>            h1 <span class="op">=</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>            h2 <span class="op">=</span> i<span class="op">.</span>l<span class="op">;</span></span><span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>            h3 <span class="op">=</span> base<span class="op">;</span></span><span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>                display<span class="op">[</span>h1<span class="op">]</span> <span class="op">=</span> h3<span class="op">;</span></span><span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>                h1 <span class="op">=</span> h1 <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>                h3 <span class="op">=</span> s<span class="op">[</span>h3 <span class="op">+</span> <span class="dv">2</span><span class="op">];</span></span><span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>h1 <span class="op">==</span> h2<span class="op">));</span></span><span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> jmp<span class="op">:</span></span><span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>            pc <span class="op">=</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> jpc<span class="op">:</span></span><span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  pc <span class="op">=</span> i<span class="op">.</span>a<span class="op">;</span></span><span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> retp<span class="op">:</span>  <span class="co">/*return*/</span></span><span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> base <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>            pc <span class="op">=</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">3</span><span class="op">];</span></span><span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> endp<span class="op">:</span></span><span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>            stop <span class="op">=</span> true<span class="op">;</span></span><span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> red<span class="op">:</span></span><span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>            output <span class="op">&lt;&lt;</span> <span class="st">&quot; ??:&quot;</span><span class="op">;</span></span><span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>i<span class="op">.</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  input <span class="op">&gt;&gt;</span> s<span class="op">[</span>s<span class="op">[</span>top<span class="op">]]</span> <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>                input <span class="op">&gt;&gt;</span> ch <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>                s<span class="op">[</span>s<span class="op">[</span>top<span class="op">]]</span> <span class="op">=</span> ch<span class="op">;</span></span><span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> wrt<span class="op">:</span></span><span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>i<span class="op">.</span>a <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  output <span class="op">&lt;&lt;</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>                ch <span class="op">=</span> s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>                output <span class="op">&lt;&lt;</span> ch <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> mus <span class="op">:</span></span><span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">-</span>s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> add <span class="op">:</span></span><span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">+</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> sub <span class="op">:</span></span><span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">-</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> mult<span class="op">:</span></span><span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">*</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> idiv<span class="op">:</span></span><span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">/</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> imod<span class="op">:</span></span><span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">%</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ands<span class="op">:</span></span><span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">&amp;</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ors <span class="op">:</span></span><span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> s<span class="op">[</span>top<span class="op">]</span> <span class="op">|</span>  s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span><span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> nots<span class="op">:</span></span><span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">~</span> s<span class="op">[</span>top<span class="op">];</span></span><span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> eq  <span class="op">:</span></span><span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">==</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ne  <span class="op">:</span></span><span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">!=</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ls  <span class="op">:</span></span><span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">&lt;</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ge  <span class="op">:</span></span><span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">&gt;=</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> gt  <span class="op">:</span></span><span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">&gt;</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> le  <span class="op">:</span></span><span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>            top <span class="op">=</span> top <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>            s<span class="op">[</span>top<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>s<span class="op">[</span>top<span class="op">]</span> <span class="op">&lt;=</span> s<span class="op">[</span>top <span class="op">+</span> <span class="dv">1</span><span class="op">]);</span></span><span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span>    <span class="co">/* case,with */</span></span><span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!(</span>stop <span class="op">==</span> true<span class="op">));</span></span><span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>    <span class="co">//output &lt;&lt; &quot; </span><span class="re">END</span><span class="co"> PL/0 &quot; &lt;&lt; NL;</span></span><span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span><span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>      <span class="co">/* interpret */</span></span></code></pre></div><h2 id="第三关">第三关</h2><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;ptoc.h&quot;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifndef WIN32</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> _splitpath<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> _makepath<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">void</span> _split_whole_name<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>whole_name<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">);</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    *Constants</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    *******************************/</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> norw <span class="op">=</span> <span class="dv">25</span><span class="op">;</span>       <span class="co">/* no. of reserved words */</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> txmax <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>     <span class="co">/* length of identifier table */</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> bmax <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>       <span class="co">/* length of block inormation table */</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> arrmax <span class="op">=</span> <span class="dv">30</span><span class="op">;</span>     <span class="co">/* length of array information table */</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> nmax <span class="op">=</span> <span class="dv">6</span><span class="op">;</span>        <span class="co">/* max. no. of digits in numbers */</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> al <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>         <span class="co">/* length of identifiers */</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> amax <span class="op">=</span> <span class="dv">2047</span><span class="op">;</span>     <span class="co">/* maxinum address */</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> levmax <span class="op">=</span> <span class="dv">7</span><span class="op">;</span>      <span class="co">/* maxinum depth of block nesting */</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> cxmax <span class="op">=</span> <span class="dv">1000</span><span class="op">;</span>    <span class="co">/* size of code array */</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> min_index1 <span class="op">=</span> <span class="op">-</span><span class="dv">32767</span><span class="op">;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> max_index1 <span class="op">=</span> <span class="op">+</span><span class="dv">32767</span><span class="op">;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************/</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">    *Enums</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">    *******************************/</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> symbol <span class="op">&#123;</span>nul<span class="op">,</span> ident<span class="op">,</span> intcon<span class="op">,</span> charcon<span class="op">,</span> plus<span class="op">,</span> minus<span class="op">,</span> times<span class="op">,</span> divsym<span class="op">,</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> leq<span class="op">,</span> gtr<span class="op">,</span> geq<span class="op">,</span> ofsym<span class="op">,</span> arraysym<span class="op">,</span> programsym<span class="op">,</span> modsym<span class="op">,</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                andsym<span class="op">,</span> orsym<span class="op">,</span> notsym<span class="op">,</span> lbrack<span class="op">,</span> rbrack<span class="op">,</span> lparen<span class="op">,</span> rparen<span class="op">,</span> comma<span class="op">,</span></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                semicolon<span class="op">,</span> period<span class="op">,</span> becomes<span class="op">,</span> colon<span class="op">,</span> beginsym<span class="op">,</span>  endsym<span class="op">,</span> ifsym<span class="op">,</span> thensym<span class="op">,</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>                elsesym<span class="op">,</span> whilesym<span class="op">,</span> downtosym<span class="op">,</span>tosym<span class="op">,</span>repeatsym<span class="op">,</span> untilsym <span class="op">,</span>forsym <span class="op">,</span> casesym <span class="op">,</span> dosym<span class="op">,</span> callsym<span class="op">,</span> constsym<span class="op">,</span> typesym<span class="op">,</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                varsym<span class="op">,</span> procsym<span class="op">,</span> last_symbol</span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;;</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> oobject <span class="op">&#123;</span>konstant<span class="op">,</span> typel<span class="op">,</span> variable<span class="op">,</span> prosedure<span class="op">,</span> last_oobject<span class="op">&#125;;</span></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> types <span class="op">&#123;</span>notyp<span class="op">,</span> ints<span class="op">,</span> chars<span class="op">,</span> bool_<span class="op">,</span> arrays<span class="op">,</span> last_types<span class="op">&#125;;</span></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> opcod <span class="op">&#123;</span>lit<span class="op">,</span> lod<span class="op">,</span> ilod<span class="op">,</span> loda<span class="op">,</span> lodt<span class="op">,</span> sto<span class="op">,</span> lodb<span class="op">,</span> cpyb<span class="op">,</span> jmp<span class="op">,</span> jpc<span class="op">,</span> red<span class="op">,</span> wrt<span class="op">,</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>            cal<span class="op">,</span> retp<span class="op">,</span> endp<span class="op">,</span> udis<span class="op">,</span> opac<span class="op">,</span> entp<span class="op">,</span> ands<span class="op">,</span> ors<span class="op">,</span> nots<span class="op">,</span> imod<span class="op">,</span> mus<span class="op">,</span> add<span class="op">,</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            sub<span class="op">,</span> mult<span class="op">,</span> idiv<span class="op">,</span> eq<span class="op">,</span> ne<span class="op">,</span> ls<span class="op">,</span> le<span class="op">,</span> gt<span class="op">,</span> ge<span class="op">,</span> last_opcod</span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;;</span>  <span class="co">/* opration code */</span></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************/</span></span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************</span></span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">    *Structures</span></span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">    *******************************/</span></span><span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> varying_string<span class="op">&lt;</span>al<span class="op">&gt;</span> alfa<span class="op">;</span><span class="co">/*String with length al*/</span></span><span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> <span class="dt">short</span> index1<span class="op">;</span></span><span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">typedef</span> set_of_enum<span class="op">(</span>symbol<span class="op">)</span> symset<span class="op">;</span></span><span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> instruction</span><span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    opcod f<span class="op">;</span></span><span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> l<span class="op">;</span></span><span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> a<span class="op">;</span></span><span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span></span><span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> item</span><span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    types typ<span class="op">;</span></span><span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ref<span class="op">;</span></span><span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span></span><span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> A1</span><span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    alfa name<span class="op">;</span></span><span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    oobject kind<span class="op">;</span></span><span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    types typ<span class="op">;</span></span><span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> lev<span class="op">;</span></span><span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    boolean normal<span class="op">;</span></span><span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    index1 ref<span class="op">;</span></span><span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    index1 link<span class="op">;</span></span><span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span></span><span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> adr<span class="op">;</span></span><span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> val<span class="op">;</span></span><span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> size<span class="op">;</span></span><span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span></span><span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span><span class="co">//Elements of nametab</span></span><span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> A2</span><span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    types inxtyp<span class="op">,</span> eltyp<span class="op">;</span></span><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    index1 elref<span class="op">,</span> low<span class="op">,</span> high<span class="op">,</span> elsize<span class="op">,</span> size<span class="op">;</span></span><span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span><span class="co">//Elements of atab</span></span><span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> B1</span><span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    index1 last<span class="op">,</span> lastpar<span class="op">,</span> psize<span class="op">,</span> vsize<span class="op">;</span></span><span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span><span class="co">//Elements of btab</span></span><span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> constrec</span><span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    types tp<span class="op">;</span></span><span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;;</span></span><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************</span></span><span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a><span class="co">    *Global variables</span></span><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a><span class="co">    *******************************/</span></span><span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> ch<span class="op">;</span>           <span class="co">/* last character read */</span></span><span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    symbol sym<span class="op">;</span>        <span class="co">/* last symbol read*/</span></span><span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    alfa id<span class="op">;</span>           <span class="co">/* last identifier read*/</span></span><span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> num<span class="op">;</span>       <span class="co">/* last number read */</span></span><span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cc<span class="op">;</span>        <span class="co">/* character count */</span></span><span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ll<span class="op">;</span>        <span class="co">/* line length */</span></span><span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> kk<span class="op">,</span> err<span class="op">;</span></span><span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    varying_string<span class="op">&lt;</span><span class="dv">81</span><span class="op">&gt;</span> line<span class="op">;</span></span><span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    alfa a<span class="op">;</span></span><span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> norw<span class="op">,</span> alfa<span class="op">&gt;</span> word1<span class="op">;</span></span><span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> norw<span class="op">,</span> symbol<span class="op">&gt;</span> wsym<span class="op">;</span></span><span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>    array <span class="op">&lt;</span> <span class="op">-</span><span class="dv">128</span><span class="op">,</span> <span class="dv">127</span><span class="op">,</span> symbol <span class="op">&gt;</span> ssym<span class="op">;</span></span><span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> last_opcod<span class="op">,</span> varying_string<span class="op">&lt;</span><span class="dv">5</span><span class="op">&gt;</span> <span class="op">&gt;</span> mnemonic<span class="op">;</span></span><span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    symset declbegsys<span class="op">,</span> statbegsys<span class="op">,</span> facbegsys<span class="op">,</span> constbegsys<span class="op">,</span> typebegsys<span class="op">;</span></span><span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> txmax<span class="op">,</span> A1<span class="op">&gt;</span> nametab<span class="op">;</span><span class="co">/* name table */</span></span><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tx<span class="op">;</span>             <span class="co">/* index of nametab*/</span></span><span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">1</span><span class="op">,</span> amax<span class="op">,</span> A2<span class="op">&gt;</span> atab<span class="op">;</span><span class="co">/* array information table */</span></span><span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ax<span class="op">;</span>             <span class="co">/*index of atab */</span></span><span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> bmax<span class="op">,</span> B1<span class="op">&gt;</span> btab<span class="op">;</span><span class="co">/* block information table */</span></span><span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bx<span class="op">;</span>                 <span class="co">/* index of btab */</span></span><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> levmax<span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> display<span class="op">;</span></span><span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> cxmax<span class="op">,</span> instruction<span class="op">&gt;</span> code<span class="op">;</span></span><span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cx<span class="op">;</span>          <span class="co">/* code allocation index */</span></span><span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    array<span class="op">&lt;</span><span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> labtab<span class="op">;</span></span><span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> lx<span class="op">;</span></span><span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    text sfile<span class="op">;</span>       <span class="co">/* source program file */</span></span><span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    string sfile_buff<span class="op">;</span></span><span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> sfilename<span class="op">[</span>_MAX_PATH<span class="op">];</span> <span class="co">/* source program file name */</span></span><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    file<span class="op">&lt;</span>instruction<span class="op">&gt;</span> fcode<span class="op">;</span></span><span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    file<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> labfile<span class="op">;</span></span><span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    text listfile<span class="op">;</span></span><span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    string listfile_buff<span class="op">;</span></span><span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> listfilename<span class="op">[</span>_MAX_PATH<span class="op">];</span></span><span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> dir<span class="op">[</span>_MAX_DIR<span class="op">];</span></span><span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span>_MAX_FNAME<span class="op">];</span></span><span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> ext<span class="op">[</span>_MAX_EXT<span class="op">];</span></span><span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*********************************************************/</span></span><span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************</span></span><span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a><span class="co">    *Function Decalarations</span></span><span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="co">    *******************************/</span></span><span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> initial<span class="op">();</span></span><span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterpreid<span class="op">();</span></span><span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enter<span class="op">(</span>alfa x0<span class="op">,</span> oobject x1<span class="op">,</span> types x2<span class="op">,</span> <span class="dt">int</span> x3<span class="op">);</span></span><span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> error<span class="op">(</span><span class="dt">int</span> n<span class="op">);</span></span><span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> getch<span class="op">();</span></span><span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> getsym<span class="op">();</span></span><span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterarray <span class="op">(</span>types tp <span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> h<span class="op">);</span></span><span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterblock<span class="op">();</span></span><span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> gen<span class="op">(</span>opcod x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> z<span class="op">);</span></span><span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> test<span class="op">(</span>symset s1<span class="op">,</span> symset s2<span class="op">,</span> <span class="dt">int</span> n<span class="op">);</span></span><span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> block<span class="op">(</span> symset fsys<span class="op">,</span> <span class="dt">int</span> level<span class="op">);</span></span><span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enter1<span class="op">(</span> oobject k<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> position<span class="op">(</span>alfa id<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> constant<span class="op">(</span>symset fsys<span class="op">,</span> constrec <span class="op">&amp;</span>c<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> arraytyp<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>aref<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>arsz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> paramenterlist<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">);</span></span><span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> constdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> typedeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> vardeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">);</span></span><span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> procdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> listcode<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx0<span class="op">);</span></span><span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> statement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> expression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> simpleexpression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> repeatstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> term<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> factor<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> assignment<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ifstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">);</span></span><span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> compound<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">);</span></span><span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> whilestatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">);</span></span><span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> stanproc<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> call<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">);</span></span><span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> fsplit<span class="op">(</span>string sfilename<span class="op">,</span> string dir<span class="op">,</span> string name<span class="op">,</span> string ext<span class="op">);</span></span><span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*******************************/</span></span><span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> initial<span class="op">()</span></span><span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;and       &quot;</span><span class="op">;</span></span><span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;array     &quot;</span><span class="op">;</span></span><span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;begin     &quot;</span><span class="op">;</span></span><span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;call      &quot;</span><span class="op">;</span></span><span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;case      &quot;</span><span class="op">;</span></span><span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;const     &quot;</span><span class="op">;</span></span><span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;do        &quot;</span><span class="op">;</span></span><span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">8</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;downto    &quot;</span><span class="op">;</span></span><span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span> <span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;else      &quot;</span><span class="op">;</span></span><span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;end       &quot;</span><span class="op">;</span></span><span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;for       &quot;</span><span class="op">;</span></span><span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">12</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;if        &quot;</span><span class="op">;</span></span><span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">13</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;mod       &quot;</span><span class="op">;</span></span><span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;not       &quot;</span><span class="op">;</span></span><span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">15</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;of        &quot;</span><span class="op">;</span></span><span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;or        &quot;</span><span class="op">;</span></span><span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">17</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;procedure &quot;</span><span class="op">;</span></span><span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">18</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;program   &quot;</span><span class="op">;</span></span><span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">19</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;repeat    &quot;</span><span class="op">;</span></span><span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">20</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;then      &quot;</span><span class="op">;</span></span><span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">21</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;to        &quot;</span><span class="op">;</span></span><span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">22</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;type      &quot;</span><span class="op">;</span></span><span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">23</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;until     &quot;</span><span class="op">;</span></span><span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">24</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;var       &quot;</span><span class="op">;</span></span><span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>    word1<span class="op">[</span><span class="dv">25</span><span class="op">]</span> <span class="op">=</span> <span class="st">&quot;while     &quot;</span><span class="op">;</span></span><span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> andsym<span class="op">;</span></span><span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> arraysym<span class="op">;</span></span><span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">3</span><span class="op">]</span> <span class="op">=</span> beginsym<span class="op">;</span></span><span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">4</span><span class="op">]</span> <span class="op">=</span> callsym<span class="op">;</span></span><span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">5</span><span class="op">]</span> <span class="op">=</span> casesym<span class="op">;</span></span><span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">6</span><span class="op">]</span> <span class="op">=</span> constsym<span class="op">;</span></span><span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">7</span><span class="op">]</span> <span class="op">=</span> dosym<span class="op">;</span></span><span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">8</span><span class="op">]</span> <span class="op">=</span> downtosym<span class="op">;</span></span><span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span> <span class="dv">9</span><span class="op">]</span> <span class="op">=</span> elsesym<span class="op">;</span></span><span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> endsym<span class="op">;</span></span><span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">11</span><span class="op">]</span> <span class="op">=</span> forsym<span class="op">;</span></span><span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">12</span><span class="op">]</span> <span class="op">=</span> ifsym<span class="op">;</span></span><span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">13</span><span class="op">]</span> <span class="op">=</span> modsym<span class="op">;</span></span><span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> notsym<span class="op">;</span></span><span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">15</span><span class="op">]</span> <span class="op">=</span> ofsym<span class="op">;</span></span><span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">16</span><span class="op">]</span> <span class="op">=</span> orsym<span class="op">;</span></span><span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">17</span><span class="op">]</span> <span class="op">=</span> procsym<span class="op">;</span></span><span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">18</span><span class="op">]</span> <span class="op">=</span> programsym<span class="op">;</span></span><span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">19</span><span class="op">]</span> <span class="op">=</span> repeatsym<span class="op">;</span></span><span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">20</span><span class="op">]</span> <span class="op">=</span> thensym<span class="op">;</span></span><span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">21</span><span class="op">]</span> <span class="op">=</span> tosym<span class="op">;</span></span><span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">22</span><span class="op">]</span> <span class="op">=</span> typesym<span class="op">;</span></span><span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">23</span><span class="op">]</span> <span class="op">=</span> untilsym<span class="op">;</span></span><span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">24</span><span class="op">]</span> <span class="op">=</span> varsym<span class="op">;</span></span><span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>    wsym<span class="op">[</span><span class="dv">25</span><span class="op">]</span> <span class="op">=</span> whilesym<span class="op">;</span></span><span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;+&#39;</span><span class="op">]</span> <span class="op">=</span> plus<span class="op">;</span></span><span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;-&#39;</span><span class="op">]</span> <span class="op">=</span> minus<span class="op">;</span></span><span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;*&#39;</span><span class="op">]</span> <span class="op">=</span> times<span class="op">;</span></span><span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;/&#39;</span><span class="op">]</span> <span class="op">=</span> divsym<span class="op">;</span></span><span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;[&#39;</span><span class="op">]</span> <span class="op">=</span> lbrack<span class="op">;</span></span><span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;]&#39;</span><span class="op">]</span> <span class="op">=</span> rbrack<span class="op">;</span></span><span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;(&#39;</span><span class="op">]</span> <span class="op">=</span> lparen<span class="op">;</span></span><span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;)&#39;</span><span class="op">]</span> <span class="op">=</span> rparen<span class="op">;</span></span><span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;=&#39;</span><span class="op">]</span> <span class="op">=</span> eql<span class="op">;</span></span><span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;,&#39;</span><span class="op">]</span> <span class="op">=</span> comma<span class="op">;</span></span><span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;.&#39;</span><span class="op">]</span> <span class="op">=</span> period<span class="op">;</span></span><span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;&lt;&#39;</span><span class="op">]</span> <span class="op">=</span> lss<span class="op">;</span></span><span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;&gt;&#39;</span><span class="op">]</span> <span class="op">=</span> gtr<span class="op">;</span></span><span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>    ssym<span class="op">[</span><span class="ch">&#39;;&#39;</span><span class="op">]</span> <span class="op">=</span> semicolon<span class="op">;</span></span><span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>lit<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LIT  &quot;</span><span class="op">;</span></span><span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>lod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LOD  &quot;</span><span class="op">;</span></span><span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>sto<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;STO  &quot;</span><span class="op">;</span></span><span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>cal<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;CAL  &quot;</span><span class="op">;</span></span><span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>jmp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;JMP  &quot;</span><span class="op">;</span></span><span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>jpc<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;JPC  &quot;</span><span class="op">;</span></span><span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>red<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;RED  &quot;</span><span class="op">;</span></span><span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>wrt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;WRT  &quot;</span><span class="op">;</span></span><span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ilod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ILOD  &quot;</span><span class="op">;</span></span><span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>loda<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODA &quot;</span><span class="op">;</span></span><span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>lodt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODt  &quot;</span><span class="op">;</span></span><span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>lodb<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LODB &quot;</span><span class="op">;</span></span><span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>cpyb<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;COPYB &quot;</span><span class="op">;</span></span><span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>endp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ENDP &quot;</span><span class="op">;</span></span><span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>retp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;RETP  &quot;</span><span class="op">;</span></span><span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>udis<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ADIS &quot;</span><span class="op">;</span></span><span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>mus<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;MUS  &quot;</span><span class="op">;</span></span><span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>add<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ADD &quot;</span><span class="op">;</span></span><span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>sub<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;SUB  &quot;</span><span class="op">;</span></span><span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>mult<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;MULT &quot;</span><span class="op">;</span></span><span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>idiv<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;DDIV  &quot;</span><span class="op">;</span></span><span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>eq<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;EQ  &quot;</span><span class="op">;</span></span><span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ne<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;NE &quot;</span><span class="op">;</span></span><span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ls<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LS  &quot;</span><span class="op">;</span></span><span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>le<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;LE &quot;</span><span class="op">;</span></span><span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>gt<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;GT  &quot;</span><span class="op">;</span></span><span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ge<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;GE &quot;</span><span class="op">;</span></span><span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>opac<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;OPAC &quot;</span><span class="op">;</span></span><span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>entp<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ENTP&quot;</span><span class="op">;</span></span><span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>imod<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;IMOD &quot;</span><span class="op">;</span></span><span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ands<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ANDS&quot;</span><span class="op">;</span></span><span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>ors<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;ORS &quot;</span><span class="op">;</span></span><span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>    mnemonic<span class="op">[</span>nots<span class="op">]</span> <span class="op">=</span> <span class="st">&quot;NOTS&quot;</span><span class="op">;</span></span><span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>    declbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>constsym<span class="op">,</span> varsym<span class="op">,</span> typesym<span class="op">,</span> procsym<span class="op">,</span> eos<span class="op">);</span></span><span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>    statbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>beginsym<span class="op">,</span> callsym<span class="op">,</span>casesym<span class="op">,</span> ifsym<span class="op">,</span> whilesym<span class="op">,</span>repeatsym<span class="op">,</span> forsym<span class="op">,</span>eos<span class="op">);</span></span><span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>    facbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> intcon<span class="op">,</span> lparen<span class="op">,</span> notsym<span class="op">,</span> charcon<span class="op">,</span> eos<span class="op">);</span></span><span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>    typebegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> arraysym<span class="op">,</span> eos<span class="op">);</span></span><span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    constbegsys <span class="op">=</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> intcon<span class="op">,</span> charcon<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">);</span></span><span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    err <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>    a<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> &#39;\<span class="dv">12</span><span class="er">&#39;</span><span class="op">;</span><span class="co">// What is \12 LosPhoenix</span></span><span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    display<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>    cx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    ch <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>    kk <span class="op">=</span> al<span class="op">;</span></span><span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>    bx <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    tx <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*init*/</span></span><span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enter<span class="op">(</span>alfa x0<span class="op">,</span> oobject x1<span class="op">,</span> types x2<span class="op">,</span> <span class="dt">int</span> x3<span class="op">)</span></span><span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>    tx <span class="op">=</span> tx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>name <span class="op">=</span> x0<span class="op">;</span></span><span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>link <span class="op">=</span> tx <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>kind <span class="op">=</span> x1<span class="op">;</span></span><span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> x2<span class="op">;</span></span><span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>lev <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>tx<span class="op">].</span>kind<span class="op">)</span></span><span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> x3<span class="op">;</span></span><span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> x3<span class="op">;</span></span><span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>            nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> x3<span class="op">;</span></span><span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*enter*/</span></span><span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterpreid<span class="op">()</span><span class="co">// Only at the begining. Init nametable and btab</span></span><span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;          &quot;</span><span class="op">,</span> variable<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">0</span><span class="op">);</span>    <span class="co">/* sentinel */</span></span><span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;char      &quot;</span><span class="op">,</span> typel<span class="op">,</span> chars<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;integer   &quot;</span><span class="op">,</span> typel<span class="op">,</span> ints<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;boolean   &quot;</span><span class="op">,</span> typel<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;false     &quot;</span><span class="op">,</span> konstant<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">0</span><span class="op">);</span></span><span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;true      &quot;</span><span class="op">,</span> konstant<span class="op">,</span> bool_<span class="op">,</span>  <span class="dv">1</span><span class="op">);</span></span><span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;read      &quot;</span><span class="op">,</span> prosedure<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>    enter<span class="op">(</span><span class="st">&quot;write     &quot;</span><span class="op">,</span> prosedure<span class="op">,</span> notyp<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span><span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>last <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>lastpar <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>psize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>vsize <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*enterprid*/</span></span><span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> error<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span></span><span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>    listfile <span class="op">&lt;&lt;</span> <span class="st">&quot;****&quot;</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span><span class="ch">&#39; &#39;</span><span class="op">,</span> cc <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39;^&#39;</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>n<span class="op">,</span> <span class="dv">2</span><span class="op">)</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>    err <span class="op">=</span> err <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;Error&quot;</span> <span class="op">&lt;&lt;</span> n <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* error */</span></span><span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> getch<span class="op">()</span></span><span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cc <span class="op">==</span> ll<span class="op">)</span>   <span class="co">/* get character to end of line *//* read next line */</span></span><span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>eof<span class="op">(</span>sfile<span class="op">))</span></span><span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>            output <span class="op">&lt;&lt;</span> <span class="st">&quot;program incomplete&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>            close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span><span class="op">;</span></span><span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>        ll <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>        cc <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>        listfile <span class="op">&lt;&lt;</span> format<span class="op">(</span>cx<span class="op">,</span> <span class="dv">4</span><span class="op">)</span> <span class="op">&lt;&lt;</span> <span class="ch">&#39; &#39;</span><span class="op">;</span>   <span class="co">/*print code address */</span></span><span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span> eoln<span class="op">(</span>sfile<span class="op">))</span></span><span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>            ll <span class="op">=</span> ll <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>            sfile <span class="op">&gt;&gt;</span> ch<span class="op">;</span></span><span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a>            listfile <span class="op">&lt;&lt;</span> ch<span class="op">;</span></span><span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a>            line<span class="op">[</span>ll<span class="op">]</span> <span class="op">=</span> ch<span class="op">;</span></span><span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>        listfile <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>        sfile <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>        ll <span class="op">=</span> ll <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a>        line<span class="op">[</span>ll<span class="op">]</span> <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span> <span class="co">/*process end-line*/</span></span><span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> cc <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>    ch <span class="op">=</span> line<span class="op">[</span>cc<span class="op">];</span></span><span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>    <span class="co">//output &lt;&lt; ch;//test</span></span><span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* getch */</span></span><span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> getsym<span class="op">()</span><span class="co">/*getsym*/</span></span><span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> k<span class="op">,</span> j<span class="op">;</span></span><span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*Why is there a goto in this code. LosPhoenix*/</span></span><span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>    L1<span class="op">:</span></span><span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39; &#39;</span><span class="op">)</span></span><span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>ch<span class="op">)</span></span><span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;a&#39;</span><span class="op">:</span></span><span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;b&#39;</span><span class="op">:</span></span><span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;c&#39;</span><span class="op">:</span></span><span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;d&#39;</span><span class="op">:</span></span><span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;e&#39;</span><span class="op">:</span></span><span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;f&#39;</span><span class="op">:</span></span><span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;g&#39;</span><span class="op">:</span></span><span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;h&#39;</span><span class="op">:</span></span><span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;i&#39;</span><span class="op">:</span></span><span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;j&#39;</span><span class="op">:</span></span><span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;k&#39;</span><span class="op">:</span></span><span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;l&#39;</span><span class="op">:</span></span><span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;m&#39;</span><span class="op">:</span></span><span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;n&#39;</span><span class="op">:</span></span><span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;o&#39;</span><span class="op">:</span></span><span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;p&#39;</span><span class="op">:</span></span><span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;q&#39;</span><span class="op">:</span></span><span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;r&#39;</span><span class="op">:</span></span><span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;s&#39;</span><span class="op">:</span></span><span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;t&#39;</span><span class="op">:</span></span><span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;u&#39;</span><span class="op">:</span></span><span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;v&#39;</span><span class="op">:</span></span><span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;w&#39;</span><span class="op">:</span></span><span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;x&#39;</span><span class="op">:</span></span><span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;y&#39;</span><span class="op">:</span></span><span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;z&#39;</span><span class="op">:</span></span><span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* identifier or reserved word */</span></span><span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>k <span class="op">&lt;</span> al<span class="op">)</span></span><span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>                k <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>                a<span class="op">[</span>k<span class="op">]</span> <span class="op">=</span> ch<span class="op">;</span></span><span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">((</span>set<span class="op">::</span>of<span class="op">(</span>range<span class="op">(</span><span class="ch">&#39;a&#39;</span><span class="op">,</span> <span class="ch">&#39;z&#39;</span><span class="op">),</span> range<span class="op">(</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> <span class="ch">&#39;9&#39;</span><span class="op">),</span> eos<span class="op">).</span>has<span class="op">(</span>ch<span class="op">)));</span></span><span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>k <span class="op">&gt;=</span> kk<span class="op">)</span></span><span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>                kk <span class="op">=</span> k<span class="op">;</span>    <span class="co">/* kk: last identifier length */</span></span><span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a>                a<span class="op">[</span>kk<span class="op">]</span> <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>                kk <span class="op">=</span> kk <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>kk <span class="op">==</span> k<span class="op">));</span></span><span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>        id <span class="op">=</span> a<span class="op">;</span></span><span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> norw<span class="op">;</span>  <span class="co">/* binary search reserved word table */</span></span><span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> <span class="op">(</span>i <span class="op">+</span> j<span class="op">)</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>id <span class="op">&lt;=</span> word1<span class="op">[</span>k<span class="op">])</span>  j <span class="op">=</span> k <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>id <span class="op">&gt;=</span> word1<span class="op">[</span>k<span class="op">])</span>  i <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>i <span class="op">&gt;</span> j<span class="op">));</span></span><span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span> <span class="op">&gt;</span> j<span class="op">)</span></span><span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>                sym <span class="op">=</span> wsym<span class="op">[</span>k<span class="op">];</span></span><span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a>                sym <span class="op">=</span> ident<span class="op">;</span></span><span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;0&#39;</span><span class="op">:</span></span><span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;1&#39;</span><span class="op">:</span></span><span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;2&#39;</span><span class="op">:</span></span><span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;3&#39;</span><span class="op">:</span></span><span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;4&#39;</span><span class="op">:</span></span><span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;5&#39;</span><span class="op">:</span></span><span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;6&#39;</span><span class="op">:</span></span><span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;7&#39;</span><span class="op">:</span></span><span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;8&#39;</span><span class="op">:</span></span><span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;9&#39;</span><span class="op">:</span></span><span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* number */</span></span><span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>        num <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> intcon<span class="op">;</span></span><span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>            num <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> num <span class="op">+</span> <span class="op">(</span>ch <span class="op">-</span> <span class="ch">&#39;0&#39;</span><span class="op">);</span></span><span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> k <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">((</span>set<span class="op">::</span>of<span class="op">(</span>range<span class="op">(</span><span class="ch">&#39;0&#39;</span><span class="op">,</span> <span class="ch">&#39;9&#39;</span><span class="op">),</span> eos<span class="op">).</span>has<span class="op">(</span>ch<span class="op">)));</span></span><span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>k <span class="op">&gt;</span> nmax<span class="op">)</span>  error<span class="op">(</span><span class="dv">47</span><span class="op">);</span></span><span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;:&#39;</span><span class="op">:</span></span><span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> becomes<span class="op">;</span></span><span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> sym <span class="op">=</span> colon<span class="op">;</span></span><span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;&lt;&#39;</span> <span class="op">:</span></span><span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> leq<span class="op">;</span></span><span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;&gt;&#39;</span><span class="op">)</span></span><span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> neq<span class="op">;</span></span><span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> sym <span class="op">=</span> lss<span class="op">;</span></span><span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;&gt;&#39;</span> <span class="op">:</span></span><span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;=&#39;</span><span class="op">)</span></span><span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> geq<span class="op">;</span></span><span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> sym <span class="op">=</span> gtr<span class="op">;</span></span><span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;.&#39;</span> <span class="op">:</span></span><span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;.&#39;</span><span class="op">)</span></span><span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>            sym <span class="op">=</span> colon<span class="op">;</span></span><span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>            getch<span class="op">();</span></span><span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>   sym <span class="op">=</span> period<span class="op">;</span></span><span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;\&#39;&#39;</span>  <span class="op">:</span></span><span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> charcon<span class="op">;</span></span><span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a>        num <span class="op">=</span> ch<span class="op">;</span></span><span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ch <span class="op">==</span> <span class="ch">&#39;\&#39;&#39;</span><span class="op">)</span>  getch<span class="op">();</span></span><span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">48</span><span class="op">);</span></span><span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;+&#39;</span><span class="op">:</span></span><span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;-&#39;</span><span class="op">:</span></span><span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;*&#39;</span><span class="op">:</span></span><span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;/&#39;</span><span class="op">:</span></span><span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;(&#39;</span><span class="op">:</span></span><span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;)&#39;</span><span class="op">:</span></span><span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;=&#39;</span><span class="op">:</span></span><span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;[&#39;</span><span class="op">:</span></span><span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;]&#39;</span><span class="op">:</span></span><span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;;&#39;</span><span class="op">:</span></span><span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">&#39;,&#39;</span><span class="op">:</span></span><span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>        sym <span class="op">=</span> ssym<span class="op">[</span>ch<span class="op">];</span></span><span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span><span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>        getch<span class="op">();</span></span><span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> L1<span class="op">;</span></span><span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>    <span class="co">/* case */</span></span><span id="cb3-585"><a href="#cb3-585" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-586"><a href="#cb3-586" aria-hidden="true" tabindex="-1"></a>    <span class="co">//output&lt;&lt;sym&lt;&lt;NL;</span></span><span id="cb3-587"><a href="#cb3-587" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* getsym */</span></span><span id="cb3-588"><a href="#cb3-588" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-589"><a href="#cb3-589" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterarray <span class="op">(</span>types tp <span class="op">,</span> <span class="dt">int</span> l<span class="op">,</span> <span class="dt">int</span> h<span class="op">)</span></span><span id="cb3-590"><a href="#cb3-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-591"><a href="#cb3-591" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>l <span class="op">&gt;</span> h<span class="op">)</span>  error<span class="op">(</span><span class="dv">14</span><span class="op">);</span></span><span id="cb3-592"><a href="#cb3-592" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ax <span class="op">==</span> amax<span class="op">)</span></span><span id="cb3-593"><a href="#cb3-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-594"><a href="#cb3-594" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-595"><a href="#cb3-595" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;too many arrays in program &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-596"><a href="#cb3-596" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-597"><a href="#cb3-597" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-598"><a href="#cb3-598" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-599"><a href="#cb3-599" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-600"><a href="#cb3-600" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-601"><a href="#cb3-601" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-602"><a href="#cb3-602" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> ax <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-603"><a href="#cb3-603" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-604"><a href="#cb3-604" aria-hidden="true" tabindex="-1"></a>            <span class="co">//A2 &amp;with = atab[ax];</span></span><span id="cb3-605"><a href="#cb3-605" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-606"><a href="#cb3-606" aria-hidden="true" tabindex="-1"></a>            atab<span class="op">[</span>tx<span class="op">].</span>inxtyp <span class="op">=</span> tp<span class="op">;</span></span><span id="cb3-607"><a href="#cb3-607" aria-hidden="true" tabindex="-1"></a>            atab<span class="op">[</span>tx<span class="op">].</span>low <span class="op">=</span> l<span class="op">;</span></span><span id="cb3-608"><a href="#cb3-608" aria-hidden="true" tabindex="-1"></a>            atab<span class="op">[</span>tx<span class="op">].</span>high <span class="op">=</span> h<span class="op">;</span></span><span id="cb3-609"><a href="#cb3-609" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-610"><a href="#cb3-610" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-611"><a href="#cb3-611" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* enterarray */</span></span><span id="cb3-612"><a href="#cb3-612" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-613"><a href="#cb3-613" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enterblock<span class="op">()</span></span><span id="cb3-614"><a href="#cb3-614" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-615"><a href="#cb3-615" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>bx <span class="op">==</span> bmax<span class="op">)</span></span><span id="cb3-616"><a href="#cb3-616" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-617"><a href="#cb3-617" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb3-618"><a href="#cb3-618" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;too many procedure in program &quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-619"><a href="#cb3-619" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-620"><a href="#cb3-620" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-621"><a href="#cb3-621" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-622"><a href="#cb3-622" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-623"><a href="#cb3-623" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-624"><a href="#cb3-624" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-625"><a href="#cb3-625" aria-hidden="true" tabindex="-1"></a>        bx <span class="op">=</span> bx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-626"><a href="#cb3-626" aria-hidden="true" tabindex="-1"></a>        btab<span class="op">[</span>bx<span class="op">].</span>last <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-627"><a href="#cb3-627" aria-hidden="true" tabindex="-1"></a>        btab<span class="op">[</span>bx<span class="op">].</span>lastpar <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-628"><a href="#cb3-628" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-629"><a href="#cb3-629" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* enterblock */</span></span><span id="cb3-630"><a href="#cb3-630" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-631"><a href="#cb3-631" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> gen<span class="op">(</span>opcod x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> z<span class="op">)</span></span><span id="cb3-632"><a href="#cb3-632" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-633"><a href="#cb3-633" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>cx <span class="op">&gt;</span> cxmax<span class="op">)</span></span><span id="cb3-634"><a href="#cb3-634" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-635"><a href="#cb3-635" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">49</span><span class="op">);</span></span><span id="cb3-636"><a href="#cb3-636" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;program too long&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-637"><a href="#cb3-637" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-638"><a href="#cb3-638" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-639"><a href="#cb3-639" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-640"><a href="#cb3-640" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-641"><a href="#cb3-641" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-642"><a href="#cb3-642" aria-hidden="true" tabindex="-1"></a>        <span class="co">//instruction &amp;with = code[cx];</span></span><span id="cb3-643"><a href="#cb3-643" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-644"><a href="#cb3-644" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx<span class="op">].</span>f <span class="op">=</span> x<span class="op">;</span></span><span id="cb3-645"><a href="#cb3-645" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx<span class="op">].</span>l <span class="op">=</span> y<span class="op">;</span></span><span id="cb3-646"><a href="#cb3-646" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx<span class="op">].</span>a <span class="op">=</span> z<span class="op">;</span></span><span id="cb3-647"><a href="#cb3-647" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-648"><a href="#cb3-648" aria-hidden="true" tabindex="-1"></a>    cx <span class="op">=</span> cx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-649"><a href="#cb3-649" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* gen */</span></span><span id="cb3-650"><a href="#cb3-650" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-651"><a href="#cb3-651" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> test<span class="op">(</span>symset s1<span class="op">,</span> symset s2<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span></span><span id="cb3-652"><a href="#cb3-652" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-653"><a href="#cb3-653" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span> <span class="op">(</span>s1<span class="op">.</span>has<span class="op">(</span>sym<span class="op">)))</span></span><span id="cb3-654"><a href="#cb3-654" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-655"><a href="#cb3-655" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span>n<span class="op">);</span></span><span id="cb3-656"><a href="#cb3-656" aria-hidden="true" tabindex="-1"></a>        s1 <span class="op">=</span> s1 <span class="op">+</span> s2<span class="op">;</span></span><span id="cb3-657"><a href="#cb3-657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span> <span class="op">(</span>s1<span class="op">.</span>has<span class="op">(</span>sym<span class="op">)))</span></span><span id="cb3-658"><a href="#cb3-658" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-659"><a href="#cb3-659" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-660"><a href="#cb3-660" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* test */</span></span><span id="cb3-661"><a href="#cb3-661" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-662"><a href="#cb3-662" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> enter1<span class="op">(</span> oobject k<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-663"><a href="#cb3-663" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-664"><a href="#cb3-664" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> j<span class="op">,</span> l<span class="op">;</span></span><span id="cb3-665"><a href="#cb3-665" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-666"><a href="#cb3-666" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>tx <span class="op">==</span> txmax<span class="op">)</span></span><span id="cb3-667"><a href="#cb3-667" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-668"><a href="#cb3-668" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-669"><a href="#cb3-669" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;program too long&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-670"><a href="#cb3-670" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-671"><a href="#cb3-671" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-672"><a href="#cb3-672" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-673"><a href="#cb3-673" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-674"><a href="#cb3-674" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-675"><a href="#cb3-675" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-676"><a href="#cb3-676" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb3-677"><a href="#cb3-677" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> btab<span class="op">[</span>display<span class="op">[</span>level<span class="op">]].</span>last<span class="op">;</span></span><span id="cb3-678"><a href="#cb3-678" aria-hidden="true" tabindex="-1"></a>        l <span class="op">=</span> j<span class="op">;</span></span><span id="cb3-679"><a href="#cb3-679" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>nametab<span class="op">[</span>j<span class="op">].</span>name <span class="op">!=</span> id<span class="op">)</span>  j <span class="op">=</span> nametab<span class="op">[</span>j<span class="op">].</span>link<span class="op">;</span></span><span id="cb3-680"><a href="#cb3-680" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>j <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-681"><a href="#cb3-681" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span>l<span class="op">);</span></span><span id="cb3-682"><a href="#cb3-682" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-683"><a href="#cb3-683" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-684"><a href="#cb3-684" aria-hidden="true" tabindex="-1"></a>            tx <span class="op">=</span> tx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-685"><a href="#cb3-685" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-686"><a href="#cb3-686" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[tx];</span></span><span id="cb3-687"><a href="#cb3-687" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-688"><a href="#cb3-688" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb3-689"><a href="#cb3-689" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>link <span class="op">=</span> l<span class="op">;</span></span><span id="cb3-690"><a href="#cb3-690" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>kind <span class="op">=</span> k<span class="op">;</span></span><span id="cb3-691"><a href="#cb3-691" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-692"><a href="#cb3-692" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-693"><a href="#cb3-693" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb3-694"><a href="#cb3-694" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> false<span class="op">;</span></span><span id="cb3-695"><a href="#cb3-695" aria-hidden="true" tabindex="-1"></a>                <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>tx<span class="op">].</span>kind<span class="op">)</span></span><span id="cb3-696"><a href="#cb3-696" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-697"><a href="#cb3-697" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb3-698"><a href="#cb3-698" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb3-699"><a href="#cb3-699" aria-hidden="true" tabindex="-1"></a>                    nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-700"><a href="#cb3-700" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-701"><a href="#cb3-701" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb3-702"><a href="#cb3-702" aria-hidden="true" tabindex="-1"></a>                    nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-703"><a href="#cb3-703" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-704"><a href="#cb3-704" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb3-705"><a href="#cb3-705" aria-hidden="true" tabindex="-1"></a>                    nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-706"><a href="#cb3-706" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-707"><a href="#cb3-707" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span>    <span class="co">/* initial value */</span></span><span id="cb3-708"><a href="#cb3-708" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-709"><a href="#cb3-709" aria-hidden="true" tabindex="-1"></a>            btab<span class="op">[</span>display<span class="op">[</span>level<span class="op">]].</span>last <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-710"><a href="#cb3-710" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-711"><a href="#cb3-711" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-712"><a href="#cb3-712" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* enter */</span></span><span id="cb3-713"><a href="#cb3-713" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-714"><a href="#cb3-714" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> position<span class="op">(</span>alfa id<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-715"><a href="#cb3-715" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-716"><a href="#cb3-716" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> j<span class="op">;</span></span><span id="cb3-717"><a href="#cb3-717" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-718"><a href="#cb3-718" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> position_result<span class="op">;</span></span><span id="cb3-719"><a href="#cb3-719" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span><span class="dv">0</span><span class="op">].</span>name <span class="op">=</span> id<span class="op">;</span></span><span id="cb3-720"><a href="#cb3-720" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> level<span class="op">;</span></span><span id="cb3-721"><a href="#cb3-721" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb3-722"><a href="#cb3-722" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-723"><a href="#cb3-723" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> btab<span class="op">[</span>display<span class="op">[</span>j<span class="op">]].</span>last<span class="op">;</span></span><span id="cb3-724"><a href="#cb3-724" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>name <span class="op">!=</span> id<span class="op">)</span></span><span id="cb3-725"><a href="#cb3-725" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>link<span class="op">;</span></span><span id="cb3-726"><a href="#cb3-726" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> j <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-727"><a href="#cb3-727" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-728"><a href="#cb3-728" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!((</span>j <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">||</span> <span class="op">(</span>i <span class="op">!=</span> <span class="dv">0</span><span class="op">)));</span></span><span id="cb3-729"><a href="#cb3-729" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb3-730"><a href="#cb3-730" aria-hidden="true" tabindex="-1"></a>    position_result <span class="op">=</span> i<span class="op">;</span></span><span id="cb3-731"><a href="#cb3-731" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> position_result<span class="op">;</span></span><span id="cb3-732"><a href="#cb3-732" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* position */</span></span><span id="cb3-733"><a href="#cb3-733" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-734"><a href="#cb3-734" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> constant<span class="op">(</span>symset fsys<span class="op">,</span> constrec <span class="op">&amp;</span>c<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-735"><a href="#cb3-735" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-736"><a href="#cb3-736" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> sign<span class="op">;</span></span><span id="cb3-737"><a href="#cb3-737" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-738"><a href="#cb3-738" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-739"><a href="#cb3-739" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-740"><a href="#cb3-740" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>constbegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span><span id="cb3-741"><a href="#cb3-741" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>constbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-742"><a href="#cb3-742" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-743"><a href="#cb3-743" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>   <span class="op">(</span>sym <span class="op">==</span> charcon<span class="op">)</span></span><span id="cb3-744"><a href="#cb3-744" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-745"><a href="#cb3-745" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span>tp <span class="op">=</span> chars<span class="op">;</span></span><span id="cb3-746"><a href="#cb3-746" aria-hidden="true" tabindex="-1"></a>            c<span class="op">.</span>i <span class="op">=</span> num<span class="op">;</span></span><span id="cb3-747"><a href="#cb3-747" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-748"><a href="#cb3-748" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-749"><a href="#cb3-749" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-750"><a href="#cb3-750" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-751"><a href="#cb3-751" aria-hidden="true" tabindex="-1"></a>            sign <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-752"><a href="#cb3-752" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-753"><a href="#cb3-753" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-754"><a href="#cb3-754" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> minus<span class="op">)</span>  sign <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb3-755"><a href="#cb3-755" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-756"><a href="#cb3-756" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-757"><a href="#cb3-757" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-758"><a href="#cb3-758" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-759"><a href="#cb3-759" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-760"><a href="#cb3-760" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb3-761"><a href="#cb3-761" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> konstant<span class="op">)</span></span><span id="cb3-762"><a href="#cb3-762" aria-hidden="true" tabindex="-1"></a>                        error<span class="op">(</span><span class="dv">12</span><span class="op">);</span></span><span id="cb3-763"><a href="#cb3-763" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span><span id="cb3-764"><a href="#cb3-764" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-765"><a href="#cb3-765" aria-hidden="true" tabindex="-1"></a>                        c<span class="op">.</span>tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-766"><a href="#cb3-766" aria-hidden="true" tabindex="-1"></a>                        c<span class="op">.</span>i <span class="op">=</span> sign <span class="op">*</span> nametab<span class="op">[</span>x<span class="op">].</span>val<span class="op">;</span></span><span id="cb3-767"><a href="#cb3-767" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-768"><a href="#cb3-768" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-769"><a href="#cb3-769" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-770"><a href="#cb3-770" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-771"><a href="#cb3-771" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> intcon<span class="op">)</span></span><span id="cb3-772"><a href="#cb3-772" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-773"><a href="#cb3-773" aria-hidden="true" tabindex="-1"></a>                c<span class="op">.</span>tp <span class="op">=</span> ints<span class="op">;</span></span><span id="cb3-774"><a href="#cb3-774" aria-hidden="true" tabindex="-1"></a>                c<span class="op">.</span>i <span class="op">=</span> sign <span class="op">*</span> num<span class="op">;</span></span><span id="cb3-775"><a href="#cb3-775" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-776"><a href="#cb3-776" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-777"><a href="#cb3-777" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-778"><a href="#cb3-778" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">6</span><span class="op">);</span></span><span id="cb3-779"><a href="#cb3-779" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-780"><a href="#cb3-780" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* constant */</span></span><span id="cb3-781"><a href="#cb3-781" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-782"><a href="#cb3-782" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> arraytyp<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>aref<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>arsz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-783"><a href="#cb3-783" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-784"><a href="#cb3-784" aria-hidden="true" tabindex="-1"></a>    types eltp<span class="op">;</span></span><span id="cb3-785"><a href="#cb3-785" aria-hidden="true" tabindex="-1"></a>    constrec low<span class="op">,</span> high<span class="op">;</span></span><span id="cb3-786"><a href="#cb3-786" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> elrf<span class="op">,</span> elsz<span class="op">;</span></span><span id="cb3-787"><a href="#cb3-787" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-788"><a href="#cb3-788" aria-hidden="true" tabindex="-1"></a>    constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span> rbrack<span class="op">,</span> rparen<span class="op">,</span> ofsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> low<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-789"><a href="#cb3-789" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>low<span class="op">.</span>tp <span class="op">!=</span> ints<span class="op">)</span>  <span class="op">&amp;&amp;</span> <span class="op">(</span>low<span class="op">.</span>tp <span class="op">!=</span> chars<span class="op">))</span></span><span id="cb3-790"><a href="#cb3-790" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">50</span><span class="op">);</span></span><span id="cb3-791"><a href="#cb3-791" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-792"><a href="#cb3-792" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">38</span><span class="op">);</span></span><span id="cb3-793"><a href="#cb3-793" aria-hidden="true" tabindex="-1"></a>    constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rbrack<span class="op">,</span> comma<span class="op">,</span> rparen<span class="op">,</span> ofsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> high<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-794"><a href="#cb3-794" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>high<span class="op">.</span>tp <span class="op">!=</span> low<span class="op">.</span>tp<span class="op">)</span></span><span id="cb3-795"><a href="#cb3-795" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-796"><a href="#cb3-796" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-797"><a href="#cb3-797" aria-hidden="true" tabindex="-1"></a>        high<span class="op">.</span>i <span class="op">=</span> low<span class="op">.</span>i<span class="op">;</span></span><span id="cb3-798"><a href="#cb3-798" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-799"><a href="#cb3-799" aria-hidden="true" tabindex="-1"></a>    enterarray<span class="op">(</span>low<span class="op">.</span>tp<span class="op">,</span> low<span class="op">.</span>i<span class="op">,</span> high<span class="op">.</span>i<span class="op">);</span></span><span id="cb3-800"><a href="#cb3-800" aria-hidden="true" tabindex="-1"></a>    aref <span class="op">=</span> ax<span class="op">;</span></span><span id="cb3-801"><a href="#cb3-801" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb3-802"><a href="#cb3-802" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-803"><a href="#cb3-803" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-804"><a href="#cb3-804" aria-hidden="true" tabindex="-1"></a>        eltp <span class="op">=</span> arrays<span class="op">;</span></span><span id="cb3-805"><a href="#cb3-805" aria-hidden="true" tabindex="-1"></a>        arraytyp<span class="op">(</span>elrf<span class="op">,</span> elsz<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-806"><a href="#cb3-806" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-807"><a href="#cb3-807" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-808"><a href="#cb3-808" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-809"><a href="#cb3-809" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rbrack<span class="op">)</span></span><span id="cb3-810"><a href="#cb3-810" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-811"><a href="#cb3-811" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-812"><a href="#cb3-812" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-813"><a href="#cb3-813" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">28</span><span class="op">);</span></span><span id="cb3-814"><a href="#cb3-814" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-815"><a href="#cb3-815" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-816"><a href="#cb3-816" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ofsym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-817"><a href="#cb3-817" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">17</span><span class="op">);</span></span><span id="cb3-818"><a href="#cb3-818" aria-hidden="true" tabindex="-1"></a>        typ<span class="op">(</span>fsys<span class="op">,</span> eltp<span class="op">,</span> elrf<span class="op">,</span> elsz<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-819"><a href="#cb3-819" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-820"><a href="#cb3-820" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-821"><a href="#cb3-821" aria-hidden="true" tabindex="-1"></a>        <span class="co">//A2 &amp;with = atab[aref];</span></span><span id="cb3-822"><a href="#cb3-822" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-823"><a href="#cb3-823" aria-hidden="true" tabindex="-1"></a>        arsz <span class="op">=</span> <span class="op">(</span>atab<span class="op">[</span>aref<span class="op">].</span>high <span class="op">-</span> atab<span class="op">[</span>aref<span class="op">].</span>low <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> elsz<span class="op">;</span></span><span id="cb3-824"><a href="#cb3-824" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>aref<span class="op">].</span>size <span class="op">=</span> arsz<span class="op">;</span></span><span id="cb3-825"><a href="#cb3-825" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>aref<span class="op">].</span>eltyp <span class="op">=</span> eltp<span class="op">;</span></span><span id="cb3-826"><a href="#cb3-826" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>aref<span class="op">].</span>elref <span class="op">=</span> elrf<span class="op">;</span></span><span id="cb3-827"><a href="#cb3-827" aria-hidden="true" tabindex="-1"></a>        atab<span class="op">[</span>aref<span class="op">].</span>elsize <span class="op">=</span> elsz<span class="op">;</span></span><span id="cb3-828"><a href="#cb3-828" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-829"><a href="#cb3-829" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* arraytyp */</span></span><span id="cb3-830"><a href="#cb3-830" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-831"><a href="#cb3-831" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> typ<span class="op">(</span>symset fsys<span class="op">,</span> types <span class="op">&amp;</span>tp<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>rf<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>sz<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-832"><a href="#cb3-832" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-833"><a href="#cb3-833" aria-hidden="true" tabindex="-1"></a>    types eltp<span class="op">;</span></span><span id="cb3-834"><a href="#cb3-834" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> elrf<span class="op">,</span> x<span class="op">;</span></span><span id="cb3-835"><a href="#cb3-835" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> elsz<span class="op">,</span> offset<span class="op">,</span> t0<span class="op">,</span> t1<span class="op">;</span></span><span id="cb3-836"><a href="#cb3-836" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* typ */</span></span><span id="cb3-837"><a href="#cb3-837" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-838"><a href="#cb3-838" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-839"><a href="#cb3-839" aria-hidden="true" tabindex="-1"></a>    sz <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-840"><a href="#cb3-840" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>typebegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span><span id="cb3-841"><a href="#cb3-841" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>typebegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-842"><a href="#cb3-842" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-843"><a href="#cb3-843" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-844"><a href="#cb3-844" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-845"><a href="#cb3-845" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-846"><a href="#cb3-846" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-847"><a href="#cb3-847" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-848"><a href="#cb3-848" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[x];</span></span><span id="cb3-849"><a href="#cb3-849" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> typel<span class="op">)</span></span><span id="cb3-850"><a href="#cb3-850" aria-hidden="true" tabindex="-1"></a>                    error<span class="op">(</span><span class="dv">19</span><span class="op">);</span></span><span id="cb3-851"><a href="#cb3-851" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span></span><span id="cb3-852"><a href="#cb3-852" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-853"><a href="#cb3-853" aria-hidden="true" tabindex="-1"></a>                    tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-854"><a href="#cb3-854" aria-hidden="true" tabindex="-1"></a>                    rf <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-855"><a href="#cb3-855" aria-hidden="true" tabindex="-1"></a>                    sz <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>size<span class="op">;</span></span><span id="cb3-856"><a href="#cb3-856" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>tp <span class="op">==</span> notyp<span class="op">)</span>  error<span class="op">(</span><span class="dv">18</span><span class="op">);</span></span><span id="cb3-857"><a href="#cb3-857" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-858"><a href="#cb3-858" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-859"><a href="#cb3-859" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-860"><a href="#cb3-860" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-861"><a href="#cb3-861" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> arraysym<span class="op">)</span></span><span id="cb3-862"><a href="#cb3-862" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-863"><a href="#cb3-863" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-864"><a href="#cb3-864" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-865"><a href="#cb3-865" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-866"><a href="#cb3-866" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-867"><a href="#cb3-867" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-868"><a href="#cb3-868" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">16</span><span class="op">);</span></span><span id="cb3-869"><a href="#cb3-869" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb3-870"><a href="#cb3-870" aria-hidden="true" tabindex="-1"></a>                    getsym<span class="op">();</span></span><span id="cb3-871"><a href="#cb3-871" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-872"><a href="#cb3-872" aria-hidden="true" tabindex="-1"></a>            tp <span class="op">=</span> arrays<span class="op">;</span></span><span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a>            arraytyp<span class="op">(</span>rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*typ*/</span></span><span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> paramenterlist<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">)</span>   <span class="co">/*formal parameter list*/</span></span><span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a>    types tp<span class="op">;</span></span><span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>    boolean valpar<span class="op">;</span></span><span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rf<span class="op">,</span> sz<span class="op">,</span> x<span class="op">,</span> t0<span class="op">;</span></span><span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>    tp <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>    sz <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">),</span> fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">),</span> <span class="dv">7</span><span class="op">);</span></span><span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> varsym<span class="op">)</span></span><span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>            valpar <span class="op">=</span> true<span class="op">;</span></span><span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>            valpar <span class="op">=</span> false<span class="op">;</span></span><span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a>        t0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a>            enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>                enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span></span><span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//A1 &amp;with = nametab[x];</span></span><span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>x<span class="op">].</span>kind <span class="op">!=</span> typel<span class="op">)</span></span><span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>                        error<span class="op">(</span><span class="dv">19</span><span class="op">);</span></span><span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span><span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>                        tp <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a>                        rf <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>valpar<span class="op">)</span>  sz <span class="op">=</span> nametab<span class="op">[</span>x<span class="op">].</span>size<span class="op">;</span></span><span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> sz <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a>            test <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> <span class="dv">14</span><span class="op">);</span></span><span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>t0 <span class="op">&lt;</span> tx<span class="op">)</span></span><span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a>            t0 <span class="op">=</span> t0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[t0];</span></span><span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>adr <span class="op">=</span> dx<span class="op">;</span></span><span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>normal <span class="op">=</span> valpar<span class="op">;</span></span><span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>                dx <span class="op">=</span> dx <span class="op">+</span> sz<span class="op">;</span></span><span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span></span><span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-960"><a href="#cb3-960" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-961"><a href="#cb3-961" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-962"><a href="#cb3-962" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-963"><a href="#cb3-963" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-964"><a href="#cb3-964" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-965"><a href="#cb3-965" aria-hidden="true" tabindex="-1"></a>            test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> varsym<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-966"><a href="#cb3-966" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-967"><a href="#cb3-967" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>   <span class="co">/*while*/</span></span><span id="cb3-968"><a href="#cb3-968" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span></span><span id="cb3-969"><a href="#cb3-969" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-970"><a href="#cb3-970" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-971"><a href="#cb3-971" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-972"><a href="#cb3-972" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-973"><a href="#cb3-973" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb3-974"><a href="#cb3-974" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*parameterlist*/</span></span><span id="cb3-975"><a href="#cb3-975" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-976"><a href="#cb3-976" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> constdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-977"><a href="#cb3-977" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-978"><a href="#cb3-978" aria-hidden="true" tabindex="-1"></a>    constrec c<span class="op">;</span></span><span id="cb3-979"><a href="#cb3-979" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-980"><a href="#cb3-980" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-981"><a href="#cb3-981" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-982"><a href="#cb3-982" aria-hidden="true" tabindex="-1"></a>        enter1<span class="op">(</span>konstant<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-983"><a href="#cb3-983" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-984"><a href="#cb3-984" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span></span><span id="cb3-985"><a href="#cb3-985" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-986"><a href="#cb3-986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-987"><a href="#cb3-987" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-988"><a href="#cb3-988" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">26</span><span class="op">);</span></span><span id="cb3-989"><a href="#cb3-989" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-990"><a href="#cb3-990" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-991"><a href="#cb3-991" aria-hidden="true" tabindex="-1"></a>        constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> c<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-992"><a href="#cb3-992" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> c<span class="op">.</span>tp<span class="op">;</span></span><span id="cb3-993"><a href="#cb3-993" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-994"><a href="#cb3-994" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>val <span class="op">=</span> c<span class="op">.</span>i<span class="op">;</span></span><span id="cb3-995"><a href="#cb3-995" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-996"><a href="#cb3-996" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-997"><a href="#cb3-997" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-998"><a href="#cb3-998" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-999"><a href="#cb3-999" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* constdeclaration */</span></span><span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> typedeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true" tabindex="-1"></a>    types tp<span class="op">;</span></span><span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> rf<span class="op">,</span> sz<span class="op">,</span> t1<span class="op">;</span></span><span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true" tabindex="-1"></a>        enter1<span class="op">(</span>typel<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span></span><span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">26</span><span class="op">);</span></span><span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span></span><span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true" tabindex="-1"></a>                    getsym<span class="op">();</span></span><span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true" tabindex="-1"></a>        typ <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> tp<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx<span class="op">].</span>size <span class="op">=</span> sz<span class="op">;</span></span><span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* typedeclaration */</span></span><span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> vardeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>dx<span class="op">)</span></span><span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true" tabindex="-1"></a>    types tp<span class="op">;</span></span><span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> t0<span class="op">,</span> t1<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">;</span></span><span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true" tabindex="-1"></a>        t0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true" tabindex="-1"></a>        enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> comma<span class="op">)</span></span><span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true" tabindex="-1"></a>                enter1<span class="op">(</span>variable<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> colon<span class="op">)</span></span><span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true" tabindex="-1"></a>        t1 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true" tabindex="-1"></a>        typ <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> comma<span class="op">,</span> ident<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> tp<span class="op">,</span> rf<span class="op">,</span> sz<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>t0 <span class="op">&lt;</span> t1<span class="op">)</span></span><span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true" tabindex="-1"></a>            t0 <span class="op">=</span> t0 <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[t0];</span></span><span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>typ <span class="op">=</span> tp<span class="op">;</span></span><span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>ref <span class="op">=</span> rf<span class="op">;</span></span><span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>lev <span class="op">=</span> level<span class="op">;</span></span><span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>adr <span class="op">=</span> dx<span class="op">;</span></span><span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true" tabindex="-1"></a>                nametab<span class="op">[</span>t0<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true" tabindex="-1"></a>                dx <span class="op">=</span> dx <span class="op">+</span> sz<span class="op">;</span></span><span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* vardeclaration */</span></span><span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> procdeclaration<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true" tabindex="-1"></a>        id <span class="op">=</span> <span class="ch">&#39; &#39;</span><span class="op">;</span></span><span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true" tabindex="-1"></a>    enter1<span class="op">(</span>prosedure<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>normal <span class="op">=</span> true<span class="op">;</span></span><span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true" tabindex="-1"></a>    block<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span></span><span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*procdeclaration*/</span></span><span id="cb3-1094"><a href="#cb3-1094" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1095"><a href="#cb3-1095" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> listcode<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx0<span class="op">)</span></span><span id="cb3-1096"><a href="#cb3-1096" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1097"><a href="#cb3-1097" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb3-1098"><a href="#cb3-1098" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1099"><a href="#cb3-1099" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> cx0<span class="op">;</span> i <span class="op">&lt;=</span> cx <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">++)</span></span><span id="cb3-1100"><a href="#cb3-1100" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1101"><a href="#cb3-1101" aria-hidden="true" tabindex="-1"></a>        <span class="co">//instruction &amp;with = code[i];</span></span><span id="cb3-1102"><a href="#cb3-1102" aria-hidden="true" tabindex="-1"></a>        listfile <span class="op">&lt;&lt;</span> format<span class="op">(</span>i<span class="op">,</span> <span class="dv">4</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>mnemonic<span class="op">[</span>code<span class="op">[</span>i<span class="op">].</span>f<span class="op">],</span> <span class="dv">7</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>code<span class="op">[</span>i<span class="op">].</span>l<span class="op">,</span> <span class="dv">3</span><span class="op">)</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span>code<span class="op">[</span>i<span class="op">].</span>a<span class="op">,</span> <span class="dv">5</span><span class="op">)</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-1103"><a href="#cb3-1103" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1104"><a href="#cb3-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* listcode */</span></span><span id="cb3-1105"><a href="#cb3-1105" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1106"><a href="#cb3-1106" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> factor<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1107"><a href="#cb3-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1108"><a href="#cb3-1108" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb3-1109"><a href="#cb3-1109" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1110"><a href="#cb3-1110" aria-hidden="true" tabindex="-1"></a>    x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-1111"><a href="#cb3-1111" aria-hidden="true" tabindex="-1"></a>    x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1112"><a href="#cb3-1112" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>facbegsys<span class="op">,</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1113"><a href="#cb3-1113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>facbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1114"><a href="#cb3-1114" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1115"><a href="#cb3-1115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>sym<span class="op">)</span></span><span id="cb3-1116"><a href="#cb3-1116" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1117"><a href="#cb3-1117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ident <span class="op">:</span></span><span id="cb3-1118"><a href="#cb3-1118" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1119"><a href="#cb3-1119" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1120"><a href="#cb3-1120" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1121"><a href="#cb3-1121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb3-1122"><a href="#cb3-1122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-1123"><a href="#cb3-1123" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1124"><a href="#cb3-1124" aria-hidden="true" tabindex="-1"></a>                <span class="co">//A1 &amp;with = nametab[i];</span></span><span id="cb3-1125"><a href="#cb3-1125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">switch</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind<span class="op">)</span></span><span id="cb3-1126"><a href="#cb3-1126" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-1127"><a href="#cb3-1127" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> konstant<span class="op">:</span></span><span id="cb3-1128"><a href="#cb3-1128" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-1129"><a href="#cb3-1129" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-1130"><a href="#cb3-1130" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1131"><a href="#cb3-1131" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>val<span class="op">);</span></span><span id="cb3-1132"><a href="#cb3-1132" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-1133"><a href="#cb3-1133" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1134"><a href="#cb3-1134" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> variable<span class="op">:</span></span><span id="cb3-1135"><a href="#cb3-1135" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-1136"><a href="#cb3-1136" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-1137"><a href="#cb3-1137" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-1138"><a href="#cb3-1138" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">((</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> ints<span class="op">)</span> <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> bool_<span class="op">)</span> <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> chars<span class="op">))</span></span><span id="cb3-1139"><a href="#cb3-1139" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1140"><a href="#cb3-1140" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>normal<span class="op">)</span>   gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1141"><a href="#cb3-1141" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> gen<span class="op">(</span>ilod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1142"><a href="#cb3-1142" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>  <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb3-1143"><a href="#cb3-1143" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-1144"><a href="#cb3-1144" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>normal<span class="op">)</span>  gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1145"><a href="#cb3-1145" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1146"><a href="#cb3-1146" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-1147"><a href="#cb3-1147" aria-hidden="true" tabindex="-1"></a>                            arrayelement<span class="op">(</span>fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span> <span class="co">//LosPhoenix tocheck</span></span><span id="cb3-1148"><a href="#cb3-1148" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> arrays<span class="op">)</span></span><span id="cb3-1149"><a href="#cb3-1149" aria-hidden="true" tabindex="-1"></a>                            gen<span class="op">(</span>lodt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1150"><a href="#cb3-1150" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-1151"><a href="#cb3-1151" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-1152"><a href="#cb3-1152" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1153"><a href="#cb3-1153" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> prosedure<span class="op">:</span></span><span id="cb3-1154"><a href="#cb3-1154" aria-hidden="true" tabindex="-1"></a>                <span class="cf">case</span> typel<span class="op">:</span></span><span id="cb3-1155"><a href="#cb3-1155" aria-hidden="true" tabindex="-1"></a>                    error<span class="op">(</span><span class="dv">41</span><span class="op">);</span></span><span id="cb3-1156"><a href="#cb3-1156" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1157"><a href="#cb3-1157" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-1158"><a href="#cb3-1158" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1159"><a href="#cb3-1159" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1160"><a href="#cb3-1160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1161"><a href="#cb3-1161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> intcon<span class="op">:</span></span><span id="cb3-1162"><a href="#cb3-1162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> charcon <span class="op">:</span></span><span id="cb3-1163"><a href="#cb3-1163" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1164"><a href="#cb3-1164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> intcon<span class="op">)</span>  x<span class="op">.</span>typ <span class="op">=</span> ints<span class="op">;</span></span><span id="cb3-1165"><a href="#cb3-1165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> x<span class="op">.</span>typ <span class="op">=</span> chars<span class="op">;</span></span><span id="cb3-1166"><a href="#cb3-1166" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1167"><a href="#cb3-1167" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> num<span class="op">);</span></span><span id="cb3-1168"><a href="#cb3-1168" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1169"><a href="#cb3-1169" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1170"><a href="#cb3-1170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1171"><a href="#cb3-1171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lparen <span class="op">:</span></span><span id="cb3-1172"><a href="#cb3-1172" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1173"><a href="#cb3-1173" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1174"><a href="#cb3-1174" aria-hidden="true" tabindex="-1"></a>            expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1175"><a href="#cb3-1175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1176"><a href="#cb3-1176" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb3-1177"><a href="#cb3-1177" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1178"><a href="#cb3-1178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1179"><a href="#cb3-1179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> notsym <span class="op">:</span></span><span id="cb3-1180"><a href="#cb3-1180" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1181"><a href="#cb3-1181" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1182"><a href="#cb3-1182" aria-hidden="true" tabindex="-1"></a>            factor<span class="op">(</span>fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1183"><a href="#cb3-1183" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb3-1184"><a href="#cb3-1184" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>nots <span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1185"><a href="#cb3-1185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1186"><a href="#cb3-1186" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1187"><a href="#cb3-1187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1188"><a href="#cb3-1188" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span>    <span class="co">/* case */</span></span><span id="cb3-1189"><a href="#cb3-1189" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rbrack<span class="op">,</span> rparen<span class="op">,</span>tosym<span class="op">,</span>downtosym<span class="op">,</span> eos<span class="op">),</span> facbegsys<span class="op">,</span> <span class="dv">23</span><span class="op">);</span></span><span id="cb3-1190"><a href="#cb3-1190" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>    <span class="co">/* of if */</span></span><span id="cb3-1191"><a href="#cb3-1191" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* factor */</span></span><span id="cb3-1192"><a href="#cb3-1192" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1193"><a href="#cb3-1193" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> term<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1194"><a href="#cb3-1194" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1195"><a href="#cb3-1195" aria-hidden="true" tabindex="-1"></a>    symbol mulop<span class="op">;</span></span><span id="cb3-1196"><a href="#cb3-1196" aria-hidden="true" tabindex="-1"></a>    item y<span class="op">;</span></span><span id="cb3-1197"><a href="#cb3-1197" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* term */</span></span><span id="cb3-1198"><a href="#cb3-1198" aria-hidden="true" tabindex="-1"></a>    factor<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1199"><a href="#cb3-1199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1200"><a href="#cb3-1200" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1201"><a href="#cb3-1201" aria-hidden="true" tabindex="-1"></a>        mulop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb3-1202"><a href="#cb3-1202" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1203"><a href="#cb3-1203" aria-hidden="true" tabindex="-1"></a>        factor<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>times<span class="op">,</span> divsym<span class="op">,</span> modsym<span class="op">,</span> andsym<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1204"><a href="#cb3-1204" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb3-1205"><a href="#cb3-1205" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1206"><a href="#cb3-1206" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1207"><a href="#cb3-1207" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-1208"><a href="#cb3-1208" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1209"><a href="#cb3-1209" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1210"><a href="#cb3-1210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-1211"><a href="#cb3-1211" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1212"><a href="#cb3-1212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>mulop <span class="op">==</span> times<span class="op">)</span></span><span id="cb3-1213"><a href="#cb3-1213" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1214"><a href="#cb3-1214" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>mult<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1215"><a href="#cb3-1215" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1216"><a href="#cb3-1216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> divsym<span class="op">)</span></span><span id="cb3-1217"><a href="#cb3-1217" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1218"><a href="#cb3-1218" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>idiv<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1219"><a href="#cb3-1219" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1220"><a href="#cb3-1220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> modsym<span class="op">)</span></span><span id="cb3-1221"><a href="#cb3-1221" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1222"><a href="#cb3-1222" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>imod<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1223"><a href="#cb3-1223" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1224"><a href="#cb3-1224" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>  <span class="op">(</span>mulop <span class="op">==</span> andsym<span class="op">)</span></span><span id="cb3-1225"><a href="#cb3-1225" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb3-1226"><a href="#cb3-1226" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>ands<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1227"><a href="#cb3-1227" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1228"><a href="#cb3-1228" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1229"><a href="#cb3-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1230"><a href="#cb3-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* term*/</span></span><span id="cb3-1231"><a href="#cb3-1231" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1232"><a href="#cb3-1232" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> simpleexpression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1233"><a href="#cb3-1233" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1234"><a href="#cb3-1234" aria-hidden="true" tabindex="-1"></a>    symbol addop<span class="op">;</span></span><span id="cb3-1235"><a href="#cb3-1235" aria-hidden="true" tabindex="-1"></a>    item y<span class="op">;</span></span><span id="cb3-1236"><a href="#cb3-1236" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* simpleexpression */</span></span><span id="cb3-1237"><a href="#cb3-1237" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1238"><a href="#cb3-1238" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1239"><a href="#cb3-1239" aria-hidden="true" tabindex="-1"></a>        addop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb3-1240"><a href="#cb3-1240" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1241"><a href="#cb3-1241" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1242"><a href="#cb3-1242" aria-hidden="true" tabindex="-1"></a>        term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1243"><a href="#cb3-1243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>addop <span class="op">==</span> minus<span class="op">)</span>  gen<span class="op">(</span>mus<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1244"><a href="#cb3-1244" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1245"><a href="#cb3-1245" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1246"><a href="#cb3-1246" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1247"><a href="#cb3-1247" aria-hidden="true" tabindex="-1"></a>        term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1248"><a href="#cb3-1248" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1249"><a href="#cb3-1249" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1250"><a href="#cb3-1250" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1251"><a href="#cb3-1251" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1252"><a href="#cb3-1252" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1253"><a href="#cb3-1253" aria-hidden="true" tabindex="-1"></a>        addop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb3-1254"><a href="#cb3-1254" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1255"><a href="#cb3-1255" aria-hidden="true" tabindex="-1"></a>        term<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>plus<span class="op">,</span> minus<span class="op">,</span> orsym<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1256"><a href="#cb3-1256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb3-1257"><a href="#cb3-1257" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1258"><a href="#cb3-1258" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1259"><a href="#cb3-1259" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-1260"><a href="#cb3-1260" aria-hidden="true" tabindex="-1"></a>            x<span class="op">.</span>ref <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1261"><a href="#cb3-1261" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1262"><a href="#cb3-1262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-1263"><a href="#cb3-1263" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1264"><a href="#cb3-1264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>addop <span class="op">==</span> plus<span class="op">)</span></span><span id="cb3-1265"><a href="#cb3-1265" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1266"><a href="#cb3-1266" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>add<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1267"><a href="#cb3-1267" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1268"><a href="#cb3-1268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>  <span class="op">(</span>addop <span class="op">==</span> minus<span class="op">)</span></span><span id="cb3-1269"><a href="#cb3-1269" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1270"><a href="#cb3-1270" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>sub<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1271"><a href="#cb3-1271" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1272"><a href="#cb3-1272" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>  <span class="op">(</span>addop <span class="op">==</span> orsym<span class="op">)</span></span><span id="cb3-1273"><a href="#cb3-1273" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> bool_<span class="op">)</span></span><span id="cb3-1274"><a href="#cb3-1274" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>ors<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1275"><a href="#cb3-1275" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1276"><a href="#cb3-1276" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1277"><a href="#cb3-1277" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1278"><a href="#cb3-1278" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* simpleexpression */</span></span><span id="cb3-1279"><a href="#cb3-1279" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1280"><a href="#cb3-1280" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> expression<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1281"><a href="#cb3-1281" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1282"><a href="#cb3-1282" aria-hidden="true" tabindex="-1"></a>    symbol relop<span class="op">;</span></span><span id="cb3-1283"><a href="#cb3-1283" aria-hidden="true" tabindex="-1"></a>    item y<span class="op">;</span></span><span id="cb3-1284"><a href="#cb3-1284" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*expression*/</span></span><span id="cb3-1285"><a href="#cb3-1285" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1286"><a href="#cb3-1286" aria-hidden="true" tabindex="-1"></a>    simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> gtr<span class="op">,</span> leq<span class="op">,</span> geq<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1287"><a href="#cb3-1287" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1288"><a href="#cb3-1288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eql<span class="op">,</span> neq<span class="op">,</span> lss<span class="op">,</span> leq<span class="op">,</span> gtr<span class="op">,</span> geq<span class="op">,</span> eos<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1289"><a href="#cb3-1289" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1290"><a href="#cb3-1290" aria-hidden="true" tabindex="-1"></a>        relop <span class="op">=</span> sym<span class="op">;</span></span><span id="cb3-1291"><a href="#cb3-1291" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1292"><a href="#cb3-1292" aria-hidden="true" tabindex="-1"></a>        simpleexpression<span class="op">(</span>fsys<span class="op">,</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1293"><a href="#cb3-1293" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span></span><span id="cb3-1294"><a href="#cb3-1294" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1295"><a href="#cb3-1295" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span>relop<span class="op">)</span></span><span id="cb3-1296"><a href="#cb3-1296" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1297"><a href="#cb3-1297" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> eql<span class="op">:</span></span><span id="cb3-1298"><a href="#cb3-1298" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>eq<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1299"><a href="#cb3-1299" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1300"><a href="#cb3-1300" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> neq<span class="op">:</span></span><span id="cb3-1301"><a href="#cb3-1301" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>ne<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1302"><a href="#cb3-1302" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1303"><a href="#cb3-1303" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> lss<span class="op">:</span></span><span id="cb3-1304"><a href="#cb3-1304" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>ls<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1305"><a href="#cb3-1305" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1306"><a href="#cb3-1306" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> geq<span class="op">:</span></span><span id="cb3-1307"><a href="#cb3-1307" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>ge<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1308"><a href="#cb3-1308" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1309"><a href="#cb3-1309" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> gtr<span class="op">:</span></span><span id="cb3-1310"><a href="#cb3-1310" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>gt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1311"><a href="#cb3-1311" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1312"><a href="#cb3-1312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> leq<span class="op">:</span></span><span id="cb3-1313"><a href="#cb3-1313" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>le<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1314"><a href="#cb3-1314" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1315"><a href="#cb3-1315" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1316"><a href="#cb3-1316" aria-hidden="true" tabindex="-1"></a>        x<span class="op">.</span>typ <span class="op">=</span> bool_<span class="op">;</span></span><span id="cb3-1317"><a href="#cb3-1317" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1318"><a href="#cb3-1318" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* expression */</span></span><span id="cb3-1319"><a href="#cb3-1319" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> forstatement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb3-1320"><a href="#cb3-1320" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1321"><a href="#cb3-1321" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1322"><a href="#cb3-1322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb3-1323"><a href="#cb3-1323" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> downto <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1324"><a href="#cb3-1324" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1325"><a href="#cb3-1325" aria-hidden="true" tabindex="-1"></a>    assignment<span class="op">(</span>i<span class="op">,</span>level<span class="op">,</span>fsys<span class="op">);</span></span><span id="cb3-1326"><a href="#cb3-1326" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> addr <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">;</span></span><span id="cb3-1327"><a href="#cb3-1327" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>addr <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1328"><a href="#cb3-1328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sym <span class="op">==</span> tosym<span class="op">)</span></span><span id="cb3-1329"><a href="#cb3-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1330"><a href="#cb3-1330" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1331"><a href="#cb3-1331" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1332"><a href="#cb3-1332" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>sym<span class="op">==</span>downtosym<span class="op">)</span></span><span id="cb3-1333"><a href="#cb3-1333" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1334"><a href="#cb3-1334" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1335"><a href="#cb3-1335" aria-hidden="true" tabindex="-1"></a>        downto <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1336"><a href="#cb3-1336" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1337"><a href="#cb3-1337" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1338"><a href="#cb3-1338" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1339"><a href="#cb3-1339" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">37</span><span class="op">);</span></span><span id="cb3-1340"><a href="#cb3-1340" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1341"><a href="#cb3-1341" aria-hidden="true" tabindex="-1"></a>    cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1342"><a href="#cb3-1342" aria-hidden="true" tabindex="-1"></a>    simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>dosym<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1343"><a href="#cb3-1343" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb3-1344"><a href="#cb3-1344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>downto<span class="op">)</span></span><span id="cb3-1345"><a href="#cb3-1345" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1346"><a href="#cb3-1346" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>le<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1347"><a href="#cb3-1347" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1348"><a href="#cb3-1348" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1349"><a href="#cb3-1349" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1350"><a href="#cb3-1350" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>ge<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1351"><a href="#cb3-1351" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1352"><a href="#cb3-1352" aria-hidden="true" tabindex="-1"></a>    cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1353"><a href="#cb3-1353" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1354"><a href="#cb3-1354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sym<span class="op">==</span>dosym<span class="op">)</span></span><span id="cb3-1355"><a href="#cb3-1355" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1356"><a href="#cb3-1356" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1357"><a href="#cb3-1357" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1358"><a href="#cb3-1358" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1359"><a href="#cb3-1359" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1360"><a href="#cb3-1360" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1361"><a href="#cb3-1361" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1362"><a href="#cb3-1362" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1363"><a href="#cb3-1363" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>loda<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb3-1364"><a href="#cb3-1364" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>addr<span class="op">);</span></span><span id="cb3-1365"><a href="#cb3-1365" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-1366"><a href="#cb3-1366" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>downto<span class="op">)</span></span><span id="cb3-1367"><a href="#cb3-1367" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1368"><a href="#cb3-1368" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>sub<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1369"><a href="#cb3-1369" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1370"><a href="#cb3-1370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1371"><a href="#cb3-1371" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1372"><a href="#cb3-1372" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>add<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1373"><a href="#cb3-1373" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1374"><a href="#cb3-1374" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>sto<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1375"><a href="#cb3-1375" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx1<span class="op">);</span></span><span id="cb3-1376"><a href="#cb3-1376" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1377"><a href="#cb3-1377" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1378"><a href="#cb3-1378" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1379"><a href="#cb3-1379" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1380"><a href="#cb3-1380" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cc<span class="op">;</span></span><span id="cb3-1381"><a href="#cb3-1381" aria-hidden="true" tabindex="-1"></a>    index1 addr<span class="op">,</span> p<span class="op">;</span></span><span id="cb3-1382"><a href="#cb3-1382" aria-hidden="true" tabindex="-1"></a>    item y<span class="op">;</span></span><span id="cb3-1383"><a href="#cb3-1383" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1384"><a href="#cb3-1384" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> x<span class="op">.</span>ref<span class="op">;</span></span><span id="cb3-1385"><a href="#cb3-1385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-1386"><a href="#cb3-1386" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1387"><a href="#cb3-1387" aria-hidden="true" tabindex="-1"></a>        <span class="cf">do</span></span><span id="cb3-1388"><a href="#cb3-1388" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1389"><a href="#cb3-1389" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1390"><a href="#cb3-1390" aria-hidden="true" tabindex="-1"></a>            expression<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> eos<span class="op">),</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1391"><a href="#cb3-1391" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> arrays<span class="op">)</span>  error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1392"><a href="#cb3-1392" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-1393"><a href="#cb3-1393" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1394"><a href="#cb3-1394" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>y<span class="op">.</span>typ <span class="op">!=</span> atab<span class="op">[</span>p<span class="op">].</span>inxtyp<span class="op">)</span>  error<span class="op">(</span><span class="dv">44</span><span class="op">);</span></span><span id="cb3-1395"><a href="#cb3-1395" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>p<span class="op">].</span>low<span class="op">);</span></span><span id="cb3-1396"><a href="#cb3-1396" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>sub<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1397"><a href="#cb3-1397" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>lit<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> atab<span class="op">[</span>p<span class="op">].</span>elsize<span class="op">);</span></span><span id="cb3-1398"><a href="#cb3-1398" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>mult<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1399"><a href="#cb3-1399" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>add<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1400"><a href="#cb3-1400" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>typ <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>eltyp<span class="op">;</span></span><span id="cb3-1401"><a href="#cb3-1401" aria-hidden="true" tabindex="-1"></a>                x<span class="op">.</span>ref <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>elref<span class="op">;</span></span><span id="cb3-1402"><a href="#cb3-1402" aria-hidden="true" tabindex="-1"></a>                p <span class="op">=</span> atab<span class="op">[</span>p<span class="op">].</span>elref<span class="op">;</span></span><span id="cb3-1403"><a href="#cb3-1403" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1404"><a href="#cb3-1404" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1405"><a href="#cb3-1405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb3-1406"><a href="#cb3-1406" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1407"><a href="#cb3-1407" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rbrack<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1408"><a href="#cb3-1408" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">28</span><span class="op">);</span></span><span id="cb3-1409"><a href="#cb3-1409" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1410"><a href="#cb3-1410" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">16</span><span class="op">);</span></span><span id="cb3-1411"><a href="#cb3-1411" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1412"><a href="#cb3-1412" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*arrayelement*/</span></span><span id="cb3-1413"><a href="#cb3-1413" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1414"><a href="#cb3-1414" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> assignment<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1415"><a href="#cb3-1415" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1416"><a href="#cb3-1416" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">,</span> y<span class="op">;</span></span><span id="cb3-1417"><a href="#cb3-1417" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1418"><a href="#cb3-1418" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1419"><a href="#cb3-1419" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb3-1420"><a href="#cb3-1420" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span></span><span id="cb3-1421"><a href="#cb3-1421" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1422"><a href="#cb3-1422" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* giving value to non-variation */</span></span><span id="cb3-1423"><a href="#cb3-1423" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb3-1424"><a href="#cb3-1424" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1425"><a href="#cb3-1425" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1426"><a href="#cb3-1426" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1427"><a href="#cb3-1427" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1428"><a href="#cb3-1428" aria-hidden="true" tabindex="-1"></a>    x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-1429"><a href="#cb3-1429" aria-hidden="true" tabindex="-1"></a>    x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-1430"><a href="#cb3-1430" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1431"><a href="#cb3-1431" aria-hidden="true" tabindex="-1"></a>        A1 <span class="op">&amp;</span>with <span class="op">=</span> nametab<span class="op">[</span>i<span class="op">];</span></span><span id="cb3-1432"><a href="#cb3-1432" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>with<span class="op">.</span>normal<span class="op">)</span></span><span id="cb3-1433"><a href="#cb3-1433" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>loda<span class="op">,</span> with<span class="op">.</span>lev<span class="op">,</span> with<span class="op">.</span>adr<span class="op">);</span></span><span id="cb3-1434"><a href="#cb3-1434" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> with<span class="op">.</span>lev<span class="op">,</span> with<span class="op">.</span>adr<span class="op">);</span></span><span id="cb3-1435"><a href="#cb3-1435" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1436"><a href="#cb3-1436" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-1437"><a href="#cb3-1437" aria-hidden="true" tabindex="-1"></a>        arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>becomes<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1438"><a href="#cb3-1438" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> becomes<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1439"><a href="#cb3-1439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1440"><a href="#cb3-1440" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1441"><a href="#cb3-1441" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">33</span><span class="op">);</span></span><span id="cb3-1442"><a href="#cb3-1442" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> eql<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1443"><a href="#cb3-1443" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1444"><a href="#cb3-1444" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1445"><a href="#cb3-1445" aria-hidden="true" tabindex="-1"></a>    expression<span class="op">(</span>fsys<span class="op">,</span> y<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1446"><a href="#cb3-1446" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> y<span class="op">.</span>typ<span class="op">)</span>  error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1447"><a href="#cb3-1447" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb3-1448"><a href="#cb3-1448" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>ref <span class="op">==</span> y<span class="op">.</span>ref<span class="op">)</span></span><span id="cb3-1449"><a href="#cb3-1449" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>cpyb<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>x<span class="op">.</span>ref<span class="op">].</span>size<span class="op">);</span></span><span id="cb3-1450"><a href="#cb3-1450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">40</span><span class="op">);</span></span><span id="cb3-1451"><a href="#cb3-1451" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> gen<span class="op">(</span>sto<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1452"><a href="#cb3-1452" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*assignment*/</span></span><span id="cb3-1453"><a href="#cb3-1453" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1454"><a href="#cb3-1454" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> ifstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb3-1455"><a href="#cb3-1455" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1456"><a href="#cb3-1456" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1457"><a href="#cb3-1457" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1458"><a href="#cb3-1458" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1459"><a href="#cb3-1459" aria-hidden="true" tabindex="-1"></a>    expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>thensym<span class="op">,</span> dosym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1460"><a href="#cb3-1460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> bool_<span class="op">)</span>  error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb3-1461"><a href="#cb3-1461" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> thensym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1462"><a href="#cb3-1462" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">35</span><span class="op">);</span></span><span id="cb3-1463"><a href="#cb3-1463" aria-hidden="true" tabindex="-1"></a>    cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1464"><a href="#cb3-1464" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jpc<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1465"><a href="#cb3-1465" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>elsesym<span class="op">,</span> eos<span class="op">),</span> level<span class="op">);</span></span><span id="cb3-1466"><a href="#cb3-1466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> elsesym<span class="op">)</span></span><span id="cb3-1467"><a href="#cb3-1467" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1468"><a href="#cb3-1468" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1469"><a href="#cb3-1469" aria-hidden="true" tabindex="-1"></a>        cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1470"><a href="#cb3-1470" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1471"><a href="#cb3-1471" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx1<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1472"><a href="#cb3-1472" aria-hidden="true" tabindex="-1"></a>        labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1473"><a href="#cb3-1473" aria-hidden="true" tabindex="-1"></a>        lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1474"><a href="#cb3-1474" aria-hidden="true" tabindex="-1"></a>        statement<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1475"><a href="#cb3-1475" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1476"><a href="#cb3-1476" aria-hidden="true" tabindex="-1"></a>        labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1477"><a href="#cb3-1477" aria-hidden="true" tabindex="-1"></a>        lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1478"><a href="#cb3-1478" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1479"><a href="#cb3-1479" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-1480"><a href="#cb3-1480" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1481"><a href="#cb3-1481" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>cx1<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1482"><a href="#cb3-1482" aria-hidden="true" tabindex="-1"></a>        labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1483"><a href="#cb3-1483" aria-hidden="true" tabindex="-1"></a>        lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1484"><a href="#cb3-1484" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1485"><a href="#cb3-1485" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*ifstatement*/</span></span><span id="cb3-1486"><a href="#cb3-1486" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1487"><a href="#cb3-1487" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> compound<span class="op">(</span>symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1488"><a href="#cb3-1488" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1489"><a href="#cb3-1489" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1490"><a href="#cb3-1490" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1491"><a href="#cb3-1491" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> statbegsys<span class="op">).</span>has<span class="op">(</span>sym<span class="op">))</span></span><span id="cb3-1492"><a href="#cb3-1492" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1493"><a href="#cb3-1493" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1494"><a href="#cb3-1494" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1495"><a href="#cb3-1495" aria-hidden="true" tabindex="-1"></a>        statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1496"><a href="#cb3-1496" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1497"><a href="#cb3-1497" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> endsym<span class="op">)</span></span><span id="cb3-1498"><a href="#cb3-1498" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1499"><a href="#cb3-1499" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">36</span><span class="op">);</span></span><span id="cb3-1500"><a href="#cb3-1500" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*compound*/</span></span><span id="cb3-1501"><a href="#cb3-1501" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> repeatstatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1502"><a href="#cb3-1502" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1503"><a href="#cb3-1503" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1504"><a href="#cb3-1504" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1505"><a href="#cb3-1505" aria-hidden="true" tabindex="-1"></a>    cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1506"><a href="#cb3-1506" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>untilsym<span class="op">,</span>eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1507"><a href="#cb3-1507" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>sym<span class="op">!=</span>untilsym<span class="op">)</span></span><span id="cb3-1508"><a href="#cb3-1508" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1509"><a href="#cb3-1509" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1510"><a href="#cb3-1510" aria-hidden="true" tabindex="-1"></a>        statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>untilsym<span class="op">,</span>eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1511"><a href="#cb3-1511" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1512"><a href="#cb3-1512" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1513"><a href="#cb3-1513" aria-hidden="true" tabindex="-1"></a>    expression<span class="op">(</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1514"><a href="#cb3-1514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>x<span class="op">.</span>typ<span class="op">!=</span>bool_<span class="op">)</span>error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb3-1515"><a href="#cb3-1515" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx1<span class="op">);</span></span><span id="cb3-1516"><a href="#cb3-1516" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span>cx<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-1517"><a href="#cb3-1517" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1518"><a href="#cb3-1518" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1519"><a href="#cb3-1519" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> whilestatement<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb3-1520"><a href="#cb3-1520" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1521"><a href="#cb3-1521" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1522"><a href="#cb3-1522" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1523"><a href="#cb3-1523" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1524"><a href="#cb3-1524" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1525"><a href="#cb3-1525" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1526"><a href="#cb3-1526" aria-hidden="true" tabindex="-1"></a>    cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1527"><a href="#cb3-1527" aria-hidden="true" tabindex="-1"></a>    expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>dosym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1528"><a href="#cb3-1528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">!=</span> bool_<span class="op">)</span>  error<span class="op">(</span><span class="dv">34</span><span class="op">);</span></span><span id="cb3-1529"><a href="#cb3-1529" aria-hidden="true" tabindex="-1"></a>    cx2 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1530"><a href="#cb3-1530" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jpc<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1531"><a href="#cb3-1531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> dosym<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1532"><a href="#cb3-1532" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">37</span><span class="op">);</span></span><span id="cb3-1533"><a href="#cb3-1533" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1534"><a href="#cb3-1534" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cx1<span class="op">);</span></span><span id="cb3-1535"><a href="#cb3-1535" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>cx2<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1536"><a href="#cb3-1536" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1537"><a href="#cb3-1537" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1538"><a href="#cb3-1538" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/*whilestatement*/</span></span><span id="cb3-1539"><a href="#cb3-1539" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1540"><a href="#cb3-1540" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> stanproc<span class="op">(</span><span class="dt">int</span> i<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> item <span class="op">&amp;</span>x<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1541"><a href="#cb3-1541" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1542"><a href="#cb3-1542" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">;</span></span><span id="cb3-1543"><a href="#cb3-1543" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1544"><a href="#cb3-1544" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">6</span><span class="op">)</span></span><span id="cb3-1545"><a href="#cb3-1545" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1546"><a href="#cb3-1546" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* read */</span></span><span id="cb3-1547"><a href="#cb3-1547" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1548"><a href="#cb3-1548" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb3-1549"><a href="#cb3-1549" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1550"><a href="#cb3-1550" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-1551"><a href="#cb3-1551" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1552"><a href="#cb3-1552" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1553"><a href="#cb3-1553" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1554"><a href="#cb3-1554" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-1555"><a href="#cb3-1555" aria-hidden="true" tabindex="-1"></a>                    n <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1556"><a href="#cb3-1556" aria-hidden="true" tabindex="-1"></a>                    getsym<span class="op">();</span></span><span id="cb3-1557"><a href="#cb3-1557" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  error<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span><span id="cb3-1558"><a href="#cb3-1558" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>n<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span></span><span id="cb3-1559"><a href="#cb3-1559" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-1560"><a href="#cb3-1560" aria-hidden="true" tabindex="-1"></a>                        error<span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb3-1561"><a href="#cb3-1561" aria-hidden="true" tabindex="-1"></a>                        n <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1562"><a href="#cb3-1562" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-1563"><a href="#cb3-1563" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span><span id="cb3-1564"><a href="#cb3-1564" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-1565"><a href="#cb3-1565" aria-hidden="true" tabindex="-1"></a>                        x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>n<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-1566"><a href="#cb3-1566" aria-hidden="true" tabindex="-1"></a>                        x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>n<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-1567"><a href="#cb3-1567" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>n<span class="op">].</span>normal<span class="op">)</span></span><span id="cb3-1568"><a href="#cb3-1568" aria-hidden="true" tabindex="-1"></a>                            gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1569"><a href="#cb3-1569" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>n<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1570"><a href="#cb3-1570" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-1571"><a href="#cb3-1571" aria-hidden="true" tabindex="-1"></a>                            arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1572"><a href="#cb3-1572" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1573"><a href="#cb3-1573" aria-hidden="true" tabindex="-1"></a>                            gen<span class="op">(</span>red<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1574"><a href="#cb3-1574" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> chars<span class="op">)</span></span><span id="cb3-1575"><a href="#cb3-1575" aria-hidden="true" tabindex="-1"></a>                            gen<span class="op">(</span>red<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-1576"><a href="#cb3-1576" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1577"><a href="#cb3-1577" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-1578"><a href="#cb3-1578" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-1579"><a href="#cb3-1579" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1580"><a href="#cb3-1580" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1581"><a href="#cb3-1581" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb3-1582"><a href="#cb3-1582" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span>  error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb3-1583"><a href="#cb3-1583" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>  getsym<span class="op">();</span></span><span id="cb3-1584"><a href="#cb3-1584" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1585"><a href="#cb3-1585" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">32</span><span class="op">);</span></span><span id="cb3-1586"><a href="#cb3-1586" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1587"><a href="#cb3-1587" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">7</span><span class="op">)</span></span><span id="cb3-1588"><a href="#cb3-1588" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1589"><a href="#cb3-1589" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* write */</span></span><span id="cb3-1590"><a href="#cb3-1590" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1591"><a href="#cb3-1591" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb3-1592"><a href="#cb3-1592" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1593"><a href="#cb3-1593" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-1594"><a href="#cb3-1594" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1595"><a href="#cb3-1595" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1596"><a href="#cb3-1596" aria-hidden="true" tabindex="-1"></a>                expression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>rparen<span class="op">,</span> comma<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1597"><a href="#cb3-1597" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> ints<span class="op">)</span></span><span id="cb3-1598"><a href="#cb3-1598" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>wrt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-1599"><a href="#cb3-1599" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> chars<span class="op">)</span></span><span id="cb3-1600"><a href="#cb3-1600" aria-hidden="true" tabindex="-1"></a>                    gen<span class="op">(</span>wrt<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-1601"><a href="#cb3-1601" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> error<span class="op">(</span><span class="dv">43</span><span class="op">);</span></span><span id="cb3-1602"><a href="#cb3-1602" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1603"><a href="#cb3-1603" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb3-1604"><a href="#cb3-1604" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> rparen<span class="op">)</span>  error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb3-1605"><a href="#cb3-1605" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1606"><a href="#cb3-1606" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1607"><a href="#cb3-1607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">32</span><span class="op">);</span></span><span id="cb3-1608"><a href="#cb3-1608" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1609"><a href="#cb3-1609" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* standproc */</span></span><span id="cb3-1610"><a href="#cb3-1610" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1611"><a href="#cb3-1611" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> call<span class="op">(</span><span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">,</span> symset <span class="op">&amp;</span>fsys<span class="op">)</span></span><span id="cb3-1612"><a href="#cb3-1612" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1613"><a href="#cb3-1613" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1614"><a href="#cb3-1614" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> lastp<span class="op">,</span> cp<span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">;</span></span><span id="cb3-1615"><a href="#cb3-1615" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* call */</span></span><span id="cb3-1616"><a href="#cb3-1616" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1617"><a href="#cb3-1617" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1618"><a href="#cb3-1618" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1619"><a href="#cb3-1619" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1620"><a href="#cb3-1620" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>kind <span class="op">==</span> prosedure<span class="op">)</span></span><span id="cb3-1621"><a href="#cb3-1621" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1622"><a href="#cb3-1622" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>lev <span class="op">==</span> <span class="dv">0</span><span class="op">)</span>  stanproc<span class="op">(</span>i<span class="op">,</span> level<span class="op">,</span> x<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1623"><a href="#cb3-1623" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb3-1624"><a href="#cb3-1624" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1625"><a href="#cb3-1625" aria-hidden="true" tabindex="-1"></a>                getsym<span class="op">();</span></span><span id="cb3-1626"><a href="#cb3-1626" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>opac<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/*open active record*/</span></span><span id="cb3-1627"><a href="#cb3-1627" aria-hidden="true" tabindex="-1"></a>                lastp <span class="op">=</span> btab<span class="op">[</span>nametab<span class="op">[</span>i<span class="op">].</span>ref<span class="op">].</span>lastpar<span class="op">;</span></span><span id="cb3-1628"><a href="#cb3-1628" aria-hidden="true" tabindex="-1"></a>                cp <span class="op">=</span> i<span class="op">;</span></span><span id="cb3-1629"><a href="#cb3-1629" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lparen<span class="op">)</span></span><span id="cb3-1630"><a href="#cb3-1630" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#123;</span></span><span id="cb3-1631"><a href="#cb3-1631" aria-hidden="true" tabindex="-1"></a>                    <span class="co">/*actual parameter list*/</span></span><span id="cb3-1632"><a href="#cb3-1632" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">do</span></span><span id="cb3-1633"><a href="#cb3-1633" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#123;</span></span><span id="cb3-1634"><a href="#cb3-1634" aria-hidden="true" tabindex="-1"></a>                        getsym<span class="op">();</span></span><span id="cb3-1635"><a href="#cb3-1635" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="op">(</span>cp <span class="op">&gt;=</span> lastp<span class="op">)</span></span><span id="cb3-1636"><a href="#cb3-1636" aria-hidden="true" tabindex="-1"></a>                            error<span class="op">(</span><span class="dv">29</span><span class="op">);</span></span><span id="cb3-1637"><a href="#cb3-1637" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">else</span></span><span id="cb3-1638"><a href="#cb3-1638" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#123;</span></span><span id="cb3-1639"><a href="#cb3-1639" aria-hidden="true" tabindex="-1"></a>                            cp <span class="op">=</span> cp <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1640"><a href="#cb3-1640" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>cp<span class="op">].</span>normal<span class="op">)</span></span><span id="cb3-1641"><a href="#cb3-1641" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#123;</span></span><span id="cb3-1642"><a href="#cb3-1642" aria-hidden="true" tabindex="-1"></a>                                <span class="co">/*value parameter*/</span></span><span id="cb3-1643"><a href="#cb3-1643" aria-hidden="true" tabindex="-1"></a>                                expression<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> colon<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1644"><a href="#cb3-1644" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> nametab<span class="op">[</span>cp<span class="op">].</span>typ<span class="op">)</span></span><span id="cb3-1645"><a href="#cb3-1645" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#123;</span></span><span id="cb3-1646"><a href="#cb3-1646" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>ref <span class="op">!=</span> nametab<span class="op">[</span>cp<span class="op">].</span>ref<span class="op">)</span></span><span id="cb3-1647"><a href="#cb3-1647" aria-hidden="true" tabindex="-1"></a>                                        error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb3-1648"><a href="#cb3-1648" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x<span class="op">.</span>typ <span class="op">==</span> arrays<span class="op">)</span></span><span id="cb3-1649"><a href="#cb3-1649" aria-hidden="true" tabindex="-1"></a>                                        gen<span class="op">(</span>lodb<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> atab<span class="op">[</span>x<span class="op">.</span>ref<span class="op">].</span>size<span class="op">);</span></span><span id="cb3-1650"><a href="#cb3-1650" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#125;</span></span><span id="cb3-1651"><a href="#cb3-1651" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span> error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb3-1652"><a href="#cb3-1652" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#125;</span></span><span id="cb3-1653"><a href="#cb3-1653" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">else</span>           <span class="co">/*variable parameter*/</span></span><span id="cb3-1654"><a href="#cb3-1654" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#123;</span></span><span id="cb3-1655"><a href="#cb3-1655" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> ident<span class="op">)</span></span><span id="cb3-1656"><a href="#cb3-1656" aria-hidden="true" tabindex="-1"></a>                                    error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1657"><a href="#cb3-1657" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span></span><span id="cb3-1658"><a href="#cb3-1658" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#123;</span></span><span id="cb3-1659"><a href="#cb3-1659" aria-hidden="true" tabindex="-1"></a>                                    k <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1660"><a href="#cb3-1660" aria-hidden="true" tabindex="-1"></a>                                    getsym<span class="op">();</span></span><span id="cb3-1661"><a href="#cb3-1661" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">if</span> <span class="op">(</span>k <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-1662"><a href="#cb3-1662" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">&#123;</span></span><span id="cb3-1663"><a href="#cb3-1663" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>k<span class="op">].</span>kind <span class="op">!=</span> variable<span class="op">)</span>  error <span class="op">(</span><span class="dv">30</span><span class="op">);</span></span><span id="cb3-1664"><a href="#cb3-1664" aria-hidden="true" tabindex="-1"></a>                                        x<span class="op">.</span>typ <span class="op">=</span> nametab<span class="op">[</span>k<span class="op">].</span>typ<span class="op">;</span></span><span id="cb3-1665"><a href="#cb3-1665" aria-hidden="true" tabindex="-1"></a>                                        x<span class="op">.</span>ref <span class="op">=</span> nametab<span class="op">[</span>k<span class="op">].</span>ref<span class="op">;</span></span><span id="cb3-1666"><a href="#cb3-1666" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>k<span class="op">].</span>normal<span class="op">)</span></span><span id="cb3-1667"><a href="#cb3-1667" aria-hidden="true" tabindex="-1"></a>                                            gen<span class="op">(</span>loda<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1668"><a href="#cb3-1668" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">else</span> gen<span class="op">(</span>lod<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>k<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1669"><a href="#cb3-1669" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> lbrack<span class="op">)</span></span><span id="cb3-1670"><a href="#cb3-1670" aria-hidden="true" tabindex="-1"></a>                                            arrayelement<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> x<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1671"><a href="#cb3-1671" aria-hidden="true" tabindex="-1"></a>                                        <span class="cf">if</span>    <span class="op">((</span>nametab<span class="op">[</span>cp<span class="op">].</span>typ <span class="op">!=</span> x<span class="op">.</span>typ<span class="op">)</span></span><span id="cb3-1672"><a href="#cb3-1672" aria-hidden="true" tabindex="-1"></a>                                                <span class="op">||</span> <span class="op">(</span>nametab<span class="op">[</span>cp<span class="op">].</span>ref <span class="op">!=</span> x<span class="op">.</span>ref<span class="op">))</span></span><span id="cb3-1673"><a href="#cb3-1673" aria-hidden="true" tabindex="-1"></a>                                            error<span class="op">(</span><span class="dv">31</span><span class="op">);</span></span><span id="cb3-1674"><a href="#cb3-1674" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">&#125;</span></span><span id="cb3-1675"><a href="#cb3-1675" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&#125;</span></span><span id="cb3-1676"><a href="#cb3-1676" aria-hidden="true" tabindex="-1"></a>                            <span class="op">&#125;</span>   <span class="co">/*variable parameter*/</span></span><span id="cb3-1677"><a href="#cb3-1677" aria-hidden="true" tabindex="-1"></a>                        <span class="op">&#125;</span></span><span id="cb3-1678"><a href="#cb3-1678" aria-hidden="true" tabindex="-1"></a>                        test<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>comma<span class="op">,</span> rparen<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1679"><a href="#cb3-1679" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-1680"><a href="#cb3-1680" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> comma<span class="op">));</span></span><span id="cb3-1681"><a href="#cb3-1681" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> rparen<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1682"><a href="#cb3-1682" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span> error<span class="op">(</span><span class="dv">25</span><span class="op">);</span></span><span id="cb3-1683"><a href="#cb3-1683" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-1684"><a href="#cb3-1684" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>cp <span class="op">&lt;</span> lastp<span class="op">)</span>  error<span class="op">(</span><span class="dv">39</span><span class="op">);</span>  <span class="co">/*too few actual parameters*/</span></span><span id="cb3-1685"><a href="#cb3-1685" aria-hidden="true" tabindex="-1"></a>                gen<span class="op">(</span>cal<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1686"><a href="#cb3-1686" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>nametab<span class="op">[</span>i<span class="op">].</span>lev <span class="op">&lt;</span> level<span class="op">)</span>  gen<span class="op">(</span>udis<span class="op">,</span> nametab<span class="op">[</span>i<span class="op">].</span>lev<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1687"><a href="#cb3-1687" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1688"><a href="#cb3-1688" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1689"><a href="#cb3-1689" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">51</span><span class="op">);</span></span><span id="cb3-1690"><a href="#cb3-1690" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1691"><a href="#cb3-1691" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1692"><a href="#cb3-1692" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1693"><a href="#cb3-1693" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span> <span class="co">/*call*/</span></span><span id="cb3-1694"><a href="#cb3-1694" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1695"><a href="#cb3-1695" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> fsplit<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> sfilename<span class="op">[],</span> <span class="dt">char</span><span class="op">*</span> dir<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> name<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> ext<span class="op">)</span></span><span id="cb3-1696"><a href="#cb3-1696" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1697"><a href="#cb3-1697" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Todo LosPhoenix</span></span><span id="cb3-1698"><a href="#cb3-1698" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span><span id="cb3-1699"><a href="#cb3-1699" aria-hidden="true" tabindex="-1"></a><span class="co">    char path_buffer = sfilename.get_body();</span></span><span id="cb3-1700"><a href="#cb3-1700" aria-hidden="true" tabindex="-1"></a><span class="co">    char drive[_MAX_DRIVE];</span></span><span id="cb3-1701"><a href="#cb3-1701" aria-hidden="true" tabindex="-1"></a><span class="co">    char dir[_MAX_DIR];</span></span><span id="cb3-1702"><a href="#cb3-1702" aria-hidden="true" tabindex="-1"></a><span class="co">    char fname[_MAX_FNAME];</span></span><span id="cb3-1703"><a href="#cb3-1703" aria-hidden="true" tabindex="-1"></a><span class="co">    char ext[_MAX_EXT];</span></span><span id="cb3-1704"><a href="#cb3-1704" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span><span id="cb3-1705"><a href="#cb3-1705" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> drive<span class="op">[</span>_MAX_DRIVE<span class="op">];</span></span><span id="cb3-1706"><a href="#cb3-1706" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> dir_temp<span class="op">[</span>_MAX_DIR<span class="op">];</span></span><span id="cb3-1707"><a href="#cb3-1707" aria-hidden="true" tabindex="-1"></a>    _splitpath<span class="op">(</span>sfilename<span class="op">,</span> drive<span class="op">,</span> dir_temp<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-1708"><a href="#cb3-1708" aria-hidden="true" tabindex="-1"></a>    _makepath<span class="op">(</span> dir<span class="op">,</span> drive<span class="op">,</span> dir_temp<span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">,</span> <span class="st">&quot;&quot;</span><span class="op">);</span></span><span id="cb3-1709"><a href="#cb3-1709" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1710"><a href="#cb3-1710" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1711"><a href="#cb3-1711" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> casestatement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span><span class="op">&amp;</span> level<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx1<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>cx2<span class="op">)</span></span><span id="cb3-1712"><a href="#cb3-1712" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1713"><a href="#cb3-1713" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> backpatch<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span><span id="cb3-1714"><a href="#cb3-1714" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> jmpindex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-1715"><a href="#cb3-1715" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1716"><a href="#cb3-1716" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1717"><a href="#cb3-1717" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> position<span class="op">(</span>id<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1718"><a href="#cb3-1718" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>loda<span class="op">,</span>level<span class="op">,</span>nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1719"><a href="#cb3-1719" aria-hidden="true" tabindex="-1"></a>    simpleexpression<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ofsym<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>x<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1720"><a href="#cb3-1720" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>sto<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1721"><a href="#cb3-1721" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>ofsym<span class="op">)</span></span><span id="cb3-1722"><a href="#cb3-1722" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1723"><a href="#cb3-1723" aria-hidden="true" tabindex="-1"></a>        error<span class="op">(</span><span class="dv">17</span><span class="op">);</span></span><span id="cb3-1724"><a href="#cb3-1724" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1725"><a href="#cb3-1725" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1726"><a href="#cb3-1726" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb3-1727"><a href="#cb3-1727" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1728"><a href="#cb3-1728" aria-hidden="true" tabindex="-1"></a>        cx1 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1729"><a href="#cb3-1729" aria-hidden="true" tabindex="-1"></a>        constrec c<span class="op">;</span></span><span id="cb3-1730"><a href="#cb3-1730" aria-hidden="true" tabindex="-1"></a>        constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span>comma<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>c<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1731"><a href="#cb3-1731" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>lod<span class="op">,</span>level<span class="op">,</span>nametab<span class="op">[</span>i<span class="op">].</span>adr<span class="op">);</span></span><span id="cb3-1732"><a href="#cb3-1732" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span>c<span class="op">.</span>i<span class="op">);</span></span><span id="cb3-1733"><a href="#cb3-1733" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>eq<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1734"><a href="#cb3-1734" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1735"><a href="#cb3-1735" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1736"><a href="#cb3-1736" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>sym<span class="op">==</span>comma<span class="op">)</span></span><span id="cb3-1737"><a href="#cb3-1737" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1738"><a href="#cb3-1738" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1739"><a href="#cb3-1739" aria-hidden="true" tabindex="-1"></a>            constant<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>colon<span class="op">,</span>comma<span class="op">,</span>eos<span class="op">)+</span>fsys<span class="op">,</span>c<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1740"><a href="#cb3-1740" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>lit<span class="op">,</span><span class="dv">0</span><span class="op">,</span>c<span class="op">.</span>i<span class="op">);</span></span><span id="cb3-1741"><a href="#cb3-1741" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>eq<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1742"><a href="#cb3-1742" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>jpc<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1743"><a href="#cb3-1743" aria-hidden="true" tabindex="-1"></a>            gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1744"><a href="#cb3-1744" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1745"><a href="#cb3-1745" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>colon<span class="op">)</span></span><span id="cb3-1746"><a href="#cb3-1746" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1747"><a href="#cb3-1747" aria-hidden="true" tabindex="-1"></a>            error<span class="op">(</span><span class="dv">24</span><span class="op">);</span></span><span id="cb3-1748"><a href="#cb3-1748" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1749"><a href="#cb3-1749" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1750"><a href="#cb3-1750" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1751"><a href="#cb3-1751" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb3-1752"><a href="#cb3-1752" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1753"><a href="#cb3-1753" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1754"><a href="#cb3-1754" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jmp<span class="op">)</span></span><span id="cb3-1755"><a href="#cb3-1755" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1756"><a href="#cb3-1756" aria-hidden="true" tabindex="-1"></a>                code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1757"><a href="#cb3-1757" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1758"><a href="#cb3-1758" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1759"><a href="#cb3-1759" aria-hidden="true" tabindex="-1"></a>        statement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">);</span></span><span id="cb3-1760"><a href="#cb3-1760" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1761"><a href="#cb3-1761" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>semicolon<span class="op">)</span></span><span id="cb3-1762"><a href="#cb3-1762" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1763"><a href="#cb3-1763" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>sym<span class="op">!=</span>endsym<span class="op">)</span></span><span id="cb3-1764"><a href="#cb3-1764" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1765"><a href="#cb3-1765" aria-hidden="true" tabindex="-1"></a>                error<span class="op">(</span><span class="dv">36</span><span class="op">);</span></span><span id="cb3-1766"><a href="#cb3-1766" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1767"><a href="#cb3-1767" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span><span id="cb3-1768"><a href="#cb3-1768" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1769"><a href="#cb3-1769" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb3-1770"><a href="#cb3-1770" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1771"><a href="#cb3-1771" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1772"><a href="#cb3-1772" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jpc<span class="op">)</span></span><span id="cb3-1773"><a href="#cb3-1773" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1774"><a href="#cb3-1774" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1775"><a href="#cb3-1775" aria-hidden="true" tabindex="-1"></a>                code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span><span id="cb3-1776"><a href="#cb3-1776" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1777"><a href="#cb3-1777" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1778"><a href="#cb3-1778" aria-hidden="true" tabindex="-1"></a>        gen<span class="op">(</span>jmp<span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-1779"><a href="#cb3-1779" aria-hidden="true" tabindex="-1"></a>        backpatch<span class="op">[</span>jmpindex<span class="op">++]</span> <span class="op">=</span> cx<span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb3-1780"><a href="#cb3-1780" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1781"><a href="#cb3-1781" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1782"><a href="#cb3-1782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-1783"><a href="#cb3-1783" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> tmp <span class="op">=</span> cx1<span class="op">;</span>tmp<span class="op">&lt;</span>cx<span class="op">;</span>tmp<span class="op">++)</span></span><span id="cb3-1784"><a href="#cb3-1784" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1785"><a href="#cb3-1785" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1786"><a href="#cb3-1786" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>code<span class="op">[</span>tmp<span class="op">].</span>f<span class="op">==</span>jpc<span class="op">)</span></span><span id="cb3-1787"><a href="#cb3-1787" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1788"><a href="#cb3-1788" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1789"><a href="#cb3-1789" aria-hidden="true" tabindex="-1"></a>                code<span class="op">[</span>tmp<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1790"><a href="#cb3-1790" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1791"><a href="#cb3-1791" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1792"><a href="#cb3-1792" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>jmpindex<span class="op">;</span>i<span class="op">++)</span></span><span id="cb3-1793"><a href="#cb3-1793" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1794"><a href="#cb3-1794" aria-hidden="true" tabindex="-1"></a>        code<span class="op">[</span>backpatch<span class="op">[</span>i<span class="op">]].</span>a <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1795"><a href="#cb3-1795" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1796"><a href="#cb3-1796" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1797"><a href="#cb3-1797" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1798"><a href="#cb3-1798" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1799"><a href="#cb3-1799" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> statement<span class="op">(</span>symset fsys<span class="op">,</span> <span class="dt">int</span> <span class="op">&amp;</span>level<span class="op">)</span></span><span id="cb3-1800"><a href="#cb3-1800" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1801"><a href="#cb3-1801" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> cx1<span class="op">,</span> cx2<span class="op">,</span> cx3<span class="op">;</span></span><span id="cb3-1802"><a href="#cb3-1802" aria-hidden="true" tabindex="-1"></a>    item x<span class="op">;</span></span><span id="cb3-1803"><a href="#cb3-1803" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> arrayelement<span class="op">(</span>symset fsys<span class="op">,</span> item <span class="op">&amp;</span> x<span class="op">);</span></span><span id="cb3-1804"><a href="#cb3-1804" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* statement */</span></span><span id="cb3-1805"><a href="#cb3-1805" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>statbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> fsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1806"><a href="#cb3-1806" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span>   assignment<span class="op">(</span>i<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1807"><a href="#cb3-1807" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> callsym<span class="op">)</span></span><span id="cb3-1808"><a href="#cb3-1808" aria-hidden="true" tabindex="-1"></a>        call<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1809"><a href="#cb3-1809" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ifsym<span class="op">)</span></span><span id="cb3-1810"><a href="#cb3-1810" aria-hidden="true" tabindex="-1"></a>        ifstatement<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">,</span> cx1<span class="op">,</span> cx2<span class="op">);</span></span><span id="cb3-1811"><a href="#cb3-1811" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> beginsym<span class="op">)</span></span><span id="cb3-1812"><a href="#cb3-1812" aria-hidden="true" tabindex="-1"></a>        compound<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1813"><a href="#cb3-1813" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> whilesym<span class="op">)</span></span><span id="cb3-1814"><a href="#cb3-1814" aria-hidden="true" tabindex="-1"></a>        whilestatement<span class="op">(</span>cx1<span class="op">,</span> level<span class="op">,</span> fsys<span class="op">,</span> cx2<span class="op">);</span></span><span id="cb3-1815"><a href="#cb3-1815" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> repeatsym<span class="op">)</span></span><span id="cb3-1816"><a href="#cb3-1816" aria-hidden="true" tabindex="-1"></a>        repeatstatement<span class="op">(</span>cx1<span class="op">,</span>level<span class="op">,</span>fsys<span class="op">);</span></span><span id="cb3-1817"><a href="#cb3-1817" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> forsym<span class="op">)</span></span><span id="cb3-1818"><a href="#cb3-1818" aria-hidden="true" tabindex="-1"></a>        forstatement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">,</span>cx1<span class="op">,</span>cx2<span class="op">);</span></span><span id="cb3-1819"><a href="#cb3-1819" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> casesym<span class="op">)</span></span><span id="cb3-1820"><a href="#cb3-1820" aria-hidden="true" tabindex="-1"></a>        casestatement<span class="op">(</span>fsys<span class="op">,</span>level<span class="op">,</span>cx1<span class="op">,</span>cx2<span class="op">);</span></span><span id="cb3-1821"><a href="#cb3-1821" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>elsesym<span class="op">,</span>eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1822"><a href="#cb3-1822" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1823"><a href="#cb3-1823" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* statement */</span></span><span id="cb3-1824"><a href="#cb3-1824" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1825"><a href="#cb3-1825" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> block<span class="op">(</span> symset fsys<span class="op">,</span> <span class="dt">int</span> level<span class="op">)</span></span><span id="cb3-1826"><a href="#cb3-1826" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1827"><a href="#cb3-1827" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dx<span class="op">;</span>  <span class="co">/* data allocation index */</span></span><span id="cb3-1828"><a href="#cb3-1828" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tx0<span class="op">;</span> <span class="co">/* initial table index */</span></span><span id="cb3-1829"><a href="#cb3-1829" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cx0<span class="op">;</span> <span class="co">/* initial code  index */</span></span><span id="cb3-1830"><a href="#cb3-1830" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> prt<span class="op">,</span> prb<span class="op">;</span></span><span id="cb3-1831"><a href="#cb3-1831" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* block */</span></span><span id="cb3-1832"><a href="#cb3-1832" aria-hidden="true" tabindex="-1"></a>    prt <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1833"><a href="#cb3-1833" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span><span id="cb3-1834"><a href="#cb3-1834" aria-hidden="true" tabindex="-1"></a>    tx0 <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1835"><a href="#cb3-1835" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>tx<span class="op">].</span>adr <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1836"><a href="#cb3-1836" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> levmax<span class="op">)</span>  error<span class="op">(</span><span class="dv">4</span><span class="op">);</span></span><span id="cb3-1837"><a href="#cb3-1837" aria-hidden="true" tabindex="-1"></a>    enterblock<span class="op">();</span></span><span id="cb3-1838"><a href="#cb3-1838" aria-hidden="true" tabindex="-1"></a>    prb <span class="op">=</span> bx<span class="op">;</span></span><span id="cb3-1839"><a href="#cb3-1839" aria-hidden="true" tabindex="-1"></a>    display<span class="op">[</span>level<span class="op">]</span> <span class="op">=</span> bx<span class="op">;</span></span><span id="cb3-1840"><a href="#cb3-1840" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>prt<span class="op">].</span>typ <span class="op">=</span> notyp<span class="op">;</span></span><span id="cb3-1841"><a href="#cb3-1841" aria-hidden="true" tabindex="-1"></a>    nametab<span class="op">[</span>prt<span class="op">].</span>ref <span class="op">=</span> prb<span class="op">;</span></span><span id="cb3-1842"><a href="#cb3-1842" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1843"><a href="#cb3-1843" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">((</span>sym <span class="op">==</span> lparen<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">))</span></span><span id="cb3-1844"><a href="#cb3-1844" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1845"><a href="#cb3-1845" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1846"><a href="#cb3-1846" aria-hidden="true" tabindex="-1"></a>        paramenterlist<span class="op">(</span>fsys<span class="op">,</span> level<span class="op">,</span> dx<span class="op">);</span></span><span id="cb3-1847"><a href="#cb3-1847" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1848"><a href="#cb3-1848" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1849"><a href="#cb3-1849" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1850"><a href="#cb3-1850" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>  <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb3-1851"><a href="#cb3-1851" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1852"><a href="#cb3-1852" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1853"><a href="#cb3-1853" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span>prb<span class="op">].</span>lastpar <span class="op">=</span> tx<span class="op">;</span></span><span id="cb3-1854"><a href="#cb3-1854" aria-hidden="true" tabindex="-1"></a>    btab<span class="op">[</span>prb<span class="op">].</span>psize <span class="op">=</span> dx<span class="op">;</span></span><span id="cb3-1855"><a href="#cb3-1855" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1856"><a href="#cb3-1856" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>jmp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/* jump from declaration part to statement part */</span></span><span id="cb3-1857"><a href="#cb3-1857" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span><span id="cb3-1858"><a href="#cb3-1858" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1859"><a href="#cb3-1859" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> constsym<span class="op">)</span></span><span id="cb3-1860"><a href="#cb3-1860" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1861"><a href="#cb3-1861" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1862"><a href="#cb3-1862" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-1863"><a href="#cb3-1863" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1864"><a href="#cb3-1864" aria-hidden="true" tabindex="-1"></a>                constdeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1865"><a href="#cb3-1865" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1866"><a href="#cb3-1866" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb3-1867"><a href="#cb3-1867" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1868"><a href="#cb3-1868" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> typesym<span class="op">)</span></span><span id="cb3-1869"><a href="#cb3-1869" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1870"><a href="#cb3-1870" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1871"><a href="#cb3-1871" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-1872"><a href="#cb3-1872" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1873"><a href="#cb3-1873" aria-hidden="true" tabindex="-1"></a>                typedeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1874"><a href="#cb3-1874" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1875"><a href="#cb3-1875" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb3-1876"><a href="#cb3-1876" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1877"><a href="#cb3-1877" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> varsym<span class="op">)</span></span><span id="cb3-1878"><a href="#cb3-1878" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1879"><a href="#cb3-1879" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1880"><a href="#cb3-1880" aria-hidden="true" tabindex="-1"></a>            <span class="cf">do</span></span><span id="cb3-1881"><a href="#cb3-1881" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#123;</span></span><span id="cb3-1882"><a href="#cb3-1882" aria-hidden="true" tabindex="-1"></a>                vardeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">,</span> dx<span class="op">);</span></span><span id="cb3-1883"><a href="#cb3-1883" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-1884"><a href="#cb3-1884" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!(</span>sym <span class="op">!=</span> ident<span class="op">));</span></span><span id="cb3-1885"><a href="#cb3-1885" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1886"><a href="#cb3-1886" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span>sym <span class="op">==</span> procsym<span class="op">)</span>    procdeclaration<span class="op">(</span>level<span class="op">,</span> fsys<span class="op">);</span></span><span id="cb3-1887"><a href="#cb3-1887" aria-hidden="true" tabindex="-1"></a>        test<span class="op">(</span>statbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>ident<span class="op">,</span> eos<span class="op">),</span> declbegsys<span class="op">,</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1888"><a href="#cb3-1888" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1889"><a href="#cb3-1889" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!(!</span> <span class="op">(</span>declbegsys<span class="op">.</span>has<span class="op">(</span>sym<span class="op">))));</span></span><span id="cb3-1890"><a href="#cb3-1890" aria-hidden="true" tabindex="-1"></a>    code<span class="op">[</span>nametab<span class="op">[</span>tx0<span class="op">].</span>adr<span class="op">].</span>a <span class="op">=</span> cx<span class="op">;</span> <span class="co">/*back enter statement code&#39;s start adr. */</span></span><span id="cb3-1891"><a href="#cb3-1891" aria-hidden="true" tabindex="-1"></a>    labtab<span class="op">[</span>lx<span class="op">]</span> <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1892"><a href="#cb3-1892" aria-hidden="true" tabindex="-1"></a>    lx <span class="op">=</span> lx <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-1893"><a href="#cb3-1893" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1894"><a href="#cb3-1894" aria-hidden="true" tabindex="-1"></a>        <span class="co">//A1 &amp;with = nametab[tx0];</span></span><span id="cb3-1895"><a href="#cb3-1895" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1896"><a href="#cb3-1896" aria-hidden="true" tabindex="-1"></a>        nametab<span class="op">[</span>tx0<span class="op">].</span>adr <span class="op">=</span> cx<span class="op">;</span> <span class="co">/*code&#39;s start address */</span></span><span id="cb3-1897"><a href="#cb3-1897" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1898"><a href="#cb3-1898" aria-hidden="true" tabindex="-1"></a>    cx0 <span class="op">=</span> cx<span class="op">;</span></span><span id="cb3-1899"><a href="#cb3-1899" aria-hidden="true" tabindex="-1"></a>    gen<span class="op">(</span>entp<span class="op">,</span> level<span class="op">,</span> dx<span class="op">);</span> <span class="co">/* block entry */</span></span><span id="cb3-1900"><a href="#cb3-1900" aria-hidden="true" tabindex="-1"></a>    statement<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>semicolon<span class="op">,</span> endsym<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> fsys<span class="op">,</span> level<span class="op">);</span></span><span id="cb3-1901"><a href="#cb3-1901" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>level <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span>  gen<span class="op">(</span>retp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/*return*/</span></span><span id="cb3-1902"><a href="#cb3-1902" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> gen<span class="op">(</span>endp<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span> <span class="co">/* end prograam */</span></span><span id="cb3-1903"><a href="#cb3-1903" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>fsys<span class="op">,</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1904"><a href="#cb3-1904" aria-hidden="true" tabindex="-1"></a>    listcode<span class="op">(</span>cx0<span class="op">);</span></span><span id="cb3-1905"><a href="#cb3-1905" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="co">/* block */</span></span><span id="cb3-1906"><a href="#cb3-1906" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1907"><a href="#cb3-1907" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1908"><a href="#cb3-1908" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************************************************/</span></span><span id="cb3-1909"><a href="#cb3-1909" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span><span id="cb3-1910"><a href="#cb3-1910" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1911"><a href="#cb3-1911" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* main */</span></span><span id="cb3-1912"><a href="#cb3-1912" aria-hidden="true" tabindex="-1"></a>    pio_initialize<span class="op">(</span>argc<span class="op">,</span> argv<span class="op">);</span></span><span id="cb3-1913"><a href="#cb3-1913" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> <span class="st">&quot;Please input source program file name:&quot;</span> <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-1914"><a href="#cb3-1914" aria-hidden="true" tabindex="-1"></a>    input <span class="op">&gt;&gt;</span> sfile_buff <span class="op">&gt;&gt;</span> NL<span class="op">;</span></span><span id="cb3-1915"><a href="#cb3-1915" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>sfilename<span class="op">,</span> sfile_buff<span class="op">.</span>get_body<span class="op">());</span></span><span id="cb3-1916"><a href="#cb3-1916" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1917"><a href="#cb3-1917" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> sfilename <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-1918"><a href="#cb3-1918" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1919"><a href="#cb3-1919" aria-hidden="true" tabindex="-1"></a>    assign<span class="op">(</span>sfile<span class="op">,</span> sfilename<span class="op">);</span></span><span id="cb3-1920"><a href="#cb3-1920" aria-hidden="true" tabindex="-1"></a>    reset<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-1921"><a href="#cb3-1921" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1922"><a href="#cb3-1922" aria-hidden="true" tabindex="-1"></a>    fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-1923"><a href="#cb3-1923" aria-hidden="true" tabindex="-1"></a>    listfile_buff <span class="op">=</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name<span class="op">,</span> <span class="st">&quot;c.lst&quot;</span><span class="op">));</span></span><span id="cb3-1924"><a href="#cb3-1924" aria-hidden="true" tabindex="-1"></a>    assign<span class="op">(</span>listfile<span class="op">,</span> listfile_buff<span class="op">);</span></span><span id="cb3-1925"><a href="#cb3-1925" aria-hidden="true" tabindex="-1"></a>    rewrite<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-1926"><a href="#cb3-1926" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1927"><a href="#cb3-1927" aria-hidden="true" tabindex="-1"></a>    fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-1928"><a href="#cb3-1928" aria-hidden="true" tabindex="-1"></a>        assign<span class="op">(</span>fcode<span class="op">,</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name <span class="op">,</span> <span class="st">&quot;c.pld&quot;</span><span class="op">)));</span></span><span id="cb3-1929"><a href="#cb3-1929" aria-hidden="true" tabindex="-1"></a>        rewrite<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb3-1930"><a href="#cb3-1930" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1931"><a href="#cb3-1931" aria-hidden="true" tabindex="-1"></a>    fsplit<span class="op">(</span>sfilename<span class="op">,</span> dir<span class="op">,</span> name<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-1932"><a href="#cb3-1932" aria-hidden="true" tabindex="-1"></a>        assign<span class="op">(</span>labfile<span class="op">,</span> strcat<span class="op">(</span>dir<span class="op">,</span> strcat<span class="op">(</span>name <span class="op">,</span><span class="st">&quot;c.lab&quot;</span><span class="op">)));</span></span><span id="cb3-1933"><a href="#cb3-1933" aria-hidden="true" tabindex="-1"></a>        rewrite<span class="op">(</span>labfile<span class="op">);</span></span><span id="cb3-1934"><a href="#cb3-1934" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1935"><a href="#cb3-1935" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1936"><a href="#cb3-1936" aria-hidden="true" tabindex="-1"></a>    initial<span class="op">();</span></span><span id="cb3-1937"><a href="#cb3-1937" aria-hidden="true" tabindex="-1"></a>    enterpreid<span class="op">();</span></span><span id="cb3-1938"><a href="#cb3-1938" aria-hidden="true" tabindex="-1"></a>    getsym<span class="op">();</span></span><span id="cb3-1939"><a href="#cb3-1939" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> programsym<span class="op">)</span></span><span id="cb3-1940"><a href="#cb3-1940" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1941"><a href="#cb3-1941" aria-hidden="true" tabindex="-1"></a>        getsym<span class="op">();</span></span><span id="cb3-1942"><a href="#cb3-1942" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> ident<span class="op">)</span></span><span id="cb3-1943"><a href="#cb3-1943" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb3-1944"><a href="#cb3-1944" aria-hidden="true" tabindex="-1"></a>            getsym<span class="op">();</span></span><span id="cb3-1945"><a href="#cb3-1945" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sym <span class="op">==</span> semicolon<span class="op">)</span>  getsym<span class="op">();</span></span><span id="cb3-1946"><a href="#cb3-1946" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> error<span class="op">(</span><span class="dv">23</span><span class="op">);</span></span><span id="cb3-1947"><a href="#cb3-1947" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-1948"><a href="#cb3-1948" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> error<span class="op">(</span><span class="dv">22</span><span class="op">);</span></span><span id="cb3-1949"><a href="#cb3-1949" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1950"><a href="#cb3-1950" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> error<span class="op">(</span><span class="dv">15</span><span class="op">);</span></span><span id="cb3-1951"><a href="#cb3-1951" aria-hidden="true" tabindex="-1"></a>    test<span class="op">(</span>declbegsys <span class="op">+</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>beginsym<span class="op">,</span> eos<span class="op">),</span> set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>eos<span class="op">),</span> <span class="dv">13</span><span class="op">);</span></span><span id="cb3-1952"><a href="#cb3-1952" aria-hidden="true" tabindex="-1"></a>    block<span class="op">(</span>set_of_enum<span class="op">(</span>symbol<span class="op">)::</span>of<span class="op">(</span>period<span class="op">,</span> eos<span class="op">)</span> <span class="op">+</span> declbegsys <span class="op">+</span> statbegsys<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-1953"><a href="#cb3-1953" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>sym <span class="op">!=</span> period<span class="op">)</span>  error<span class="op">(</span><span class="dv">38</span><span class="op">);</span></span><span id="cb3-1954"><a href="#cb3-1954" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-1955"><a href="#cb3-1955" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1956"><a href="#cb3-1956" aria-hidden="true" tabindex="-1"></a>        output <span class="op">&lt;&lt;</span> <span class="st">&quot;SUCCESS&quot;</span><span class="op">;</span></span><span id="cb3-1957"><a href="#cb3-1957" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-1958"><a href="#cb3-1958" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> cx<span class="op">;</span> i <span class="op">++)</span></span><span id="cb3-1959"><a href="#cb3-1959" aria-hidden="true" tabindex="-1"></a>            fcode <span class="op">&lt;&lt;</span> code<span class="op">[</span>i<span class="op">];</span></span><span id="cb3-1960"><a href="#cb3-1960" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fcode<span class="op">);</span></span><span id="cb3-1961"><a href="#cb3-1961" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-1962"><a href="#cb3-1962" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> lx<span class="op">;</span> i <span class="op">++)</span></span><span id="cb3-1963"><a href="#cb3-1963" aria-hidden="true" tabindex="-1"></a>            labfile <span class="op">&lt;&lt;</span> labtab<span class="op">[</span>i<span class="op">];</span></span><span id="cb3-1964"><a href="#cb3-1964" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>labfile<span class="op">);</span></span><span id="cb3-1965"><a href="#cb3-1965" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1966"><a href="#cb3-1966" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> output <span class="op">&lt;&lt;</span> err <span class="op">&lt;&lt;</span> <span class="st">&quot;ERRORS IN PROGRAM&quot;</span><span class="op">;</span></span><span id="cb3-1967"><a href="#cb3-1967" aria-hidden="true" tabindex="-1"></a>    output <span class="op">&lt;&lt;</span> NL<span class="op">;</span></span><span id="cb3-1968"><a href="#cb3-1968" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>sfile<span class="op">);</span></span><span id="cb3-1969"><a href="#cb3-1969" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>listfile<span class="op">);</span></span><span id="cb3-1970"><a href="#cb3-1970" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> EXIT_SUCCESS<span class="op">;</span></span><span id="cb3-1971"><a href="#cb3-1971" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>     <span class="co">/* of whole program  */</span></span><span id="cb3-1972"><a href="#cb3-1972" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1973"><a href="#cb3-1973" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifndef WIN32</span></span><span id="cb3-1974"><a href="#cb3-1974" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> _makepath<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb3-1975"><a href="#cb3-1975" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1976"><a href="#cb3-1976" aria-hidden="true" tabindex="-1"></a>    strcpy<span class="op">(</span>path<span class="op">,</span>dir<span class="op">);</span></span><span id="cb3-1977"><a href="#cb3-1977" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1978"><a href="#cb3-1978" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1979"><a href="#cb3-1979" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> _splitpath<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>drive<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>dir<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb3-1980"><a href="#cb3-1980" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1981"><a href="#cb3-1981" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p_whole_name<span class="op">;</span></span><span id="cb3-1982"><a href="#cb3-1982" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1983"><a href="#cb3-1983" aria-hidden="true" tabindex="-1"></a>    drive<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1984"><a href="#cb3-1984" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">==</span> path<span class="op">)</span></span><span id="cb3-1985"><a href="#cb3-1985" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1986"><a href="#cb3-1986" aria-hidden="true" tabindex="-1"></a>        dir<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1987"><a href="#cb3-1987" aria-hidden="true" tabindex="-1"></a>        fname<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1988"><a href="#cb3-1988" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1989"><a href="#cb3-1989" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-1990"><a href="#cb3-1990" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1991"><a href="#cb3-1991" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-1992"><a href="#cb3-1992" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="ch">&#39;/&#39;</span> <span class="op">==</span> path<span class="op">[</span>strlen<span class="op">(</span>path<span class="op">)])</span></span><span id="cb3-1993"><a href="#cb3-1993" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-1994"><a href="#cb3-1994" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>dir<span class="op">,</span> path<span class="op">);</span></span><span id="cb3-1995"><a href="#cb3-1995" aria-hidden="true" tabindex="-1"></a>        fname<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1996"><a href="#cb3-1996" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-1997"><a href="#cb3-1997" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span><span id="cb3-1998"><a href="#cb3-1998" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-1999"><a href="#cb3-1999" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-2000"><a href="#cb3-2000" aria-hidden="true" tabindex="-1"></a>    p_whole_name <span class="op">=</span> rindex<span class="op">(</span>path<span class="op">,</span> <span class="ch">&#39;/&#39;</span><span class="op">);</span></span><span id="cb3-2001"><a href="#cb3-2001" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">!=</span> p_whole_name<span class="op">)</span></span><span id="cb3-2002"><a href="#cb3-2002" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-2003"><a href="#cb3-2003" aria-hidden="true" tabindex="-1"></a>        p_whole_name<span class="op">++;</span></span><span id="cb3-2004"><a href="#cb3-2004" aria-hidden="true" tabindex="-1"></a>        _split_whole_name<span class="op">(</span>p_whole_name<span class="op">,</span> fname<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-2005"><a href="#cb3-2005" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-2006"><a href="#cb3-2006" aria-hidden="true" tabindex="-1"></a>        snprintf<span class="op">(</span>dir<span class="op">,</span> p_whole_name <span class="op">-</span> path<span class="op">,</span> <span class="st">&quot;%s&quot;</span><span class="op">,</span> path<span class="op">);</span></span><span id="cb3-2007"><a href="#cb3-2007" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2008"><a href="#cb3-2008" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-2009"><a href="#cb3-2009" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-2010"><a href="#cb3-2010" aria-hidden="true" tabindex="-1"></a>        _split_whole_name<span class="op">(</span>path<span class="op">,</span> fname<span class="op">,</span> ext<span class="op">);</span></span><span id="cb3-2011"><a href="#cb3-2011" aria-hidden="true" tabindex="-1"></a>        dir<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-2012"><a href="#cb3-2012" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2013"><a href="#cb3-2013" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2014"><a href="#cb3-2014" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-2015"><a href="#cb3-2015" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">void</span> _split_whole_name<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>whole_name<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>fname<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>ext<span class="op">)</span></span><span id="cb3-2016"><a href="#cb3-2016" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-2017"><a href="#cb3-2017" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>p_ext<span class="op">;</span></span><span id="cb3-2018"><a href="#cb3-2018" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-2019"><a href="#cb3-2019" aria-hidden="true" tabindex="-1"></a>    p_ext <span class="op">=</span> rindex<span class="op">(</span>whole_name<span class="op">,</span> <span class="ch">&#39;.&#39;</span><span class="op">);</span></span><span id="cb3-2020"><a href="#cb3-2020" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>NULL <span class="op">!=</span> p_ext<span class="op">)</span></span><span id="cb3-2021"><a href="#cb3-2021" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-2022"><a href="#cb3-2022" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>ext<span class="op">,</span> p_ext<span class="op">);</span></span><span id="cb3-2023"><a href="#cb3-2023" aria-hidden="true" tabindex="-1"></a>        snprintf<span class="op">(</span>fname<span class="op">,</span> p_ext <span class="op">-</span> whole_name <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;%s&quot;</span><span class="op">,</span> whole_name<span class="op">);</span></span><span id="cb3-2024"><a href="#cb3-2024" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2025"><a href="#cb3-2025" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-2026"><a href="#cb3-2026" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb3-2027"><a href="#cb3-2027" aria-hidden="true" tabindex="-1"></a>        ext<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">&#39;\0&#39;</span><span class="op">;</span></span><span id="cb3-2028"><a href="#cb3-2028" aria-hidden="true" tabindex="-1"></a>        strcpy<span class="op">(</span>fname<span class="op">,</span> whole_name<span class="op">);</span></span><span id="cb3-2029"><a href="#cb3-2029" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2030"><a href="#cb3-2030" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-2031"><a href="#cb3-2031" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-2032"><a href="#cb3-2032" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> 编译器前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 编译原理 </tag>
            
            <tag> 模拟实训 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>空间坐标转换方法</title>
      <link href="/2021/12/05/Algorithm/Space%20coordinate%20transformation/"/>
      <url>/2021/12/05/Algorithm/Space%20coordinate%20transformation/</url>
      
        <content type="html"><![CDATA[<h2 id="一变换操作">一，变换操作</h2><ol type="1"><li><p>平移变换</p><p>变换矩阵</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  1 &amp; 0 &amp; t_{x} \\  0 &amp; 1 &amp; t_{y} \\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p><p>变换关系</p><blockquote><p><span class="math inline">\(t_{x}\)</span>, <span class="math inline">\(t_{y}\)</span>分别对应x轴，y轴的偏移量</p></blockquote></li><li><p>比例变换</p><p>变换矩阵</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  s_{x} &amp; 0 &amp; 0\\  0 &amp; s_{y} &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p><p>变换关系</p><blockquote><p>（1）当<span class="math inline">\(S_{x} = S_{y} = 1\)</span> 时，为恒等比例变换，就是图形不变</p><p>（2）当<span class="math inline">\(S_{x} = S_{y} &gt; 1\)</span> 时，图形沿两个坐标轴方向等比例放大。</p><p>（3）当<span class="math inline">\(S_{x} = S_{y} &lt;1\)</span> 时，图形沿两个坐标轴方向等比例缩小。</p><p>（4）当<span class="math inline">\(S_{x} \neq S_{y}\)</span> 时，图形沿两个坐标轴方向做非均匀的比例变换。</p></blockquote></li><li><p>对称变换</p><p>变换矩阵</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  a &amp; b &amp; 0\\  d &amp; e &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p><p>变换关系：</p><blockquote><p>（1）当<span class="math inline">\(b=d=0,a=-1,e=1\)</span>时，产生与y轴对称的反射图形</p><p>（2）当<span class="math inline">\(b=d=0,a=1,e=-1\)</span>时，产生与x轴对称的反射图形</p><p>（3）当<span class="math inline">\(b=d=0,a=e=-1\)</span>时，产生与原点对称的反射图形</p><p>（4）当<span class="math inline">\(b=d=1,a=e=0\)</span>时，产生与直线y=x对称的反射图形</p><p>（5）当<span class="math inline">\(b=d=-1,a=e=0\)</span>时，产生与直线y=-x对称的反射图形</p></blockquote></li><li><p>旋转变换</p><p>变换矩阵</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  \text{cos}(\theta) &amp; -\text{sin}(\theta) &amp; 0\\  \text{sin}(\theta) &amp; \text{cos}(\theta) &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p><p>变换关系</p><p><span class="math inline">\(\begin{cases}  x´=x \text{cos}\theta-y \text{sin}\theta \\  y´=x \text{sin}\theta+y \text{cos}\theta \\ \end{cases}\)</span></p></li><li><p>错切变换</p><p>变换矩阵</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  1 &amp; b &amp; 0\\  d &amp; 1 &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p><p>变换关系</p><p><span class="math inline">\(\begin{cases}  x´=x + by \\  y´=dx + y \\ \end{cases}\)</span></p></li><li><p>复合变换</p><p>原理</p><blockquote><p>复合变换是指图形做一次以上的几何变换，变换结果是每次变换矩阵相乘。</p></blockquote><p>举例：如何做到将图形绕平面上的一点(x0,y0)旋转变换θ角度？</p><blockquote><p>方法：将图形先平移到原点，然后进行缩放或者旋转的变化，最后再移回 <span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\ \end{pmatrix} {=} \begin{pmatrix}  1 &amp; 0 &amp; x_{0}\\  0 &amp; 1 &amp; y_{0}\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  \text{cos}(\theta) &amp; -\text{sin}(\theta) &amp; 0\\  \text{sin}(\theta) &amp; \text{cos}(\theta) &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  1 &amp; 0 &amp; -x_{0}\\  0 &amp; 1 &amp; -y_{0}\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} \begin{pmatrix}  x \\  y \\  1 \\ \end{pmatrix}\)</span></p></blockquote></li></ol><h2 id="二数学坐标变换直接应用">二，数学坐标变换直接应用</h2><p><strong><font size = 5>POJ 3889</font></strong><font size = 5 face = "Times new Roman"> Fractal Streets</font></p><p><a href="http://poj.org/problem?id=3889">POJ题目链接</a></p><p><img src="http://poj.org/images/3889_1.png" alt="3889" /></p><p>这张图是典型的分形图。容易根据给定的房屋编号确定房屋在四个片区中的哪一个，所以，我们只需要从原始的，1号房屋对应的最小片区开始，按照扩展规律扩展即可。</p><p>有什么规律呢？以行号增大的方向为x轴正方向，列号增大的方向为y轴正方向，左上角片区相当于上一级城市以<span class="math inline">\(y = x\)</span>为对称轴做翻转。左下角片区相当于上一级城市以<span class="math inline">\(y = -x + sz - 1, (\text{其中}sz\text{表示上一级城市大小，即}2^{i - 1})\)</span>为对称轴做翻转。右上角片区相当于上一级城市平移<span class="math inline">\(sz\)</span>，右下角片区相当于上一级城市在<span class="math inline">\(x,y\)</span>方向分别平移<span class="math inline">\(sz\)</span>。用变换矩阵很容易求出坐标的对应关系。以左下角为例。</p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\  \end{pmatrix}  {=}  \begin{pmatrix}  1 &amp; 0 &amp; 2^{i-1}\times 2 - 1\\  0 &amp; 1 &amp; 2^{i-1} - 1\\  0 &amp; 0 &amp; 1\\  \end{pmatrix}  \begin{pmatrix}  0 &amp; -1 &amp; 0\\  -1 &amp; 0 &amp; 0\\  0 &amp; 0 &amp; 1\\  \end{pmatrix}  \begin{pmatrix}  x \\  y \\  1 \\  \end{pmatrix}=&gt;\)</span></p><p><span class="math inline">\(\begin{pmatrix}  x&#39; \\  y&#39; \\  1 \\  \end{pmatrix}  {=}  \begin{pmatrix}  0 &amp; -1 &amp; 2^{i} - 1\\  -1 &amp; 0 &amp; 2^{i-1} - 1\\  0 &amp; 0 &amp; 1\\  \end{pmatrix}  \begin{pmatrix}  x \\  y \\  1 \\  \end{pmatrix}\)</span></p><p>注意这道题的坐标是离散的而非连续的，得到变换关系</p><p><span class="math inline">\(\begin{cases} x&#39; = 2^{i} - y - 1 \\ y&#39; = 2^{i - 1} - x - 1 \end{cases}\)</span></p><h2 id="三应用">三，应用</h2><p>地理信息系统(GIS)，计算机图形学等。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> 数学 </tag>
            
            <tag> GIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C,C++语法</title>
      <link href="/2021/12/05/Programming%20Language/C,C++%E8%AF%AD%E6%B3%95/"/>
      <url>/2021/12/05/Programming%20Language/C,C++%E8%AF%AD%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="c语言定义和声明结构体">1. C语言定义和声明结构体</h2><h3 id="一般的结构体">1.1 一般的结构体</h3><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Student<span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">21</span><span class="op">];</span><span class="co">//学生姓名</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span>      <span class="co">//学生年龄</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>stu5<span class="op">,</span>stu6<span class="op">,</span>stu7<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Student stu2<span class="op">,</span>stu3<span class="op">,</span>stu4<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span><span class="op">*</span> stu_ptr <span class="op">=</span> new Student<span class="op">;</span> <span class="co">//结构体指针</span></span></code></pre></div><h3 id="匿名结构体">1.2 匿名结构体</h3><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> <span class="op">&#123;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">21</span><span class="op">];</span><span class="co">//学生姓名</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span>      <span class="co">//学生年龄</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>stu8<span class="op">,</span>stu9<span class="op">;</span></span></code></pre></div><h2 id="c语言结构体的初始化">2. C语言结构体的初始化</h2><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Student<span class="op">&#123;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span>      <span class="co">//学生年龄</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> grade<span class="op">;</span>    <span class="co">//学生年级</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">21</span><span class="op">];</span><span class="co">//学生姓名</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span></code></pre></div><h3 id="成员变量单个初始化">2.1 成员变量单个初始化</h3><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Student s<span class="op">;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>age   <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>grade <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>name  <span class="op">=</span> <span class="st">&quot;Jack&quot;</span><span class="op">;</span></span></code></pre></div><h3 id="顺序初始化">2.2 顺序初始化</h3><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Student s <span class="op">=</span> <span class="op">&#123;</span><span class="dv">16</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">&quot;Tom&quot;</span><span class="op">&#125;;</span></span></code></pre></div><h2 id="c语言关键字和访问绝对地址">2. C语言关键字和访问绝对地址</h2><h3 id="关键字static">2.1 关键字static</h3><ol type="1"><li>在<strong>函数体内</strong> ，一个被声明为静态的变量 在这一函数被调用过程中维持其值不变。</li><li>在文件域内（但在函数体外），一个被声明为静态的变量 可以被文件域内所有函数访问，但不能被文件域外其它函数访问。它是一个<strong>本地的全局变量</strong>。</li><li>在文件域内 ，一个被声明为静态的函数只可被这一文件域内的其它函数调用。那就是，这个函数被限制在<strong>声明它的文件的本地范围内使用</strong>。</li></ol><h3 id="关键字const">2.2 关键字const</h3><p>只读 ：不能简单说 “常数 使用关键字 const 能产生更紧凑的代码。 使编译器保护那些不希望被改变的参数，防止其被无意的代码修改。</p><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> a <span class="op">;</span> <span class="co">// a 是一个常整数</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="dt">const</span> a<span class="op">;</span>a<span class="op">;</span><span class="co">// a 是一个常整数</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span> a<span class="op">;</span><span class="co">// a 是一个指向常整数的指针</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="dt">const</span> a<span class="op">;</span>a<span class="op">;</span><span class="co">// a 是一个指向整数的常指针</span></span></code></pre></div><h3 id="关键字volatile">2.3 关键字volatile</h3><ol type="1"><li><p>阻止编译器优化 定义为 volatile 的变量是说这变量可能会被意想不到地改变 优化器在用到这个变量时必须每次都重新读取这个变量的值，而不是使用保存在寄存器里的备份。</p></li><li><p>volatile 变量使用的几种情况（主要用于嵌入式系统）</p><ul><li>I/O 接口电路的硬件寄存器 （如：状态寄存器）</li><li>中断服务子程序中会访问到的非自动变量</li><li>多任务中被几个任务共享的变量</li></ul></li><li><p>举例</p><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> eventI2C<span class="op">;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 声明只读的无符号字符变量 eventI2C</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">// const ：本程序不应该试图去修改它</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// volatile ：可能被外界（硬件、其他进程）改变</span></span></code></pre></div></li></ol><h3 id="访问绝对地址">2.4 访问绝对地址</h3><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// UART寄存器定义</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ULCON0 (*(volatile unsigned long*) 0x01D00000)</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define UCON0 (*(volatile unsigned long*) 0x01D00004)</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define UFCON0 (*(volatile unsigned long*) 0x01D00008)</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define UMCON0 (*(volatile unsigned long*) 0x01D0000C)</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 使用方式</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>pULCON0 <span class="op">=</span> <span class="bn">0x03</span><span class="op">;</span> <span class="co">// 帧长度 8 位，停止位 1 位，无校验</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>pUFCON0 <span class="op">=</span> <span class="bn">0x21</span><span class="op">;</span> <span class="co">// 启用 FIFO ，发送 FIFO 触发级别为空，</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                 <span class="co">// 接收 FIFO 触发级别为 12 字节</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>pUCON0 <span class="op">=</span> <span class="bn">0xC5</span><span class="op">;</span>  <span class="co">// 接收中断 查询允许，发送中断 查询允许</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                 <span class="co">// 允许接收错误中断，允许接收超时中断</span></span></code></pre></div><h2 id="c-pair类型重载">3. C++ pair类型重载</h2><div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T1<span class="op">,</span> <span class="kw">typename</span> T2<span class="op">&gt;</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="kw">operator</span><span class="op">&lt;(</span><span class="at">const</span> pair<span class="op">&lt;</span>T1<span class="op">,</span> T2<span class="op">&gt;</span> <span class="op">&amp;</span>lhs<span class="op">,</span> <span class="at">const</span> pair<span class="op">&lt;</span>T1<span class="op">,</span> T2<span class="op">&gt;</span> <span class="op">&amp;</span>rhs<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lhs<span class="op">.</span>first <span class="op">&lt;</span> rhs<span class="op">.</span>first <span class="op">||</span> <span class="op">(!(</span>rhs<span class="op">.</span>first <span class="op">&lt;</span> lhs<span class="op">.</span>first<span class="op">)</span> <span class="op">&amp;&amp;</span> lhs<span class="op">.</span>second <span class="op">&lt;</span> rhs<span class="op">.</span>second<span class="op">);</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>意义：如果lhs的第一个变量小于rhs的第一个变量，返回<strong>true</strong>，否则，如果rhs的第一个变量不小于lhs的第一个变量（即<code>lhs.first &lt;= rhs.first</code>，由于前面已经处理过<code>lhs.first &lt; rhs.first</code>的情况，所以相当于<code>lhs.first == rhs.first</code>），且lhs的第二个变量小于rhs的第二个变量，返回<strong>true</strong>。逻辑和下面的代码相同：</p><div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> T1<span class="op">,</span> <span class="kw">typename</span> T2<span class="op">&gt;</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> <span class="kw">operator</span><span class="op">&lt;(</span><span class="at">const</span> pair<span class="op">&lt;</span>T1<span class="op">,</span> T2<span class="op">&gt;</span> <span class="op">&amp;</span>lhs<span class="op">,</span> <span class="at">const</span> pair<span class="op">&lt;</span>T1<span class="op">,</span> T2<span class="op">&gt;</span> <span class="op">&amp;</span>rhs<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>lhs<span class="op">.</span>first <span class="op">==</span> rhs<span class="op">.</span>first<span class="op">)</span> <span class="cf">return</span> lhs<span class="op">.</span>second <span class="op">&lt;</span> rhs<span class="op">.</span>second<span class="op">;</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> lhs<span class="op">.</span>first <span class="op">&lt;</span> rhs<span class="op">.</span>first<span class="op">;</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用网页用户限制的解除</title>
      <link href="/2021/11/15/Front/noLimit/"/>
      <url>/2021/11/15/Front/noLimit/</url>
      
        <content type="html"><![CDATA[<h2 id="解决csdn的复制粘贴限制">解决CSDN的复制粘贴限制</h2><p>CSDN站曾经是一个非常好的计算机技术交流平台。但现在却开始商业化，为了用户数量不择手段，现在居然连复制代码都要限制（我现在已经不喜欢它了）。</p><p>为了复制一小段代码就注册个账号是很麻烦的，而且CSDN对用户数据安全也没那么上心。所以我总结了以下几个好用的方法。</p><h3 id="方法一">方法一</h3><p>第一步：键入F12，打开浏览器开发者工具。选择要复制的代码块。在开发者工具显示的的源码中，会自动定位到如下位置。</p><div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;code</span><span class="ot"> class=</span><span class="st">&quot;prism language-cpp&quot;</span><span class="kw">&gt;</span>...<span class="kw">&lt;/code&gt;</span></span></code></pre></div><p>第二步：在开发者工具的控制台(console)中，输入如下JavaScript命令，替换getElementByClassName()方法中的字符串为上面html中code class字符串的内容，想要复制的代码会显示在控制台的输出中。</p><div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>[<span class="op">...</span><span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByClassName</span>(<span class="st">&quot;prism language-cpp&quot;</span>)]<span class="op">.</span><span class="fu">forEach</span>(i<span class="kw">=&gt;</span><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(i<span class="op">.</span><span class="at">innerText</span>))</span></code></pre></div><h3 id="方法二">方法二</h3><p>在控制台输入</p><div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">function</span>()&#123;</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> code <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByTagName</span>(<span class="st">&#39;code&#39;</span>)<span class="op">;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> code<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i)  &#123;</span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        code[i]<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">userSelect</span><span class="op">=</span><span class="st">&#39;text&#39;</span><span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    &#125;</span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>&#125;)()<span class="op">;</span></span></code></pre></div><p>这样就能编辑代码块中的内容了，也就能复制代码了。可以建一个收藏夹，每次点击收藏夹时就会运行这段代码。</p><h2 id="解除csdn关注后查看文章的限制">解除CSDN关注后查看文章的限制</h2><p>这种操作会导致粉丝不正常增长，非常的不好。我很不喜欢这种行为。</p><p>第一行代码为删除 <code>DIV</code> 高度，并取消 <code>overflow</code> 属性，第二行代码为去除关注博主按钮区域。</p><div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">function</span> () &#123;</span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Your code here...</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 使用 Jquery 选择器，也可以直接使用原生的 JS</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="st">&quot;#article_content&quot;</span>)<span class="op">.</span><span class="fu">removeAttr</span>(<span class="st">&quot;style&quot;</span>)<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">$</span>(<span class="st">&quot;.hide-article-box&quot;</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>&#125;)()<span class="op">;</span></span></code></pre></div><p>来源：https://blog.csdn.net/qq_45662588/article/details/118764577</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> 网页前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> 网页内容 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于markdown格式排版</title>
      <link href="/2021/11/15/Markdown/MarkdownIndent/"/>
      <url>/2021/11/15/Markdown/MarkdownIndent/</url>
      
        <content type="html"><![CDATA[<h2 id="markdown-格式">markdown 格式</h2><h3 id="一中文段首首行缩进">一，中文段首首行缩进</h3><p><strong><font size = 5 face = "KAITI">markdown语法中，多个空格只会被翻译成一个空格</font></strong></p><div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>半角的空白<span class="dv">&amp;ensp;</span>或<span class="dv">&amp;#8194;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>全角的空白<span class="dv">&amp;emsp;</span>或<span class="dv">&amp;#8195;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>不断行的空白格<span class="dv">&amp;nbsp;</span>或<span class="dv">&amp;#160;</span></span></code></pre></div><h2 id="二latex公式的对齐">二，Latex公式的对齐</h2><ol type="1"><li><p>公式无序号，使用</p><div class="sourceCode" id="cb2"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">align*</span>&#125;</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ss">...</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">align*</span>&#125;</span></code></pre></div></li><li><p>公式有序号，使用</p><div class="sourceCode" id="cb3"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">align</span>&#125;</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ss">行1等号左 &amp;= 行1等号右 </span><span class="sc">\\</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;= 行2等号右 </span><span class="sc">\\</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ss">&amp;= 行3等号右 </span><span class="sc">\notag</span><span class="ss"> </span><span class="sc">\\</span><span class="ss"> </span><span class="co">%\notag取消标记%</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">align</span>&#125;</span></code></pre></div></li><li><p>示例</p><div class="sourceCode" id="cb4"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ss">$$</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">align*</span>&#125;<span class="ss"> </span><span class="sc">\text</span>&#123;sgn&#125;<span class="ss">(H(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;))&amp;=</span><span class="sc">\text</span>&#123;sgn&#125;<span class="ss">(</span><span class="sc">\frac</span><span class="ss">&#123;1&#125;           &#123;2&#125;</span><span class="sc">\ln\frac</span><span class="ss">&#123;P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)&#125;&#123;P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=-1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)&#125;) </span><span class="sc">\\</span><span class="ss"> &amp;=</span><span class="kw">\begin</span>&#123;<span class="ex">cases</span>&#125;<span class="ss">1, P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;) &gt; P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=-1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;) </span><span class="sc">\\</span><span class="ss"> -1, P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;) &lt; P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=-1|</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)</span><span class="kw">\end</span>&#123;<span class="ex">cases</span>&#125;<span class="ss"> </span><span class="sc">\\</span><span class="ss"> &amp;=</span><span class="sc">\underset</span><span class="ss">&#123;y </span><span class="sc">\in</span><span class="ss"> </span><span class="sc">\&#123;</span><span class="ss">-1,1</span><span class="sc">\&#125;</span><span class="ss">&#125;&#123;</span><span class="sc">\arg\max</span><span class="ss">&#125;P(f(</span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;)=y | </span><span class="sc">\pmb</span><span class="ss">&#123;x&#125;) </span><span class="kw">\end</span>&#123;<span class="ex">align*</span>&#125;</span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ss">$$</span></span></code></pre></div><p><span class="math display">\[\begin{align*} \text{sgn}(H(\pmb{x}))&amp;=\text{sgn}(\frac{1}           {2}\ln\frac{P(f(\pmb{x})=1|\pmb{x})}{P(f(\pmb{x})=-1|\pmb{x})}) \\ &amp;=\begin{cases}1, P(f(\pmb{x})=1|\pmb{x}) &gt; P(f(\pmb{x})=-1|\pmb{x}) \\ -1, P(f(\pmb{x})=1|\pmb{x}) &lt; P(f(\pmb{x})=-1|\pmb{x})\end{cases} \\ &amp;=\underset{y \in \{-1,1\}}{\arg\max}P(f(\pmb{x})=y | \pmb{x}) \end{align*}\]</span></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 实训平台评测程序代码的获取</title>
      <link href="/2021/11/11/Operation%20System/Educoder%20%E8%AF%84%E6%B5%8B%E7%A8%8B%E5%BA%8F/"/>
      <url>/2021/11/11/Operation%20System/Educoder%20%E8%AF%84%E6%B5%8B%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="实训地址">实训地址</h1><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h1 id="分析历程">分析历程</h1><h2 id="一实训机上偶然的发现">一，实训机上偶然的发现</h2><p>在修改输入答案文件夹中的答案时，我误删了<code>/data/workspace/edu/step1/test1</code>文件。再点击评测时，发现评测界面输出一行红字<font color = red face = "宋体">“评测文件被修改”</font>。说明实训项目可能是依赖test1文件进行评测的。</p><p>尝试运行test1，发现权限不够。做实训时，用户是以<code>root</code>身份登录的。所以输入<code>ls -la</code>命令查看test的权限。果然没分给我。于是使用<code>chmod -R 777 test1</code>命令更改文件夹权限，接着输入<code>./test1</code>运行之。运行结果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/shixunRE0.png" alt="运行结果" /></p><p>果然，和平常做实训时的评测结果一样。由python的报错可知，实训使用python脚本进行评测。那么，test1文件应该是python封装的可执行文件。</p><h2 id="二本机进行分析">二，本机进行分析</h2><p>用某种方法，将test1文件导出到本机上。使用python的archive_viewer.py脚本，对test1文件进行分析。</p><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="op">&lt;</span>archive_viewer.py的路径<span class="op">&gt;</span> <span class="op">&lt;</span>待分析评测文件<span class="op">&gt;</span></span></code></pre></div><p>下图是部分结果。</p><p>archiev_viewer.py的位置（site-packages/PyInstaller/utils/cliutils/archive_viewer.py）</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/shixunRE1.png" alt="archive_viewer.py运行结果" /></p><p>观察发现图中(12469, 1669, 4892, 1 ,'s', 'test1')这一组就是test1的python代码。</p><p>输入<code>x test1</code>命令将其提取出来。</p><p>使用wxmedit软件，发现其内容如下。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/shixunRE2.png" alt="test1的内容" /></p><p>E3开头，说明是比较标准的python代码二进制文件。但是，如果我们直接用python的逆向器，是无法对这个文件进行反编译的。所以，要对这个文件进行一些补充。主要补充python解释器的版本号信息和代码的时间戳。在开头补充16B代码</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dv">42</span> <span class="dv">0</span><span class="er">D</span> <span class="dv">0</span><span class="er">D</span> <span class="dv">0</span><span class="er">A</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="dv">70</span> <span class="dv">79</span> <span class="dv">69</span> <span class="dv">30</span> <span class="dv">10</span> <span class="bn">01</span> <span class="bn">00</span> <span class="bn">00</span></span></code></pre></div><p>即可。</p><p>补充后的代码如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/shixunRE3.png" alt="test1补充后的内容" /></p><p>然后，将test1增加.pyc扩展名。重命名为test1.pyc。使用python的uncompyle库进行反编译。</p><p>如果没有安装ucompyle工具，那么需要在python cmd中输入如下命令下载：</p><div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install uncompyle</span></code></pre></div><p>然后使用uncompyle反编译，将输出文件保存到test1.py</p><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">uncompyle6</span> test1.pyc <span class="op">&gt;</span> test1.py</span></code></pre></div><p>使用打开test1.py文件，惊喜发生了，我们获得了评测程序的代码。该实训评测代码如下：</p><p>从代码中，可以知道评测机制，和所有问题的答案。</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uncompyle6 version 3.8.0</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Python bytecode 3.7.0 (3394)</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Decompiled from: Python 3.8.12 (default, Oct 12 2021, 03:01:40) [MSC v.1916 64 bit (AMD64)]</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Embedded file name: test1.py</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiled at: 1995-09-28 00:18:56</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Size of source mod 2**32: 272 bytes</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(<span class="st">&#39;/root/gdb.log&#39;</span>):</span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span> <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;/root/gdb.log&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>).read()</span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span> <span class="op">=</span> <span class="bu">file</span>.replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>).replace(<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>, <span class="st">&#39;&#39;</span>)</span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;i_zone=&#123;112,0,0,0,0,0,0,0,0&#125;,i_wait=0x0&lt;startup_32&gt;,i_atime=0,i_ctime=0,i_dev=768,i_num=1&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第1次开始运行时，参数dir所对应的i节点正确&#39;</span>)</span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第1次开始运行时，参数dir所对应的i节点错误&#39;</span>)</span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;bread(dev=768,block=112)atbuffer.c:271271&#123;1:current-&gt;pid=1&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数bread第1次开始运行时，参数block的值正确&#39;</span>)</span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数bread第1次开始运行时，参数block的值错误&#39;</span>)</span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;inode=1,name=&quot;.&quot;,&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match第1次开始运行时，参数de指向的目录项的i节点号和名字正确&#39;</span>)</span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match第1次开始运行时，参数de指向的目录项的i节点号和名字错误&#39;</span>)</span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;inode=48,name=&quot;usr&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match第8次开始运行时，参数de指向的目录项的i节点号和名字正确&#39;</span>)</span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match第8次开始运行时，参数de指向的目录项的i节点号和名字错误&#39;</span>)</span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;iget(dev=768,nr=48)atinode.c:245245&#123;1:current-&gt;pid=1&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数iget第1次开始运行时，参数nr的值正确&#39;</span>)</span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数iget第1次开始运行时，参数nr的值错误&#39;</span>)</span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;bread(dev=768,block=6)atbuffer.c:271271&#123;1:current-&gt;pid=1&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数bread第2次开始运行时，参数block的值正确&#39;</span>)</span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数bread第2次开始运行时，参数block的值错误&#39;</span>)</span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;i_zone=&#123;987,0,0,0,0,0,0,0,0&#125;,i_wait=0x0&lt;startup_32&gt;,i_atime=0,i_ctime=0,i_dev=768,i_num=48,i_count=1,i_lock=0&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第2次开始运行时，参数dir所对应的i节点正确&#39;</span>)</span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第2次开始运行时，参数dir所对应的i节点错误&#39;</span>)</span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;i_zone=&#123;4721,0,0,0,0,0,0,0,0&#125;,i_wait=0x0&lt;startup_32&gt;,i_atime=0,i_ctime=0,i_dev=768,i_num=131,i_count=1,i_lock=0&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第3次开始运行时，参数dir所对应的i节点正确&#39;</span>)</span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数find_entry第3次开始运行时，参数dir所对应的i节点错误&#39;</span>)</span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;inode=134,name=&quot;hello.c&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match匹配到/usr/root/hello.c的目录项时，参数de指向的目录项的i节点正确&#39;</span>)</span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;函数match匹配到/usr/root/hello.c的目录项时，参数de指向的目录项的i节点错误&#39;</span>)</span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;open_namei(pathname=0x18407&quot;/usr/root/hello.c&quot;,flag=0,mode=32768,res_inode=0xffffb4&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">&#39;i_ctime=0,i_dev=768,i_num=134,i_count=1,i_lock=0&#39;</span> <span class="kw">in</span> <span class="bu">file</span>:</span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;函数open_namei结束时，变量res_inode指向的i节点正确&#39;</span>)</span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;函数open_namei结束时，变量res_inode指向的i节点错误&#39;</span>)</span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;未检测到gdb.log&#39;</span>)</span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span> <span class="op">=</span> <span class="bu">open</span>(<span class="st">&#39;第一关.txt&#39;</span>, <span class="st">&#39;r&#39;</span>, encoding<span class="op">=</span><span class="st">&#39;utf-8&#39;</span>)</span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="bu">file</span>.read().replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&#39;&#39;</span>)</span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span>.close()</span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="st">&#39;1.&#39;</span></span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> <span class="st">&#39;2.&#39;</span></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="st">&#39;3.&#39;</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="st">&#39;4.&#39;</span></span><span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    e <span class="op">=</span> <span class="st">&#39;5.&#39;</span></span><span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> <span class="st">&#39;6.&#39;</span></span><span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> <span class="st">&#39;7.&#39;</span></span><span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="st">&#39;8.&#39;</span></span><span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> <span class="st">&#39;9.&#39;</span></span><span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    one <span class="op">=</span> f[f.index(a):f.index(b)]</span><span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    two <span class="op">=</span> f[f.index(b):f.index(c)]</span><span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    three <span class="op">=</span> f[f.index(c):f.index(d)]</span><span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    four <span class="op">=</span> f[f.index(d):f.index(e)]</span><span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    five <span class="op">=</span> f[f.index(e):f.index(g)]</span><span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    six <span class="op">=</span> f[f.index(g):f.index(h)]</span><span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    seven <span class="op">=</span> f[f.index(h):f.index(i)]</span><span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    eight <span class="op">=</span> f[f.index(i):f.index(j)]</span><span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    nine <span class="op">=</span> f[f.index(j):]</span><span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    one_answer_1 <span class="op">=</span> one.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    one_answer_2 <span class="op">=</span> one.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> one_answer_1 <span class="op">==</span> <span class="st">&#39;1&#39;</span>:</span><span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> one_answer_2 <span class="op">==</span> <span class="st">&#39;112&#39;</span>:</span><span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第一题答案正确&#39;</span>)</span><span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span><span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第一题答案错误&#39;</span>)</span><span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>        two_answer_1 <span class="op">=</span> two.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> two_answer_1 <span class="op">==</span> <span class="st">&#39;112&#39;</span>:</span><span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第二题答案正确&#39;</span>)</span><span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第二题答案错误&#39;</span>)</span><span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>three_answer_1 <span class="op">=</span> three.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>three_answer_2 <span class="op">=</span> three.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> three_answer_1 <span class="op">==</span> <span class="st">&#39;1&#39;</span>:</span><span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> three_answer_2 <span class="op">==</span> <span class="st">&#39;&quot;.&quot;&#39;</span>:</span><span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第三题答案正确&#39;</span>)</span><span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第三题答案错误&#39;</span>)</span><span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span><span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    four_answer_1 <span class="op">=</span> four.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    four_answer_2 <span class="op">=</span> four.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> four_answer_1 <span class="op">==</span> <span class="st">&#39;48&#39;</span>:</span><span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> four_answer_2 <span class="op">==</span> <span class="st">&#39;&quot;usr&quot;&#39;</span>:</span><span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第四题答案正确&#39;</span>)</span><span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span><span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第四题答案错误&#39;</span>)</span><span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>        five_answer_1 <span class="op">=</span> five.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> five_answer_1 <span class="op">==</span> <span class="st">&#39;48&#39;</span>:</span><span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第五题答案正确&#39;</span>)</span><span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第五题答案错误&#39;</span>)</span><span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>six_answer_1 <span class="op">=</span> six.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>six_answer_2 <span class="op">=</span> six.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> six_answer_1 <span class="op">==</span> <span class="st">&#39;48&#39;</span>:</span><span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> six_answer_2 <span class="op">==</span> <span class="st">&#39;987&#39;</span>:</span><span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第六题答案正确&#39;</span>)</span><span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第六题答案错误&#39;</span>)</span><span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span><span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    seven_answer_1 <span class="op">=</span> seven.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    seven_answer_2 <span class="op">=</span> seven.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> seven_answer_1 <span class="op">==</span> <span class="st">&#39;131&#39;</span>:</span><span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> seven_answer_2 <span class="op">==</span> <span class="st">&#39;4721&#39;</span>:</span><span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第七题答案正确&#39;</span>)</span><span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span><span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第七题答案错误&#39;</span>)</span><span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>        eight_answer_1 <span class="op">=</span> eight.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> eight_answer_1 <span class="op">==</span> <span class="st">&#39;134&#39;</span>:</span><span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;第八题答案正确&#39;</span>)</span><span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;第八题答案错误&#39;</span>)</span><span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>nine_answer_1 <span class="op">=</span> nine.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">1</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>nine_answer_2 <span class="op">=</span> nine.split(<span class="st">&#39;(&#39;</span>)[<span class="dv">2</span>].split(<span class="st">&#39;)&#39;</span>)[<span class="dv">0</span>]</span><span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> nine_answer_1 <span class="op">==</span> <span class="st">&#39;134&#39;</span> <span class="kw">and</span> nine_answer_2 <span class="op">==</span> <span class="st">&#39;4743&#39;</span>:</span><span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;第九题答案正确&#39;</span>)</span><span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span><span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;第九题答案错误&#39;</span>)</span><span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a><span class="co"># okay decompiling test1.pyc</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
            <tag> 逆向分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训7.x实验</title>
      <link href="/2021/11/08/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD7.x/"/>
      <url>/2021/11/08/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD7.x/</url>
      
        <content type="html"><![CDATA[<h1 id="实训地址">实训地址</h1><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h1 id="实训7.1文件系统的静态结构">实训7.1：文件系统的静态结构</h1><h2 id="第一关文件-usrroothello.c-的手动分析">第一关：文件 /usr/root/hello.c 的手动分析</h2><h3 id="补充linux文件系统静态结构简图">补充：Linux文件系统静态结构简图</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/rootimage-blocks.png" alt="Linux文件系统的静态结构" /></p><h3 id="补充linux文件访问过程简图">补充：Linux文件访问过程简图</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/Linuxfilesystem-1.png" alt="Linux文件系统简图" /></p><h3 id="实验方法和答案">实验方法和答案</h3><p>在Linux操作系统的文件系统中，超级块相当于文件系统的地图。在超级块中保存着文件系统的属性信息、磁盘布局和资源使用情况等信息。文件系统通过超级块了解磁盘的布局，查找已用和可用资源等。超级块又相当于入口，文件系统的操作通常从超级块开始。</p><p>超级块的数据结构如下</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> super_block <span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_ninodes<span class="op">;</span> <span class="co">/* i节点数 */</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_nzones<span class="op">;</span> <span class="co">/* 逻辑块数，或称为区块数 */</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_imap_blocks<span class="op">;</span> <span class="co">/* i节点位图所占块数 */</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_zmap_blocks<span class="op">;</span> <span class="co">/* 逻辑块位图所占块数 */</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_firstdatazone<span class="op">;</span> <span class="co">/* 数据区第一个逻辑块块号 */</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_log_zone_size<span class="op">;</span> <span class="co">/* Log_2(磁盘块数/逻辑块) */</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> s_max_size<span class="op">;</span> <span class="co">/* 最大文件长度 */</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_magic<span class="op">;</span> <span class="co">/* 文件系统幻数 */</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* These are only in memory */</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> buffer_head <span class="op">*</span> s_imap<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> buffer_head <span class="op">*</span> s_zmap<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> s_dev<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> m_inode <span class="op">*</span> s_isup<span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> m_inode <span class="op">*</span> s_imount<span class="op">;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> s_time<span class="op">;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> task_struct <span class="op">*</span> s_wait<span class="op">;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> s_lock<span class="op">;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> s_rd_only<span class="op">;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> s_dirt<span class="op">;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span></code></pre></div><p>用<strong>hexdump</strong>打开rootimage-0.11，输入如下命令，查看超级块的内容。</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x400</span> <span class="op">-</span>n <span class="dv">1024</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span></code></pre></div><p>索引节点区就是文件系统静态结构图中的<strong>i</strong>节点区。根据上面的文件系统静态结构图，可算出i节点区是第五块，地址为<span class="math inline">\(0\text{x}400 \times 0\text{x}5 = 0\text{x}1400\)</span>（从0开始编号）。</p><p>查看0号索引节点（i节点区）内容</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x1400</span> <span class="op">-</span>n <span class="dv">32</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span></code></pre></div><p>显示内容如下，注意内容是<strong>小端存储</strong>的。</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bn">00001400</span>  ed <span class="dv">41</span> <span class="bn">00</span> <span class="bn">00</span> <span class="dv">80</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="dv">0</span><span class="er">c</span> <span class="dv">7</span><span class="er">a</span> <span class="dv">65</span> <span class="dv">5</span><span class="er">f</span> <span class="bn">00</span> <span class="er">08</span> <span class="dv">70</span> <span class="bn">00</span>  <span class="op">|.</span>A<span class="op">.......</span>ze_<span class="op">..</span>p<span class="op">.|</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bn">00001410</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|................|</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bn">00001420</span></span></code></pre></div><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span>在超级块中，i 节点位图所占的块数是多少？<span class="op">(</span><span class="dv">1</span><span class="op">)</span>区块位图所占的块数是多少？<span class="op">(</span><span class="dv">2</span><span class="op">)</span>数据区的第一个区块的编号是多少？<span class="op">(</span><span class="bn">0x70</span><span class="op">)</span>索引节点区的第一个数据块的编号和起始地址是多少？<span class="op">(</span><span class="dv">5</span><span class="op">)(</span><span class="bn">0x1400</span><span class="op">)</span></span></code></pre></div><p>一号索引节点位置在0x70，所以计算出它的起始地址<span class="math inline">\(0 + 0\text{x}70 \times 0\text{x}400 = 0\text{x}1\text{c}000\)</span></p><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fl">2.1</span> 号索引节点的第一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x70</span><span class="op">)(</span><span class="bn">0x1c000</span><span class="op">)</span></span></code></pre></div><p>目录项本质上是一类特殊的文件，包含了子目录和自身的一些信息，并且该文件和一般文件都存储在数据区中，因此如果要想知道某个目录的索引节点编号，你只需要找到父目录项文件存储在数据区的位置(地址)，然后输出父目录文件中的数据，就可以得到子目录的相关信息。</p><p>显示数据区的内容。</p><div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1c000 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span></code></pre></div><p>内容如下</p><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c000</span>  <span class="bn">01</span> <span class="bn">00</span> <span class="dv">2</span><span class="er">e</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|................|</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c010</span>  <span class="bn">01</span> <span class="bn">00</span> <span class="dv">2</span><span class="er">e</span> <span class="dv">2</span><span class="er">e</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|................|</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c020</span>  <span class="bn">02</span> <span class="bn">00</span> <span class="dv">62</span> <span class="dv">69</span> <span class="dv">6</span><span class="er">e</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|..</span>bin<span class="op">...........|</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c030</span>  <span class="dv">0</span><span class="er">f</span> <span class="bn">00</span> <span class="dv">64</span> <span class="dv">65</span> <span class="dv">76</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|..</span>dev<span class="op">...........|</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c040</span>  <span class="dv">23</span> <span class="bn">00</span> <span class="dv">65</span> <span class="dv">74</span> <span class="dv">63</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|</span>#<span class="op">.</span>etc<span class="op">...........|</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c050</span>  <span class="dv">2</span><span class="er">e</span> <span class="bn">00</span> <span class="dv">72</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">74</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|..</span>root<span class="op">..........|</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c060</span>  <span class="dv">2</span><span class="er">f</span> <span class="bn">00</span> <span class="dv">74</span> <span class="dv">6</span><span class="er">d</span> <span class="dv">70</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|/.</span>tmp<span class="op">...........|</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c070</span>  <span class="dv">30</span> <span class="bn">00</span> <span class="dv">75</span> <span class="dv">73</span> <span class="dv">72</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|</span><span class="fl">0.</span><span class="er">usr</span><span class="op">...........|</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c080</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|................|</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="op">*</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c400</span></span></code></pre></div><p>发现了文件目录和文件名。</p><p>目录项的数据结构如下：</p><div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 定义在include/linux/fs.h中 */</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NAME_LEN 14</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ROOT_INO 1</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">//文件目录项结构</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> dir_entry <span class="op">&#123;</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> inode<span class="op">;</span> <span class="co">/* i节点号 */</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span>NAME_LEN<span class="op">];</span> <span class="co">/* 文件名 */</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span></code></pre></div><p>注意这一行，结合目录项的数据结构，找到索引节点编号为0x30，一个索引节点占 32 字节，计算出起始地址（<strong>一定要注意：索引节点从 1 开始编号！</strong>）<span class="math inline">\(0\text{x}1400 + (0\text{x}30 - 0\text{x}1) \times 0\text{x}20 = 0\text{x}19\text{e}0\)</span></p><div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bn">0001</span><span class="er">c070</span>  <span class="dv">30</span> <span class="bn">00</span> <span class="dv">75</span> <span class="dv">73</span> <span class="dv">72</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|</span><span class="fl">0.</span><span class="er">usr</span><span class="op">...........|</span></span></code></pre></div><div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span>目录 <span class="op">/</span>usr 的索引节点的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x30</span><span class="op">)(</span><span class="bn">0x19e0</span><span class="op">)</span></span></code></pre></div><p>查看/usr目录索引节点的内容，一个索引节点占 32 字节，所以显示32个字节即可。</p><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x19e0 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span></code></pre></div><p>显示内容如下</p><div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fl">000019e0</span>  ed <span class="dv">41</span> <span class="bn">00</span> <span class="bn">00</span> <span class="dv">60</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  b4 <span class="dv">5</span><span class="er">d</span> <span class="dv">65</span> <span class="dv">5</span><span class="er">f</span> <span class="bn">00</span> <span class="bn">06</span> db <span class="bn">03</span>  <span class="op">|.</span>A<span class="op">..</span>`<span class="op">....]</span>e_<span class="op">....|</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bn">00001</span><span class="er">9f0</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span> <span class="bn">00</span>  <span class="op">|................|</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bn">00001</span><span class="er">a00</span></span></code></pre></div><p>iNode的结构如下</p><div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> d_inode <span class="op">&#123;</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> i_mode<span class="op">;</span> <span class="co">/* 文件的类型和属性 */</span></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> i_uid<span class="op">;</span> <span class="co">/* 文件宿主的用户id */</span></span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> i_size<span class="op">;</span> <span class="co">/* 文件长度（字节） */</span></span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> i_time<span class="op">;</span> <span class="co">/* 修改时间 */</span></span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> i_gid<span class="op">;</span> <span class="co">/* 文件宿主的主id */</span></span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> i_nlinks<span class="op">;</span> <span class="co">/* 链接数（有多少个文件指向该节点） */</span></span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span> i_zone<span class="op">[</span><span class="dv">9</span><span class="op">];</span> </span><span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* 文件占用的盘上逻辑块号数组。其中zone[0] - zone[6]是直接块号 </span></span><span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    zone[7]是间接块号，zone[8]是二次（双重）间接块号。</span></span><span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    zone是区的意思，可译成区块或逻辑块。对于设备特殊文件名的i节点，</span></span><span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    其zone[0]存放的是改文件名所指设备的设备号。zone[0]是第一区块的编号。</span></span><span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span><span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;;</span></span></code></pre></div><p>寻找zone[0]对应的第一个区块的值为0x3db。计算起始地址<span class="math inline">\(0 + 0\text{x}3\text{db} \times 0\text{x}400 = 0\text{x}\text{f}6\text{c}00\)</span></p><div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span>目录 <span class="op">/</span>usr 的索引节点的第一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x03db</span><span class="op">)(</span><span class="bn">0xf6c00</span><span class="op">)</span></span></code></pre></div><p>接下来寻找子目录root，操作与寻找/usr目录一样。</p><div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0xf6c00</span> <span class="op">-</span>n <span class="dv">1024</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x2440</span> <span class="op">-</span>n <span class="dv">32</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x49c400</span> <span class="op">-</span>n <span class="dv">1024</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span><span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x24a0</span> <span class="op">-</span>n <span class="dv">32</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span><span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>hexdump <span class="op">-</span>s <span class="bn">0x4a1c00</span> <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>C rootimage<span class="op">-</span><span class="fl">0.11</span></span></code></pre></div><div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span>目录 <span class="op">/</span>usr<span class="op">/</span>root 的索引节点的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x0083</span><span class="op">)(</span><span class="bn">0x2440</span><span class="op">)</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span>目录 <span class="op">/</span>usr<span class="op">/</span>root 的索引节点的第一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x1271</span><span class="op">)(</span><span class="bn">0x49c400</span><span class="op">)</span></span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fl">7.</span>文件 <span class="op">/</span>usr<span class="op">/</span>root<span class="op">/</span>hello<span class="op">.</span>c 的索引节点的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x0086</span><span class="op">)(</span><span class="bn">0x24a0</span><span class="op">)</span></span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fl">8.</span>文件 <span class="op">/</span>usr<span class="op">/</span>root<span class="op">/</span>hello<span class="op">.</span>c 的索引节点的第一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x1287</span><span class="op">)(</span><span class="bn">0x4a1c00</span><span class="op">)</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fl">9.</span>文件 <span class="op">/</span>usr<span class="op">/</span>root<span class="op">/</span>hello<span class="op">.</span>c 的头两个字节是什么？<span class="op">(</span><span class="bn">0x23</span><span class="op">)(</span><span class="bn">0x69</span><span class="op">)</span></span></code></pre></div><h2 id="第二关文件-etcmagic-的手动分析">第二关：文件 /etc/magic 的手动分析</h2><h3 id="实验方法">实验方法</h3><p>和第一关大致相同，不再细致讲解，只给出操作</p><div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1400 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1c000 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1840 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0xedc00 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1920 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0xf4000 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0xf5400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span></code></pre></div><h3 id="本关答案">本关答案</h3><div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span>目录 <span class="op">/</span>etc 的索引节点的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x0023</span><span class="op">)(</span><span class="bn">0x1840</span><span class="op">)</span></span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span>目录 <span class="op">/</span>etc 的索引节点的第一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x03b7</span><span class="op">)(</span><span class="bn">0xedc00</span><span class="op">)</span></span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span>文件 <span class="op">/</span>etc<span class="op">/</span>magic 的索引节点的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x002a</span><span class="op">)(</span><span class="bn">0x1920</span><span class="op">)</span></span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fl">4.</span>文件 <span class="op">/</span>etc<span class="op">/</span>magic 的索引节点的最后一个区块的编号和起始地址分别是多少？<span class="op">(</span><span class="bn">0x3d5</span><span class="op">)(</span><span class="bn">0xf5400</span><span class="op">)</span></span><span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span>文件 <span class="op">/</span>etc<span class="op">/</span>magic 的尾部包含字符串 XENIX <span class="dv">8086</span> relocatable or <span class="dv">80286</span> small model ，其起始地址是什么？<span class="op">(</span><span class="bn">0x000f55ec</span><span class="op">)</span></span></code></pre></div><h2 id="第三关硬链接和软链接">第三关：硬链接和软链接</h2><h3 id="实验方法-1">实验方法</h3><p>在bochs虚拟机中</p><div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建硬链接</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> hello.c hello-2.c</span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sync</span></span></code></pre></div><p>在Ubuntu中</p><div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> images</span><span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看超级块内容，找到数据区第一个逻辑块的块号为0x70</span></span><span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意x86的使用的是小端表示法</span></span><span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># i节点位图占了1个块，逻辑块位图占了2个块，从i节点区在5号块（块编号从0开始）</span></span><span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看i索引节点节点区内容，i节点区的起始位置在0 + 0x400 * 0x5 = 0x1400</span></span><span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看文件占用的逻辑块号，计算文件区块的地址为0x70 * 0x400 = 0x1c000</span></span><span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x1c000 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 看到usr的目录项，根据目录项结构，找到i节点号为0x30，由此找到usr目录子目录的i节点地址为0x1400 + 0x20 * (0x30 - 0x1)=0x19e0</span></span><span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x19e0 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 找到usr目录子目录的数据地址0 + 0x3db * 0x400 = 0xf6c00</span></span><span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0xf6c00 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 继续重复前两步操作，查看root里面的内容</span></span><span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x2440 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x49c400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 最后，就查看到/usr/root目录中文件和目录的相关信息</span></span></code></pre></div><p>在bochs虚拟机中</p><div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除hello.c</span></span><span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> hello.c</span><span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sync</span></span></code></pre></div><p>在Ubuntu中</p><div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 不用重复上面的大量操作了，直接查看即可。</span></span><span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x49c400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存评测用的history文件</span></span><span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">history</span> <span class="op">&gt;</span> /data/workspace/myshixun/history4.log</span></code></pre></div><h3 id="本关答案-1">本关答案</h3><div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="ex">0x49c430</span><span class="kw">)(</span><span class="ex">0x86</span><span class="kw">)</span></span><span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">0x49c440</span><span class="kw">)(</span><span class="ex">0x86</span><span class="kw">)</span></span><span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span><span class="er">(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span><span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span><span class="er">(</span><span class="ex">0x86</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关文件的删除和恢复">第四关：文件的删除和恢复</h2><h3 id="实验方法-2">实验方法</h3><div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x49c400 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 0x24a0 <span class="at">-n</span> 32 <span class="at">-C</span> rootimage-0.11</span><span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 4a1c00 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span><span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-s</span> 4a1c00 <span class="at">-n</span> 1024 <span class="at">-C</span> rootimage-0.11</span></code></pre></div><h3 id="本关答案-2">本关答案</h3><div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="ex">0x49c430</span><span class="kw">)</span></span><span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">0x24a0</span><span class="kw">)</span></span><span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span><span class="er">(</span><span class="ex">0x4a1c00</span><span class="kw">)</span></span><span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span><span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0x86</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span><span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span><span class="er">(</span><span class="ex">否</span><span class="kw">)</span></span><span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.</span><span class="er">(</span><span class="ex">否</span><span class="kw">)</span></span><span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.</span><span class="er">(</span><span class="ex">是</span><span class="kw">)(</span><span class="ex">是</span><span class="kw">)</span></span></code></pre></div><h1 id="实训7.2文件访问类系统调用的分析">实训7.2：文件访问类系统调用的分析</h1><h2 id="第一关open-系统调用的工作过程分析">第一关：open 系统调用的工作过程分析</h2><h3 id="注意事项">注意事项</h3><ol type="1"><li><p>除了问地址的值以外，其他的答案都是以十进制来写</p></li><li><p>分析hello.c的文件打开过程时，分析的时刻是你在Linux操作系统输入回车后的过程，输入回车之前的各个函数find_entry请不要分析，因为那时候还没有真正打开hello.c文件。</p></li></ol><h3 id="实验方法-3">实验方法</h3><div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一，常规操作</span></span><span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/2.tgz ~/os/</span><span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../2.tgz</span><span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 2 cur</span><span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span></code></pre></div><div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_open</span><span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> find_entry</span><span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">**</span>dir</span><span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 函数 find_entry 第 1 次开始运行时，参数 dir 所对应的 i 节点的编号就是i_num的值。</span></span><span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 该 i 节点的第一个数据块的块号就是zone[0]的值。</span></span><span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> bread</span><span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> block <span class="co"># 这条命令找到参数block的值</span></span><span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> match</span><span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 4</span><span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>de <span class="co"># 找到de指向i节点的信息</span></span><span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>de <span class="co"># 找到运行8次后de指向i节点的信息</span></span><span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> iget</span><span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 5</span><span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> nr</span><span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="bu">enable</span> 4</span><span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 6</span><span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> block</span><span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="bu">enable</span> 3</span><span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 4</span><span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">**</span>dir</span><span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">**</span>dir</span><span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="bu">enable</span> 5</span><span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>de</span><span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> namei.c:409</span><span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 5</span><span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">**</span>res_inode</span></code></pre></div><h3 id="本关答案-3">本关答案</h3><div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> find_entry 第 1 次开始运行时，参数 dir 所对应的 i 节点的编号是什么？<span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">该</span> i 节点的第一个数据块的块号是什么？<span class="er">(</span><span class="ex">112</span><span class="kw">)</span></span><span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数</span> bread 第 1 次开始运行时，参数 block 的值是什么？<span class="er">(</span><span class="ex">112</span><span class="kw">)</span></span><span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.函数</span> match 第 1 次开始运行时，参数 de 指向的目录项的 i 节点号和名字分别是什么？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="st">&quot;.&quot;</span><span class="kw">)</span></span><span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.函数</span> match 第 8 次开始运行时，参数 de 指向的目录项的 i 节点号和名字分别是什么？<span class="er">(</span><span class="ex">48</span><span class="kw">)(</span><span class="st">&quot;usr&quot;</span><span class="kw">)</span></span><span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.函数</span> iget 第 1 次开始运行时，参数 nr 的值是什么？<span class="er">(</span><span class="ex">48</span><span class="kw">)</span></span><span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.函数</span> find_entry 第 2 次开始运行时，参数 dir 所对应的 i 节点的编号是什么？<span class="er">(</span><span class="ex">48</span><span class="kw">)</span><span class="ex">该</span> i 节点的第一个数据块的块号是什么？<span class="er">(</span><span class="ex">987</span><span class="kw">)</span></span><span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.函数</span> find_entry 第 3 次开始运行时，参数 dir 所对应的 i 节点的编号是什么？<span class="er">(</span><span class="ex">131</span><span class="kw">)</span><span class="ex">该</span> i 节点的第一个数据块的块号是什么？<span class="er">(</span><span class="ex">4721</span><span class="kw">)</span></span><span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8.函数</span> match 匹配到 /usr/root/hello.c 的目录项时，参数 de 指向的目录项的 i 节点号是什么？<span class="er">(</span><span class="ex">134</span><span class="kw">)</span></span><span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9.函数</span> open_namei 结束时，变量 res_inode 指向的 i 节点的编号是什么？<span class="er">(</span><span class="ex">134</span><span class="kw">)</span><span class="ex">该</span> i 节点的第一个数据块的块号是什么？<span class="er">(</span><span class="ex">4743</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关文件管理相关的内核数据结构分析">第二关：文件管理相关的内核数据结构分析</h2><h3 id="实验方法-4">实验方法</h3><div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_open</span><span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 185</span><span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> fd</span><span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> currnet-<span class="op">&gt;</span>filp</span><span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> file_table</span><span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> inode_table</span></code></pre></div><h3 id="本关答案-4">本关答案</h3><div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> sys_open 返回的文件描述符（fd）是多少？<span class="er">(</span><span class="ex">3</span><span class="kw">)</span></span><span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.文件</span> hello.c 在进程的打开文件表中对应的数组元素的值是什么？<span class="er">(</span><span class="ex">0x25df0</span><span class="kw">)</span></span><span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.文件</span> hello.c 在读写状态信息表中的当前读写位置是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.文件</span> hello.c 在活跃文件目录表中的索引节点号是多少？<span class="er">(</span><span class="ex">134</span><span class="kw">)</span><span class="ex">该索引节点的第一个数据块的块号是多少？</span><span class="er">(</span><span class="ex">4743</span><span class="kw">)</span></span><span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.当前进程的打开文件表中的有效数组元素有几个？</span><span class="er">(</span><span class="ex">4</span><span class="kw">)</span></span><span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.读写状态信息表中的有效数组元素有几个？</span><span class="er">(</span><span class="ex">2</span><span class="kw">)</span></span><span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.活跃文件目录表中的有效数组元素有几个？</span><span class="er">(</span><span class="ex">6</span><span class="kw">)</span><span class="ex">其索引节点号分别是多少？</span><span class="er">(</span><span class="ex">1</span> 15 26 48 131 134<span class="kw">)</span></span><span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="ex">（第七题的索引节点号之间用空格分隔开！！！）</span></span></code></pre></div><h2 id="第四关read-系统调用的分析">第四关：read 系统调用的分析</h2><h3 id="实验方法-5">实验方法</h3><div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_read</span><span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> file_table</span><span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> inode_table</span><span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> bread</span><span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> block</span></code></pre></div><h3 id="本关答案-5">本关答案</h3><div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.对</span> /usr/root/hello.c 的读操作刚开始时，其对应的 file 对象内存放的当前位置是什么？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">其对应的</span> inode 对象内存放的第一个数据块的块号是什么？<span class="er">(</span><span class="ex">4743</span><span class="kw">)</span></span><span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.读</span> /usr/root/hello.c 时，传递给 bread 函数的参数 block 是什么？<span class="er">(</span><span class="ex">4743</span><span class="kw">)</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习PostgreSQL</title>
      <link href="/2021/11/07/SQL/PostgreSql/"/>
      <url>/2021/11/07/SQL/PostgreSql/</url>
      
        <content type="html"><![CDATA[<p>PostgreSQL在未创建新用户时，默认登录用户是超级用户postgres。</p><h2 id="数据库用户操作">数据库用户操作</h2><ol type="1"><li><p>输入登录命令，输入正确的账号密码</p><div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>psql <span class="op">-</span>U postgres <span class="op">-</span>d postgres</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>psql <span class="op">-</span>U <span class="op">&lt;</span>用户名<span class="op">&gt;</span> <span class="op">-</span>d <span class="op">&lt;</span>数据库名<span class="op">&gt;</span></span></code></pre></div></li><li><p>创建数据库新用户</p><div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="fu">USER</span> Username <span class="kw">WITH</span> <span class="kw">PASSWORD</span> <span class="st">&#39;*****&#39;</span>;</span></code></pre></div></li><li><p>创建数据库</p><div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">DATABASE</span> <span class="op">&lt;</span>数据库名<span class="op">&gt;</span>;</span></code></pre></div></li><li><p>授予用户数据库全部权限</p><div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">ON</span> <span class="kw">DATABASE</span> <span class="op">&lt;</span>数据库名<span class="op">&gt;</span> <span class="kw">TO</span> <span class="op">&lt;</span>用户名<span class="op">&gt;</span>;</span></code></pre></div></li><li><p>设置年月日输入格式（在线有效，离线无效）</p><div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> datestyle <span class="kw">TO</span> <span class="st">&#39;DMY&#39;</span>;</span></code></pre></div></li><li><p>删除，添加，修改属性</p><div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> SC <span class="kw">DROP</span> <span class="kw">COLUMN</span> grade;</span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> SC <span class="kw">ADD</span> <span class="kw">COLUMN</span> grade <span class="dt">NUMERIC</span>(<span class="dv">3</span>, <span class="dv">0</span>);</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> S <span class="kw">ALTER</span> <span class="kw">COLUMN</span> sage <span class="kw">TYPE</span> <span class="dt">NUMERIC</span>(<span class="dv">3</span>, <span class="dv">0</span>);</span></code></pre></div></li><li><p>删除，添加约束</p><div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> S <span class="kw">DROP</span> <span class="kw">CONSTRAINT</span> <span class="ot">&quot;s_sage_check&quot;</span>;</span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> SC <span class="kw">ADD</span> <span class="kw">CONSTRAINT</span> <span class="ot">&quot;sc_grade_check&quot;</span> <span class="kw">CHECK</span>(grade <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">AND</span> grade <span class="op">&lt;=</span> <span class="dv">100</span>);</span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> SC <span class="kw">ADD</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(sno, cno);</span></code></pre></div></li></ol><h2 id="数据库资源操作">数据库资源操作</h2><ol type="1"><li><p>显示所有表名称和结构</p><p>命令 :</p><div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>\d</span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>\d <span class="op">&lt;</span>TableName<span class="op">&gt;</span></span></code></pre></div></li><li><p>创建表</p><div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="op">&lt;</span>表名<span class="op">&gt;</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(<span class="op">&lt;</span>列名<span class="op">&gt;</span> <span class="op">&lt;</span>数据类型<span class="op">&gt;</span> [列级完整性约束条件]</span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>[,<span class="op">&lt;</span>列名<span class="op">&gt;</span> <span class="op">&lt;</span>数据类型<span class="op">&gt;</span> [列级完整性约束条件]]</span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>…</span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>[,<span class="op">&lt;</span>表级完整性约束条件<span class="op">&gt;</span>…]);</span></code></pre></div></li></ol><h2 id="数据库的查询操作">数据库的查询操作</h2><ol type="1"><li><p>查询的一般格式</p><div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> [<span class="kw">DISTINCT</span>] <span class="op">&lt;</span>目标列表达式列表<span class="op">&gt;</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="op">&lt;</span>基本表或视图列表<span class="op">&gt;</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>[<span class="kw">WHERE</span> <span class="op">&lt;</span>条件表达式<span class="op">&gt;</span>]</span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>[<span class="kw">GROUP</span> <span class="kw">BY</span> <span class="op">&lt;</span>列名列表<span class="op">&gt;</span> [<span class="kw">HAVING</span> <span class="op">&lt;</span>条件表达式<span class="op">&gt;</span>]]</span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>[<span class="kw">ORDER</span> <span class="kw">BY</span> <span class="op">&lt;</span>列名<span class="op">&gt;</span> [<span class="kw">ASC</span>|<span class="kw">DESC</span>]];</span></code></pre></div></li></ol><h2 id="数据库的增删改操作">数据库的增删改操作</h2><ol type="1"><li><p>插入元组：</p><ul><li><p>不能违背完整性约束！</p></li><li><p>如果没有指定元组某个元素的值，系统默认将其赋值为空。</p></li><li><p>如果表明后添加(属性)，那么属性列的顺序可与表中不一样，只要和常量相对应即可</p></li></ul><p>语法和示例</p><div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> <span class="op">&lt;</span>表名<span class="op">&gt;</span>[(<span class="op">&lt;</span>属性列1<span class="op">&gt;</span> [,<span class="op">&lt;</span>属性列2<span class="op">&gt;</span>]…)]<span class="op">&lt;</span>子查询<span class="op">&gt;</span>;</span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> S(Sno, Sname, Ssex, Sage) <span class="kw">VALUES</span> (<span class="st">&#39;S14&#39;</span>, <span class="st">&#39;Tom&#39;</span>, <span class="st">&#39;M&#39;</span>);</span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> S(Sno, Sname, Ssex) <span class="kw">VALUES</span> (<span class="st">&#39;S14&#39;</span>, <span class="st">&#39;Tom&#39;</span>, <span class="st">&#39;M&#39;</span>);</span></code></pre></div></li><li><p>插入子查询结果：</p><p>例：计算每门课的平均分，存入如下数据库表中</p><div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> AvgGrade(</span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>   Cno <span class="dt">CHAR</span>(<span class="dv">9</span>) <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   grade <span class="dt">INT</span>;</span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>);</span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> AvgGrade</span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">SELECT</span> Cno, <span class="fu">AVG</span>(grade)</span><span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">FROM</span> SC</span><span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>   <span class="kw">GROUP</span> <span class="kw">BY</span> Cno;</span></code></pre></div></li><li><p>修改内容</p><p>语法和示例</p><div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> <span class="op">&lt;</span>表名<span class="op">&gt;</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> <span class="op">&lt;</span>列名1<span class="op">&gt;=&lt;</span>表达式1<span class="op">&gt;</span> [, <span class="op">&lt;</span>列名2<span class="op">&gt;=&lt;</span>表达式2<span class="op">&gt;</span>]…</span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>[<span class="kw">WHERE</span> <span class="op">&lt;</span>条件表达式<span class="op">&gt;</span>];</span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> SC</span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> grade <span class="op">=</span> grade <span class="op">*</span> <span class="fl">1.3</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> Cno <span class="kw">IN</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>   (<span class="kw">SELECT</span> Cno <span class="kw">FROM</span> C <span class="kw">WHERE</span> Cname <span class="op">=</span> <span class="st">&#39;DB&#39;</span>)</span></code></pre></div></li><li><p>删除内容</p><p>语法和示例</p><div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> <span class="op">&lt;</span>表名<span class="op">&gt;</span> [<span class="kw">WHERE</span> <span class="op">&lt;</span>条件表达式<span class="op">&gt;</span>];</span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> SC</span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> Cno <span class="kw">IN</span> (<span class="kw">SELECT</span> Cno <span class="kw">FROM</span> C</span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> Cname<span class="op">=</span><span class="st">&#39;DB&#39;</span>);</span></code></pre></div></li></ol><h2 id="数据库理论知识">数据库理论知识</h2><h3 id="一-数据库的空值">一， 数据库的空值</h3><ol type="1"><li>一般需特殊处理，常用的空值处理方法：NULLIF(p, v) : 若p非空值，返回p，否则返回v</li><li>空值与其它值的算术运算结果为空值，如：NULL+3=NULL</li><li>空值进行比较的结果为UNKNOWN。</li><li>UNKNOWN可进行逻辑运算<ul><li>如：3&gt;NULL的结果不为真也不为假，结果为UNKNOWN</li><li>如：UNKNOWN OR TRUE=TRUE、UNKNOWN AND TRUE=UNKNOWN</li></ul></li></ol><h3 id="二-数据库视图">二， 数据库视图</h3><ol type="1"><li><p>视图</p><p>可以理解成数据库的“窗口”，是一个“虚表”，只能看到视图定义的信息，数据实际存放在基本表中。</p><p>在视图中的增删改相当于对数据的增删改。</p></li><li><p>创建视图：</p><p>语法和示例</p><div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> [<span class="kw">OR</span> <span class="kw">REPLACE</span>] <span class="kw">VIEW</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>视图名<span class="op">&gt;</span> [(<span class="op">&lt;</span>列名1<span class="op">&gt;</span>[, <span class="op">&lt;</span>列名2<span class="op">&gt;</span>]…)]</span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="op">&lt;</span>子查询<span class="op">&gt;</span></span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>[<span class="kw">WITH</span> <span class="kw">CHECK</span> <span class="kw">OPTION</span>]; <span class="co">/* 防止插入非法数据 */</span></span></code></pre></div></li><li><p>删除视图</p><div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">VIEW</span> <span class="op">&lt;</span>视图名<span class="op">&gt;</span> [<span class="kw">CASCADE</span>];</span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">VIEW</span> M_C1 <span class="kw">CASCADE</span> <span class="kw">CONSTRAINT</span>;</span></code></pre></div><ul><li>如选择了CASCADE，则级联删除由该视图导出的其它视图。</li><li>若未选择，则保留由其导出的视图，但这些导出的视图将无法使用，除非重新定义该视图。</li><li>SQL没有提供修改视图的方法，修改需要先删除后创建。</li></ul></li><li><p>在视图中查询和更新：与基本表的查询和更新相同</p><ul><li><p>目前多数DBMS对行列子集视图的查询能够进行正确转换，但对非行列子集视图的查询不一定能够转换</p></li><li><p>一些的视图是不可更新的，因为对这些视图的更新不能唯一地、有意义地转换成对相应基本表的更新</p></li></ul></li><li><p>视图种类：</p><ol type="1"><li>行列子集视图</li></ol><div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>M_S(Sno, Sname, Ssex, Sage)</span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="kw">SELECT</span> Sno, Sname, Ssex, Sage</span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> S</span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> Ssex<span class="op">=</span><span class="st">&#39;M&#39;</span></span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> <span class="kw">CHECK</span> <span class="kw">OPTION</span>;</span></code></pre></div><ol start="2" type="1"><li>基于多表的视图</li></ol><div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>M_C1</span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="kw">SELECT</span> S.Sno, Sname, grade</span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> S, SC</span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> S.Sno<span class="op">=</span>SC.Sno <span class="kw">AND</span></span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>S.Ssex<span class="op">=</span><span class="st">&#39;M&#39;</span> <span class="kw">AND</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>SC.Cno<span class="op">=</span><span class="st">&#39;C1&#39;</span>;</span></code></pre></div><ol start="3" type="1"><li>基于视图的视图</li></ol><div class="sourceCode" id="cb19"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span> M_C1_A</span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="kw">SELECT</span> Sno, Sname, grade</span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> M_C1</span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> grade<span class="op">&gt;=</span><span class="dv">90</span>;</span></code></pre></div><ol start="4" type="1"><li>带表达式的视图</li></ol><div class="sourceCode" id="cb20"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Birth_S</span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="kw">SELECT</span> Sno, Sname, Ssex, <span class="dv">2021</span><span class="op">-</span>Sage Sbirth</span><span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> S;</span></code></pre></div><ol start="5" type="1"><li>分组视图</li></ol><div class="sourceCode" id="cb21"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span></span><span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>S_G(Sno, Gavg)</span><span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span> <span class="kw">SELECT</span> Sno, <span class="fu">AVG</span>(grade)</span><span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> SC</span><span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> Sno</span><span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Sno <span class="kw">ASC</span>;</span></code></pre></div></li><li><p>为什么需要视图？</p><ol type="1"><li><p>简化查询操作，一次定义，多次使用。</p></li><li><p>分别满足不同用户的需求，使不同用户从不同角度看待同一数据</p></li><li><p>提供逻辑独立性</p></li></ol><p>数据库模式对应关系：模式 <span class="math inline">\(\stackrel{对应}{\rightarrow}\)</span> 表，外模式 <span class="math inline">\(\stackrel{对应}{\rightarrow}\)</span> 视图</p><p>应用程序使用外模式访问数据库。如果改变了表，那么只需改变模式与外模式的映射，这样应用程序就不用发生改变。</p><ol start="4" type="1"><li><p>对机密数据提供安全保护</p></li><li><p>适当利用视图可以更清晰地表达查询</p></li></ol></li></ol><h3 id="三触发器">三，触发器</h3><ol type="1"><li><p>触发器：一种<strong>完整性控制</strong>机制</p></li><li><p>定义触发器：不同数据库略有不同</p></li><li><p>应用：对外码的修改</p><p>举例：在表T上定义触发器，如修改教师工号，则级联修改C表中的教师工号。</p><div class="sourceCode" id="cb22"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">TRIGGER</span> t1</span><span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">AFTER</span> <span class="co">-- 触发时机</span></span><span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> <span class="kw">OF</span> Tno <span class="kw">ON</span> T <span class="co">-- 触发事件</span></span><span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="co">-- 触发器类型：行级触发器</span></span><span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span> <span class="co">-- 触发器执行的动作</span></span><span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">UPDATE</span> C <span class="kw">SET</span> Tno<span class="op">=</span><span class="ch">:NEW</span>.Tno</span><span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">WHERE</span> Tno<span class="op">=</span><span class="ch">:OLD</span>.Tno</span><span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span></code></pre></div><p>注释：</p><ul><li><p>Before：触发事件执行之前调用触发器。</p></li><li><p>After：触发事件执行之后调用触发器。</p></li><li><p>NEW：数据类型是RECORD。对于行级触发器，它存有INSERT或UPDATE操作产生的新的数据行。对于语句级触发器，它的值是NULL。</p></li><li><p>OLD：数据类型是RECORD。对于行级触发器，它存有被UPDATE或DELETE操作修改或删除的旧的数据行。对于语句级触发器，它的值是NULL。</p></li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 课程实践 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训6.x实验</title>
      <link href="/2021/11/03/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD6.x/"/>
      <url>/2021/11/03/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD6.x/</url>
      
        <content type="html"><![CDATA[<h1 id="实训地址">实训地址</h1><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h1 id="实训6.1块设备访问">实训6.1：块设备访问</h1><h2 id="第一关文件的读取过程分析">第一关：文件的读取过程分析</h2><h3 id="实验方法">实验方法</h3><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/2.tgz ~/os/</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../2.tgz</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 2 cur</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span></code></pre></div><div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_read</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 然后回到bochs，按下Enter键</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> buf</span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 此时找到用户缓冲区地址</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> bread</span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> add_request</span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>req</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>dev</span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> hd_out</span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> read_intr</span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="ex">x/8bx</span> 0x3fcc00</span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="ex">x/8bx</span> 0x3fcc00</span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> wake_up</span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 6</span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 5</span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 4</span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> schedule</span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[next]-<span class="op">&gt;</span>pid</span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> c</span></code></pre></div><h3 id="本关答案">本关答案</h3><div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> sys_read 的参数中记录的用户缓冲区地址（段内偏移）是多少？<span class="er">(</span><span class="ex">0x254fb</span><span class="kw">)</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数</span> bread 的参数中记录的硬盘数据块号是多少？<span class="er">(</span><span class="ex">4743</span><span class="kw">)</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.函数</span> add_request 执行时，硬盘请求队列头指针的值是多少？所添加请求的扇区号、扇区数、和对应系统缓冲区的地址分别是多少？<span class="er">(</span><span class="ex">0x0</span><span class="kw">)(</span><span class="ex">9486</span><span class="kw">)(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">0x3fcc00</span><span class="kw">)</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.函数</span> hd_out 的参数中记录的硬盘柱面号、磁头号、扇区号分别是多少？<span class="er">(</span><span class="ex">237</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">7</span><span class="kw">)</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.硬盘读中断处理函数</span> read_intr 第一次开始执行时，上述系统缓冲区的头 8 个字节是什么？<span class="er">(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.在该函数读取了硬盘控制器的数据后，该系统缓冲区的头</span> 8 个字节是什么？<span class="er">(</span><span class="ex">0x23</span><span class="kw">)(</span><span class="ex">0x69</span><span class="kw">)(</span><span class="ex">0x6e</span><span class="kw">)(</span><span class="ex">0x63</span><span class="kw">)(</span><span class="ex">0x6c</span><span class="kw">)(</span><span class="ex">0x75</span><span class="kw">)(</span><span class="ex">0x64</span><span class="kw">)(</span><span class="ex">0x65</span><span class="kw">)</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.1</span> 号进程被唤醒时，是在几号进程？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8.1</span> 号进程后来被调度程序重新选中时，它的剩余时间片是多少？<span class="er">(</span><span class="ex">13</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关第一次读硬盘的过程分析">第二关：第一次读硬盘的过程分析</h2><h3 id="实验方法-1">实验方法</h3><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> bread</span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> add_request</span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>dev</span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>req</span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> hd_out</span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> read_intr</span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="ex">x/8bx</span> 0x3ffc00</span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 260</span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 5</span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 4</span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="ex">x/8bx</span> 0x3ffc00</span></code></pre></div><h3 id="本关答案-1">本关答案</h3><div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.bochs</span> 虚拟机的硬盘镜像文件的头8个字节是什么？<span class="er">(</span><span class="ex">eb</span><span class="kw">)(</span><span class="ex">3c</span><span class="kw">)(</span><span class="ex">90</span><span class="kw">)(</span><span class="ex">4d</span><span class="kw">)(</span><span class="ex">53</span><span class="kw">)(</span><span class="ex">44</span><span class="kw">)(</span><span class="ex">4f</span><span class="kw">)(</span><span class="ex">53</span><span class="kw">)</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数</span> bread 的参数中记录的硬盘数据块号是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.函数</span> add_request 执行时，硬盘请求队列头指针的值是多少？<span class="er">(</span><span class="ex">0x0</span><span class="kw">)</span><span class="ex">所添加请求的扇区号、扇区数、和对应系统缓冲区的地址分别是多少？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">0x3ffc00</span><span class="kw">)</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.函数</span> hd_out 的参数中记录的硬盘柱面号、磁头号、扇区号分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.硬盘读中断处理函数</span> read_intr 第一次开始执行时，上述系统缓冲区的头 8 个字节是什么？<span class="er">(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.在该函数读取了硬盘控制器的数据后，该系统缓冲区的头</span> 8 个字节是什么？<span class="er">(</span><span class="ex">0xeb</span><span class="kw">)(</span><span class="ex">0x3c</span><span class="kw">)(</span><span class="ex">0x90</span><span class="kw">)(</span><span class="ex">0x4d</span><span class="kw">)(</span><span class="ex">0x53</span><span class="kw">)(</span><span class="ex">0x44</span><span class="kw">)(</span><span class="ex">0x4f</span><span class="kw">)(</span><span class="ex">0x53</span><span class="kw">)</span></span></code></pre></div><h2 id="第三关编写一个显示文件内容的程序">第三关：编写一个显示文件内容的程序</h2><h3 id="实验方法-2">实验方法</h3><p>编写如图所示的代码，将代码放入虚拟机中，按要求在/etc/rc中添加一行文字<code>/usr/root/a.out</code>（a.out处是可执行文件的名字），如果编译时指定了文件名，就是指定的可执行文件名。代码之外的其它操作见<a href="https://redleaves699.github.io/2021/10/07/Educoder%20操作系统实训4.x/#第三关：可执行文件的执行">这里</a>。</p><p>修改得到的<code>/etc/rc</code>文件为</p><div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/update</span> <span class="kw">&amp;</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;/dev/hd0 /&quot;</span> <span class="op">&gt;</span> /etc/mtab</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Ok. &quot;</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/root/a.out</span></span></code></pre></div><p>mycat代码为</p><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fcntl.h&gt;</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MSG_LEN 80</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define FILE_FROM &quot;/usr/root/hello.c&quot;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define FILE_TO &quot;/usr/root/hello-new.c&quot;</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> msg<span class="op">[</span>MSG_LEN <span class="op">+</span> <span class="dv">10</span><span class="op">];</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd<span class="op">,</span> num<span class="op">;</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n\r</span><span class="st">Hi, press ENTER to continue...</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    read<span class="op">(</span><span class="dv">0</span><span class="op">,</span> msg<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>fd <span class="op">=</span> open<span class="op">(</span>FILE_FROM<span class="op">,</span> O_RDONLY<span class="op">,</span> <span class="dv">0</span><span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Open file error.</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>num <span class="op">=</span> read<span class="op">(</span>fd<span class="op">,</span> msg<span class="op">,</span> MSG_LEN<span class="op">))</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;Read file error.</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    msg<span class="op">[</span>num<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Content of file </span><span class="sc">\&quot;</span><span class="st">%s</span><span class="sc">\&quot;</span><span class="st">:</span><span class="sc">\n\r</span><span class="st">---</span><span class="sc">\n\r</span><span class="st">%s---</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">,</span> FILE_TO<span class="op">,</span> msg<span class="op">);</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="本关答案-2">本关答案</h3><div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">答案正确</span></span></code></pre></div><h2 id="第四关版本-0-内核中文件的读取过程分析">第四关：版本 0 内核中文件的读取过程分析</h2><h3 id="实验方法-3">实验方法</h3><p>本关操作建立在第三关的基础上。</p><div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_execve</span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 2</span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code + filename</span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 此时发现正要执行的程序是/usr/root/a.out</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_read</span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 执行continue调试命令后，sys_read读入a.out</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 再次执行continue调试命令</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> buf</span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> add_request</span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>req</span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> dev-<span class="op">&gt;</span>current_request</span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> req-<span class="op">&gt;</span>sector</span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> req-<span class="op">&gt;</span>nr_sectors</span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> req-<span class="op">&gt;</span>buffer</span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> wake_up</span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 4</span><span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> schedule</span><span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span><span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> c</span></code></pre></div><h3 id="本关答案-3">本关答案</h3><div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> sys_read 的参数中记录的用户缓冲区地址（段内偏移）是多少？<span class="er">(</span><span class="ex">0x3fffebc</span><span class="kw">)</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数add_request执行时，硬盘请求队列头指针的值是多少？</span><span class="er">(</span><span class="ex">0x0</span><span class="kw">)</span><span class="ex">所添加请求的扇区号、扇区数、和对应系统缓冲区的地址分别是多少？</span><span class="er">(</span><span class="ex">9486</span><span class="kw">)(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">0x3c8800</span><span class="kw">)</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.该进程被唤醒时，是在几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.该进程后来被调度程序重新选中时，它的剩余时间片是多少？</span><span class="er">(</span><span class="ex">15</span><span class="kw">)</span></span></code></pre></div><h1 id="实训6.2对字符设备的访问">实训6.2：对字符设备的访问</h1><h2 id="第一关键盘的读取过程分析不是自己做的">第一关：键盘的读取过程分析(不是自己做的)</h2><h2 id="实验方法-4">实验方法</h2><div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_read</span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> tty_read</span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">x/3i</span> keyboard_interrupt</span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x16d1d</span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># (在虚拟机里enter一下)</span></span><span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_tty_interrupt</span><span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code  + buf</span><span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> wake_up</span><span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code  + buf</span><span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> tty_io.c:288</span><span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="ex">x/2bx</span> 0x40254fb</span></code></pre></div><h2 id="本关答案-4">本关答案</h2><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> sys_read 的参数中记录的用户缓冲区地址（段内偏移）是多少？<span class="er">(</span><span class="ex">0x254fb</span><span class="kw">)</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数</span> tty_read 开始运行时，0 号终端的 read_q 队列的头指针（数组下标）和尾指针分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.键盘中断处理程序开始运行时，0</span> 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.函数</span> do_tty_interrupt 开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;\r&quot;</span><span class="kw">)</span><span class="ex">0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.函数</span> wake_up 开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span> </span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;\n&quot;</span><span class="kw">)</span></span><span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8.函数</span> tty_read 结束时，0 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">用户缓冲区的头</span> 2 个字节是什么？<span class="er">(</span><span class="ex">0x0a</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span><span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">注：答案需要使用引号的地方全部使用英文双引号！！！</span></span></code></pre></div><h2 id="第二关从键盘的一行数据中读取一个字符不是自己做的">第二关：从键盘的一行数据中读取一个字符(不是自己做的)</h2><h2 id="实验方法-5">实验方法</h2><div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> tty_read</span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_tty_interrupt</span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (在虚拟机输入abc然后enter，虚拟机不会显示，直接回到gdb继续调试)</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> wake_up</span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].read_q</span><span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> tty_io.c:288</span><span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code + buf</span><span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="ex">x/2bx</span> 0x40254fb</span></code></pre></div><h2 id="本关答案-5">本关答案</h2><div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.函数</span> tty_read 开始运行时，0 号终端的 read_q 队列的头指针（数组下标）和尾指针分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.函数</span> do_tty_interrupt 第一次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;a&quot;</span><span class="kw">)</span></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.函数</span> wake_up 第一次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;a&quot;</span><span class="kw">)</span></span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.函数</span> do_tty_interrupt 第三次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;b&quot;</span><span class="kw">)</span></span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">1</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.函数</span> wake_up 第三次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">2</span><span class="kw">)</span><span class="ex">0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">2</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;ab&quot;</span><span class="kw">)</span></span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8.函数</span> do_tty_interrupt 第七次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">4</span><span class="kw">)(</span><span class="ex">3</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;\r&quot;</span><span class="kw">)</span><span class="ex">0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">3</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9.函数</span> wake_up 第七次开始运行时，0 号终端的 read_q 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">4</span><span class="kw">)(</span><span class="ex">4</span><span class="kw">)</span> <span class="ex">0</span> 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">4</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;abc\n&quot;</span><span class="kw">)</span><span class="ex">该队列里目前有多少行？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span></span><span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10.函数</span> tty_read 结束时，0 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">4</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">该队列中的未读取字符串是什么？</span><span class="er">(</span><span class="st">&quot;bc\n&quot;</span><span class="kw">)</span><span class="ex">用户缓冲区的头</span> 2 个字节是什么？<span class="er">(</span><span class="ex">0x61</span><span class="kw">)(</span><span class="ex">0x00</span><span class="kw">)</span></span></code></pre></div><h2 id="第三关观察从键盘输入的口令不是自己做的">第三关：观察从键盘输入的口令(不是自己做的)</h2><h2 id="实验方法-6">实验方法</h2><div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_execve</span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (在虚拟机中输入passwd,enter后回到gdb)</span></span><span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> tty_read</span><span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span><span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_io.c:288</span><span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># (在虚拟机中输入secret，enter后回到gdb)</span></span><span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> tty_table[0].secondary</span></code></pre></div><h2 id="本关答案-6">本关答案</h2><div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.程序</span> passwd 会在几号进程中执行？<span class="er">(</span><span class="ex">6</span><span class="kw">)</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.上述进程第一次开始执行函数</span> tty_read 时，0 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">7</span><span class="kw">)(</span><span class="ex">7</span><span class="kw">)</span><span class="ex">该队列的</span> buf 数组中记录的字符串是什么？<span class="er">(</span><span class="st">&quot;passwd\n&quot;</span><span class="kw">)</span></span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.上述进程第一次执行完函数</span> tty_read 时，0 号终端的 secondary 队列的头指针和尾指针分别是多少？<span class="er">(</span><span class="ex">14</span><span class="kw">)(</span><span class="ex">14</span><span class="kw">)</span><span class="ex">该队列的</span> buf 数组中记录的字符串是什么？<span class="er">(</span><span class="st">&quot;passwd\nsecret\n&quot;</span><span class="kw">)</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决GitHub资源访问问题</title>
      <link href="/2021/11/02/Git/GitHub%20resource/"/>
      <url>/2021/11/02/Git/GitHub%20resource/</url>
      
        <content type="html"><![CDATA[<h2 id="问题访问github速度很慢">问题：访问GitHub速度很慢</h2><p>平时，访问GitHub非常不稳定，访问速度忽快忽慢，有时还打不开。从GitHub上下载文件也很让人头痛。</p><h2 id="解决方法一关闭计算机代理">解决方法一：关闭计算机代理</h2><p>Windows10系统默认开启网页代理选项，这样会加快国内网站的访问速度。但是，这个代理会影响国外网站的解析。所以要提升访问GitHub的速度，就要关闭它。</p><p>关闭方法：Win10设置 -&gt; 网络和Internet -&gt; 代理，将自动设置代理选项的自动检测设置开关关闭。</p><h2 id="解决方法二使用cdn加速">解决方法二：使用CDN加速</h2><p>在网页按如下格式输入网址，可以使用CDN加速，这样访问仓库里的文件就会快一些</p><pre class="url"><code>https://cdn.jsdelivr.net/gh/&#123;你的github用户名&#125;/&#123;仓库名称&#125;/&#123;仓库具体路径&#125;</code></pre><p>这是我存在GitHub仓库里的一张图片，可以正常打开</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Source%20license.jpeg" alt="Source license" /></p><p>以下是一个生成CDN加速链接的Python脚本：</p><p>使用时，新建一个名为CDN的目录，与.git放在同一目录，并添加到.gitignore中</p><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_dir(dirs):</span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> []</span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dirr <span class="kw">in</span> os.listdir(dirs):</span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        dirr <span class="op">=</span> os.path.join(dirs, dirr)</span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (os.path.isfile(dirr)) :</span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            L.append(dirr)</span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> :</span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            L <span class="op">+=</span> list_dir(dirr)</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L</span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_all_file(dirs):</span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> []</span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dirr <span class="kw">in</span> os.listdir(dirs) :</span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        dirr <span class="op">=</span> os.path.join(dirs, dirr)</span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (os.path.isdir(dirr)) :</span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            L <span class="op">+=</span> list_dir(dirr)</span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            L.append(dirr)</span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L</span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> str_replace(string, L):</span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(L)) :</span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        L[i] <span class="op">=</span> L[i].replace(string, <span class="st">&quot;&quot;</span>)</span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        L[i] <span class="op">=</span> L[i].replace(<span class="st">&#39; &#39;</span>, <span class="st">&quot;%20&quot;</span>)</span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        L[i] <span class="op">=</span> L[i].replace(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">&#39;</span>, <span class="st">&#39;/&#39;</span>)</span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (L[i][<span class="dv">0</span>] <span class="op">==</span> <span class="st">&#39;/&#39;</span>):</span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            L[i] <span class="op">=</span> L[i][<span class="dv">1</span> : <span class="bu">len</span>(L[i]) : <span class="dv">1</span>]</span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L</span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transURL(info):</span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> url[url.find(info[<span class="st">&#39;repodir&#39;</span>]) : ]</span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp.replace(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="st">&quot;&quot;</span>)</span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp.replace(<span class="st">&#39; &#39;</span>, <span class="st">&quot;%20&quot;</span>)</span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> info[<span class="st">&#39;cdn_url&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;GitHubusr&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;Repo&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> tmp</span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> writefilelist(info, imagefile):</span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;pic.log&quot;</span>, <span class="st">&quot;w&quot;</span>) <span class="im">as</span> f:</span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> image_name <span class="kw">in</span> imagefile:</span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            f.write(info[<span class="st">&#39;cdn_url&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;GitHubusr&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;Repo&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;repodir&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> image_name <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> writefilelistasHtml(info, imagefile):</span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;pic.html&quot;</span>, <span class="st">&quot;w&quot;</span>) <span class="im">as</span> f:</span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> image_name <span class="kw">in</span> imagefile:</span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="st">&#39;&lt;img src = </span><span class="ch">\&quot;</span><span class="st">&#39;</span> <span class="op">+</span> <span class="op">\</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                info[<span class="st">&#39;cdn_url&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;GitHubusr&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;Repo&#39;</span>] <span class="op">+</span> <span class="op">\</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;/&#39;</span> <span class="op">+</span> info[<span class="st">&#39;repodir&#39;</span>] <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> image_name <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span> <span class="op">+</span> <span class="st">&#39;width = 120 height = 120&#39;</span> <span class="op">+</span><span class="st">&#39;/&gt;&#39;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_info():</span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;settings.json&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> s:</span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        dict_json <span class="op">=</span> json.loads(s.read())</span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        s.close()</span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> dict_json</span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> helps():</span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;----------------------------------------&quot;</span>)</span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Welcome to GitHub image CDN transformer:</span><span class="ch">\n</span><span class="st">Choose:&quot;</span>)</span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;    1. transform GitHub url to CDN url then CONTINUE</span><span class="ch">\n</span><span class="st">    2. tranform GitHub url in a dir then EXIT</span><span class="ch">\n</span><span class="st">    3. tranform GitHub url in html</span><span class="ch">\n</span><span class="st">Other. exit&quot;</span>)</span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;----------------------------------------&quot;</span>)</span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span> :</span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    helps()</span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> read_info()</span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    pic_ <span class="op">=</span> os.path.join(os.path.abspath(os.path.dirname(os.getcwd())), info[<span class="st">&#39;imagefile&#39;</span>])</span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="va">True</span>) :</span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;Please input command : &#39;</span>)</span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> a <span class="op">==</span> <span class="st">&#39;1&#39;</span> :</span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                url <span class="op">=</span> <span class="bu">input</span>(<span class="st">&#39;input url : &#39;</span>)</span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(transURL(info))</span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> a <span class="op">==</span> <span class="st">&#39;2&#39;</span> :</span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>                writefilelist(info, str_replace(pic_, list_all_file(pic_)))</span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> a <span class="op">==</span> <span class="st">&#39;3&#39;</span> :</span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>                writefilelistasHtml(info, str_replace(pic_, list_all_file(pic_)))</span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&#39;Finished!&#39;</span>)</span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&#39;Finished!&#39;</span>)</span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>            helps()</span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">EOFError</span> :</span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Bye~&quot;</span>)</span></code></pre></div><h2 id="解决方法三使用镜像站">解决方法三：使用镜像站</h2><p>在此推荐一个镜像站</p><p><a href="https://hub.連接.台灣">GitHub台灣</a>：https://hub.連接.台灣</p><h2 id="解决方法四更改主机host文件">解决方法四：更改主机Host文件</h2><p>修改C:，根据域名得到实时有效的ip地址，并改到hosts文件中，本方法现在作用不大，所以放在最后。</p>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android项目的阅读 - UI（总第二篇）</title>
      <link href="/2021/10/28/Android/Android%20UI%E8%AE%BE%E8%AE%A1/"/>
      <url>/2021/10/28/Android/Android%20UI%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="ui设计">1. UI设计</h1><h2 id="fragment与fragment管理器的简介">1.1 fragment与fragment管理器的简介</h2><p>fragment是一种<strong>控制器对象</strong>，activity可以委派它完成一些任务。这些任务通常就是管理用户界面。受管理的用户界面可以是整屏或整屏的一部分。</p><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->&lt;!DOCTYPE html&gt;<html><head><title>blog drawer</title><meta charset="utf-8"/></head><body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2021-10-28T15:37:29.706Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/15.4.0 Chrome/91.0.4472.164 Electron/13.5.0 Safari/537.36\&quot; etag=\&quot;H2XLTjLyDGW3-ZPlysxt\&quot; version=\&quot;15.4.0\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;8VTii5JQyqyGZYSvtrSO\&quot; name=\&quot;第 1 页\&quot;&gt;7VdNc5swEP01e3THfBjDEWycdqY5ZDKeNr0pIINagRhZjk1+fRcQxhTbTWfcOM30BPt2Vx/v7UoA1izb3UhSpLciphzMcbwDaw6maYxNGx8VUjbIxDMbIJEs1kEdcM+eaZup0Q2L6boXqITgihV9MBJ5TiPVw4iUYtsPWwnen7UgCR0A9xHhQ/QLi1XaoK457fCPlCVpO7PheI0nI22w3sk6JbHYHkBWCNZMCqGat2w3o7wir+WlyVuc8O4XJmmuXpJQGN/uFnerkX/7vFyGN8uRM38cGZZenCrbHdMYCdCmkCoVicgJDzs0kGKTx7QadoxWF/NZiAJBA8HvVKlSq0k2SiCUqoxrL90x9bVK/zDR1sOBZ77TI9dGqY1mndXiTu5fQ2uxkRE9t+m2kIhMqDoXaO51wgKnIqNKlpgoKSeKPfVXQnSlJfu4Tgx80Xr8iTZ64CfCN3oqEuG0TJUD0fqSbFOm6H1Baha22Jh9+vWwVCq6O0/mcOs6wbJ0Veu23lf5tmsST0PpQX+0aZcny/lXChkZluVBUmU+HPq6tNr6Gw1gvrQBJldtAHPQACtJkqza71trAGt87QawB2RBOAF/Cp4NoQOBDUE4oA0JUH1u1kqKH3QmuJCI5CKvGmXFOP8FIpwlOZoREkYRDyo6GV6cvnZkLI7rLjsmRl+uS+jh2v0DyRnq4byqHpOBHstPEKIcE3BnEHrgzcE3314hu9cu5OmRQp6CH4Jv1PyNwR0e9u+2kC372oXsHtFjAcEMPH//PVLp4gMuHY+cwAXXql8MwGLCs8dzwJ1CiCdQAME71s42f/9VZJivKp53Wrz9XfpfvGPiHbvRDesy4qHZ/fjVvoPfZyv8CQ==&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div><script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script></body></html><p>管理用户界面的fragment又称为UI fragment。它自己也有产生于布局文件的视图，fragment的视图包含了用户可以交互的可视化UI元素。</p><p>activity视图可预留供fragment视图插入的位置，如果有多个fragment要插入，activity可提供多个位置。</p><!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->&lt;!DOCTYPE html&gt;<html><head><title>blog drawer</title><meta charset="utf-8"/></head><body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2021-10-28T15:17:16.831Z\&quot; agent=\&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/15.4.0 Chrome/91.0.4472.164 Electron/13.5.0 Safari/537.36\&quot; etag=\&quot;2OXMoMwM14fjRU-aTrIf\&quot; version=\&quot;15.4.0\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;8VTii5JQyqyGZYSvtrSO\&quot; name=\&quot;第 1 页\&quot;&gt;zVZLc6MwDP41OqbDG3PECeleOtNOp7OPmwsOeJbgjHGapL9+bTAQIG232+7OnkCfJVnSJ9kGd7k9XguyK254RktwrOwI7gocx7YcT300cmoRP3JaIBcsM0oDcM+eaWdp0D3LaD1SlJyXku3GYMqriqZyhBEh+GGstuHleNcdyekMuE9JOUe/skwWLYqccMC/UJYX3c52ELUrW9Ipm0zqgmT8cAa5CbhLwbls/7bHJS118bq6tHbrF1b7wASt5O8Y7Owfd+u7zSK+eX54SK4fFsHqcWHIeCLl3iRsgpWnrgKC76uMaicWuPhQMEnvdyTVqwfFucIKuS2VZKtf444KSY8vxmn32au2oXxLpTgpFWPgeKZgpmMcy8iHof5uaLDivPbIgMRwnve+h7KoH1OZd1TJnVcp8QEhiEJIEMQ2xGgjSL7VKSYhRDEgr1kJAQVaN8KAE0jWgJeAlo2Op4wgCbQbHDb+1hCvIfEAY4h9rYMcwFGzFGpQLyFAq8ah1flp95qGA0mkf3D0MT4zJtRUMV4pueZ7Xf9P4difcGzPObatSxwHf4vj4ALHAUSq3okusyo/Cj7K8ZzRlshzq2bDviGioIkiAGz1mw5R9K3SBIqbQGMFxq/1wyyr/7JD3ODtDulPin/TIejts5JWWawvHSWlJalrlo6LNa4szdRVY4y5kAXPeUXKZECxKpY4fdPqV57fyd+VvLCuLAt1yOrYeWyk07l0SwVT+VNhwDZmvfXrzKh7loicyrcujzmDgpZEsqex/0tsGNNbztTOPfOeFY6Yt/0JoarLREqN1fmFN3U0OWT6A6Vz1CY4c9Q0R5/Pn/dL17FnDUPUpDwxebpwbkxbSY2OHDcPKVmupyxVRGk6sR4wpp4qsVnYsixr2kbQmj2Tx8aV5nynU2yS9jH4K+1rL3ndPra061oK/pMuecl1m1S80l42rCwn0GcMduiNWXHng40uzLXz/rFW4vC8alkdHqlu8gs=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;}"></div><script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script></body></html><p>根据用户需求，可联合使用fragment和activity来组装用户界面。 利用fragment，可轻松实现选择不同的列表项就显示对应的明细视图的操作。activity负责以一个明细fragment替换另一个明细fragment，如图7-3所示。这样，视图切换的过程中，也不用销毁activity了。</p><p>除列表明细类应用外，使用UI fragment将应用的UI分解成构建块，还适用于其他类型的应用。例如，利用单个构建块，可以方便地构建分页界面、动画侧边栏界面等更多定制界面。</p><p>不过，UI设计得这样灵活也是要付出代价的，即更复杂的应用、更多的部件以及大量的实现代码。</p><h2 id="fragment功能概览">1.2 fragment功能概览</h2><p>fragment<strong>不具有在屏幕上显示视图的能力</strong>。因此，只有将它的视图放在activity的视图层结构中，fragment视图才能显示在屏幕上。</p><p>下图是《Android编程权威指南》的一个名为CrimeIntent的项目。</p><p>下面第一张图体现了“CrimeActivity托管CrimeFragment”的关系。</p><p>从图中可以看到，灰色区域是fragment类的一个实例CrimeFragment的<strong>控制范围</strong>（fragment不能靠自己直接显示界面，要在类内部使用view类），实例中调用了fragment_crime.xml资源，使得灰色区域中的那个白色的方框能够按格式显示。白色方框中有两个组件，EditText（可编辑的文字模块）和Checkbox（可选方框）。onTextChanged()是监听输入的方法，如果有EditText组件有输入，则告诉fragment现在有输入。同理，如果Checkbox组件被勾选，onCheckedChanged()负责告知fragment组件被勾选的消息。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-crimeintent0.11.png" alt="CrimeIntent CrimeActivity托管着CrimeFragment" /></p><p>第二张图体现了这些类之间的关系。箭头指向的，是一个类管理的其他类或资源。以CrimeActivity类为例，它需要管理CrimeFragment类和FrameLayout视图资源。CrimeFragment则管理3个视图资源Button（按钮），Checkbox，和EditText。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-crimeintent0.1.png" alt="CrimeIntent 对象之间的关系" /></p><blockquote><p>CrimeActivity视图由FrameLayout组件组成，FrameLayout组件为CrimeFragment视图安排了显示位置。 CrimeFragment视图由一个LinearLayout组件及其三个子视图组成。这三个子视图包括一个EditText组件、一个Button组件和一个CheckBox组件。CrimeFragment类中有存储它们的成员变量，并设有监听器，会响应用户操作时，更新模型层数据。</p></blockquote><h2 id="fragment的托管功能">1.3 fragment的托管功能</h2><p>为托管UI fragment，activity必须做到：</p><ul><li>在布局中为fragment的视图安排位置</li><li>管理fragment实例的生命周期</li></ul><h3 id="fragment的生命周期">1.3.1 fragment的生命周期</h3><p>下图展示了fragment的生命周期。类似于activity的生命周期，它具有停止、暂停以及运行状态，也拥有可以覆盖的<strong>生命周期方法</strong>，用来在关键节点完成一些任务。可以看到，许多方法对应着activity的生命周期方法，如onCreate(Bundle)。 这种对应非常重要。因为fragment代表activity工作，所以它的状态应该反映activity的状态。显然，fragment需要相对应的生命周期方法来处理activity的工作。 fragment生命周期与activity生命周期的一个关键区别就在于，fragment的生命周期方法由托管activity而不是操作系统调用。操作系统不关心activity用来管理视图的fragment。fragment的使用是activity内部的事情。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/fragment_lifetime.svg" alt="activity管理的fragment的生命周期" /></p><h3 id="fragment托管的两种方式">1.3.2 fragment托管的两种方式</h3><p>activity托管UI fragment有如下两种方式：</p><ul><li>在activity布局中添加fragment</li><li>在activity代码中添加fragment</li></ul><p>第一种方法就是使用布局fragment，这种方式不够灵活，第二种方式比较复杂，但可以在运行时控制fragment。何时添加fragment以及随后可以完成何种具体任务由你自己定；你也可以移除fragment，或用其他fragment代替当前fragment，然后重新添加已移除的fragment。</p><h2 id="创建ui-fragment">1.4 创建UI fragment</h2><p>创建UI fragment的步骤与创建activity的步骤相同：</p><ul><li>定义用户界面布局文件；</li><li>创建fragment类并设置其视图为定义的布局；</li><li>编写代码，组装在布局文件中实例化的组件；</li></ul><p>下面主要学习代码的编写，下面是一段示例代码</p><div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeFragment <span class="kw">extends</span> Fragment <span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Crime mCrime<span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        mCrime <span class="op">=</span> <span class="kw">new</span> <span class="fu">Crime</span><span class="op">();</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>以上实现代码中，有以下几点值得一说。</p><ul><li><p>首先，Fragment.onCreate(Bundle)是<strong>公共方法</strong>，而Activity.onCreate(Bundle)是<strong>受保护方法</strong>。Fragment.onCreate(Bundle)方法及其他<strong>Fragment生命周期方法必须是公共方法</strong>，因为托管fragment的activity要调用它们。</p></li><li><p>其次，类似于activity，<strong>fragment同样具有保存及获取状态的bundle</strong>。如同使用Activity.onSaveInstanceState(Bundle)方法那样，你也可以根据需要覆盖-Fragment.onSaveInstanceState(Bundle)方法。</p></li><li><p>另外，fragment的视图并没有在Fragment.onCreate(Bundle)方法中生成。虽然我们在该方 法中配置了fragment实例，但<strong>创建和配置fragment视图是另一个Fragment生命周期方法完成的</strong>：</p></li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span>Bundle savedInstanceState<span class="op">)</span></span></code></pre></div><p>该方法实例化fragment视图的布局， 然后将<strong>实例化的View 返回</strong>给托管activity 。<strong>LayoutInflater</strong>及<strong>ViewGroup</strong>是<strong>实例化布局的必要参数</strong>。Bundle用来存储恢复数据，可供该方法从保存状态下重建视图。</p><p>下面添加onCreateView(...)方法的实现代码，从fragment_crime.xml布局中实例化并返回视图.</p><div class="sourceCode" id="cb3"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeFragment <span class="kw">extends</span> Fragment <span class="op">&#123;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Crime mCrime<span class="op">;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        mCrime <span class="op">=</span> <span class="kw">new</span> <span class="fu">Crime</span><span class="op">();</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                             Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> v <span class="op">=</span> inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment_crime</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v<span class="op">;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>在onCreateView(...)方法中，fragment的视图是直接通过<strong>调用LayoutInflater.inflate(...)方法</strong>并传入布局的资源ID生成的。<strong>第二个参数</strong>是视图的<strong>父视图</strong>，我们通常需要父视图来正确配置组件。<strong>第三个参数</strong>告诉布局生成器<strong>是否将生成的视图添加给父视图</strong>。这里，传入了false参数，因为我们将以代码的方式添加视图。</p><p>下面是生成fragment中的EditText、CheckBox和Button组件的代码。它们也是在onCreateView(...)方法里实例化。</p><div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeFragment extents Fragment <span class="op">&#123;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> Crime mCrime<span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> EditText mTitleField<span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                             Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> v <span class="op">=</span> inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment_crime</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        mTitleField <span class="op">=</span> <span class="op">(</span>EditText<span class="op">)</span>v<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">crime_title</span><span class="op">);</span><span class="co">// 这里的代码调用了view类</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        mTitleField<span class="op">.</span><span class="fu">addTextChangedListener</span><span class="op">(</span><span class="kw">new</span> <span class="fu">TextWatcher</span><span class="op">()</span> <span class="op">&#123;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">beforeTextChanged</span><span class="op">(</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                <span class="bu">CharSequence</span> s<span class="op">,</span> <span class="dt">int</span> start<span class="op">,</span> <span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> after<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                <span class="co">// This space intentionally left blank</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onTextChanged</span><span class="op">(</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                <span class="bu">CharSequence</span> s<span class="op">,</span> <span class="dt">int</span> start<span class="op">,</span> <span class="dt">int</span> before<span class="op">,</span> <span class="dt">int</span> count<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                mCrime<span class="op">.</span><span class="fu">setTitle</span><span class="op">(</span>s<span class="op">.</span><span class="fu">toString</span><span class="op">());</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">afterTextChanged</span><span class="op">(</span>Editable s<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// This one too</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;);</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v<span class="op">;</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> </span></code></pre></div><p>对比以下调用activity的代码</p><div class="sourceCode" id="cb5"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> QuizActivity <span class="kw">extends</span> AppCompatActivity <span class="op">&#123;</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">...</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_quiz</span><span class="op">);</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        mQuestionTextView <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">question_text_view</span><span class="op">);</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> question <span class="op">=</span> mQuestionBank<span class="op">[</span>mCurrentIndex<span class="op">].</span><span class="fu">getTextResId</span><span class="op">();</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        mQuestionTextView<span class="op">.</span><span class="fu">setText</span><span class="op">(</span>question<span class="op">);</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        mTrueButton <span class="op">=</span> <span class="op">(</span><span class="bu">Button</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">true_button</span><span class="op">);</span> <span class="co">//这里的代码没有调用view类</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">...</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>Fragment.onCreateView(...)方法中的组件引用几乎等同于Activity.onCreate(Bundle)方法的处理。唯一的区别是，你调用了fragment视图的View.findViewById(int)方法。以前使用Activity.findViewById(int)方法十分便利，能够在后台自动调用View.findViewById(int)方法，而Fragment类没有对应的便利方法，因此必须手动调用。</p><p>fragment中监听器方法的设置和activity中完全一样。</p><h2 id="fragmentmanager类">1.5 fragmentManager类</h2><p>FragmentManager类负责管理fragment并将它们的视图添加到activity的视图层级结构中。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-fragmentManager.jpg" alt="fragment 简图" /></p><p>FragmentManager类具体管理：</p><ul><li>fragment队列</li><li>fragment事务回退栈</li></ul><p>要以代码的方式将fragment添加给activity，需要直接调用activity的FragmentManager。首先是获取FragmentManager本身。在CrimeActivity.java中，在onCreate(Bundle)方法中添加代码取得FragmentManager，如下面的代码所示。</p><div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeActivity <span class="kw">extends</span> AppCompatActivity <span class="op">&#123;</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_crime</span><span class="op">);</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        FragmentManager fm <span class="op">=</span> <span class="fu">getSupportFragmentManager</span><span class="op">();</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>如果添完代码遇到错误，记得检查导入语句，看是否已导入支持库版本的FragmentManager类。</p><p>因为使用了支持库及AppCompatActivity类，所以这里调用了getSupportFragmentManager()方法。如果不考虑旧版本的兼容性问题，可直接继承Activity类并调用getFragmentManager()方法。</p><h3 id="fragment-事务">1.5.1 fragment 事务</h3><p>获取FragmentManager之后，再获取一个fragment交给它管理</p><div class="sourceCode" id="cb7"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeActivity <span class="kw">extends</span> AppCompatActivity <span class="op">&#123;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_crime</span><span class="op">);</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        FragmentManager fm <span class="op">=</span> <span class="fu">getSupportFragmentManager</span><span class="op">();</span><span class="co">// 创建FragmentManager</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        Fragment fragment <span class="op">=</span> fm<span class="op">.</span><span class="fu">findFragmentById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">);</span><span class="co">// 使用R.id.fragment_container的容器视图资源ID，向FragmentManager请求并获取fragment。</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fragment <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">&#123;</span><span class="co">// 如果没有获取到需要的fragment，根据当前资源新建一个fragment放入FragmentManager中</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            fragment <span class="op">=</span> <span class="kw">new</span> <span class="fu">CrimeFragment</span><span class="op">();</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            fm<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">()</span><span class="co">// 这段代码创建并提交了一个fragment事务</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">,</span> fragment<span class="op">)</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>fragment事务被用来添加、移除、附加、分离或替换fragment队列中的fragment。这是使用fragment动态组装和重新组装用户界面的关键。FragmentManager管理着fragment队列和事务回退栈。</p><p>FragmentManager.beginTransaction()方法创建并返回FragmentTransaction实例。 FragmentTransaction类支持流接口（fluent interface）的链式方法调用，以此配置FragmentTransaction再返回它。因此，以上灰底代码可解读为：“创建一个新的fragment事务，执行一个fragment添加操作，然后提交该事务。”add(...)方法是整个事务的核心，它有两个参数：容器视图资源ID和新创建的CrimeFragment。</p><p>容器视图资源ID你应该很熟悉了，它是定义在activity_crime.xml中的FrameLayout组件的资源ID。 容器视图资源ID的作用有：</p><ul><li>告诉FragmentManager，fragment视图应该出现在activity视图的什么位置；</li><li>唯一标识FragmentManager队列中的fragment。</li></ul><p>如需从FragmentManager中获取CrimeFragment，使用容器视图资源ID就行了：</p><div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Fragment fragment <span class="op">=</span> fm<span class="op">.</span><span class="fu">findFragmentById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">);</span></span></code></pre></div><p>FragmentManager使用FrameLayout组件的资源ID识别CrimeFragment。如果要向activity添加多个fragment，通常就需要分别为每个fragment创建具有不同ID的不同容器。</p><h4 id="注意fragmentmanager可以在activity销毁时保存fragment队列">注意：FragmentManager可以在activity销毁时保存fragment队列</h4><p>设备旋转或回收内存时，Android系统会销毁CrimeActivity，而后重建时，会调用CrimeActivity.onCreate(Bundle)方法。activity被销毁时，它的FragmentManager会将fragment队列保存下来。这样，activity重建时，新的FragmentManager会首先获取保存的队列，然后重建fragment队列，从而恢复到原来的状态。</p><h3 id="重新审视fragment的生命周期">1.5.2 重新审视fragment的生命周期</h3><p>activity的FragmentManager负责调用队列中fragment的生命周期方法。添加fragment供FragmentManager管理时，onAttach(Context)、onCreate(Bundle)和onCreateView(...)方法会被调用。</p><p>在fragment加入到fragmentManager队列后，onActivityCreated(Bundle)方法会被调用。</p><p>在activity处于运行状态时，添加fragment会发生什么呢？这种情况下，FragmentManager立即驱动fragment，调用一系列必要的生命周期方法，快速跟上activity的步伐（与activity的最新状态保持同步）。例如，向处于运行状态的activity中添加fragment时，以下fragment生命周期方法会被依次调用：onAttach(Context)、onCreate(Bundle)、onCreateView(...)、onActivityCreated(Bundle)、onStart()以及onResume()。</p><p>一旦追上，托管activity的FragmentManager就会边接收操作系统的调用指令，边调用其他生命周期方法，让<strong>fragment与activity的状态取得一致</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/fragment_lifetime_m.svg" alt="fragmentManager管理的fragment生命周期" /></p><h2 id="使用fragment要注意的点">1.6 使用fragment要注意的点</h2><h3 id="less-is-more">1.6.1 Less is more</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-less%20is%20more.jpg" alt="Less is more!" /></p><h3 id="fragment-与支持库">1.6.2 fragment 与支持库</h3><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-appcompatActivity.jpg" alt="fragment和支持库" /></p><p>从图上可以看到，AppCompatActivity是FragmentActivity的子类。《TBNRG》这本书的第二版使用的就是FragmentActivity类。第三版换为AppCompatActivity类。</p><h2 id="使用recyclerview显示列表">1.7 使用RecyclerView显示列表</h2><p>本节将使用RecyclerView显示如图所示的列表</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-crimelist-display.jpg" alt="列表" /></p><p>下图是CriminalIntent应用在本章的整体规划图。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/BNRG-crimelistdesign.jpg" alt="CriminalIntent_listdesign" /></p><h3 id="先构造相应的数据类">1.7.1 先构造相应的数据类</h3><div class="sourceCode" id="cb9"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeLab <span class="op">&#123;</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">static</span> CrimeLab sCrimeLab<span class="op">;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span>Crime<span class="op">&gt;</span> mCrimes<span class="op">;</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> CrimeLab <span class="fu">get</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sCrimeLab <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">&#123;</span> <span class="co">// Android开发的命名约定，一看到此前缀，我们就知道sCrimeLab是一个静态变量</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            sCrimeLab <span class="op">=</span> <span class="kw">new</span> <span class="fu">CrimeLab</span><span class="op">(</span>context<span class="op">);</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sCrimeLab<span class="op">;</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="fu">CrimeLab</span><span class="op">(</span><span class="bu">Context</span> context<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        mCrimes <span class="op">=</span> <span class="kw">new</span> <span class="bu">ArrayList</span><span class="op">&lt;&gt;();</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">List</span><span class="op">&lt;</span>Crime<span class="op">&gt;</span> <span class="fu">getCrimes</span><span class="op">()</span> <span class="op">&#123;</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mCrimes<span class="op">;</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Crime <span class="fu">getCrime</span><span class="op">(</span><span class="bu">UUID</span> id<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>Crime crime <span class="op">:</span> mCrimes<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>crime<span class="op">.</span><span class="fu">getId</span><span class="op">().</span><span class="fu">equals</span><span class="op">(</span>id<span class="op">))</span> <span class="op">&#123;</span></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> crime<span class="op">;</span></span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="java的抽象类和抽象方法">1.7.1+ Java的抽象类和抽象方法</h3><p>合理运用抽象类，有助于我们消除大量的重复代码。详见下面的例子：</p><div class="sourceCode" id="cb10"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 创建一个新的activity时，都要调用以下代码唯一的区别就在注释一行</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span> Called when the activity is first created<span class="co">. */</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeActivity <span class="kw">extends</span> AppCompatActivity <span class="op">&#123;</span>   </span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_fragment</span><span class="op">);</span></span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        FragmentManager fm <span class="op">=</span> <span class="fu">getSupportFragmentManager</span><span class="op">();</span></span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        Fragment fragment <span class="op">=</span> fm<span class="op">.</span><span class="fu">findFragmentById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">);</span></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fragment <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            fragment <span class="op">=</span> <span class="kw">new</span> <span class="fu">CrimeFragment</span><span class="op">();</span> <span class="co">//只有这里有区别</span></span><span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            fm<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">()</span></span><span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">,</span> fragment<span class="op">)</span></span><span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span><span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>如果应用中有很多activity，那么会出现大量的重复代码。</p><p>所以，我们可以为这些重复的代码建立<strong>抽象类</strong>，代码中不同的部分采用<strong>抽象方法</strong>代替。抽象类如下：</p><blockquote><p><strong>补充：抽象类和抽象方法</strong></p><p>所有的抽象方法和抽象方法所在的类都要使用abstract关键字定义，用abstract关键字定义的抽象方法所在的类称为抽象类</p><p>抽象类中包含抽象方法，抽象方法不包含方法体，即抽象类中没有具体实现，所以抽象类中不能直接产生实例化对象，抽象类只能被实体类继承之后再实例化。</p></blockquote><div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">abstract</span> <span class="kw">class</span> SingleFragmentActivity <span class="kw">extends</span> AppCompatActivity <span class="op">&#123;</span> <span class="co">// 抽象类</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="kw">abstract</span> Fragment <span class="fu">createFragment</span><span class="op">();</span> <span class="co">// 抽象方法</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_fragment</span><span class="op">);</span></span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        FragmentManager fm <span class="op">=</span> <span class="fu">getSupportFragmentManager</span><span class="op">();</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        Fragment fragment <span class="op">=</span> fm<span class="op">.</span><span class="fu">findFragmentById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">);</span></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fragment <span class="op">==</span> <span class="kw">null</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            fragment <span class="op">=</span> <span class="fu">createFragment</span><span class="op">();</span></span><span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            fm<span class="op">.</span><span class="fu">beginTransaction</span><span class="op">()</span></span><span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">add</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">fragment_container</span><span class="op">,</span> fragment<span class="op">)</span></span><span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="fu">commit</span><span class="op">();</span></span><span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>这样，再创建一个activity类时，就可以直接这样实现，减少了重复代码，更加简洁：</p><div class="sourceCode" id="cb12"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeActivity <span class="kw">extends</span> AppCompatActivity SingleFragmentActivity <span class="op">&#123;</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> Fragment <span class="fu">createFragment</span><span class="op">()</span> <span class="op">&#123;</span></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">new</span> <span class="fu">CrimeFragment</span><span class="op">();</span></span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="recyclerview">1.7.2 RecyclerView</h3><p>RecyclerView只创建刚好充满屏幕的View，而不是全部的View。用户滑动屏幕切换视图时，上一个视图会回收利用。顾名思义，RecyclerView所做的就是回收再利用，循环往复。</p><p>RecyclerView的任务仅限于<strong>回收和定位</strong>屏幕上的View。</p><p>列表项View能够显示数据还离不开另外两个类的支持：<strong>ViewHolder</strong>子类和<strong>Adapter</strong>子类。</p><h3 id="viewholder">1.7.3 ViewHolder</h3><p>ViewHolder是一个容器，顾名思义，它只做一件事：<strong>容纳View视图</strong></p><div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// A typical ViewHolder subclass</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ListRow <span class="kw">extends</span> RecyclerView<span class="op">.</span><span class="fu">ViewHolder</span> <span class="op">&#123;</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">ImageView</span> mThumbnail<span class="op">;</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">ListRow</span><span class="op">(</span><span class="bu">View</span> view<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span>view<span class="op">);</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        mThumbnail <span class="op">=</span> <span class="op">(</span><span class="bu">ImageView</span><span class="op">)</span> view<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">thumbnail</span><span class="op">);</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>你可以创建ListRow来获取自定义的mThumbnail和RecyclerView.ViewHolder超类传入的itemView 。ViewHolder为itemView 而生： 它<strong>引用着</strong>传给super(view)的<strong>整个View视图</strong></p><div class="sourceCode" id="cb14"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The code is a typical usage of a ViewHolder</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ListRow row <span class="op">=</span> <span class="kw">new</span> <span class="fu">ListRow</span><span class="op">(</span>inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">list_row</span><span class="op">,</span> parent<span class="op">,</span> <span class="kw">false</span><span class="op">));</span></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">View</span> view <span class="op">=</span> row<span class="op">.</span><span class="fu">itemView</span><span class="op">;</span></span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">ImageView</span> thumbnailView <span class="op">=</span> row<span class="op">.</span><span class="fu">mThumbnail</span><span class="op">;</span></span></code></pre></div><h3 id="adapter">1.7.4 Adapter</h3><p><strong>RecyclerView自己不创建ViewHolder</strong>。这个任务实际是由Adapter来完成的。<strong>Adapter</strong>是一个控制器对象，<strong>从模型层获取数据，然后提供给RecyclerView显示</strong>，是沟通的桥梁。</p><p>Adapter负责</p><ul><li>创建必要的ViewHolder；</li><li>绑定ViewHolder至模型层数据；</li></ul><p>要创建Adapter，首先要定义RecyclerView.Adapter子类。然后由它封装从CrimeLab获取的crime。 RecyclerView需要显示视图对象时，就会去找它的Adapter。</p><p>调用过程如图</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/code%20reading/recycle_adapter.svg" alt="recycleView &amp; adapter之间的关系" /></p><p>整个过程执行完毕，RecyclerView就能在屏幕上显示crime列表项了。需要注意的是，相对于onBindViewHolder(ViewHolder, int)方法，onCreateViewHolder(ViewGroup, int)方法的调用并不频繁。一旦有了够用的ViewHolder，RecyclerView就会停止调用onCreate-ViewHolder(...)方法。随后，它会回收利用旧的ViewHolder以节约时间和内存。</p><h3 id="一个列表界面的创建代码">1.7.5 一个列表界面的创建代码</h3><div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 为CrimeListFragment配置视图</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeListFragment <span class="kw">extends</span> Fragment <span class="op">&#123;</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Nothing yet</span></span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> RecyclerView mCrimeRecyclerView<span class="op">;</span></span><span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span></span><span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                             Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view <span class="op">=</span> inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment_crime_list</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        mCrimeRecyclerView <span class="op">=</span> <span class="op">(</span>RecyclerView<span class="op">)</span> view</span><span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">crime_recycler_view</span><span class="op">);</span></span><span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* As soon as you create your RecyclerView, you need to give it another object called a LayoutManager. RecyclerView requires a LayoutManager to work. */</span></span><span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        mCrimeRecyclerView<span class="op">.</span><span class="fu">setLayoutManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">LinearLayoutManager</span><span class="op">(</span><span class="fu">getActivity</span><span class="op">()));</span><span class="co">// RecyclerView 类不会亲自摆放屏幕上的列表项。实际上，摆放的任务被委托给了LayoutManager。</span></span><span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view<span class="op">;</span></span><span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>注意，没有LayoutManager的支持，不仅RecyclerView无法工作，还会导致应用崩溃。所以，RecyclerView视图创建完成后，就立即转交给了LayoutManager对象。</p><p>RecyclerView 类不会亲自摆放屏幕上的列表项。实际上，摆放的任务被委托给了LayoutManager。除了在屏幕上摆放列表项，LayoutManager还负责定义屏幕滚动行为。因此，没有LayoutManager，RecyclerView也就没法正常工作。</p><p>除了一些Android操作系统内置版实现，LayoutManager还有很多第三方库实现版本。上一段代码使用的是LinearLayoutManager类，它支持以竖直列表的形式展示列表项。系统内置实现中还有一个GridLayoutManager类，以网格形式展示列表项。</p><blockquote><h4 id="getactivity方法">getActivity()方法</h4><ul><li><code>getActivity()</code> in a <code>Fragment</code> returns the <code>Activity</code> the <code>Fragment</code> is currently associated with. (see http://developer.android.com/reference/android/app/Fragment.html#getActivity())</li></ul></blockquote><p>上一段代码实现了一个RecyclerView空视图。要想显示出crime列表项，还需要完成Adapter和ViewHolder的实现。</p><div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 定义ViewHolder内部类</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimelistFragment <span class="kw">extends</span> Fragment <span class="op">&#123;</span></span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">...</span></span><span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">class</span> CrimeHolder <span class="kw">extends</span> RecyclerView<span class="op">.</span><span class="fu">ViewHolder</span> <span class="op">&#123;</span></span><span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">CrimeHolder</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup parent<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">super</span><span class="op">(</span>inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">list_item_crime</span><span class="op">,</span> parent<span class="op">,</span> <span class="kw">false</span><span class="op">));</span></span><span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>在CrimeHolder的构造方法里，我们首先实例化list_item_crime布局，然后传给super(...)方法，也就是ViewHolder的构造方法。基类ViewHolder因而实际引用这个视图。如果你需要，可以在ViewHolder的itemView变量里找到它。 定义完ViewHolder，接下来的任务是创建Adapter。</p><div class="sourceCode" id="cb17"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 创建Adapter内部类，定义必要的方法。</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CrimeListFragment <span class="kw">extends</span> Fragment <span class="op">&#123;</span></span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> RecyclerView mCrimeRecyclerView<span class="op">;</span></span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> CrimeAdapter mAdapter<span class="op">;</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">View</span> <span class="fu">onCreateView</span><span class="op">(</span>LayoutInflater inflater<span class="op">,</span> ViewGroup container<span class="op">,</span></span><span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                             Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">View</span> view <span class="op">=</span> inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">fragment_crime_list</span><span class="op">,</span> container<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        mCrimeRecyclerView <span class="op">=</span> <span class="op">(</span>RecyclerView<span class="op">)</span> view</span><span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">crime_recycler_view</span><span class="op">);</span></span><span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        mCrimeRecyclerView<span class="op">.</span><span class="fu">setLayoutManager</span><span class="op">(</span><span class="kw">new</span> <span class="fu">LinearLayoutManager</span><span class="op">(</span><span class="fu">getActivity</span><span class="op">()));</span></span><span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateUI</span><span class="op">();</span></span><span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> view<span class="op">;</span></span><span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 根据数据更新显示内容</span></span><span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">void</span> <span class="fu">updateUI</span><span class="op">()</span> <span class="op">&#123;</span></span><span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        CrimeLab crimeLab <span class="op">=</span> CrimeLab<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="fu">getActivity</span><span class="op">());</span></span><span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">List</span><span class="op">&lt;</span>Crime<span class="op">&gt;</span> crimes <span class="op">=</span> crimeLab<span class="op">.</span><span class="fu">getCrimes</span><span class="op">();</span></span><span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        mAdapter <span class="op">=</span> <span class="kw">new</span> <span class="fu">CrimeAdapter</span><span class="op">(</span>crimes<span class="op">);</span></span><span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        mCrimeRecyclerView<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span>mAdapter<span class="op">);</span></span><span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 把视图绑定工作放入CrimeHolder类里，implement功能为了是增加一个监听器</span></span><span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">class</span> CrimeHolder <span class="kw">extends</span> RecyclerView<span class="op">.</span><span class="fu">ViewHolder</span> <span class="kw">implements</span> <span class="bu">View</span><span class="op">.</span><span class="fu">OnClickListener</span> <span class="op">&#123;</span> </span><span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> TextView mTitleTextView<span class="op">;</span></span><span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> TextView mDateTextView<span class="op">;</span></span><span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> Crime mcrime<span class="op">;</span></span><span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">CrimeHolder</span><span class="op">(</span>layoutinflater inflater<span class="op">,</span> ViewGroup parent<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">super</span><span class="op">(</span>inflater<span class="op">.</span><span class="fu">inflate</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">list_item_crime</span><span class="op">,</span> parent<span class="op">,</span> <span class="kw">false</span><span class="op">));</span></span><span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>            itemView<span class="op">.</span><span class="fu">setOnClickListener</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span> <span class="co">// 增加一个监听器</span></span><span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>            mTitleTextView <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> itemView<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">crime_title</span><span class="op">);</span></span><span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            mDateTextView <span class="op">=</span> <span class="op">(</span>TextView<span class="op">)</span> itemView<span class="op">.</span><span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">crime_date</span><span class="op">);</span></span><span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span><span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onClick</span><span class="op">(</span><span class="bu">View</span> view<span class="op">)</span> <span class="op">&#123;</span> <span class="co">// 监听器调用，响应点击事件</span></span><span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            Toast<span class="op">.</span><span class="fu">makeText</span><span class="op">(</span><span class="fu">getActivity</span><span class="op">(),</span></span><span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                           mCrime<span class="op">.</span><span class="fu">getTitle</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot; clicked!&quot;</span><span class="op">,</span> Toast<span class="op">.</span><span class="fu">LENGTH_SHORT</span><span class="op">)</span></span><span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span><span class="fu">show</span><span class="op">();</span></span><span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">bind</span><span class="op">(</span>Crime crime<span class="op">)</span> <span class="op">&#123;</span> <span class="co">// 每次有新的Crime要在CrimeHolder中显示时，都要调用它一次，刷新显示</span></span><span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>            mCrime <span class="op">=</span> crime<span class="op">;</span></span><span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>            mTitleTextView<span class="op">.</span><span class="fu">setText</span><span class="op">(</span>mCrime<span class="op">.</span><span class="fu">getTitle</span><span class="op">());</span></span><span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            mDateTextView<span class="op">.</span><span class="fu">setText</span><span class="op">(</span>mCrime<span class="op">.</span><span class="fu">getDate</span><span class="op">().</span><span class="fu">toString</span><span class="op">());</span></span><span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">class</span> CrimeAdapter <span class="kw">extends</span> RecyclerView<span class="op">.</span><span class="fu">Adapter</span><span class="op">&lt;</span>CrimeHolder<span class="op">&gt;</span> <span class="op">&#123;</span> <span class="co">// 定义Adapter内部类</span></span><span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="bu">List</span><span class="op">&lt;</span>Crime<span class="op">&gt;</span> mCrimes<span class="op">;</span></span><span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">CrimeAdapter</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>Crime<span class="op">&gt;</span> crimes<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>            mCrimes <span class="op">=</span> crimes<span class="op">;</span></span><span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span><span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> CrimeHolder <span class="fu">onCreateViewHolder</span><span class="op">(</span>ViewGroup parent<span class="op">,</span> <span class="dt">int</span> viewType<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>            LayoutInflater layoutInflater <span class="op">=</span> LayoutInflater<span class="op">.</span><span class="fu">from</span><span class="op">(</span><span class="fu">getActivity</span><span class="op">());</span></span><span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="kw">new</span> <span class="fu">CrimeHolder</span><span class="op">(</span>layoutInflater<span class="op">,</span> parent<span class="op">);</span></span><span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span><span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">int</span> <span class="fu">getItemCount</span><span class="op">()</span> <span class="op">&#123;</span></span><span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> mCrimes<span class="op">.</span><span class="fu">size</span><span class="op">();</span></span><span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span><span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onBindViewHolder</span><span class="op">(</span>CrimeHolder holder<span class="op">,</span> <span class="dt">int</span> position<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>            Crime crime <span class="op">=</span> mCrimes<span class="op">.</span><span class="fu">get</span><span class="op">(</span>position<span class="op">);</span></span><span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>            holder<span class="op">.</span><span class="fu">bind</span><span class="op">(</span>crime<span class="op">);</span></span><span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>如果你一通猛滑，列表项滚动得非常流畅。这要归功于onBindViewHolder(...)方法。任何时候，只要有可能，都要确保这个方法轻巧、高效。</p><h2 id="listview-和-gridview">1.8 ListView 和 GridView</h2><p>Android操作系统核心库包含ListView、GridView和Adapter这3个类。Android 5.0之前，创建列表项或网格项都应该优先使用这些类。 这些类的API与RecyclerView的API非常相似。ListView和GridView不关心具体的展示项，只负责展示项的滚动。Adapter负责创建列表项的所有视图。不过，使用ListView和GridView时，不一定非要使用ViewHolder模式（虽然可以并且应该使用）。</p><p>过去传统的实现方式现已被RecyclerView的实现方式取代，因此不用再费力地调整ListView和GridView的工作行为了。</p><p>ListView和GridView 是 AdapterView 的子类，它们可以填充绑定到一个适配器，它从外部源检索数据，并创建一个视图表示每个数据项。</p><h3 id="listview">1.8.1 ListView</h3><p>简单的用法示例</p><div class="sourceCode" id="cb18"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MainActivity <span class="kw">extends</span> Activity <span class="op">&#123;</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>   <span class="bu">String</span><span class="op">[]</span> <span class="bu">Array</span> <span class="op">=</span> <span class="op">&#123;</span><span class="st">&quot;A Type&quot;</span><span class="op">,</span> <span class="st">&quot;B Type&quot;</span><span class="op">,</span> <span class="st">&quot;C Type&quot;</span><span class="op">,</span> <span class="st">&quot;Reset&quot;</span><span class="op">,</span> <span class="st">&quot;Setting&quot;</span><span class="op">&#125;;</span></span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">@Override</span></span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">onCreate</span><span class="op">(</span>Bundle savedInstanceState<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">super</span><span class="op">.</span><span class="fu">onCreate</span><span class="op">(</span>savedInstanceState<span class="op">);</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setContentView</span><span class="op">(</span>R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_main</span><span class="op">);</span>     </span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      ArrayAdapter adapter <span class="op">=</span> <span class="kw">new</span> ArrayAdapter<span class="op">&lt;</span><span class="bu">String</span><span class="op">&gt;(</span><span class="kw">this</span><span class="op">,</span> </span><span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      R<span class="op">.</span><span class="fu">layout</span><span class="op">.</span><span class="fu">activity_listview</span><span class="op">,</span> <span class="bu">Array</span><span class="op">);</span>    </span><span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="bu">ListView</span> listView <span class="op">=</span> <span class="op">(</span><span class="bu">ListView</span><span class="op">)</span> <span class="fu">findViewById</span><span class="op">(</span>R<span class="op">.</span><span class="fu">id</span><span class="op">.</span><span class="fu">list</span><span class="op">);</span></span><span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      listView<span class="op">.</span><span class="fu">setAdapter</span><span class="op">(</span>adapter<span class="op">);</span></span><span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>   <span class="op">&#125;</span></span><span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>运行这段代码，就可以显示出列表视图。</p><h3 id="gridview">1.8.2 GridView</h3><p>与ListView大体相似。</p><h2 id="参考资料">1.9 参考资料</h2><ul><li><p>《Android编程权威指南（第三版）》</p></li><li><p>《Android编程权威指南（第二版）》</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 软件开发 </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Verilog的一些实用操作</title>
      <link href="/2021/10/25/Programming%20Language/Verilog%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
      <url>/2021/10/25/Programming%20Language/Verilog%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="位拼接运算符">位拼接运算符</h2><h3 id="位截取">位截取</h3><div class="sourceCode" id="cb1"><pre class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>rs2 <span class="op">=</span> ins<span class="op">[</span><span class="dv">24</span> <span class="op">:</span> <span class="dv">20</span><span class="op">]</span></span></code></pre></div><h3 id="拼接方法">拼接方法</h3><div class="sourceCode" id="cb2"><pre class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>ins<span class="op">[</span><span class="dv">14</span> <span class="op">:</span> <span class="dv">12</span><span class="op">],</span> ins<span class="op">[</span><span class="dv">31</span> <span class="op">:</span> <span class="dv">25</span><span class="op">]&#125;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span><span class="bn">3&#39;b000</span><span class="op">,</span> <span class="bn">7&#39;b0000000</span><span class="op">&#125;</span></span></code></pre></div><h3 id="一个bit位的重复">一个bit位的重复</h3><div class="sourceCode" id="cb3"><pre class="sourceCode verilog"><code class="sourceCode verilog"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Imm <span class="op">=</span> <span class="op">&lt;!--</span>swig￼<span class="dv">0</span><span class="op">--&gt;,</span> rImm<span class="op">[</span><span class="dv">11</span> <span class="op">:</span> <span class="dv">0</span><span class="op">]&#125;;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 硬件设计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 硬件描述语言 </tag>
            
            <tag> Verilog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训5.x实验</title>
      <link href="/2021/10/20/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD5.x/"/>
      <url>/2021/10/20/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD5.x/</url>
      
        <content type="html"><![CDATA[<h1 id="实训5进程的同步与互斥">实训5：进程的同步与互斥</h1><h2 id="实训地址">实训地址</h2><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h2 id="第一关多线程编程">第一关：多线程编程</h2><h3 id="问题背景">问题背景</h3><p>使用 3 个线程计算从 1 到 200 的累加和，3 个线程分别完成函数 p1、p2 和 p3 的计算任务。</p><h3 id="注意事项">注意事项</h3><p>主函数要等两个线程都执行完才行</p><h3 id="补充">补充</h3><h4 id="主线程结束时子线程会被杀死吗">主线程结束时，子线程会被杀死吗</h4><p>是的，如果主线程结束时，子线程还没有结束，那么子线程会被操作系统杀死。可以在主线程中使用 <code>pthread_join</code> 来等待子线程结束。</p><h4 id="多线程程序如何编译">多线程程序如何编译</h4><p>用 pthread 库实现的多线程程序，可以使用 gcc 来编译，且需加上 -pthread 参数：</p><pre><code>gcc 3.c -o 3 -pthread</code></pre><h4 id="pthread_create-函数的各个参数的含义是什么">pthread_create 函数的各个参数的含义是什么</h4><p>该函数的原型和各参数的含义如下：</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_create<span class="op">(</span>pthread_t <span class="op">*</span>tidp<span class="op">,</span> <span class="dt">const</span> pthread_attr_t <span class="op">*</span>attr<span class="op">,</span>    <span class="op">(</span><span class="dt">void</span><span class="op">*)(*</span>start_rtn<span class="op">)(</span><span class="dt">void</span><span class="op">*),</span> <span class="dt">void</span> <span class="op">*</span>arg<span class="op">);</span></span></code></pre></div><p>第一个参数为指向线程标识符的指针；</p><p>第二个参数用来设置线程属性；</p><p>第三个参数是线程运行函数的起始地址；</p><p>最后一个参数是运行函数的参数。</p><h3 id="代码">代码</h3><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum1 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> sum2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>p1<span class="op">()&#123;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> tmp <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">+=</span> i<span class="op">;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    sum1 <span class="op">+=</span> tmp<span class="op">;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>p2<span class="op">()&#123;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> tmp <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">101</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">200</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">+=</span> i<span class="op">;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    sum2 <span class="op">+=</span> tmp<span class="op">;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> p3<span class="op">()&#123;</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;sum: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> sum1 <span class="op">+</span> sum2<span class="op">);</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()&#123;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> res<span class="op">;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    pthread_t t1<span class="op">,</span> t2<span class="op">;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>thread_result<span class="op">;</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pthread_create<span class="op">(&amp;</span>t1<span class="op">,</span> NULL<span class="op">,</span> p1<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>res <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;failed to create thread&quot;</span><span class="op">);</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pthread_create<span class="op">(&amp;</span>t2<span class="op">,</span> NULL<span class="op">,</span> p2<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>res <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;failed to create thread&quot;</span><span class="op">);</span></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pthread_join<span class="op">(</span>t1<span class="op">,</span> <span class="op">&amp;</span>thread_result<span class="op">);</span><span class="co">//主函数应该</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>res <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;failed to join thread&quot;</span><span class="op">);</span></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pthread_join<span class="op">(</span>t2<span class="op">,</span> <span class="op">&amp;</span>thread_result<span class="op">);</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>res <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;failed to join thread&quot;</span><span class="op">);</span></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    p3<span class="op">();</span></span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第二关信号量的应用">第二关：信号量的应用</h2><h3 id="问题背景-1">问题背景</h3><p>某休息厅里有足够多（10 把以上）的椅子，10 位顾客先后进入休息厅寻找空椅子，找到后开始在椅子上休息，休息完后让出空椅子、退出休息厅。请只在该程序中插入一些代码（不删除现有代码），来将上述场景调整为休息厅里只有 2 把椅子。</p><h3 id="补充sem函数的介绍">补充：sem函数的介绍</h3><h4 id="定义位置">定义位置</h4><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span></code></pre></div><h4 id="sem_initsem_t-__sem-int-__pshared-unsigned-int-__value">sem_init(sem_t *__sem, int __pshared, unsigned int __value)</h4><p>sem_init函数是Posix信号量操作中的函数。sem_init() 初始化一个定位在 sem 的匿名信号量。value 参数指定信号量的初始值。 pshared 参数指明信号量是由进程内线程共享，还是由进程之间共享。如果 pshared 的值为 0，那么信号量将被进程内的线程共享，并且应该放置在这个进程的所有线程都可见的地址上（如全局变量，或者堆上动态分配的变量）。</p><p>如果 pshared 是非零值，那么信号量将在进程之间共享，并且应该定位共享内存区域(见 shm_open、mmap和 shmget。因为通过 fork 创建的孩子继承其父亲的内存映射，因此它也可以见到这个信号量。所有可以访问共享内存区域的进程都可以用 sem_post、sem_wait 等等操作信号量。初始化一个已经初始的信号量其结果未定义。</p><h4 id="sem_waitsem_t-sem">sem_wait(<strong>sem_t</strong> *sem)</h4><p>sem_wait是一个函数，也是一个原子操作，它的作用是从信号量的值减去一个“1”，但它永远会先等待该信号量为一个非零值才开始做减法。也就是说，如果你对一个值为2的信号量调用sem_wait()，线程将会继续执行，将信号量的值将减到1。</p><p>如果对一个值为0的信号量调用sem_wait()，这个函数就会原地等待直到有其它线程增加了这个值使它不再是0为止。如果有两个线程都在sem_wait()中等待同一个信号量变成非零值，那么当它被第三个线程增加一个“1”时，等待线程中只有一个能够对信号量做减法并继续执行，另一个还将处于等待状态。sem_trywait(sem_t *sem)是函数sem_wait的非阻塞版，它直接将信号量sem减1，同时返回错误代码。</p><h4 id="sem_postsem_t-sem">sem_post(<strong>sem_t</strong> *sem)</h4><p>sem_post是给信号量的值加上一个“1”，它是一个“原子操作”－－－即同时对同一个信号量做加“1”操作的两个线程是不会冲突的；而同时对同一个文件进行读和写操作的两个程序就有可能会引起冲突。</p><h3 id="代码-1">代码</h3><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SEAT_NUM  2</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CUSTOMER_NUM  10</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> customer_state<span class="op">[</span>CUSTOMER_NUM<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">&#125;;</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sleep_random<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">((</span><span class="dt">int</span><span class="op">)(</span>t <span class="op">*</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">/</span> <span class="op">(</span>RAND_MAX <span class="op">*</span><span class="fl">1.0</span><span class="op">))));</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_cur_state<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;  customers with seats: (&quot;</span><span class="op">);</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CUSTOMER_NUM<span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="dv">0</span> <span class="op">!=</span> customer_state<span class="op">[</span>i<span class="op">])</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot; %d&quot;</span><span class="op">,</span> i<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot; )</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>sem_t empty_seat_num<span class="op">;</span> <span class="co">/* 一个由椅子数量决定的信号量，实质上是允许同时运行的程序数量 */</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>customer<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>id<span class="op">)</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> myid <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>id<span class="op">;</span></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: try to get a seat...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    sem_wait<span class="op">(&amp;</span>empty_seat_num<span class="op">);</span> <span class="co">/* 如果empty_seat_num &gt; 0，继续执行，如果empty_seat_num == 0，进程会原地等待，不执行。直到有其它线程增加了这个值使它不再是0为止 */</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: sit down</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    customer_state<span class="op">[</span>myid<span class="op">-</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    print_cur_state<span class="op">();</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    sleep_random<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: stand up</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    customer_state<span class="op">[</span>myid<span class="op">-</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    print_cur_state<span class="op">();</span></span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    sem_post<span class="op">(&amp;</span>empty_seat_num<span class="op">);</span> <span class="co">/* 一个椅子被释放，让empty_seat_num这个信号量的值+1 */</span></span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> id<span class="op">[</span>CUSTOMER_NUM<span class="op">],</span> res<span class="op">;</span></span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    pthread_t t<span class="op">[</span>CUSTOMER_NUM<span class="op">];</span></span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">((</span><span class="dt">int</span><span class="op">)</span>time<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>empty_seat_num<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SEAT_NUM<span class="op">);</span> <span class="co">/* 设置信号量的值为2 */</span></span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CUSTOMER_NUM<span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        id<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> customer<span class="op">,</span> <span class="op">&amp;</span>id<span class="op">[</span>i<span class="op">]);</span></span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CUSTOMER_NUM<span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> pthread_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>res <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">&quot;failed to join thread&quot;</span><span class="op">);</span></span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第三关顺序资源分配法">第三关：顺序资源分配法</h2><h3 id="问题背景哲学家就餐">问题背景：哲学家就餐</h3><p>五个哲学家共用一张圆桌，分别坐在周围的五张椅子上，在圆桌上有五个碗和五只筷子，他们的生活方式是交替的进行思考和进餐。平时，一个哲学家进行思考，饥饿时便试图取用其左右最靠近他的筷子，只有在他拿到两只筷子时才能进餐。进餐完毕，放下筷子继续思考。试模拟此过程</p><h3 id="方法">方法</h3><p>对信号量的应用，和第二问基本相同，信号量变为了桌上筷子的有无。即当前chopsticks[left]和chopsticks[right]的值为0还是1。如果当前的进程的chopsticks[left]或chopsticks[right]有一个为0，那么它就要等待别的进程执行完，且chopsticks[left] == chopsticks[right] == 1。</p><h3 id="代码-2">代码</h3><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sleep_random<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">((</span><span class="dt">int</span><span class="op">)(</span>t <span class="op">*</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">/</span> <span class="op">(</span>RAND_MAX <span class="op">*</span><span class="fl">1.0</span><span class="op">))));</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> delay<span class="op">()&#123;</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10000000</span><span class="op">;</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>i<span class="op">--)</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">;</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N  5</span></span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>sem_t chopstick<span class="op">[</span>N<span class="op">];</span></span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>phi<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>id<span class="op">)&#123;</span>  <span class="co">/* &#39;id&#39; starts from 1 */</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> left<span class="op">,</span> right<span class="op">,</span> myid <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>id<span class="op">;</span></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> myid <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> <span class="op">(</span>myid <span class="op">&lt;</span> N<span class="op">)</span> <span class="op">?</span> myid <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;phi #%d: thinking</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>left <span class="op">&lt;</span> right<span class="op">)&#123;</span></span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            sem_wait<span class="op">(&amp;</span>chopstick<span class="op">[</span>left<span class="op">]);</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            delay<span class="op">();</span></span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            sem_wait<span class="op">(&amp;</span>chopstick<span class="op">[</span>right<span class="op">]);</span></span><span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span><span class="op">&#123;</span></span><span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>            sem_wait<span class="op">(&amp;</span>chopstick<span class="op">[</span>right<span class="op">]);</span></span><span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            delay<span class="op">();</span></span><span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            sem_wait<span class="op">(&amp;</span>chopstick<span class="op">[</span>left<span class="op">]);</span></span><span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;phi #%d: eating</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>chopstick<span class="op">[</span>left<span class="op">]);</span></span><span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>chopstick<span class="op">[</span>right<span class="op">]);</span></span><span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()&#123;</span></span><span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> id<span class="op">[</span>N<span class="op">];</span></span><span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    pthread_t t<span class="op">[</span>N<span class="op">];</span></span><span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">((</span><span class="dt">int</span><span class="op">)</span>time<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        id<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        sem_init<span class="op">(&amp;</span>chopstick<span class="op">[</span>i<span class="op">],</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span></span><span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> phi<span class="op">,</span> <span class="op">&amp;</span>id<span class="op">[</span>i<span class="op">]);</span></span><span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span></span><span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span><span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第四关生产者与消费者问题">第四关：生产者与消费者问题</h2><h3 id="问题背景生产与消费">问题背景：生产与消费</h3><p>有两个进程：一组生产者进程和一组消费者进程共享一个初始为空、固定大小为n的缓存（缓冲区）。生产者的工作是制造一段数据，只有缓冲区没满时，生产者才能把消息放入到缓冲区，否则必须等待，如此反复; 同时，只有缓冲区不空时，消费者才能从中取出消息，一次消费一段数据（即将其从缓存中移出），否则必须等待。由于缓冲区是临界资源，它只允许一个生产者放入消息，或者一个消费者从中取出消息。</p><h3 id="方法-1">方法</h3><p>用一个信号量mutex，在生产者生产（向buffer中添加元素）或消费者消费（从buffer删除元素）时，锁住这个过程，不让其他进程进行buffer的读写。</p><h3 id="代码实现">代码实现</h3><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N 8</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRODUCT_NUM 15</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define COSTUME_NUM 5</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRODUCTOR_NUM 5</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> buffer<span class="op">[</span>N<span class="op">],</span> readpos <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> writepos <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>sem_t full<span class="op">,</span> empty<span class="op">,</span> mutex<span class="op">,</span> aaa<span class="op">;</span> <span class="co">//aaa是为了通过实训加的变量，其实完全没必要</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sleep_random<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">((</span><span class="dt">int</span><span class="op">)(</span>t <span class="op">*</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">/</span> <span class="op">(</span>RAND_MAX <span class="op">*</span><span class="fl">1.0</span><span class="op">))));</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>produce<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>id<span class="op">)&#123;</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> myid <span class="op">=</span> <span class="op">*</span>id<span class="op">;</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> PRODUCT_NUM<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>empty<span class="op">);</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex<span class="op">);</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span>writepos<span class="op">++]</span> <span class="op">=</span> myid <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> i<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>writepos <span class="op">&gt;=</span> N<span class="op">)</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            writepos <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;produce:    %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid <span class="op">*</span> <span class="dv">1000</span> <span class="op">+</span> i<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex<span class="op">);</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>full<span class="op">);</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>consume<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>id<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> PRODUCT_NUM<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>full<span class="op">);</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex<span class="op">);</span></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;%d consume: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">*</span>id<span class="op">,</span>buffer<span class="op">[</span>readpos<span class="op">]);</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span>readpos<span class="op">++]</span> <span class="op">=</span>  <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>readpos <span class="op">&gt;=</span> N<span class="op">)</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>            readpos <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex<span class="op">);</span></span><span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>empty<span class="op">);</span></span><span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()&#123;</span></span><span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> res<span class="op">,</span> i<span class="op">,</span> id<span class="op">[</span>PRODUCTOR_NUM<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">&#125;,</span> id2<span class="op">[</span>COSTUME_NUM<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">&#125;;</span></span><span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    pthread_t t<span class="op">[</span>PRODUCTOR_NUM<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">&#125;,</span> t2<span class="op">[</span>COSTUME_NUM<span class="op">]</span> <span class="op">=</span> <span class="op">&#123;</span><span class="dv">0</span><span class="op">&#125;;</span></span><span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span></span><span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        buffer<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span>  <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">((</span><span class="dt">int</span><span class="op">)</span>time<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>full<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>empty<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> N<span class="op">);</span></span><span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>mutex<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> PRODUCTOR_NUM<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>        id<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pthread_create<span class="op">(&amp;</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>produce<span class="op">,</span> <span class="op">&amp;</span>id<span class="op">[</span>i<span class="op">])</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">&quot;failed to create thread&quot;</span><span class="op">);</span></span><span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        id2<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pthread_create<span class="op">(&amp;</span>t2<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>consume<span class="op">,</span> <span class="op">&amp;</span>id2<span class="op">[</span>i<span class="op">])</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">&quot;failed to create thread&quot;</span><span class="op">);</span></span><span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> COSTUME_NUM<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>res <span class="op">=</span> pthread_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">&quot;failed to join thread&quot;</span><span class="op">);</span></span><span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>res <span class="op">=</span> pthread_join<span class="op">(</span>t2<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)&#123;</span></span><span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>            perror<span class="op">(</span><span class="st">&quot;failed to join thread&quot;</span><span class="op">);</span></span><span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>            exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第五关三个并发进程">第五关：三个并发进程</h2><h3 id="问题背景三进程流水">问题背景：三进程流水</h3><p>假设有三个并发进程（ P、Q、R ），其中 P 负责从输入设备上读取信息并传给 Q ， Q 将信息加工后传给 R ，R 负责将信息打印输出。 写出符合下列条件下的并发程序。其中进程 P、Q 共享一个由 5 个缓冲区组成的缓冲池，进程 Q、R 共享另一个由 8 个缓冲区组成的缓冲池。</p><h3 id="方法-2">方法</h3><p>对P读写时，Q不能读写，R读写时，Q不能读写。所以用两个信号量锁住进程对两个缓冲区的读写。</p><p>缓冲区中没有元素，不能读。元素已满，缓冲区不能写。用full和empty两个信号量锁住每进程对其对应缓冲区的读写权限。</p><h3 id="代码实现-1">代码实现</h3><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define LIMIT  20</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define M  5</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N  8</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">/************************************/</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> buffer1<span class="op">[</span>M<span class="op">],</span> buffer2<span class="op">[</span>N<span class="op">],</span> readpos1<span class="op">,</span> writepos1<span class="op">,</span> readpos2<span class="op">,</span> writepos2<span class="op">;</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>sem_t full1<span class="op">,</span> empty1<span class="op">,</span> full2<span class="op">,</span> empty2<span class="op">,</span> mutex1<span class="op">,</span> mutex2<span class="op">;</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">/************************************/</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sleep_random<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">((</span><span class="dt">int</span><span class="op">)(</span>t <span class="op">*</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">/</span> <span class="op">(</span>RAND_MAX <span class="op">*</span><span class="fl">1.0</span><span class="op">))));</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>P<span class="op">()&#123;</span></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> LIMIT<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>empty1<span class="op">);</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex1<span class="op">);</span></span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;P sends:         %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        buffer1<span class="op">[</span>writepos1<span class="op">++]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        writepos1 <span class="op">%=</span> M<span class="op">;</span></span><span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex1<span class="op">);</span></span><span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>full1<span class="op">);</span></span><span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>Q<span class="op">()&#123;</span></span><span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> data<span class="op">;</span></span><span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> LIMIT<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>full1<span class="op">);</span></span><span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex1<span class="op">);</span></span><span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> reg <span class="op">=</span> buffer1<span class="op">[</span>readpos1<span class="op">++];</span></span><span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        readpos1 <span class="op">%=</span> M<span class="op">;</span></span><span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex1<span class="op">);</span></span><span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>empty1<span class="op">);</span></span><span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>empty2<span class="op">);</span></span><span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex2<span class="op">);</span></span><span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        buffer2<span class="op">[</span>writepos2<span class="op">++]</span> <span class="op">=</span> reg<span class="op">;</span></span><span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        writepos2 <span class="op">%=</span> N<span class="op">;</span></span><span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex2<span class="op">);</span></span><span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>full2<span class="op">);</span></span><span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>R<span class="op">()&#123;</span></span><span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> LIMIT<span class="op">;</span> i<span class="op">++)&#123;</span></span><span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>full2<span class="op">);</span></span><span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>mutex2<span class="op">);</span></span><span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;R receives: %d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> buffer2<span class="op">[</span>readpos2<span class="op">++]);</span></span><span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        readpos2 <span class="op">%=</span> N<span class="op">;</span></span><span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>mutex2<span class="op">);</span></span><span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>empty2<span class="op">);</span></span><span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()&#123;</span></span><span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span><span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    pthread_t t1<span class="op">,</span> t2<span class="op">;</span></span><span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> M<span class="op">;</span> i<span class="op">++)</span></span><span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        buffer1<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span>  <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span></span><span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        buffer2<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span>  <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">((</span><span class="dt">int</span><span class="op">)</span>time<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>empty1<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> M<span class="op">);</span></span><span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>full1<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>full2<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>empty2<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> N<span class="op">);</span></span><span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>mutex1<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>mutex2<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t1<span class="op">,</span> NULL<span class="op">,</span> P<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>t2<span class="op">,</span> NULL<span class="op">,</span> Q<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>    R<span class="op">();</span></span><span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第六关理发师问题">第六关：理发师问题</h2><h3 id="问题背景理发室问题">问题背景：理发室问题</h3><p>假设理发店由等待间（ 2 个座位）和理发间（只有一个座位）构成，5 位顾客先后进入等待间，再进入理发间。试写出模拟理发师和顾客的程序，要求为每一个顾客创建一个线程。</p><h3 id="方法-3">方法</h3><p>用empty表示当前休息室空座位数目，控制进程的访问。用room表示剩余理发室的个数，为进程分配独占的理发室。用make告诉理发程序当前是否要执行。finish是理发程序告诉客户程序的，意思是“已经理完发了”。</p><h3 id="代码实现-2">代码实现</h3><div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;semaphore.h&gt;</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SEAT_NUM  2</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CUSTOMER_NUM  5</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ROOM_NUM 1</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">/************************************/</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>sem_t empty<span class="op">,</span> room<span class="op">,</span> make<span class="op">,</span> finish<span class="op">;</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">/************************************/</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> sleep_random<span class="op">(</span><span class="dt">int</span> t<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">((</span><span class="dt">int</span><span class="op">)(</span>t <span class="op">*</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">/</span> <span class="op">(</span>RAND_MAX <span class="op">*</span><span class="fl">1.0</span><span class="op">))));</span></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>barber<span class="op">()</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        sem_wait<span class="op">(&amp;</span>make<span class="op">);</span></span><span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;barber: start cutting</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        sleep_random<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;barber: finish cutting</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        sem_post<span class="op">(&amp;</span>finish<span class="op">);</span></span><span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">/************************************/</span></span><span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>customer<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>id<span class="op">)</span></span><span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> myid <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>id<span class="op">;</span></span><span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    sleep_random<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: enter waiting-room</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    sem_wait<span class="op">(&amp;</span>empty<span class="op">);</span></span><span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: sit down</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    sem_wait<span class="op">(&amp;</span>room<span class="op">);</span></span><span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: enter cutting-room and sit down</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    sem_post<span class="op">(&amp;</span>make<span class="op">);</span></span><span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    sem_wait<span class="op">(&amp;</span>finish<span class="op">);</span></span><span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;customer %d: bye</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> myid<span class="op">);</span></span><span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    sem_post<span class="op">(&amp;</span>room<span class="op">);</span></span><span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    sem_post<span class="op">(&amp;</span>empty<span class="op">);</span></span><span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">,</span> id<span class="op">[</span>CUSTOMER_NUM<span class="op">];</span></span><span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    pthread_t t<span class="op">[</span>CUSTOMER_NUM<span class="op">];</span></span><span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">((</span><span class="dt">int</span><span class="op">)</span>time<span class="op">(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>empty<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SEAT_NUM<span class="op">);</span></span><span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>make<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>room<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> ROOM_NUM<span class="op">);</span></span><span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    sem_init<span class="op">(&amp;</span>finish<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">/************************************/</span></span><span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> CUSTOMER_NUM<span class="op">;</span> i<span class="op">++)</span></span><span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        id<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> customer<span class="op">,</span> <span class="op">&amp;</span>id<span class="op">[</span>i<span class="op">]);</span></span><span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    barber<span class="op">();</span></span><span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows和Linux的日常琐事</title>
      <link href="/2021/10/12/Operation%20System/Windows%20%E5%92%8C%20Linux%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2021/10/12/Operation%20System/Windows%20%E5%92%8C%20Linux%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="win10-清除-powershell-历史记录">Win10 清除 PowerShell 历史记录</h3><div class="sourceCode" id="cb1"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Remove-Item</span> <span class="op">(</span><span class="fu">Get-PSReadlineOption</span><span class="op">).</span><span class="fu">HistorySavePath</span></span></code></pre></div><p>重启Windows terminal后生效</p><h3 id="win10下的简繁体切换">Win10下的简繁体切换</h3><p>快捷键：<code>ctrl</code>+<code>shift</code>+<code>F</code></p><p>这个键和Android Studio的全局搜索冲突了。。。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 平时应用 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 操作系统 </tag>
            
            <tag> Windows </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训4.x实验</title>
      <link href="/2021/10/07/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD4.x/"/>
      <url>/2021/10/07/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD4.x/</url>
      
        <content type="html"><![CDATA[<h1 id="浏览之前">浏览之前</h1><p><a href="https://www.educoder.net/paths/2104">实训地址</a></p><p><font size = 5 color = blue>本文比较长，建议使用大纲视图观看文章</font></p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/大纲视图.png" alt="如何使用大纲视图" /></p><h1 id="实训4.1段式内存管理">实训4.1：段式内存管理</h1><h2 id="第一关第二关不是自己做的略过">第一关，第二关：不是自己做的<img src="https://tb2.bdstatic.com/tb/editor/images/face/i_f25.png?t=20140803" />，略过</h2><h2 id="第三关0号进程和1号进程的mynext变量的取值变化">第三关：0号进程和1号进程的mynext变量的取值变化</h2><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#终端1</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/1.3.tgz ~/os/</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.3.tgz</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1.3 cur</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:155</span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 连输7个c</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span></code></pre></div><p>只能查到进程一的mynext，不会查进程0的mynext</p><p>不过我搞到了答案</p><pre class="shell"><code>1.1 号进程的 output_char 函数调用会执行几次？(6)2.每次调用时，1 号进程和 0 号进程的 mynext 变量的值分别是多少？(1,1)(2,7)(3,7)(4,7)(5,7)(6,7)注：如果括号不够可以自行使用英文括号补充格式为(,)，如果括号数量不对评测时将会报错。</code></pre><h2 id="第四关ldtr-寄存器">第四关：LDTR 寄存器</h2><h3 id="实验方法">实验方法</h3><p>先通过gdb找到main.c:155对应的汇编指令位置为0x6969。 然后找到main.c:171对应的汇编指令位置为0x69cf。 查看寄存器值和段描述符，查看ldtr的值，算出gdt索引为7，和对应的段起始地址。 再查看gdb中0，1号进程对应的ldt位置，查询命令为</p><pre class="gdb"><code>p &amp;current-&gt;ldt</code></pre><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6969</span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">x/16wx</span> 0x5cc0</span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x69cf</span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span></code></pre></div><h3 id="本关答案">本关答案</h3><div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.1</span> 号进程（在用户态）运行时，LDTR 寄存器的值是多少？<span class="er">(</span><span class="ex">0x0038</span><span class="kw">)</span><span class="ex">它指向</span> GDT 中的几号描述符？<span class="er">(</span><span class="ex">7</span><span class="kw">)</span><span class="ex">该段描述符内存的段起始地址是多少？</span><span class="er">(</span><span class="ex">0xfff2d0</span><span class="kw">)</span><span class="ex">指向哪个进程的</span> ldt 数组？<span class="er">(</span><span class="ex">1</span><span class="kw">)</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.0</span> 号进程（在用户态）运行时，LDTR 寄存器的值是多少？<span class="er">(</span><span class="ex">0x0028</span><span class="kw">)</span><span class="ex">它指向</span> GDT 中的几号描述符？<span class="er">(</span><span class="ex">5</span><span class="kw">)</span><span class="ex">该段描述符内存的段起始地址是多少？</span><span class="er">(</span><span class="ex">0x1ed70</span><span class="kw">)</span><span class="ex">指向哪个进程的</span> ldt 数组？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span></code></pre></div><h2 id="第五关内核代码段和数据段的段基址">第五关：内核代码段和数据段的段基址</h2><h3 id="注意">注意</h3><p>基地址就是段起始地址！</p><h3 id="实验方法-1">实验方法</h3><p>以下是GDB中的操作</p><div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_pause</span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/6wx</span> gdt</span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 发现cs:0x0008,ds:0x0010,说明段起始地址在gdt中索引分别为1，2，计算cs和ds基地址为0x0</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">x/6wx</span> gdt</span></code></pre></div><h3 id="本关答案-1">本关答案</h3><div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0</span> 号进程执行到 sys_pause 时，默认数据段（CS）和默认数据段（DS）的值分别是多少？<span class="er">(</span><span class="ex">0x0008</span><span class="kw">)(</span><span class="ex">0x0010</span><span class="kw">)</span><span class="ex">其基地址分别是多少？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.1</span> 号进程执行到 sys_pause 时，默认数据段（CS）和默认数据段（DS）的值分别是多少？<span class="er">(</span><span class="ex">0x0008</span><span class="kw">)(</span><span class="ex">0x0010</span><span class="kw">)</span><span class="ex">其基地址分别是多少？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span></code></pre></div><h1 id="实训4.2-页式内存管理">实训4.2 页式内存管理</h1><h2 id="第一关1-号进程的-mynext-变量的物理地址">第一关：1 号进程的 mynext 变量的物理地址</h2><h3 id="补充">补充</h3><p>每个目录项和页表项都是以<strong>4字节</strong> (32位机器)的长度存储的数据. 由于页面表和页面的起始地址都总是在4K字节的边界上, 这些指针的低12位都永远是0.</p><h3 id="实验方法-2">实验方法</h3><div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6969</span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span> <span class="co"># 页表起始地址CR3为0</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2282c</span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 线性地址为0x402282c</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 页目录项索引0x10(在页目录的第16号)，页表索引0x22(在页表的第34号)</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0 <span class="co"># 这里的0是CR3的值，发现页表基址为0xffe000(页表项的后12位都是0)</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000 <span class="co"># 页帧起始地址0x00022(页表元素的前12位)</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2282c</span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000</span></code></pre></div><h3 id="实验答案">实验答案</h3><div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.1</span> 号进程第 1 次调用函数 output_char 时，它的 mynext 变量的物理地址是多少？<span class="er">(</span><span class="ex">0x2282c</span><span class="kw">)</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.1</span> 号进程第 2 次调用函数 output_char 时，它的 mynext 变量的物理地址是多少？<span class="er">(</span><span class="ex">0xffc82c</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关0-号进程的-mynext-变量的物理地址">第二关：0 号进程的 mynext 变量的物理地址</h2><h3 id="实验方法-3">实验方法</h3><div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x69d9</span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2282c</span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 线性地址为0x402282c</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 页目录项索引0x0(在页目录的第0号)，页表索引0x22(在页表的第34号)</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0x00001000</span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0x00001000</span></code></pre></div><h3 id="本关答案-2">本关答案</h3><div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">都是0x2282c</span></span></code></pre></div><h2 id="第三关页目录和页表的变化">第三关：页目录和页表的变化</h2><h3 id="实验方法-4">实验方法</h3><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6969</span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000</span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> tab</span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000</span><span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> tab</span></code></pre></div><p>本关答案</p><div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 1 号进程第 1 次开始执行 output_char 函数调用时，线性地址空间到物理地址空间的映射关系是怎样的？</span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="ex">0x00000000-0x00ffffff-</span><span class="op">&gt;</span>0x00000000-0x00ffffff<span class="kw">)</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">0x04000000-0x04024fff-</span><span class="op">&gt;</span>0x00000000-0x00024fff<span class="kw">)</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span><span class="er">(</span><span class="ex">0x04025000-0x04025fff-</span><span class="op">&gt;</span>0x00ffd000-0x00ffdfff<span class="kw">)</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span><span class="er">(</span><span class="ex">0x04026000-0x0409ffff-</span><span class="op">&gt;</span>0x00026000-0x0009ffff<span class="kw">)</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 1 号进程第 2 次开始执行 output_char 函数调用时，线性地址空间到物理地址空间的映射关系是怎样的？</span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span><span class="er">(</span><span class="ex">0x00000000-0x00ffffff-</span><span class="op">&gt;</span>0x00000000-0x00ffffff<span class="kw">)</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6.</span><span class="er">(</span><span class="ex">0x04000000-0x04021fff-</span><span class="op">&gt;</span>0x00000000-0x00021fff<span class="kw">)</span></span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">7.</span><span class="er">(</span><span class="ex">0x04022000-0x04022fff-</span><span class="op">&gt;</span>0x00ffc000-0x00ffcfff<span class="kw">)</span></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">8.</span><span class="er">(</span><span class="ex">0x04023000-0x04024fff-</span><span class="op">&gt;</span>0x00023000-0x00024fff<span class="kw">)</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">9.</span><span class="er">(</span><span class="ex">0x04025000-0x04025fff-</span><span class="op">&gt;</span>0x00ffd000-0x00ffdfff<span class="kw">)</span></span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">10.</span><span class="er">(</span><span class="ex">0x04026000-0x0409ffff-</span><span class="op">&gt;</span>0x00026000-0x0009ffff<span class="kw">)</span></span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 1 号进程的第 1、2 次 output_char 函数调用之间，页目录和页表发生了怎样的变化？</span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ex">11.页表项</span><span class="er">(</span><span class="ex">0x00ffe088</span><span class="kw">)</span><span class="ex">的值由原来的</span><span class="er">(</span><span class="ex">0x00022065</span><span class="kw">)</span><span class="ex">变为了</span><span class="er">(</span><span class="ex">0x00ffc067</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关用户栈和核心栈的物理位置">第四关：用户栈和核心栈的物理位置</h2><h3 id="实验方法-5">实验方法</h3><div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一，这次1环境跑到exp4里了。。。</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp4/1.tgz ~/os/</span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.tgz</span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1 cur</span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span></code></pre></div><div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> schedule</span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]</span><span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]</span><span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> task0</span><span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 打开dbg</span></span><span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 今后再用GDB，就是查询寄存器变量了</span></span></code></pre></div><div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x7963</span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x1fa20 <span class="co">#查看当前进程地址</span></span><span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2573c</span><span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0</span><span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/38wx</span> 0x1000</span><span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6f46</span><span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x1fa20</span><span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># sreg查不到寄存器具体的值，我是用gdb查的，有谁能告诉我</span></span><span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 怎么再bochs查寄存器的值吗，发个邮件如何？</span></span><span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x8:0x1f9f0</span><span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0</span><span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="ex">x/32wx</span> 0x1000</span><span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x7985</span><span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x1fa20</span><span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2573c</span><span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="ex">x/38wx</span> 0xffe000</span><span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x1fa20</span><span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x10:0xffffd0</span><span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="ex">x/4wx</span> 0</span><span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="ex">x/1024wx</span> 0x4000</span></code></pre></div><h3 id="本关答案-3">本关答案</h3><div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">使用版本</span> 1 内核时，在第 2 次进程调度后：</span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0</span> 号进程和 1 号进程的进程控制块的地址分别是多少？<span class="er">(</span><span class="ex">0x1ea20</span><span class="kw">)(</span><span class="ex">0xfff000</span><span class="kw">)</span></span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.执行到函数</span> task0 时，0 号进程的用户栈栈顶位于物理内存何处？<span class="er">(</span><span class="ex">0x2573c</span><span class="kw">)</span></span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.0</span> 号进程执行到函数 sys_pause 时，核心栈栈顶位于物理内存何处？<span class="er">(</span><span class="ex">0x1f9f0</span><span class="kw">)</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.执行到函数</span> task1 时，1 号进程的用户栈栈顶位于物理内存何处？<span class="er">(</span><span class="ex">0xffd73c</span><span class="kw">)</span></span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5.1</span> 号进程执行到函数 sys_pause 时，核心栈栈顶位于物理内存何处？<span class="er">(</span><span class="ex">0xffffd0</span><span class="kw">)</span></span></code></pre></div><h1 id="实训4.3段页式内存管理">实训4.3：段页式内存管理</h1><h2 id="第一关进程创建前后页目录和页表的变化">第一关：进程创建前后页目录和页表的变化</h2><h3 id="实验方法-6">实验方法</h3><blockquote><p>作者：富平理查德</p><p>不是RedLeaves自己做的~<img src="https://tb2.bdstatic.com/tb/editor/images/face/i_f25.png?t=20140803" />)，讲解以后再补</p></blockquote><div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6908 <span class="co"># (gdb操作中可知)</span></span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> tab</span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">next</span></span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ex">next</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x690a</span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> tab</span><span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0</span></code></pre></div><h3 id="本关答案-4">本关答案</h3><div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 0 号进程执行 fork 系统调用之前，线性地址空间到物理地址空间的映射关系是怎样的？</span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="ex">0x00000000-0x00ffffff-</span><span class="op">&gt;</span>0x00000000-0x00ffffff<span class="kw">)</span></span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 0 号进程刚执行完 fork 系统调用时，线性地址空间到物理地址空间的映射关系是怎样的？</span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">0x00000000-0x00ffffff-</span><span class="op">&gt;</span>0x00000000-0x00ffffff<span class="kw">)(</span><span class="ex">0x04000000-0x0409ffff-</span><span class="op">&gt;</span>0x00000000-0x0009ffff<span class="kw">)</span></span><span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">在</span> 0 号进程执行 fork 系统调用前后，页目录发生了怎样的变化？</span><span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3.页目录项</span><span class="er">(</span><span class="ex">0x0000000c</span><span class="kw">)</span><span class="ex">的值由原来的</span><span class="er">(</span><span class="ex">0x00004007</span><span class="kw">)</span><span class="ex">变为了</span><span class="er">(</span><span class="ex">0x00004027</span><span class="kw">)</span></span><span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">4.页目录项</span><span class="er">(</span><span class="ex">0x00000040</span><span class="kw">)</span><span class="ex">的值由原来的</span><span class="er">(</span><span class="ex">0x00000000</span><span class="kw">)</span><span class="ex">变为了</span><span class="er">(</span><span class="ex">0x00ffe007</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关1-号进程对-mynext-变量的第一次修改">第二关：1 号进程对 mynext 变量的第一次修改</h2><blockquote><p>作者：富平理查德</p><p>不是RedLeaves自己做的~<img src="https://tb2.bdstatic.com/tb/editor/images/face/i_f25.png?t=20140803" />，但是做了一些完善，讲解以后再补</p></blockquote><h3 id="实验方法-7">实验方法</h3><div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这次的1.3怎么放在exp2里了。。。</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp2/1.3.tgz ~/os/</span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.3.tgz</span><span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1.3 cur</span><span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span></code></pre></div><div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6980 <span class="co"># 注意：这里是评分点，必须亲自用GDB下断点再disas查一下</span></span><span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x17:0x2282c</span><span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000</span><span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span><span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="ex">u/35</span></span><span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0xb1d6</span><span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="ex">x/35wx</span> 0xffe000</span><span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span><span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="ex">xp/wx</span> 0x2282c</span><span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span><span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="ex">xp/wx</span> 0xffc82c</span></code></pre></div><h3 id="本关答案-5">本关答案</h3><div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.1</span> 号进程修改 mynext 变量的指令地址是多少？<span class="er">(</span><span class="ex">0x6988</span><span class="kw">)</span></span><span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.1</span> 号进程的 mynext 变量的线性地址是多少？<span class="er">(</span><span class="ex">0x402282c</span><span class="kw">)</span></span><span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.在</span> 1 号进程第一次修改 mynext 变量之前，上述线性地址对应的页表项的值是多少？<span class="er">(</span><span class="ex">0x22065</span><span class="kw">)</span><span class="ex">该线性地址被映射到的物理地址（旧物理地址）是多少？</span><span class="er">(</span><span class="ex">0x2282c</span><span class="kw">)</span></span><span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.在</span> 1 号进程第一次修改 mynext 变量时，会引发页故障，在页故障处理程序刚开始执行时，CR2 寄存器的值是多少？<span class="er">(</span><span class="ex">0x402282c</span><span class="kw">)</span></span><span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.在此页故障处理完回到恢复点时，恢复点的地址是什么？</span><span class="er">(</span><span class="ex">0xb1d6</span><span class="kw">)</span><span class="ex">此时上述线性地址对应的页表项的值是多少？</span><span class="er">(</span><span class="ex">0x00ffc007</span><span class="kw">)</span><span class="ex">该线性地址被映射到的物理地址（新物理地址）是多少？</span><span class="er">(</span><span class="ex">0x00ffc82c</span><span class="kw">)</span></span><span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.在恢复点指令执行后，上述新物理地址处的值是多少？</span><span class="er">(</span><span class="ex">0x00000002</span><span class="kw">)</span><span class="ex">上述旧物理地址处的值是多少？</span><span class="er">(</span><span class="ex">0x00000001</span><span class="kw">)</span></span></code></pre></div><h2 id="第三关-第一次页故障">第三关 第一次页故障</h2><h3 id="实验方法-8">实验方法</h3><div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 打开GDB，查询page_fault地址为0xb124</span></span><span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0xb124</span><span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x1fa20</span><span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">creg</span></span><span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">x/38wx</span> 0xffe000</span><span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x690a</span><span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="ex">x/17wx</span> 0</span><span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="ex">x/38wx</span> 0xffe000</span><span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 在已经开启的GDB中输入</span></span><span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:145</span><span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x6908</span></code></pre></div><h3 id="本关答案-6">本关答案</h3><div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">系统的第一次页故障发生时：</span></span><span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.当时正在执行几号进程？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">正在访问的线性地址是多少？</span><span class="er">(</span><span class="ex">0x0402574c</span><span class="kw">)</span></span><span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.该线性地址当时对应的页表项是什么？</span><span class="er">(</span><span class="ex">0x00025065</span><span class="kw">)</span><span class="ex">被映射到的物理地址是什么？</span><span class="er">(</span><span class="ex">0x0002574c</span><span class="kw">)</span></span><span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.该页故障处理完后，该线性地址对应的页表项是什么？</span><span class="er">(</span><span class="ex">0x00ffd007</span><span class="kw">)</span><span class="ex">被映射到的物理地址是什么？</span><span class="er">(</span><span class="ex">0x00ffd74c</span><span class="kw">)</span></span><span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.引发这次页故障的指令地址是什么？</span><span class="er">(</span><span class="ex">0x690a</span><span class="kw">)</span></span><span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5.</span> main 函数中的 fork 系统调用的陷入指令的地址是多少？<span class="er">(</span><span class="ex">0x6908</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关父子进程间的共享内存通信实现">第四关：父子进程间的共享内存通信实现</h2><h3 id="原理分析">原理分析</h3><p>现在还没弄懂<img src="https://tb2.bdstatic.com/tb/editor/images/face/i_f35.png?t=20140803" /></p><h3 id="实验方法-9">实验方法</h3><p>修改memory.c的for循环</p><div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span> <span class="op">;</span> nr<span class="op">--</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">;</span> from_page_table<span class="op">++,</span>to_page_table<span class="op">++)</span> <span class="op">&#123;</span></span><span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    this_page <span class="op">=</span> <span class="op">*</span>from_page_table<span class="op">;</span></span><span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!(</span><span class="dv">1</span> <span class="op">&amp;</span> this_page<span class="op">))</span></span><span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span><span class="op">;</span></span><span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>to_page_table <span class="op">==</span> <span class="bn">0xffe088</span><span class="op">)</span> this_page <span class="op">|=</span> <span class="dv">2</span><span class="op">;</span></span><span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> this_page <span class="op">&amp;=</span> <span class="op">~</span><span class="dv">2</span><span class="op">;</span></span><span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>to_page_table <span class="op">=</span> this_page<span class="op">;</span></span><span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>this_page <span class="op">&gt;</span> LOW_MEM<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>from_page_table <span class="op">=</span> this_page<span class="op">;</span></span><span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        this_page <span class="op">-=</span> LOW_MEM<span class="op">;</span></span><span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        this_page <span class="op">&gt;&gt;=</span> <span class="dv">12</span><span class="op">;</span></span><span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        mem_map<span class="op">[</span>this_page<span class="op">]++;</span></span><span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>修改main.c的如下两个片段</p><p>151行左右</p><div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>fork<span class="op">())</span> <span class="op">&#123;</span>      <span class="co">/* we count on this going ok */</span></span><span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>mysignal<span class="op">(</span>SIGALRM<span class="op">,</span> SIG_IGN<span class="op">);</span></span><span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> flag <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(;;)</span> <span class="op">&#123;</span></span><span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>flag <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            flag <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            output_char<span class="op">(</span><span class="ch">&#39;A&#39;</span> <span class="op">+</span> mynext<span class="op">);</span></span><span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>            mynext<span class="op">++;</span></span><span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>            mynext <span class="op">++;</span></span><span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            mynext <span class="op">%=</span> <span class="dv">26</span><span class="op">;</span></span><span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>            output_char<span class="op">(</span><span class="ch">&#39;A&#39;</span> <span class="op">+</span> mynext<span class="op">);</span></span><span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        alarm<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        pause<span class="op">();</span> </span><span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  init();</span></span><span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>第170行左右</p><div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(;;)</span> <span class="op">&#123;</span>            <span class="co">/* wyj */</span></span><span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    output_char<span class="op">(</span><span class="ch">&#39;a&#39;</span> <span class="op">+</span> mynext<span class="op">);</span></span><span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    mynext<span class="op">++;</span></span><span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    mynext <span class="op">%=</span> <span class="dv">26</span><span class="op">;</span></span><span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    pause<span class="op">();</span> </span><span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>别忘了<font size = 6 color = "red">编译！</font></p><h1 id="实训4.4页式虚存">实训4.4：页式虚存</h1><h2 id="第一关版本-0-内核的第一次缺页页故障">第一关：版本 0 内核的第一次缺页页故障</h2><h3 id="实验方法-10">实验方法</h3><div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_no_page</span><span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> address</span><span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>start_code</span><span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">x/32wx</span> 0</span><span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> 0x8000000 <span class="op">&gt;&gt;</span> 22</span><span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="er">(</span><span class="ex">unsigned</span><span class="kw">)</span><span class="ex">0x8000000</span><span class="op">&lt;&lt;10&gt;&gt;</span>22</span><span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>p/x current-&gt;start_code</span><span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>b memory.c:381</span><span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>b memory.c:387</span><span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>b memory.c:394</span><span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>c</span><span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>p/x page</span><span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>n</span><span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>p/x page</span><span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>x/4wx 0xffa000</span><span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>c</span><span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>n</span><span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>x/4wx 0xffa000</span><span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>p/x page</span><span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>c</span><span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>n</span><span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>p/x page</span><span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>p/x 0xffa000</span><span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>x/33wx 0</span><span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>x/33wx 0xff7000</span></code></pre></div><h3 id="本关答案-7">本关答案</h3><div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.该页故障由几号进程引发？</span><span class="er">(</span><span class="ex">2</span><span class="kw">)</span></span><span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.在该故障发生前，该进程执行的最后一个可执行文件是什么？</span><span class="er">(</span><span class="ex">/bin/sh</span><span class="kw">)</span><span class="ex">该可执行文件的第2块（每块1KB）的头16字节的内容是什么？</span><span class="er">(</span><span class="ex">8b</span> 44 24 08 a3 00 f0 02 00 e8 26 01 00 00 6a 00<span class="kw">)</span></span><span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">头16字节的内容按照</span><span class="er">(</span><span class="ex">00</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<span class="kw">)</span><span class="ex">这种格式填写。</span></span><span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.引发该页故障的线性地址是什么？</span><span class="er">(</span><span class="ex">0x8000000</span><span class="kw">)</span><span class="ex">该进程的代码段起始地址是多少？</span><span class="er">(</span><span class="ex">0x8000000</span><span class="kw">)</span></span><span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.该页故障处理前，该线性地址对应的页目录项的地址和值分别是什么？</span><span class="er">(</span><span class="ex">0x80</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5.该页故障处理时，申请到的空闲页帧的起始地址是什么？</span><span class="er">(</span><span class="ex">0xffa000</span><span class="kw">)</span><span class="ex">该页帧的头16字节的内容是什么？</span><span class="er">(</span><span class="ex">00</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<span class="kw">)</span></span><span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="ex">6.该页故障处理过程中、读入硬盘数据后，上述页帧的头16字节的内容是什么？</span><span class="er">(</span><span class="ex">8b</span> 44 24 08 a3 00 f0 02 00 e8 26 01 00 00 6a 00<span class="kw">)</span></span><span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">7.该页故障处理过程中、修改对应的页表项后，上述线性地址对应的页表项的值是什么？</span><span class="er">(</span><span class="ex">0x00ffa007</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关第一次使用零页的缺页页故障">第二关：第一次使用零页的缺页页故障</h2><h3 id="补充mcopy命令">补充：mcopy命令</h3><p>Linux mcopy命令用来复制 MSDOS 格式文件到 Linux 中，或是由 Linux 中复制 MSDOS 文件到磁片上。</p><p>mcopy 可复制单一的文件到所指定的文件名称，或是复制数个文件到所指定的目录之中。来源与目的文件可为 MSDOS 或是 Linux 文件。</p><p>mcopy指令是一种mtools工具指令，可以在DOS系统中复制文件或者在DOS与Linux操作系统之间进行文件复制。</p><h4 id="命令语法">命令语法</h4><div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mcopy</span> [-bspanvmQT] [-D clash_option] sourcefile targetfile</span><span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mcopy</span> [-bspanvmQT] [-D clash_option] sourcefile [ sourcefiles... ] targetdirectory</span><span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">mcopy</span> [-tnvm] MSDOSsourcefile</span></code></pre></div><h4 id="实例将虚拟机中binsh文件复制到b盘中">实例：将虚拟机中/bin/sh文件复制到”b盘“中</h4><div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mcopy</span> /bin/sh b:</span></code></pre></div><h4 id="注意-1">注意</h4><p>mcopy命令在<strong>关机后</strong>才会生效，当复制的内容包括子目录和文件时，必须使用参数"-/"递归操作。</p><h4 id="参考资料">参考资料</h4><p><a href="https://www.gnu.org/software/mtools/manual/html_node/mcopy.html">Mtools 4.0.20: mcopy (gnu.org)</a></p><p><a href="https://www.runoob.com/linux/linux-comm-mcopy.html">Linux mcopy命令 | 菜鸟教程 (runoob.com)</a></p><h3 id="实验方法-11">实验方法</h3><p>本次实验分为两步</p><h4 id="第一步查看sh文件的vma">第一步：查看sh文件的VMA</h4><p>将/bin/sh文件从虚拟机复制到~/os/linux-0.11-lab/b目录下</p><p>使用objdump命令查看VMA(起始虚拟地址)</p><div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-dlx</span> sh <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div><p>查看结果如下</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/实训4.4-L2-objdump.png" alt="objdump查看结果" /></p><h4 id="第二步在gdb中调试">第二步：在GDB中调试</h4><div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_no_page</span><span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_execve</span><span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 2</span><span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> curent-<span class="op">&gt;</span>start_code + filename</span><span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> memory.c:376</span><span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> address</span><span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="ex">x/33wx</span> 0</span><span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="ex">x/51wx</span> 0xff7000</span><span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="ex">x/33wx</span> 0</span><span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="ex">x/51wx</span> 0xff7000</span><span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="ex">x/4wx</span> 0xff2000</span></code></pre></div><h3 id="本关答案-8">本关答案</h3><div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.该页故障由几号进程引发？</span><span class="er">(</span><span class="ex">2</span><span class="kw">)</span></span><span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.在该故障发生前，该进程执行的最后一个可执行文件是什么？</span><span class="er">(</span><span class="ex">/bin/sh</span><span class="kw">)</span><span class="ex">该可执行文件的未初始化数据段（BSS）的起始虚拟地址（VMA）是什么？</span><span class="er">(</span><span class="ex">0x32000</span><span class="kw">)</span></span><span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.引发该页故障的线性地址是什么？</span><span class="er">(</span><span class="ex">0x8032000</span><span class="kw">)</span></span><span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.该页故障处理前，该线性地址对应的页表项的地址和值分别是什么？</span><span class="er">(</span><span class="ex">0xff70c8</span><span class="kw">)(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.该页故障处理后，上述线性地址对应的页表项的值是什么？</span><span class="er">(</span><span class="ex">0x00ff2007</span><span class="kw">)</span><span class="ex">该线性地址被映射到的零页（新页帧）的起始地址是什么？</span><span class="er">(</span><span class="ex">0xff2000</span><span class="kw">)</span></span><span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.该新页帧的头</span> 16 个字节是什么？<span class="er">(</span><span class="ex">00</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<span class="kw">)</span></span><span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="ex">头</span> 16 个字节按照<span class="er">(</span><span class="ex">00</span> 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<span class="kw">)</span></span></code></pre></div><h2 id="第三关可执行文件的执行">第三关：可执行文件的执行</h2><h3 id="实验方法-12">实验方法</h3><p>在Ubuntu</p><div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/01.c ~/os/linux-0.11-lab/b</span></code></pre></div><p>在Bochs虚拟机内输入以下命令，然后关闭虚拟机</p><pre class="ba"><code>mcopy b:01.c /usr/rootgcc 01.c -o 01sync</code></pre><p>打开GDB调试</p><div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_execve</span><span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 2</span><span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code + filename</span><span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 一直c到continuing.</span></span></code></pre></div><p>在Bochs中输入</p><div class="sourceCode" id="cb38"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/root/01</span></span></code></pre></div><p>回到GDB，可以看到打印出了当前运行的程序，然后进行下列操作</p><div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>start_code</span><span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>brk</span><span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ex">x/65wx</span> 0</span><span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="ex">x/68wx</span> 0xfb5000</span><span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="ex">finish</span></span><span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>start_code</span><span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>brk</span><span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="ex">x/65wx</span> 0</span><span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/wx</span> 0x100</span></code></pre></div><h3 id="本关答案-9">本关答案</h3><div class="sourceCode" id="cb40"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.执行该文件的execve系统调用刚开始执行时，该进程的用户虚空间是什么？</span><span class="er">(</span><span class="ex">0x10000000~0x10043fff</span><span class="kw">)</span><span class="ex">该空间的第一个页表项和最后一个页表项分别是什么？</span><span class="er">(</span><span class="ex">0x00ff9025</span><span class="kw">)(</span><span class="ex">0x00fea065</span><span class="kw">)</span></span><span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.执行该文件的execve系统调用执行结束时，该进程的用户虚空间是什么？</span><span class="er">(</span><span class="ex">0x10000000~0x10004fff</span><span class="kw">)</span><span class="ex">该空间占据几个页目录项？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">第一个页目录项的地址和值分别是什么？</span><span class="er">(</span><span class="ex">0x100</span><span class="kw">)(</span><span class="ex">0x00000000</span><span class="kw">)</span></span><span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.该可执行文件的代码段和数据段的长度之和是多少？</span><span class="er">(</span><span class="ex">0x5000</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关可执行文件的加载">第四关：可执行文件的加载</h2><p>未完待续</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 编译原理实训1</title>
      <link href="/2021/10/06/Compiler/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E8%AE%AD1/"/>
      <url>/2021/10/06/Compiler/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E8%AE%AD1/</url>
      
        <content type="html"><![CDATA[<h2 id="用lexflex生成pl语言的词法分析器2021.09">用LEX(FLEX)生成PL语言的词法分析器(2021.09)</h2><h3 id="第1关-什么是lexflex">第1关 什么是lex/flex？</h3><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* 简单词法分析器 */</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* 功能：能够识别出以小写字母ab结尾的所有字符串（仅含大小写字母）并给打印&#39;Hit!&#39; */</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* 说明：在下面的begin和end之间添加代码，已经实现了标识符和整常量的识别，你需要完成剩下的部分，加油吧！ */</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 提示：你只需要保证合法的输入（以字符双引号开头和结尾的字符串、中间是若干(可空)英文大小写字母的符号串的识别）*/</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%&#123;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">%&#125;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="co">/* begin */</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>\<span class="st">&quot;[a-zA-Z]*</span><span class="sc">\&quot;</span><span class="st"> &#123;printf(&quot;</span><span class="op">%</span>s<span class="op">:</span> Hit<span class="op">!</span>\n<span class="st">&quot;, yytext);&#125;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="co">/* end */</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>\n    <span class="op">&#123;&#125;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">.</span>    <span class="op">&#123;&#125;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> yywrap<span class="op">()</span> <span class="op">&#123;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">&#125;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!(</span>yyin <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">&quot;r&quot;</span><span class="op">)))</span> <span class="op">&#123;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>   perror<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">&#125;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a> <span class="op">&#125;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span> <span class="op">(</span>yylex<span class="op">());</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="第2关-用flex生成pl语言的词法分析器">第2关 用flex生成PL语言的词法分析器</h3><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* PL词法分析器 */</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* 功能：能够识别出PL支持的所有单词符号并给出种别值 */</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* 说明：在下面的begin和end之间添加代码，已经实现了标识符和整常量的识别，你需要完成剩下的部分，加油吧！ */</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* 提示：因为是顺序匹配，即从上至下依次匹配规则，所以需要合理安排顺序～ */</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">%&#123;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">%&#125;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> <span class="co">/* begin */</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>INTCON   <span class="op">[</span>\<span class="op">-]?[</span><span class="dv">1</span><span class="op">-</span><span class="dv">9</span><span class="op">][</span><span class="dv">0</span><span class="op">-</span><span class="dv">9</span><span class="op">]*|</span><span class="dv">0</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>IDENT   <span class="op">[</span>A<span class="op">-</span>Za<span class="op">-</span>z<span class="op">][</span>A<span class="op">-</span>Za<span class="op">-</span>z0<span class="op">-</span><span class="dv">9</span><span class="op">]*</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>CHARCON \&#39;<span class="op">[^</span>&#39;<span class="op">]*</span>\&#39;</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>PLUS    \<span class="op">+</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>MINUS   \<span class="op">-</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>TIMES   \<span class="op">*</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>DIVSYM  \<span class="op">/</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>EQL     \<span class="op">=</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>NEQ     \<span class="op">&lt;</span>\<span class="op">&gt;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>LEQ     \<span class="op">&lt;</span>\<span class="op">=</span> </span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>GEQ     \<span class="op">&gt;</span>\<span class="op">=</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>LSS     \<span class="op">&lt;</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>GTR     \<span class="op">&gt;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>LBRACK  \<span class="op">[</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>RBRACK  \<span class="op">]</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>LPAREN  \<span class="op">(</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>RPAREN  \<span class="op">)</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>COMMA   \<span class="op">,</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>SEMICOLON \<span class="op">;</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>PERIOD  \<span class="op">.</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>BECOME  \<span class="op">:</span>\<span class="op">=</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>COLON   \<span class="op">:</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>ERROR   <span class="op">[~!</span>@#$<span class="op">%^&amp;</span>_\\<span class="op">]</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a> </span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a> <span class="co">/* end */</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a> <span class="co">/* begin */</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>of               <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: OFSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>array        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ARRAYSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>program        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: PROGRAMSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>mod            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: MODSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>and            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ANDSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>or            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ORSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>not            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: NOTSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>begin        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: BEGINSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>end            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ENDSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: IFSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>then        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: THENSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ELSESYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: WHILESYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span>            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: DOSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>call        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: CALLSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span>        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: CONSTSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>type        <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: TYPESYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>var            <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: VARSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>procedure    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: PROCSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>INTCON<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: INTCON %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>IDENT<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: IDENT %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>CHARCON<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: CHARCON %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>PLUS<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: PLUS NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>MINUS<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: MINUS %s</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>TIMES<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: TIMES NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>DIVSYM<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: DIVSYM NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>EQL<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: EQL NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>NEQ<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: NEQ NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>LEQ<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: LEQ NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>GEQ<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: GEQ NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>LSS<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: LSS NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>GTR<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: GTR NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>LBRACK<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: LBRACK NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>RBRACK<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: RBRACK NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>LPAREN<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: LPAREN NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>RPAREN<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: RPAREN NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>COMMA<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: COMMA NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>SEMICOLON<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: SEMICOLON NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>PERIOD<span class="op">&#125;</span>    <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: PERIOD NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>BECOME<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: BECOME NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>COLON<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: COLON NULL</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span>ERROR<span class="op">&#125;</span>      <span class="op">&#123;</span>printf<span class="op">(</span><span class="st">&quot;%s: ERROR</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> yytext<span class="op">);&#125;</span></span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a> </span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a> <span class="co">/* end */</span></span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>\n    <span class="op">&#123;&#125;</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="op">.</span>    <span class="op">&#123;&#125;</span></span><span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span></span><span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> yywrap<span class="op">()</span> <span class="op">&#123;</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span> <span class="op">&#125;</span></span><span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span><span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="op">(</span>argc <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!(</span>yyin <span class="op">=</span> fopen<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">&quot;r&quot;</span><span class="op">)))</span> <span class="op">&#123;</span></span><span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>   perror<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="op">&#125;</span></span><span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a> <span class="op">&#125;</span></span><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span> <span class="op">(</span>yylex<span class="op">());</span></span><span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> 编译器前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 编译原理 </tag>
            
            <tag> 模拟实训 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机基本概念</title>
      <link href="/2021/10/03/Programming%20Language/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
      <url>/2021/10/03/Programming%20Language/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h2 id="概念一逻辑移位和算数移位">概念一：逻辑移位和算数移位</h2><p>在左移的情况下，逻辑移位和算数移位概念不必区分。</p><p>在右移的情况下：</p><ol type="1"><li><p>逻辑移位：</p><p>在C语言中，无符号数使用逻辑移位，左面的位用0补齐，例子中的数为一个8位二进制数</p><p>举例</p><p><span class="math inline">\((01100011)_2 \stackrel{\text{逻辑右移一位}}{\rightarrow} (00110001)_2\)</span></p><p><span class="math inline">\((11100011)_2 \stackrel{\text{逻辑右移一位}}{\rightarrow} (01110001)_2\)</span></p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">;</span></span></code></pre></div></li><li><p>算数移位：</p><p>在C语言中，有符号数使用算数移位，左面的位用高位补齐，例子中的数为一个8位二进制数</p><p>举例</p><p><span class="math inline">\((01100011)_2 \stackrel{逻辑右移一位}{\rightarrow} (00110001)_2\)</span></p><p><span class="math inline">\((11100011)_2 \stackrel{逻辑右移一位}{\rightarrow} (11110001)_2\)</span></p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">;</span></span></code></pre></div></li><li><p>示例</p><p>试说明以下程序的输出：</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> xx <span class="op">=</span> <span class="bn">0xffffffff</span><span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>x <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">));</span><span class="co">//将结果强制以整形输出，-1，即0xffffffff</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span>xx <span class="op">&gt;&gt;</span> <span class="dv">1</span><span class="op">));</span><span class="co">//输出2147483647，即0x7fffffff</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div></li></ol><h2 id="概念二补码">概念二：补码</h2><p>参考资料：<a href="https://zhuanlan.zhihu.com/p/362265365">什么是补码？这是地球上最通俗易懂的补码阐述</a></p><p>补码的思想：一个钟表，当前指向19点，问5个小时前是几点？</p><p>看起来很容易，做一个减法，肯定是14点。</p><p>但是，如果我们现在不会减法，该怎么办？</p><p>5个小时前，在表盘上指针指向的位置，和19小时之后表盘上指针指向的位置相同。</p><p>下图是一个与钟表相近的例子</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/bit_circle.png" alt="补码" /></p><p>推广理解一下，在计算机中，对于有限的c个数位，一个数x减去一个值a与加上一个值b的结果相同。</p><p>此时a + b应该满足互补关系，即a + b的进位超出了c个数位表示的范围，进位被忽略，此时a + b的值刚好为0。</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 进阶 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
            <tag> 中间层 </tag>
            
            <tag> 计算机系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>程序实现方法</title>
      <link href="/2021/09/29/Programming%20Language/%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95/"/>
      <url>/2021/09/29/Programming%20Language/%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="一如何实现多组数据的输入输出">一，如何实现多组数据的输入输出</h2><p>Python中使用异常来完成多组数据的输入输出</p><p>举例：计算a + b的多组输入</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc(a, b) :</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a <span class="op">+</span> b</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> (<span class="va">True</span>) :</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span> :</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                a <span class="op">=</span> <span class="bu">eval</span>(<span class="bu">input</span>())</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                b <span class="op">=</span> <span class="bu">eval</span>(<span class="bu">input</span>())</span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(calc(a, b))</span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">EOFError</span>:</span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span></code></pre></div><h2 id="二c语言二维数组如何作为函数的参数">二，C语言二维数组如何作为函数的参数</h2><p>C语言函数调用二维数组时，为了能找到每一行函数的头指针，要填入列数，多维数组原理与之类似</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> toposort<span class="op">(</span><span class="dt">int</span> G<span class="op">[][</span>MAXN<span class="op">],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>in<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>queue<span class="op"> &lt;</span><span class="dt">int</span><span class="op">&gt;</span> q<span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> p <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> p <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> in<span class="op">[</span>p<span class="op">];</span> q<span class="op">.</span>push<span class="op">(</span>p<span class="op">),</span> <span class="op">++</span>p<span class="op">);</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="三python文件操作">三，Python文件操作</h2><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1.打开文件</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;read.txt&quot;</span>)</span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. 读取文件内容</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="bu">file</span>.read()</span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(text)</span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.关闭文件</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span>.close()</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> 编程语言 </tag>
            
            <tag> 技巧 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>.gitignore的使用</title>
      <link href="/2021/09/29/Git/Gitignore/"/>
      <url>/2021/09/29/Git/Gitignore/</url>
      
        <content type="html"><![CDATA[<h2 id="为什么需要.gitignore文件">为什么需要.gitignore文件</h2><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add .</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;0.1&quot;</span></span></code></pre></div><p>上面这两段语句十分简洁，大大方便了代码的提交。</p><p>但有时，一些不必要的文件也会被提交上去。比如可执行文件，或者用户本地配置文件等。人类是懒惰的，我绝不会手动对逐个文件进行添加或删除。这该怎么办？</p><p>这时，我们就需要.gitignore，它会让git我们忽略不必要的文件。</p><h2 id="简单的使用">简单的使用</h2><p>举例</p><p>.gitignore支持通配符，支持忽略目录</p><pre class="gitignore"><code>*.class# Mobile Tools for Java (J2ME).mtj.tmp/# Package Files #*.jar*.war*.ear# virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xmlhs_err_pid*!/foo/foo/*!/foo/bar</code></pre><h2 id="详细的使用文档英文">详细的使用文档(英文)</h2><p><a href="https://git-scm.com/docs/gitignore">Git - gitignore Documentation (git-scm.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>markdown latex的特殊符号</title>
      <link href="/2021/09/22/Markdown/MarkdownSpecialSign/"/>
      <url>/2021/09/22/Markdown/MarkdownSpecialSign/</url>
      
        <content type="html"><![CDATA[<h2 id="一符号速查">一，符号速查</h2><table><colgroup><col style="width: 48%" /><col style="width: 51%" /></colgroup><thead><tr class="header"><th style="text-align: center;">符号</th><th style="text-align: center;">语法</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\sim\)</span></td><td style="text-align: center;"><code>\sim</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\rightarrow\)</span></td><td style="text-align: center;"><code>\rightarrow</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\stackrel{\text{Up}}{\underset{Down}{==}}\)</span></td><td style="text-align: center;"><code>\stackrel&#123;\text&#123;Up&#125;&#125;&#123;\underset&#123;Down&#125;&#123;==&#125;&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\rightleftharpoons\)</span></td><td style="text-align: center;"><code>\rightleftharpoons</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\parallel x \parallel\)</span></td><td style="text-align: center;"><code>\parallel x \parallel</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\sum\)</span>，<span class="math inline">\(\prod\)</span></td><td style="text-align: center;"><code>\sum \prod</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\lfloor x \rfloor\)</span>，<span class="math inline">\(\lceil x \rceil\)</span></td><td style="text-align: center;"><code>\lfloor x \rfloor , \lceil x \rceil</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\cdot\)</span>，<span class="math inline">\(\cdots\)</span></td><td style="text-align: center;"><code>\cdot, \cdots</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\partial\)</span></td><td style="text-align: center;"><code>\partial</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\bigg|\)</span></td><td style="text-align: center;"><code>\bigg\|</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\approx\)</span></td><td style="text-align: center;"><code>\approx</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\infty,\propto\)</span></td><td style="text-align: center;"><code>\infty,\propto</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\overline{y},\hat{y},\tilde{D},\widetilde{D}\)</span></td><td style="text-align: center;"><code>\overline&#123;y&#125;, \hat&#123;y&#125;, \tilde&#123;D&#125;,\widetilde&#123;D&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\triangle,\Delta,\nabla\)</span></td><td style="text-align: center;"><code>\triangle,\nabla</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\int\)</span></td><td style="text-align: center;"><code>\int</code></td></tr></tbody></table><h2 id="二输入箭头及上方字符">二，输入箭头及上方字符</h2><p>大部分符号 … 变成双向只需要将首字母大写，变成长符号只需要在前面加上一个long/Long)</p><hr /><h3 id="效果展示">效果展示</h3><p>效果1 : <span class="math inline">\(2H_{2}O \stackrel{通电}{\rightarrow} 2H_{2} + O_{2}\)</span></p><p>效果2 : <span class="math inline">\(2H_{2}O \stackrel{\text{通电}}{==} 2H_{2} + O_{2}\)</span></p><p>效果3 : <span class="math inline">\(4NH_3 + 5O_2 \stackrel{\text{催化剂}}{\underset{\Delta}{\rightleftharpoons}} 4NO + 6H_2O\)</span></p><p>效果4 : <span class="math inline">\(\stackrel{-2}{^{16}_{8}O^{2-}_2}\)</span></p><h3 id="代码">代码</h3><div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>2H_&#123;2&#125;O \stackrel&#123;通电&#125;&#123;\rightarrow&#125; 2H_&#123;2&#125; + O_&#123;2&#125;</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>2H_&#123;2&#125;O \stackrel&#123;\text&#123;通电&#125;&#125;&#123;==&#125; 2H_&#123;2&#125; + O_&#123;2&#125;</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>4NH_3 + 5O_2 \stackrel&#123;\text&#123;催化剂&#125;&#125;&#123;\underset&#123;\Delta&#125;&#123;\rightleftharpoons&#125;&#125; 4NO + 6H_2O</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>\stackrel&#123;-2&#125;&#123;^&#123;16&#125;_&#123;8&#125;O^&#123;2-&#125;_2&#125;</span></code></pre></div><h3 id="注意">注意</h3><p>在<code>\stackrel</code>中，不需要加花括号的时候不要加。</p><h3 id="更多资料">更多资料</h3><p><a href="https://www.zhihu.com/question/356331842">如何用markdown写化学方程式？ - 知乎 (zhihu.com)</a></p><p><a href="https://www.bilibili.com/video/BV1mK4y147Lq?from=search&amp;seid=4134217629237576756">化学方程式的Markdown打法_哔哩哔哩_bilibili</a></p><p><a href="https://blog.csdn.net/m0_37167788/article/details/78603307">MarkDown - Latex符号(箭头)的整理</a></p><h2 id="三输入矩阵及数字对齐">三，输入矩阵及数字对齐</h2><ol type="1"><li><p>小括号/中括号矩阵，行列式，矩阵间等号</p><p>效果</p><p><span class="math inline">\(\begin{pmatrix}  1 &amp; 0 &amp; 0\\  0 &amp; 1 &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{pmatrix} {=} \begin{bmatrix}  1 &amp; 0 &amp; 0\\  0 &amp; 1 &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{bmatrix} \quad \begin{vmatrix}  1 &amp; 0 &amp; 0\\  0 &amp; 1 &amp; 0\\  0 &amp; 0 &amp; 1\\ \end{vmatrix}\)</span></p><p>代码</p><div class="sourceCode" id="cb2"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">pmatrix</span>&#125;</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ss"> 1 &amp; 0 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 1 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 0 &amp; 1</span><span class="sc">\\</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">pmatrix</span>&#125;</span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>&#123;=&#125;</span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">bmatrix</span>&#125;</span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ss"> 1 &amp; 0 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 1 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 0 &amp; 1</span><span class="sc">\\</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">bmatrix</span>&#125;</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">\quad</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">vmatrix</span>&#125;</span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ss"> 1 &amp; 0 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 1 &amp; 0</span><span class="sc">\\</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ss"> 0 &amp; 0 &amp; 1</span><span class="sc">\\</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">vmatrix</span>&#125;</span></code></pre></div></li><li><p>输入带省略号的矩阵</p><p>效果 <span class="math display">\[\pmb{X}=\begin{pmatrix} x_{11} &amp; x_{12}&amp; \cdots &amp; x_{1d} &amp; 1\\ x_{21} &amp; x_{22}&amp; \cdots &amp; x_{2d} &amp; 1\\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots\\ x_{m1} &amp; x_{m2}&amp; \cdots &amp; x_{md} &amp; 1\\\end{pmatrix}\]</span></p><p>代码</p><div class="sourceCode" id="cb3"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">\pmb</span>&#123;X&#125;=<span class="kw">\begin</span>&#123;<span class="ex">pmatrix</span>&#125;</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ss"> x_&#123;11&#125; &amp; x_&#123;12&#125;&amp; </span><span class="sc">\cdots</span><span class="ss"> &amp; x_&#123;1d&#125; &amp; 1</span><span class="sc">\\</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ss"> x_&#123;21&#125; &amp; x_&#123;22&#125;&amp; </span><span class="sc">\cdots</span><span class="ss"> &amp; x_&#123;2d&#125; &amp; 1</span><span class="sc">\\</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ss"> </span><span class="sc">\vdots</span><span class="ss"> &amp; </span><span class="sc">\vdots</span><span class="ss"> &amp; </span><span class="sc">\ddots</span><span class="ss"> &amp; </span><span class="sc">\vdots</span><span class="ss"> &amp; </span><span class="sc">\vdots\\</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ss"> x_&#123;m1&#125; &amp; x_&#123;m2&#125;&amp; </span><span class="sc">\cdots</span><span class="ss"> &amp; x_&#123;md&#125; &amp; 1</span><span class="sc">\\</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">pmatrix</span>&#125;</span></code></pre></div></li><li><p>实现试卷中对齐的选项效果</p><p>效果</p><p>$</p><span class="math display">\[\begin{array}{cc} (A)\quad 4 &amp; \hspace{4cm}(B)\quad 3\\ (C)\quad 2 &amp; \hspace{4cm}(D)\quad 1 \end{array}\]</span><p>$</p><p>代码</p><div class="sourceCode" id="cb4"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>&#123;<span class="ex">array</span>&#125;&#123;cc&#125;</span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        (A)<span class="fu">\quad</span> 4 &amp; <span class="fu">\hspace</span>&#123;4cm&#125;(B)<span class="fu">\quad</span> 3<span class="fu">\\</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        (C)<span class="fu">\quad</span> 2 &amp; <span class="fu">\hspace</span>&#123;4cm&#125;(D)<span class="fu">\quad</span> 1</span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">array</span>&#125;</span></code></pre></div></li><li><p>表格效果</p><p>效果</p><p><span class="math display">\[\begin{array}{|c|c|} \hline 0 &amp; 1 \\\hline 1 &amp; 0 \\\hline\end{array}\]</span></p><p>代码</p><pre class="lae"><code>\begin&#123;array&#125;&#123;|c|c|&#125;        \hline        0 &amp; 1 \\hline        1 &amp; 0 \\hline\end&#123;array&#125;</code></pre></li><li><p>大括号</p><p>效果</p><p><span class="math inline">\(\begin{cases}  x´=x \text{cos}\theta-y \text{sin}\theta \\  y´=x \text{sin}\theta+y \text{cos}\theta \\  \end{cases}\)</span></p><p>代码</p><div class="sourceCode" id="cb6"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ss">$</span><span class="kw">\begin</span>&#123;<span class="ex">cases</span>&#125;</span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ss">      x´=x </span><span class="sc">\text</span>&#123;cos&#125;<span class="sc">\theta</span><span class="ss">-y </span><span class="sc">\text</span>&#123;sin&#125;<span class="sc">\theta</span><span class="ss"> </span><span class="sc">\\</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ss">      y´=x </span><span class="sc">\text</span>&#123;sin&#125;<span class="sc">\theta</span><span class="ss">+y </span><span class="sc">\text</span>&#123;cos&#125;<span class="sc">\theta</span><span class="ss"> </span><span class="sc">\\</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>&#123;<span class="ex">cases</span>&#125;<span class="ss">$</span></span></code></pre></div></li></ol><p><a href="https://zhuanlan.zhihu.com/p/266267223">更多有关矩阵的写法</a></p><h2 id="四字母的字体加粗下划线">四，字母的字体，加粗，下划线</h2><table><thead><tr class="header"><th style="text-align: center;">效果</th><th style="text-align: center;">语法</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\pmb{Latex}\)</span></td><td style="text-align: center;"><code>\pmb&#123;Latex&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\underline{Latex}\)</span></td><td style="text-align: center;"><code>\underline&#123;Latex&#125;</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\bf{Latex}\)</span></td><td style="text-align: center;"><code>\bf&#123;Latex&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\mathbb{R}\)</span></td><td style="text-align: center;"><code>\mathbb&#123;R&#125;</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\mathcal{R}\)</span></td><td style="text-align: center;"><code>\mathcal&#123;R&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\mathscr{R}\)</span></td><td style="text-align: center;"><code>\mathscr&#123;R&#125;</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\mathbf{R}\)</span></td><td style="text-align: center;"><code>\mathbf&#123;R&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\mathit{R}\)</span></td><td style="text-align: center;"><code>\mathit&#123;R&#125;</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\mathrm{R}\)</span></td><td style="text-align: center;"><code>\mathrm&#123;R&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\mathsf{R}\)</span></td><td style="text-align: center;"><code>\mathsf&#123;R&#125;</code></td></tr><tr class="odd"><td style="text-align: center;"><span class="math inline">\(\mathtt{R}\)</span></td><td style="text-align: center;"><code>\mathtt&#123;R&#125;</code></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(\mathfrak{R}\)</span></td><td style="text-align: center;"><code>\mathfrank&#123;R&#125;</code></td></tr></tbody></table><pre><code>\mathfrak&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></pre><p><span class="math inline">\(\mathfrak{ABCDEFGHIJKLMNOPQRSTUVWXYZ}\)</span></p><pre><code>\mathscr&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></pre><p><span class="math inline">\(\mathscr{ABCDEFGHIJKLMNOPQRSTUVWXYZ}\)</span></p><pre><code>\mathcal&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></pre><p><span class="math inline">\(\mathcal{ABCDEFGHIJKLMNOPQRSTUVWXYZ}\)</span></p><pre><code>\mathbb&#123;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#125;</code></pre><p><span class="math inline">\(\mathbb{ABCDEFGHIJKLMNOPQRSTUVWXYZ}\)</span></p><h2 id="五为公式加编号">五，为公式加编号</h2><p>效果 <span class="math display">\[\frac{\partial\pmb{A}^\text{T}\pmb{x}}{\partial \pmb{x}}=\pmb{A}\tag{1.1}\]</span></p><p>代码</p><div class="sourceCode" id="cb11"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">\frac</span>&#123;<span class="fu">\partial\pmb</span>&#123;A&#125;^<span class="fu">\text</span>&#123;T&#125;<span class="fu">\pmb</span>&#123;x&#125;&#125;&#123;<span class="fu">\partial</span> <span class="fu">\pmb</span>&#123;x&#125;&#125;=<span class="fu">\pmb</span>&#123;A&#125;<span class="fu">\tag</span>&#123;1.1&#125;</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训3.x实验</title>
      <link href="/2021/09/17/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD3.x/"/>
      <url>/2021/09/17/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD3.x/</url>
      
        <content type="html"><![CDATA[<h1 id="进程描述">3.1：进程描述</h1><h2 id="实训地址">实训地址</h2><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h2 id="第一关任务寄存器tr的分析">第一关：任务寄存器（TR）的分析</h2><h3 id="实验方法">实验方法</h3><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 跟踪到1号进行运行时，例如函数task1的入口处</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> task1</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 此时current指向1号进程的进程控制块，可以查看该进程控制块的内容</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>current</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="kw">&amp;</span><span class="ex">current-</span><span class="op">&gt;</span>tss</span></code></pre></div><p>进程控制块的类型为 struct task_struct ，定义如下：</p><p><img src="https://data.educoder.net/api/attachments/1161827" alt="进程控制块" /></p><div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 其中最后一个成员tss即为进程的任务状态段，可以直接查看其地址:</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp0</span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tss的值为0xfff2e8,esp0记录的核心栈栈底位置为16777216</span></span></code></pre></div><p>任务状态段的类型定义如下：</p><p><img src="https://data.educoder.net/api/attachments/1161830" alt="任务状态段" /></p><p>其中成员 esp0 记录的即为进程的核心栈栈底位置。</p><div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 退出gdb，使用bochsdbg调试</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">quit</span></span></code></pre></div><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端1</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 跟踪到函数 task1 的入口</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x7985</span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用命令 sreg 查看所有的段寄存器：</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># TR寄存器的值为 0x0030</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一操作暂时结束</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看 TR 寄存器指向的任务状态段描述符的值</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算描述符在GDT中的索引，另开一个命令行，用python算</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0x30</span><span class="op">&gt;&gt;</span>3</span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 索引值为6</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看GDT地址，存放在gdtr中</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 找到GDT的地址为0x5cc0</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看GDT中的描述符</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="ex">x/14wx</span> 0x5cc0</span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 1号进程的地址0x00008bfff2e80068</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 起始地址0x00fff2e8</span></span></code></pre></div><h3 id="补充">补充</h3><h4 id="如何查看-tr-寄存器指向的任务状态段描述符的值">如何查看 TR 寄存器指向的任务状态段描述符的值</h4><ul><li><p>a.计算描述符在 GDT 中的索引。 TR寄存器（共16位）的高13位是所指向的任务状态段在全局描述符表（GDT）中的索引，因此将TR寄存器右移3位即可得到此索引，可以单独打开一个终端来运行 gdb ，就可以在其中进行计算。</p></li><li><p>b.查看 GDT 中该索引下的段描述符</p><p>首先查看 GDT 的地址，该地址记录在寄存器 gdtr 中，可见GDT地址为0x00005cc0</p><p>现在可以查看 GDT 中的描述符了，例如 0~4 号描述符的内容如下：</p><p><img src="https://data.educoder.net/api/attachments/1161866" alt="GDT中的描述符" /></p><p>其中 4 号描述符的值为 0x00008901ed080068 。</p></li></ul><h4 id="如何从段描述符的值计算出段的起始地址">如何从段描述符的值计算出段的起始地址</h4><p>一个段描述符占 64 位，其中段的起始地址由 3 部分拼接而成，如下图中的红色部分所示：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/1161871.jpg" /></p><p>可见前面的 4 号描述符 0x00008901ed080068 里记录的段起始地址是 0x0001ed08 。</p><h3 id="本关答案">本关答案</h3><div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.1</span> 号进程的任务状态段 TSS 的地址是多少？<span class="er">(</span><span class="ex">0xfff2e8</span><span class="kw">)</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.1</span> 号进程的核心栈栈底的位置是多少？<span class="er">(</span><span class="ex">16777216</span><span class="kw">)</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.1</span> 号进程运行时，任务寄存器 TR 的值是多少？<span class="er">(</span><span class="ex">0x0030</span><span class="kw">)</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.它指向的任务状态段描述符的值是多少？</span><span class="er">(</span><span class="ex">0x00008bfff2e80068</span><span class="kw">)</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.该描述符里记录的任务状态段起始地址是多少？</span><span class="er">(</span><span class="ex">0x00fff2e8</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关1-号进程的状态变化">第二关：1 号进程的状态变化</h2><h3 id="实验方法-1">实验方法</h3><div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#终端1</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/1.tgz ~/os/</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.tgz</span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1 cur</span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端1结束</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端2</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sys_pause if current-<span class="op">&gt;</span>pid == 1</span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sched.c:120 if p-<span class="op">&gt;</span>pid==1</span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="ex">bt</span></span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 此时看到调用栈，控制流信息，栈底层函数为timer_interrupt，注意bt命令0~0x5000的误报</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 以下操作和2.2关完全一样</span></span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 观察到此时$cx不为0，说明loop指令不是刚开始执行，loop的上一条指令还是loop</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="ex">finish</span></span><span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x77dd</span><span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span></code></pre></div><h3 id="补充x86-loop指令">补充：x86 loop指令</h3><blockquote><p><strong>Loop指令</strong>执行流程: 步骤1. 将cx寄存器的值 - 1, cx = cx - 1; 步骤2. 判断cx的值 ;</p></blockquote><h3 id="本关答案-1">本关答案</h3><div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.系统处于几号进程的上下文（或者说，当前进程是几号进程）？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.内核的函数调用栈中的顶层函数是什么？</span><span class="er">(</span><span class="ex">timer_interrupt</span><span class="kw">)</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.内核处于哪种控制流？</span><span class="er">(</span><span class="ex">B</span><span class="kw">)</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">A.</span><span class="er">(</span><span class="ex">系统调用</span><span class="kw">)</span><span class="ex">B.</span><span class="er">(</span><span class="ex">中断</span><span class="kw">)</span><span class="ex">C.</span><span class="er">(</span><span class="ex">异常</span><span class="kw">)</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.后续回到用户态时，恢复点的位置是什么？</span><span class="er">(</span><span class="ex">0x796c</span><span class="kw">)</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">5.以前的断点位置是什么？</span><span class="er">(</span><span class="ex">0x796c</span><span class="kw">)</span></span></code></pre></div><h2 id="第三关1-号进程的核心栈内容分析">第三关：1 号进程的核心栈内容分析</h2><h3 id="实验方法-2">实验方法</h3><div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> task1</span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp0</span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 核心栈栈底16777216(Dec)，题目中必须要填0x1000000(Hex)</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">bt</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 核心栈栈顶0x00007948</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span></span></code></pre></div><h3 id="注意">注意</h3><p>本关第一题不填hex值不给过，真的不想说什么了。。。</p><p>打印16进制数的命令<code>p/x &lt;var&gt;</code></p><h3 id="本关答案-2">本关答案</h3><div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.1号进程的核心栈栈底的位置是多少？</span><span class="er">(</span><span class="ex">0x1000000</span><span class="kw">)</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.1号进程执行函数</span> task1 中的第一个 int 0x81 指令后，核心栈栈顶的位置是多少？<span class="er">(</span><span class="ex">0xffffec</span><span class="kw">)</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.从栈底到栈顶依次放了哪些内容？</span><span class="er">(</span><span class="ex">0x00000017</span><span class="kw">)(</span><span class="ex">0x0002573c</span><span class="kw">)(</span><span class="ex">0x00000246</span><span class="kw">)(</span><span class="ex">0x0000000f</span><span class="kw">)(</span><span class="ex">0x00007989</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关0-号进程的核心栈内容分析">第四关：0 号进程的核心栈内容分析</h2><h3 id="实验方法-3">实验方法</h3><div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:145</span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> current-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp0</span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span></span></code></pre></div><h3 id="本关答案-3">本关答案</h3><div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0号进程的核心栈栈底的位置是多少？</span><span class="er">(</span><span class="ex">0x1fa20</span><span class="kw">)</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.0号进程执行</span> fork 系统调用中的陷入指令后，核心栈栈顶的位置是多少？<span class="er">(</span><span class="ex">0x1fa0c</span><span class="kw">)</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.从栈底到栈顶依次放了哪些内容？</span><span class="er">(</span><span class="ex">0x00000017</span><span class="kw">)(</span><span class="ex">0x00025740</span><span class="kw">)(</span><span class="ex">0x00000202</span><span class="kw">)(</span><span class="ex">0x0000000f</span><span class="kw">)(</span><span class="ex">0x0000690a</span><span class="kw">)</span></span></code></pre></div><h1 id="进程的创建">3.2：进程的创建</h1><h2 id="第一关进程创建前后tr寄存器值的分析">第一关：进程创建前后TR寄存器值的分析</h2><h3 id="实验方法-4">实验方法</h3><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/1.tgz ~/os/</span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.tgz</span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1 cur</span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一结束</span></span></code></pre></div><div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:145</span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用n指令，跳过将要执行的move_to_user_mode();函数</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 观察到陷入指令位置 0x6908</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用n直接跳到fork的下一条指令</span></span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 执行完陷入指令位置 0x6927</span></span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二结束</span></span></code></pre></div><div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在终端二退出gdb，打开dbg</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6908</span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6927</span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二结束</span></span></code></pre></div><h3 id="本关答案-4">本关答案</h3><div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0号进程的fork系统调用中的陷入指令的地址是多少？</span><span class="er">(</span><span class="ex">0x6908</span><span class="kw">)</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.0号进程执行fork系统调用之前，TR寄存器的值为多少？</span><span class="er">(</span><span class="ex">0x20</span><span class="kw">)</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.0号进程刚执行完fork系统调用时，TR寄存器的值为多少？</span><span class="er">(</span><span class="ex">0x20</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关1-号进程创建前后的gdt和pcb分析">第二关：1 号进程创建前后的GDT和PCB分析</h2><h3 id="实验方法-5">实验方法</h3><div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一的操作与上一关相同</span></span></code></pre></div><div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看0号进程的进程控制块起始地址，注意task[0]本来就是一个地址</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[0]</span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看0号进程的进程控制块tss地址</span></span><span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="kw">&amp;</span><span class="va">task</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span><span class="ex">-</span><span class="op">&gt;</span>tss</span><span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看1号进程创建前task的前两项</span></span><span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]</span><span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 在fork处设置断点，执行</span></span><span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:145</span><span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ex">finish</span></span><span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 记住0x6927是执行完进程一的恢复点</span></span><span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tss-&gt;eip现在存放进程第一条语句的地址，要输出16进制，不然过不了评测</span></span><span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 解决第五题</span></span><span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[0]</span><span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]</span><span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="kw">&amp;</span><span class="va">task</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span><span class="ex">-</span><span class="op">&gt;</span>tss</span><span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 解决第八题</span></span><span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 解决第九题</span></span><span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]</span><span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp0</span><span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="ex">quit</span></span></code></pre></div><div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./rundbg</span></span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6908</span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#断点打在0x6927后的近处</span></span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6929</span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 接下来应该输入 x/?wx &lt;gdtr的值&gt; 来查看GDT表</span></span><span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 0x20&gt;&gt;3 = 4，说明tr指向4号描述符</span></span><span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 起始段地址按照3.1第一关来计算</span></span><span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="ex">x/16wx</span> 0x5cc0</span><span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ex">x/16wx</span> 0x5cc0</span></code></pre></div><h3 id="本关答案-5">本关答案</h3><div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.0号进程的进程控制块的起始地址是多少？0号进程的TSS的地址是多少？</span><span class="er">(</span><span class="ex">0x1ea20</span><span class="kw">)(</span><span class="ex">0x1ed08</span><span class="kw">)</span></span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.在1号进程创建前，task数组的前2项是多少？</span><span class="er">(</span><span class="ex">0x1ea20</span><span class="kw">)(</span><span class="ex">0x0</span><span class="kw">)</span></span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.GDT的4~7号描述符是多少？</span><span class="er">(</span><span class="ex">0x00008b01ed080068</span><span class="kw">)(</span><span class="ex">0x00008201ecf00068</span><span class="kw">)(</span><span class="ex">0x0000000000000000</span><span class="kw">)(</span><span class="ex">0x0000000000000000</span><span class="kw">)</span></span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">4.其中存储的段起始地址分别是多少？</span><span class="er">(</span><span class="ex">0x0001ed08</span><span class="kw">)(</span><span class="ex">0x0001ecf0</span><span class="kw">)(</span><span class="ex">0x00000000</span><span class="kw">)(</span><span class="ex">0x00000000</span><span class="kw">)</span></span><span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">5.在1号进程创建后，task数组的前2项是多少？</span><span class="er">(</span><span class="ex">0x1ea20</span><span class="kw">)(</span><span class="ex">0xfff000</span><span class="kw">)</span></span><span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">6.GDT的4~7号描述符是（64位）多少？</span><span class="er">(</span><span class="ex">0x00008b01ed080068</span><span class="kw">)(</span><span class="ex">0x00008201ecf00068</span><span class="kw">)(</span><span class="ex">0x000089fff2e80068</span><span class="kw">)(</span><span class="ex">0x000082fff2d00068</span><span class="kw">)</span></span><span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">7.其中存储的段起始地址分别是多少？</span><span class="er">(</span><span class="ex">0x0001ed08</span><span class="kw">)(</span><span class="ex">0x0001ecf0</span><span class="kw">)(</span><span class="ex">0x00fff2e8</span><span class="kw">)(</span><span class="ex">0x00fff2d0</span><span class="kw">)</span></span><span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">8.1号进程的进程控制块的起始地址是多少？1号进程的TSS的地址是多少？1号进程执行的第一条语句的地址是多少？</span><span class="er">(</span><span class="ex">0xfff000</span><span class="kw">)(</span><span class="ex">0xfff2e8</span><span class="kw">)(</span><span class="ex">0x690a</span><span class="kw">)</span></span><span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">9.1号进程的核心栈栈底的位置是多少？该位置距离1号进程的进程控制块的起始位置有多远（字节数）？</span><span class="er">(</span><span class="ex">0x1000000</span><span class="kw">)(</span><span class="ex">4096</span><span class="kw">)</span></span></code></pre></div><h3 id="补充-1">补充</h3><h4 id="gdb可以查看gdtr吗">GDB可以查看gdtr吗</h4><p>这篇回答很有用：<a href="https://stackoverflow.com/questions/28263624/can-i-print-the-gdtr-and-gdt-descriptor-under-gdb">assembly - Can I print the gdtr and gdt descriptor under gdb? - Stack Overflow</a></p><h4 id="tr-寄存器的作用">TR 寄存器的作用</h4><p>CPU 通过 TR 寄存器可以找到当前进程的任务状态段，任务状态段里记录了（以前保存的）进程 CPU 现场和核心栈位置等信息,整体结构如下：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/1162832.jpg" /></p><p>可见，TR 寄存器通过 GDT 中的描述符间接指向了当前进程的任务状态段。GDT 的位置是根据 GDTR 寄存器的值来确定的。</p><h2 id="第三关系统调用fork和execve的跟踪分析">第三关：系统调用fork和execve的跟踪分析</h2><h3 id="实验方法-6">实验方法</h3><p>在exec.c的do_execve中添加</p><div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> ans<span class="op">[</span><span class="dv">1001</span><span class="op">];</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1001</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> ans<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c <span class="op">=</span> get_fs_byte<span class="op">(</span>filename <span class="op">+</span> i<span class="op">);</span></span><span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>c<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span><span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> c<span class="op">;</span></span><span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>printk<span class="op">(</span><span class="st">&quot;Exec %s(%d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">,</span> current<span class="op">-&gt;</span>pid<span class="op">);</span></span></code></pre></div><p>在fork.c的copy_process靠近return的地方添加</p><div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>printk<span class="op">(</span><span class="st">&quot;Fork %d-&gt;%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> current<span class="op">-&gt;</span>pid<span class="op">,</span> p<span class="op">-&gt;</span>pid<span class="op">);</span></span></code></pre></div><p>make编译即可</p><p>发现系统启动时，执行了/bin/sh 和 /etc/update 文件</p><h3 id="补充-2">补充</h3><p><a href="https://www.runoob.com/cprogramming/c-strings.html">C语言字符串</a></p><h2 id="第四关构建一个最小的可用操作系统">第四关：构建一个最小的可用操作系统</h2><ol type="1"><li><p>进入虚拟机，修改/etc/rc文件</p><p>删去原有内容，在rc添加两行(在终端操作)</p><div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;set&quot;</span> <span class="op">&gt;</span> rc</span><span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;ls -l /&quot;</span> <span class="op">&gt;&gt;</span> rc</span></code></pre></div></li><li><p>删除hello.c，a.out，把虚拟机中所有文件用mv命令移到根目录，然后删除原目录，记住要最后移动/usr/bin/里的的文件(否则就会~<del>重置实训</del>~)，usr中不是bin的文件和目录统统删除。</p></li><li><p>然后修改全局变量，先修改</p><div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span> argv_rc<span class="op">[]</span> <span class="op">=</span> <span class="op">&#123;</span> <span class="st">&quot;/sh&quot;</span><span class="op">,</span> NULL <span class="op">&#125;;</span></span><span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span> envp_rc<span class="op">[]</span> <span class="op">=</span> <span class="op">&#123;</span> <span class="st">&quot;HOME=/&quot;</span><span class="op">,</span> <span class="st">&quot;PATH=.&quot;</span><span class="op">,</span> NULL <span class="op">&#125;;</span></span><span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span> argv<span class="op">[]</span> <span class="op">=</span> <span class="op">&#123;</span> <span class="st">&quot;-/sh&quot;</span><span class="op">,</span>NULL <span class="op">&#125;;</span></span><span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">char</span> <span class="op">*</span> envp<span class="op">[]</span> <span class="op">=</span> <span class="op">&#123;</span> <span class="st">&quot;HOME=/&quot;</span><span class="op">,</span> <span class="st">&quot;PATH=.&quot;</span><span class="op">,</span> NULL <span class="op">&#125;;</span></span></code></pre></div></li><li><p>然后修改启动需要的文件</p><div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pid<span class="op">,</span>i<span class="op">;</span></span><span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> setup<span class="op">((</span><span class="dt">void</span> <span class="op">*)</span> <span class="op">&amp;</span>drive_info<span class="op">);</span></span><span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a> <span class="op">(</span><span class="dt">void</span><span class="op">)</span> open<span class="op">(</span><span class="st">&quot;/tty0&quot;</span><span class="op">,</span>O_RDWR<span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> <span class="op">(</span><span class="dt">void</span><span class="op">)</span> dup<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> <span class="op">(</span><span class="dt">void</span><span class="op">)</span> dup<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a> printf<span class="op">(</span><span class="st">&quot;%d buffers = %d bytes buffer space</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">,</span>NR_BUFFERS<span class="op">,</span></span><span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>     NR_BUFFERS<span class="op">*</span>BLOCK_SIZE<span class="op">);</span></span><span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a> printf<span class="op">(</span><span class="st">&quot;Free mem: %d bytes</span><span class="sc">\n\r</span><span class="st">&quot;</span><span class="op">,</span>memory_end<span class="op">-</span>main_memory_start<span class="op">);</span></span><span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="op">(!(</span>pid<span class="op">=</span>fork<span class="op">()))</span> <span class="op">&#123;</span></span><span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>     close<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> <span class="op">(</span>open<span class="op">(</span><span class="st">&quot;/rc&quot;</span><span class="op">,</span>O_RDONLY<span class="op">,</span><span class="dv">0</span><span class="op">))</span></span><span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>         _exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>     execve<span class="op">(</span><span class="st">&quot;/sh&quot;</span><span class="op">,</span>argv_rc<span class="op">,</span>envp_rc<span class="op">);</span></span><span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>     _exit<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a> <span class="op">&#125;</span></span><span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> <span class="op">(</span>pid<span class="op">&gt;</span><span class="dv">0</span><span class="op">)</span></span><span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>     <span class="cf">while</span> <span class="op">(</span>pid <span class="op">!=</span> wait<span class="op">(&amp;</span>i<span class="op">))</span></span><span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>         <span class="co">/* nothing */</span><span class="op">;</span></span><span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> <span class="op">((</span>pid<span class="op">=</span>fork<span class="op">())&lt;</span><span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>         printf<span class="op">(</span><span class="st">&quot;Fork failed in init</span><span class="sc">\r\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>         <span class="cf">continue</span><span class="op">;</span></span><span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>     <span class="op">&#125;</span></span><span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> <span class="op">(!</span>pid<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>         close<span class="op">(</span><span class="dv">0</span><span class="op">);</span>close<span class="op">(</span><span class="dv">1</span><span class="op">);</span>close<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>         setsid<span class="op">();</span></span><span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="dt">void</span><span class="op">)</span> open<span class="op">(</span><span class="st">&quot;/tty0&quot;</span><span class="op">,</span>O_RDWR<span class="op">,</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="dt">void</span><span class="op">)</span> dup<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>         <span class="op">(</span><span class="dt">void</span><span class="op">)</span> dup<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>         _exit<span class="op">(</span>execve<span class="op">(</span><span class="st">&quot;/sh&quot;</span><span class="op">,</span>argv<span class="op">,</span>envp<span class="op">));</span></span><span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>     <span class="op">&#125;</span></span></code></pre></div><p>别忘了<font size = 6 color = "red">编译！编译！编译！</font></p></li><li><p>删除多余文件和文件夹，只留下tty0, sh, rc, ls, cat, rm, sync七个文件。</p><p>当然有删除好的硬盘文件，在<a href="http://redleaves.ys168.com/">这里</a><img src="https://tb2.bdstatic.com/tb/editor/images/face/i_f25.png?t=20140803" /></p></li><li><p>点击评测</p></li></ol><h1 id="进程的调度">3.3 进程的调度</h1><h2 id="第一关第一次由时钟中断引发的进程调度">第一关：第一次由时钟中断引发的进程调度</h2><h3 id="实验方法-7">实验方法</h3><div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一与3.2第一关相同</span></span></code></pre></div><div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sched.c:336</span><span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="pp">*</span>task[1]</span><span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]-<span class="op">&gt;</span>state</span><span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>counter</span><span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> jiffies</span><span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ex">quit</span></span></code></pre></div><h3 id="本关答案-6">本关答案</h3><div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.当时bochs虚拟机输出的0/1字符串是什么？（忽略空格）</span><span class="er">(</span><span class="ex">010000000000</span><span class="kw">)</span></span><span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.该次中断是第几次时钟中断？</span><span class="er">(</span><span class="ex">16</span><span class="kw">)</span><span class="ex">当时处于几号进程的上下文？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">该进程的剩余时间片是多少？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.1号进程当时处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">1号进程控制块的alarm成员的值是多少？</span><span class="er">(</span><span class="ex">103</span><span class="kw">)</span><span class="ex">该定时器截止时间到了吗？（填到了或没到）</span><span class="er">(</span><span class="ex">没到</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关前三次进程调度">第二关：前三次进程调度</h2><h3 id="实验方法-8">实验方法</h3><div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> schedule</span><span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>pid</span><span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">## 以下代码重复三遍</span></span><span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">bt</span></span><span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[0]-<span class="op">&gt;</span>state</span><span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]-<span class="op">&gt;</span>state</span><span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sched.c:142</span><span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> next</span><span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">## 重复段结束</span></span></code></pre></div><h3 id="本关答案-7">本关答案</h3><div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.第一次进程调度时，当前进程是几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">内核函数调用栈的栈底函数是什么？</span><span class="er">(</span><span class="ex">system_call</span><span class="kw">)</span><span class="ex">其上一层函数是什么？</span><span class="er">(</span><span class="ex">sys_pause</span><span class="kw">)</span><span class="ex">0号进程处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">1号进程处于什么状态？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">选中了几号进程？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span></span><span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.第二次进程调度时，当前进程是几号进程？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">内核函数调用栈的栈底函数是什么？</span><span class="er">(</span><span class="ex">system_call</span><span class="kw">)</span><span class="ex">其上一层函数是什么？</span><span class="er">(</span><span class="ex">sys_pause</span><span class="kw">)</span><span class="ex">0号进程处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">1号进程处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">选中了几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.第三次进程调度时，当前进程是几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span><span class="ex">内核函数调用栈的栈底函数是什么？</span><span class="er">(</span><span class="ex">system_call</span><span class="kw">)</span><span class="ex">其上一层函数是什么？</span><span class="er">(</span><span class="ex">schedule</span><span class="kw">)</span><span class="ex">0号进程处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">1号进程处于什么状态？</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="ex">选中了几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span></code></pre></div><h2 id="第三关-版本1.2内核的进程调度过程分析">第三关 版本1.2内核的进程调度过程分析</h2><h2 id="第四关-两个进程的严格交替输出">第四关 两个进程的严格交替输出</h2><h1 id="进程的切换">3.4 进程的切换</h1><h2 id="第一关第一次进程切换过程分析">第一关：第一次进程切换过程分析</h2><h3 id="实验方法-9">实验方法</h3><div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span><span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 在gdb中</span></span><span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> sched.c:142</span><span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 后面四句解决前两问</span></span><span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>pid</span><span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> next</span><span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[0]-<span class="op">&gt;</span>counter</span><span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> task[1]-<span class="op">&gt;</span>counter</span><span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x6f33</span><span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 后面十句解决第三问，查看各个字段</span></span><span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>cs</span><span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>ss</span><span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp</span><span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>cs</span><span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>ss</span><span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp</span><span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="ex">ni</span></span><span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 后面十句解决第四问，查看各个字段</span></span><span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>cs</span><span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>ss</span><span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[0]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp</span><span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>cs</span><span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>ss</span><span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>eip</span><span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> task[1]-<span class="op">&gt;</span>tss-<span class="op">&gt;</span>esp</span></code></pre></div><h3 id="本关答案-8">本关答案</h3><div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">第一次进程切换时：</span></span><span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.是从几号进程切换到几号进程？</span><span class="er">(</span><span class="ex">0</span><span class="kw">)(</span><span class="ex">1</span><span class="kw">)</span></span><span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.0号进程和1号进程的剩余时间片分别是多少？</span><span class="er">(</span><span class="ex">13</span><span class="kw">)(</span><span class="ex">15</span><span class="kw">)</span></span><span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.在（ljmp）切换前，寄存器对</span> CS:EIP 和 SS:ESP 的值是多少？<span class="er">(</span><span class="ex">0x8:0x6f33</span><span class="kw">)(</span><span class="ex">0x10:0x1f9cc</span><span class="kw">)</span><span class="ex">其下一条指令的地址是多少？</span><span class="er">(</span><span class="ex">0x6f37</span><span class="kw">)</span><span class="ex">0</span> 号进程的 TSS 中的字段对 cs:eip 和 ss:esp 的值是多少？<span class="er">(</span><span class="ex">0x17:0x0</span><span class="kw">)(</span><span class="ex">0x17:0x0</span><span class="kw">)</span><span class="ex">1</span> 号进程的 TSS 中的字段对 cs:eip 和 ss:esp 的值是多少？<span class="er">(</span><span class="ex">0xf:0x690a</span><span class="kw">)(</span><span class="ex">0x17:0x25740</span><span class="kw">)</span></span><span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.在（ljmp）切换后，寄存器对</span> CS:EIP 和 SS:ESP 的值是多少？<span class="er">(</span><span class="ex">0xf:0x690a</span><span class="kw">)(</span><span class="ex">0x17:0x25740</span><span class="kw">)</span><span class="ex">0</span> 号进程的 TSS 中的字段对 cs:eip 和 ss:esp 的值是多少？<span class="er">(</span><span class="ex">0x8:0x6f37</span><span class="kw">)(</span><span class="ex">0x10:0x1f9cc</span><span class="kw">)</span><span class="ex">1</span> 号进程的 TSS 中的字段对 cs:eip 和 ss:esp 的值是多少？<span class="er">(</span><span class="ex">0xf:0x690a</span><span class="kw">)(</span><span class="ex">0x17:0x25740</span><span class="kw">)</span></span></code></pre></div><h2 id="第二关第一进程切换时tr寄存器的变化分析">第二关：第一进程切换时TR寄存器的变化分析</h2><h3 id="实验方法-10">实验方法</h3><p>先打开dbg，然后打开gdb。gdb挂着就行，用不上。 遇到panic就点continue</p><div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在dbg中</span></span><span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> 0x6f33</span><span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 按3.1的方法，查出段起始地址，由上一关，知道是0号进程的tss</span></span><span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># x/10wx 0x5cc0注意不要用这个，不然切换后起始地址会错误，一个烦人的bug</span></span><span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/14wx</span> 0x5cc0</span><span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 按3.1的方法，查出段起始地址，由上一关，知道是1号进程的tss</span></span><span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="ex">s</span></span><span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="ex">sreg</span></span><span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="ex">x/14wx</span> 0x5cc0</span></code></pre></div><h3 id="注意-1">注意</h3><p><font size = 6 color = "red">第一次进程切换前</font>，要用<font size = 6 color = "blue">x/14wx 0x5cc0</font>查看，虽然使用<font size = 6 color = "gray">x/10wx 0x5cc0</font>也可以。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/image-20210917103836830.png" alt="感谢这位兄弟" /></p><h3 id="本关答案-9">本关答案</h3><div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.第一次进程切换前，CPU</span> 中 TR 寄存器的值是多少？<span class="er">(</span><span class="ex">0x0020</span><span class="kw">)</span><span class="ex">它所指向的</span> GDT 描述符中的段起始地址是多少？<span class="er">(</span><span class="ex">0x0001ed08</span><span class="kw">)</span><span class="ex">是几号进程的</span> TSS 地址？<span class="er">(</span><span class="ex">0</span><span class="kw">)</span></span><span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.第一次进程切换后，CPU</span> 中 TR 寄存器的值是多少？<span class="er">(</span><span class="ex">0x0030</span><span class="kw">)</span><span class="ex">它所指向的</span> GDT 描述符中的段起始地址是多少？<span class="er">(</span><span class="ex">0x00fff2e8</span><span class="kw">)</span><span class="ex">是几号进程的</span> TSS 地址？<span class="er">(</span><span class="ex">1</span><span class="kw">)</span></span></code></pre></div><h2 id="后面几关不是自己做的略过">后面几关：不是自己做的<img src="https://img.moegirl.org.cn/common/thumb/9/9c/滑稽表情.png/30px-滑稽表情.png" />，略过</h2>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在本地部署LearnGitBranch</title>
      <link href="/2021/09/14/Git/%E5%9C%A8%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2LearnGitBranch/"/>
      <url>/2021/09/14/Git/%E5%9C%A8%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2LearnGitBranch/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是learngitbranch">什么是LearnGitBranch</h2><p>LearnGitBranch是一款基于javascript开发的Git学习平台，平台以生动的图形化界面和闯关的方式，帮助我们学习Git的使用。大大降低了Git学习的门槛。</p><h2 id="为什么在本地部署">为什么在本地部署？</h2><p>网络版本在这里，方便快捷。</p><p>网络版：</p><p><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching中文</a></p><p><a href="https://learngitbranching.js.org/?locale=en_US">Learn Git Branching英文</a></p><p>众所周知，有计算机的地方，不一定就有网络，有时候，网络信号不好，1KB/s的网速，让人无法忍受。我们能不能在本地部署LearnGitBranch，随时随地方便的练习和复习呢？当然可以！</p><h2 id="如何在本地部署">如何在本地部署</h2><p>在<a href="https://github.com/pcottle/learnGitBranching">这里</a>的README文件可以看到作者对于部署方法的建议，这里我只是把它实现了一遍，在<a href="https://redleaves699.github.io/2021/09/02/使用hexo和node.js搭建博客/">这篇博客</a>里，我配置了node.js环境，所以有些步骤可以省略。</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以下命令均在git bash内执行，执行前，先进入源代码所在目录</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查相关组件版本</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">node</span> <span class="at">--version</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> <span class="at">--version</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npx</span> <span class="at">--version</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装gulp相关组件</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> rm <span class="at">--global</span> gulp</span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install <span class="at">--global</span> gulp-cli</span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看gulp是否安装成功</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">gulp</span> <span class="at">--version</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装yarn</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> i <span class="at">-g</span> yarn</span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">yarn</span> <span class="at">--version</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 运行gulp，安装依赖组件并生成相关文件</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">gulp</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 最后，打开目录下的index.html即可</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> 网页前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> Git </tag>
            
            <tag> LearnGitBranch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>指针的活用</title>
      <link href="/2021/09/12/Programming%20Language/%E6%8C%87%E9%92%88%E7%9A%84%E6%B4%BB%E7%94%A8/"/>
      <url>/2021/09/12/Programming%20Language/%E6%8C%87%E9%92%88%E7%9A%84%E6%B4%BB%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="问题描述">问题描述</h2><p>传入一个单向链表，如何删除其中的某个节点？</p><p><a href="http://wordaligned.org/articles/two-star-programming">问题来源与英文解答</a></p><h2 id="常规思路">常规思路</h2><p>我肯定会这么写：维护两个结点指针prev，curr，删除节点时，判断curr是否是链表头。删除节点时，需要将prev-&gt;next指向curr-&gt;next。</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> node</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span> next<span class="op">;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">....</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> node<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">bool</span> <span class="op">(*</span> remove_fn<span class="op">)(</span>node <span class="dt">const</span> <span class="op">*</span> v<span class="op">);</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove all nodes from the supplied list for which the </span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">// supplied remove function returns true.</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns the new head of the list.</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>node <span class="op">*</span> remove_if<span class="op">(</span>node <span class="op">*</span> head<span class="op">,</span> remove_fn rm<span class="op">)</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>node <span class="op">*</span> prev <span class="op">=</span> NULL<span class="op">,</span> <span class="op">*</span> curr <span class="op">=</span> head<span class="op">;</span> curr <span class="op">!=</span> NULL<span class="op">;</span> <span class="op">)</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        node <span class="op">*</span> <span class="dt">const</span> next <span class="op">=</span> curr<span class="op">-&gt;</span>next<span class="op">;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rm<span class="op">(</span>curr<span class="op">))</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>prev<span class="op">)</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                prev<span class="op">-&gt;</span>next <span class="op">=</span> next<span class="op">;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                head <span class="op">=</span> next<span class="op">;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>curr<span class="op">);</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            prev <span class="op">=</span> curr<span class="op">;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        curr <span class="op">=</span> next<span class="op">;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> head<span class="op">;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="二级指针巧妙实现">二级指针巧妙实现</h2><p>但在Linus看来，这样的写法太繁琐。Linus使用二级指针对链表进行操作</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> remove_if<span class="op">(</span>node <span class="op">**</span> head<span class="op">,</span> remove_fn rm<span class="op">)</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>node<span class="op">**</span> curr <span class="op">=</span> head<span class="op">;</span> <span class="op">*</span>curr<span class="op">;</span> <span class="op">)</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#123;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        node <span class="op">*</span> entry <span class="op">=</span> <span class="op">*</span>curr<span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>rm<span class="op">(</span>entry<span class="op">))</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#123;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>curr <span class="op">=</span> entry<span class="op">-&gt;</span>next<span class="op">;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>entry<span class="op">);</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            curr <span class="op">=</span> <span class="op">&amp;</span>entry<span class="op">-&gt;</span>next<span class="op">;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="原理">原理</h2><p>图解</p><p>图一是*curr指向头指针时，执行删除entry和不删除entry后的指针状态</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/point01.png" alt="图一" /></p><p>图二是*curr指针指向链表中间指针时，执行删除entry和不删除entry后的指针状态，<strong>循环执行后</strong>都指一次循环执行后。</p><p><strong>注意</strong>：for循环中第一条赋值语句<code>node *entry = *curr;</code>执行后，entry就到了下一个节点。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/point02.png" alt="图二" /></p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 进阶 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技巧 </tag>
            
            <tag> C语言 </tag>
            
            <tag> 指针 </tag>
            
            <tag> 高级 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android项目的阅读 - 让项目运行起来（总第一篇）</title>
      <link href="/2021/09/11/Android/Andorid%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
      <url>/2021/09/11/Android/Andorid%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="第一部分安装android-studio">第一部分：安装Android Studio</h1><h2 id="第一步首先先安装android-studio">第一步：首先先安装Android Studio</h2><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910040114976.png" alt="安装Android" /></p><h2 id="第二步安装jdk">第二步：安装JDK</h2><p>如果已经安装了JDK，并配置环境变量，可以忽略这一步。</p><p>如果仍未安装，去网上下载<a href="http://openjdk.java.net/">OpenJDK</a>，或Oracle的JDK，然后配置环境变量即可。</p><p>如何配置java环境变量？</p><blockquote><p>1.在系统变量中建立JAVA_HOME变量</p><p>2.在系统变量的path变量中建立%JAVA_HOME%</p></blockquote><h2 id="第三步安装sdk">第三步：安装SDK</h2><p>刚开始时，系统可能会出现这个画面</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910040538835.png" alt="安装SDK的问题" /></p><p>这时点击Setup Proxy，选择Manual proxy configuration，再Host name中填入mirrors.ustc.edu.cn，继续。</p><p>Install Type选择Custom，之后填写JDK和SDK的目录。</p><p>之后会发生这样的问题，找不到SDK</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910041431443.png" alt="找不到SDK" /></p><p>不必着急，这是因为SDK并没有成功安装。</p><p>先Finish，打开SDK Manager</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910041809732.png" alt="SDK Manager" /></p><p>选择Auto-detect proxy settings，勾选Automatic proxy configuration URL，在其中填入socks5h://127.0.0.1:1080(本地)或mirrors.neusoft.edu.cn:80(镜像源)。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910042256100.png" alt="代理设置" /></p><p>之后选择System Setting中的Android SDK，点击edit，在弹出窗口填写SDK下载位置（最好选择自己新建的一个非系统盘的空文件夹，注意<strong>文件夹不能包含汉字和空格</strong>），点击next，如果你的网络比较好，这时会弹出如下内容：</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910042726427.png" alt="代理和SDK安装目录设置成功" /></p><p>下一步，然后静等所有项目安装完毕。</p><p>接下来就可以打开工程了。</p><p>如果网络比较差，就会这样</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210910092236896.png" alt="网络不好" /></p><p>需要多试几次。</p><h1 id="第二部分运行小米便签程序">第二部分：运行小米便签程序</h1><h2 id="第一步导入源代码">第一步：导入源代码</h2><p>直接导入工程(File-&gt;new-&gt;import project)，然后为新工程取个名字<name>，然后AS就会帮你建立一个名字为<name>的工程文件。</p><h2 id="第二步设置gradle和sdk">第二步：设置gradle和SDK</h2><p>接着，进入工程结构设置(File-&gt;project structure)，进入project选项。设置gradle插件和gradle版本。</p><blockquote><p><strong>注意</strong>：小米便签是一个很古老的项目，现代的gradle（7.0以上）和SDK（31）与以前相比变化很大，当时能用很多的包因为过时被废弃，所以要用SDK23以下的版本。</p></blockquote><p>然后，进入Dependencies，设置依赖包存储位置（为未来导入包做准备），ok，设置完成。</p><p>然后可能会报如下错误</p><blockquote><p>Unknown host '不知道这样的主机。 (https://mirrors.neusoft.edu.cn/)'. You may need to adjust the proxy settings in Gradle.</p></blockquote><p>这时要关闭系统默认设置grandle的代理，方法是进入Gradle Scripts打开gradle.propertities，删除原来未注释内容，添加</p><pre class="she"><code>systemProp.http.proxyHost=systemProp.http.proxyPort=80systemProp.https.proxyHost=systemProp.https.proxyPort=80</code></pre><p>关闭代理，然后设置build.gradle</p><div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">//</span> Top-level build file where you can add configuration options common to all sub-projects/modules.</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">buildscript</span> &#123;</span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">repositories</span> &#123;</span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">google()</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">maven</span> &#123; url <span class="st">&#39;https://maven.aliyun.com/repository/public&#39;</span> &#125;</span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="er">&#125;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">dependencies</span> &#123;</span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">classpath</span> <span class="st">&#39;com.android.tools.build:gradle:4.1.3&#39;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="er">&#125;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="er">&#125;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">allprojects</span> &#123;</span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">repositories</span> &#123;</span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">google()</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">maven</span> &#123; url <span class="st">&#39;https://maven.aliyun.com/repository/public&#39;</span> &#125;</span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="er">&#125;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="er">&#125;</span></span></code></pre></div><p>重启Android Studio。</p><p>更换sdk为22版本，(File-&gt;project structure-&gt;module)</p><p>运行代码，在模拟器上出现小米便签程序。</p><blockquote><p>运行时可能会出现问题，比如编译时间过长，没关系，重新编译即可，这是网络问题。</p><p>最后可能会报一个有关线程的错误，不过不用理会。只要看到IDE最下方的run那里显示Launched succeed，就表示程序编译成功，这时直接打开手机模拟器即可。</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210911111506040.png" alt="Launch succeed" /></p></blockquote><h2 id="第三步运行结果">第三步：运行结果</h2><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210911111013765.png" alt="运行结果" /></p><blockquote><p><strong>补充</strong>：如果设置SDK版本为23以上，则会出现SDK不认代码的情况</p><p>也会出现找不到setLatestEventInfo方法的情况</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/Android/image-20210911101348762.png" alt="被删除的代码为灰色和红色，未删除的为正常颜色" /></p></blockquote><h1 id="第三部分未来的工作">第三部分：未来的工作</h1><p>至此，我们完成了运行小米便签的目标，接下来，就可以阅读小米便签的相关代码，并进行以后的代码标注工作。</p>]]></content>
      
      
      <categories>
          
          <category> 软件 </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 软件开发 </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Educoder 操作系统实训2.x实验</title>
      <link href="/2021/09/09/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD2.x/"/>
      <url>/2021/09/09/Operation%20System/Educoder%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%AE%AD2.x/</url>
      
        <content type="html"><![CDATA[<h1 id="实训2.1外部中断">实训2.1：外部中断</h1><h2 id="实训地址">实训地址</h2><p><a href="https://www.educoder.net/paths/2104">操作系统 (educoder.net)</a></p><h2 id="第一关时钟中断的发生">第一关：时钟中断的发生</h2><p>方法详见左侧说明，这里直接放出答案</p><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#终端1</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/1.tgz ~/os/</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.tgz</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1 cur</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./run</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#操作暂时结束</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#开启终端2</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">display</span> jiffies</span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_timer</span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#直到0/1填满第一行</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#操作结束</span></span></code></pre></div><h3 id="补充-gdb设置断点的方式">补充： GDB设置断点的方式</h3><p>​ 1.普通断点</p><p>当程序执行到<code>main.cpp</code>文件的第5行时触发断点</p><div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">b</span> src/main.cpp:5</span></code></pre></div><ol start="2" type="1"><li>条件断点</li></ol><p>满足一定条件触发断点</p><div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">b</span> src/main.cpp:5 if cnt==10</span></code></pre></div><p>​ 3.数据断点</p><p>根据地址数据来进行设置断点，当该地址上的内容发生改变时就会触发断点。 设置数据断点有两种方式，</p><p>一种是直接指出地址值</p><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">b</span> <span class="pp">*</span>0x400522</span></code></pre></div><p>在断点处<code>print &amp;变量名</code> 就能获取该变量的地址。 另一种是直接设置变量名</p><div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">b</span> <span class="kw">&amp;</span><span class="ex">变量名</span></span></code></pre></div><ol start="4" type="1"><li>函数断点</li></ol><p>当程序执行到某个函数模块时触发断点</p><div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">b</span> funcName</span></code></pre></div><hr /><h2 id="第二关-第一次时钟中断">第二关 第一次时钟中断</h2><h3 id="补充gdb命令">补充：GDB命令</h3><ol type="1"><li><p><strong>c</strong> Continue的简写，继续执行被调试程序，直至下一个断点或程序结束。</p></li><li><p><strong>b</strong></p><p>设置断点，上面已经介绍</p></li><li><p><strong>bt</strong></p><p>backtrace的简写，列出调用栈</p></li><li><p><strong>s</strong></p><p>相当于IDE中的<strong>step into</strong>，单步运行源代码语句</p><p>这个命令必须在有源代码调试信息的情况下才可以使用（GCC编译时使用“-g”参数）</p></li><li><p><strong>si</strong></p><p>和s指令类似，单步运行汇编指令</p></li><li><p><strong>n</strong></p><p>相当于IDE中的<strong>step over</strong>，单步运行源代码语句</p><p>其余同<strong>s</strong></p></li><li><p><strong>ni</strong></p><p>和n指令类似，单步运行汇编指令</p></li></ol><div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#终端1</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> os/linux-0.11-lab/</span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#终端2</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#终端2操作结束</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_timer</span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">bt</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">finish</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x77dd</span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#发现恢复点地址为0x0000796c</span></span></code></pre></div><hr /><h2 id="第三关-第六次时钟中断">第三关 第六次时钟中断</h2><p>这一关要注意，<strong>对于外部中断而言，恢复点指令是断点指令的后一条。</strong></p><p><strong>loop 指令</strong>的功能是先将 ecx 寄存器减一，然后检查其值，如果其值非 0 ，则继续循环，否则中止循环，执行下一条指令。</p><p>loop指令的<strong>上一条指令</strong>是谁？</p><p>通过第二条info reg命令，可以观察<strong>ecx</strong>的值，为0x8440，非0，再回忆下第一条info reg，回忆<strong>ecx</strong>的值，仍为非0，得出结论，<strong>loop</strong>的上一条指令还是<strong>loop</strong>，断点指令位置仍为0x00007982</p><div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#延续第一关的配置</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#终端一</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#终端一操作结束</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#终端二</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">display</span> jiffies</span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_timer</span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="ex">bt</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="ex">finsh</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x000077dd</span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#终端二操作结束</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#可以看到虚拟机屏幕输出结果是0100</span></span><span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">#可以看到异常的恢复点为0x00007982</span></span></code></pre></div><hr /><h2 id="第四关-修改版本-1-内核源码使得每次时钟中断发生时都在屏幕上输出字符t">第四关 修改版本 1 内核源码，使得每次时钟中断发生时，都在屏幕上输出字符‘t’。</h2><p>不知为何，代码的位置不对就会出问题</p><pre class="assembly"><code>.align 4timer_interrupt:    push %ds        # save ds,es and put kernel data space    push %es        # into them. %fs is used by _system_call    push %fs    pushl %edx      # we save %eax,%ecx,%edx as gcc doesn&#39;t    pushl %ecx      # save those across function calls. %ebx    pushl %ebx      # is saved as we use that in ret_sys_call    pushl %eax    movl $0x10,%eax    mov %ax,%ds    mov %ax,%es    movl $0x17,%eax    mov %ax,%fs    incl jiffies    movb $116,%al       # 新加入的代码1    int $0x81           # 新加入的代码2    movb $0x20,%al      # EOI to interrupt controller #1    outb %al,$0x20      # 新加入的代码在这句后面就过不去    movl CS(%esp),%eax    andl $3,%eax        # %eax is CPL (0 or 3, 0=supervisor)    pushl %eax    call do_timer       # &#39;do_timer(long CPL)&#39; does everything from    addl $4,%esp        # task switching to accounting ...    jmp ret_from_sys_call</code></pre><hr /><h2 id="第五关修改版本-0-内核">第五关：修改版本 0 内核</h2><p><strong>目标</strong> ：修改<strong>版本 0 内核</strong>，使得每发生 100 次时钟中断，就在屏幕上输出一个字符‘t’和当时的进程号，如“t(0)”表示0号进程运行时发生了时钟中断。</p><p>这里实训做的很烂。。。</p><p>这个实训的难度就在于猜猜要改哪里。我尝试了改主函数，不行。。。改init函数，不行。pid放在代码的哪里，我也不知道。后来我看了前几关调试时命令行有一个变量叫<strong>current-&gt;state</strong>，估计这个是程序当前的pid了，make + ./run一试，还成功了。在vscode的搜索中，我搜索了一下<strong>pause</strong>相关的内容，在某个位置，出现了<strong>sys_pause</strong>这个函数，ctrl + 左键点进去，发现这个好像就是系统中断。于是在原代码基础上尝试添加以下代码。</p><div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sys_pause<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">&#123;</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    current<span class="op">-&gt;</span>state <span class="op">=</span> TASK_INTERRUPTIBLE<span class="op">;</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    schedule<span class="op">();</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//add following code</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>jiffies <span class="op">%</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            printk<span class="op">(</span><span class="st">&quot;t(%d)</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> current<span class="op">-&gt;</span>pid<span class="op">);</span></span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//end</span></span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><p>然后make + ./run再再再...试，内核成功运行了，至此第五关通过。</p><p><strong>注意的问题</strong>：cur在前四关中都是指向1的，这关要将其指向0。至于为什么，打开config/0.11.bxrc看看。不改bochs就会报找不到硬盘的错误。</p><div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 0 cur</span></code></pre></div><h1 id="实训2.2异常">实训2.2：异常</h1><h2 id="第一关除零异常分析">第一关：除零异常分析</h2><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#终端一</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp1/1.1.tar /home/headless/os/linux-0.11-lab/</span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xvf</span> 1.1.tar</span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ll</span></span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1.1 cur</span><span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#终端一操作结束</span></span><span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#终端二</span></span><span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:147</span><span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="ex">x/6i</span> <span class="va">$eip</span> <span class="co">#这句话是idiv指令地址正确的判定依据，虽然它用处不大</span></span><span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span>  <span class="co">#观察到idiv指令出现在0x690e</span></span><span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x690e</span><span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg  <span class="co">#观察到idiv指令执行之前cs:eip为0xf:0x690e，ss:esp为0x17:0x25760</span></span><span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg  <span class="co">#观察到新指令位置cs:eip为0x8:0x814b，ss:esp为0x10:0x1fa2c</span></span><span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg</span><span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span> <span class="co">#详见代码后注释[1]，观察到用户栈顶0x17:0x25760，恢复点位置0xf:0x690e</span></span><span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#终端二结束</span></span></code></pre></div><h3 id="补充说明">补充说明</h3><ol type="1"><li>下面面显示了栈顶的 5 个长字，是某异常发生时的中断现场，其中存储的用户栈顶的位置是 0x17:0x2573c ，存储的恢复点的位置是 0xf:0x7967 。需要注意的是，x86 中栈是从高地址向低地址方向增长的，这里的栈顶位置是 0x1fa0c 。</li></ol><p><img src="https://data.educoder.net/api/attachments/1154430" alt="实验说明" /></p><ol start="2" type="1"><li>单独查看一个寄存器</li></ol><div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">p/x</span> <span class="va">$eax</span></span></code></pre></div><hr /><h2 id="第二关-int指令分析">第二关 int指令分析</h2><div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端1</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /data/workspace/myshixun/exp2/1.tgz ~/os/</span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-zxvf</span> ../1.tgz</span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 1 cur</span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 操作暂时结束</span></span><span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 开启终端2</span></span><span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> task1</span><span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5i</span> <span class="va">$eip</span></span><span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5i</span> <span class="va">$eip</span></span><span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co"># 可以观察到当前指令位置CS:EIP(0xf:0x7987)和栈位置SS:ESP(0x17:0x2573c)</span></span><span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co"># 可以观察到当前指令位置CS:EIP(0x8:0x7948)和栈位置SS:ESP(0x10:0xffffec)</span></span><span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span> <span class="co"># 观察到用户栈顶0x17:0x2573c，恢复点位置0xf:0x7989</span></span><span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 操作结束</span></span></code></pre></div><hr /><h2 id="第三关iret指令分析">第三关：iret指令分析</h2><p>没什么强调的，和第二关基本一样</p><div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一操作同上省略</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> task1</span><span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5i</span> <span class="va">$eip</span></span><span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5i</span> <span class="va">$eip</span></span><span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span> <span class="co">#找到中断处理模块</span></span><span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x795e</span><span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co">#处理程序的 iret 指令执行之前，指令位置CS:EIP(0x8:0x795e)和栈位置SS:ESP(0x10:0xffffec)</span></span><span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span> <span class="co">#此时栈中保存的恢复点位置(0xf:0x7989)和用户栈位置(0x17:0x2573c)</span></span><span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co">#使用 si 命令执行了该 iret 指令后，新指令位置(0xf:0x7989)和栈位置(0x17:0x2573c)</span></span></code></pre></div><hr /><h2 id="第四关陷入指令分析">第四关：陷入指令分析</h2><p>和第三关唯一一处不同，就是跳入陷入函数的时候.</p><div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一操作同上省略</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> main.c:145</span><span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用n指令，跳过将要执行的move_to_user_mode();函数</span></span><span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="ex">n</span></span><span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 陷入fork</span></span><span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5i</span> <span class="va">$eip</span></span><span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co">#在 0 号进程执行 fork 系统调用中的陷入指令(int 0x80)之前，当前指令位置CS:EIP(0xf:0x6908)和栈位置SS:ESP(0x17:0x25740)</span></span><span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="ex">info</span> reg <span class="co">#使用 si 命令执行了该指令后，新指令位置(0x8:0x7764)和栈位置(0x10:0x1fa0c)</span></span><span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ex">x/5wx</span> <span class="va">$esp</span> <span class="co">##此时栈中保存的恢复点位置(0xf:0x690a)和用户栈位置(0x17:0x25740)</span></span></code></pre></div><h3 id="补充">补充：</h3><blockquote><p>跟踪到系统调用的陷入指令（int 0x80）执行之前</p><p>一般而言，可以在该系统调用处设置断点，跟踪到该断点，然后使用 si 命令单步执行到陷入指令。但是，对于 main 函数里的 fork 系统调用，不能这样操作（因为 gdb 有时断点设置不够准），可以先跟踪到前一行的 move_to_user_mode 语句，然后使用 n 单步执行，即可到达 fork 系统调用的开始，此时再反汇编，找到陷入指令。</p></blockquote><h1 id="实训-2.3-系统调用">实训 2.3 ：系统调用</h1><h2 id="第一关版本1内核执行的前-3-个系统调用">第一关：版本1内核执行的前 3 个系统调用</h2><p>第一，使用方法一，找出第一次调用 请不要使用他提供的方法一，评测不过，明明都找到正确答案了。怪不得网上的人都说这是垃圾平台，给本来时间就充裕的我们增加了消磨<del>浪费</del>时间的机会。</p><p>第二，在输答案的时候，sys_要去掉，垃圾平台。。。让我们猜谜？</p><p>答案：<code>1.系统运行时，执行的前3个系统调用的编号和名字是(2,fork)、(29,pause)、(48,signal)</code></p><div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一，操作与2.1实验一的终端一一样，省略</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab/</span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> system_call</span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ex">display</span> <span class="va">$eax</span></span><span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> <span class="pp">*</span>0x7780</span><span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="ex">x/3i</span> <span class="va">$eip</span> <span class="co"># 发现eax的值是2，查找unistd.h，进程为__NR_fork（其实不是，用第二种方法，可以看出是sys_fork）</span></span><span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="ex">x/3i</span> <span class="va">$eip</span> <span class="co"># eax的值为29，调用了sys_pause函数，是一次系统中断</span></span><span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 第三次调用</span></span><span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="ex">si</span></span><span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="ex">x/3i</span> <span class="va">$eip</span></span><span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># eax的值为48，调用了sys_signal函数</span></span></code></pre></div><h2 id="第二关命令-ls-执行的系统调用">第二关：命令 ls 执行的系统调用</h2><div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="at">-rf</span> cur</span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> 0 cur</span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> cur/linux</span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../..</span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">./rungdb</span></span><span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端一结束</span></span><span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二</span></span><span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/os/linux-0.11-lab</span><span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ex">./mygdb</span></span><span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="ex">display</span> current-<span class="op">&gt;</span>pid</span><span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 1</span><span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> do_execve</span><span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 2</span><span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>start_code+filename</span><span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 此时等待虚拟机响应</span></span><span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 虚拟机操作</span></span><span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span><span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 虚拟机操作结束</span></span><span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> system_call</span><span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="ex">disas</span></span><span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="ex">display</span> <span class="va">$eax</span></span><span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> current-<span class="op">&gt;</span>pid</span><span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> system_call if current-<span class="op">&gt;</span>pid != 0</span><span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 3</span><span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="va">$eax</span></span><span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> sys_call_table[<span class="va">$eax</span>]</span><span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 以下是若干个c，一直到current-&gt;id != 6为止，不要c太多次</span></span><span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span><span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 终端二结束</span></span></code></pre></div><p>不停运行，观察current-&gt;pid即可，答案为：</p><div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">可执行文件ls运行时（无参数），会依次执行下面这些系统调用：</span></span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="bu">time</span><span class="kw">)(</span><span class="ex">ioctl</span><span class="kw">)(</span><span class="ex">brk</span><span class="kw">)(</span><span class="ex">brk</span><span class="kw">)(</span><span class="ex">brk</span><span class="kw">)</span></span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">brk</span><span class="kw">)(</span><span class="ex">brk</span><span class="kw">)(</span><span class="ex">open</span><span class="kw">)(</span><span class="ex">fstat</span><span class="kw">)(</span><span class="ex">brk</span><span class="kw">)</span></span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span><span class="er">(</span><span class="bu">read</span><span class="kw">)(</span><span class="bu">read</span><span class="kw">)(</span><span class="ex">close</span><span class="kw">)(</span><span class="ex">ioctl</span><span class="kw">)(</span><span class="fu">write</span><span class="kw">)</span></span><span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">4.</span><span class="er">(</span><span class="fu">write</span><span class="kw">)(</span><span class="ex">close</span><span class="kw">)(</span><span class="bu">exit</span><span class="kw">)()()</span></span></code></pre></div><p>ls在6号进程中执行，后面由 6 号进程引发的系统调用才是ls 执行的系统调用，所以只需要记录current-&gt;pid = 6时的所有系统函数调用！</p><h2 id="第三关版本1内核执行的完整系统调用序列">第三关：版本1内核执行的完整系统调用序列</h2><h3 id="补充gdb断点的启用和禁用">补充：GDB断点的启用和禁用</h3><ul><li><code>disable 1</code> ：禁用第一个断点；</li><li><code>enable 2</code> ：启用第二个断点；</li><li><code>enable once</code> 1 ：下次用了第一个断点，第一个断点就被禁用；</li></ul><div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2号断点为无条件的system_call</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> system_call</span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 2</span><span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="va">$eax</span></span><span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> sys_call_table[<span class="va">$eax</span>]</span><span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3号断点为有条件的system_call</span></span><span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="ex">b</span> system_call if <span class="va">$eax</span>!=29 <span class="kw">||</span> <span class="ex">current-</span><span class="op">&gt;</span>pid!=0</span><span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="ex">commands</span> 3</span><span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> <span class="va">$eax</span></span><span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="ex">p</span> sys_call_table[<span class="va">$eax</span>]</span><span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="ex">end</span></span><span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 接下来要不停的开关断点，在出现0号进程pause调用时，把它们跳过去</span></span><span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 2</span><span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="bu">enable</span> 3</span><span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span><span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果本次显示的断点没有发生0号进程pause调用，不用跳过，执行一次system_call</span></span><span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="ex">disable</span> 3</span><span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="bu">enable</span> 2</span><span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="ex">c</span></span></code></pre></div><p>答案：</p><div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">1.</span><span class="er">(</span><span class="ex">0,fork</span><span class="kw">)(</span><span class="ex">0,pause</span><span class="kw">)(</span><span class="ex">1,signal</span><span class="kw">)(</span><span class="ex">1,alarm</span><span class="kw">)(</span><span class="ex">1,pause</span><span class="kw">)</span></span><span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">2.</span><span class="er">(</span><span class="ex">0,pause</span><span class="kw">)(</span><span class="ex">1,alarm</span><span class="kw">)(</span><span class="ex">1,pause</span><span class="kw">)(</span><span class="ex">0,pause</span><span class="kw">)(</span><span class="ex">1,alarm</span><span class="kw">)</span></span><span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3.</span><span class="er">(</span><span class="ex">1,pause</span><span class="kw">)(</span><span class="ex">0,pause</span><span class="kw">)(</span><span class="ex">1,alarm</span><span class="kw">)(</span><span class="ex">,</span><span class="kw">)(</span><span class="ex">,</span><span class="kw">)</span></span></code></pre></div><h2 id="第四关在版本1中输出系统调用信息">第四关：在版本1中输出系统调用信息</h2><p>修改system_call.asm中的system_call:函数</p><pre class="assembly"><code>system_call:    cmpl $nr_system_calls-1,%eax    ja bad_sys_call    push %ds    push %es    push %fs    pushl %edx    pushl %ecx      # push %ebx,%ecx,%edx as parameters    pushl %ebx      # to the system call    movl $0x10,%edx     # set up ds,es to kernel space    mov %dx,%ds    mov %dx,%es    movl $0x17,%edx     # fs points to local data space    mov %dx,%fs    pushl %eax #新加入的指令1    call myfunc #新加入的指令2    popl %eax #新加入的指令3    call sys_call_table(,%eax,4)    pushl %eax    movl current,%eax    cmpl $0,state(%eax)     # state    jne reschedule    cmpl $0,counter(%eax)       # counter    je reschedule</code></pre><p>修改fork.c，在其中添加</p><div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> baghdnkdn <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span><span class="co">//全局变量，随机取名，不要与已有的变量名重复</span></span><span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> myfunc <span class="op">(</span><span class="dt">int</span> eax<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>baghdnkdn <span class="op">==</span> current <span class="op">-&gt;</span> pid <span class="op">&amp;&amp;</span> eax <span class="op">==</span> <span class="dv">29</span> <span class="op">&amp;&amp;</span> baghdnkdn <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span><span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        printk<span class="op">(</span><span class="st">&quot;%d(%d)&quot;</span><span class="op">,</span> eax<span class="op">,</span> current<span class="op">-&gt;</span>pid<span class="op">);</span></span><span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    baghdnkdn <span class="op">=</span> current <span class="op">-&gt;</span> pid<span class="op">;</span></span><span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="第五关在版本0中输出系统调用信息">第五关：在版本0中输出系统调用信息</h2><p>和第四关几乎相同</p><p>修改system_call.asm中的system_call:函数，与第四关完全一样</p><p>修改fork.c，在其中添加</p><div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> myfunc<span class="op">(</span><span class="dt">int</span> eax<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>current <span class="op">-&gt;</span> pid <span class="op">&lt;</span> <span class="dv">4</span><span class="op">)</span> <span class="cf">return</span><span class="op">;</span></span><span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        printk<span class="op">(</span><span class="st">&quot;%d(%d)&quot;</span><span class="op">,</span> eax<span class="op">,</span> current<span class="op">-&gt;</span>pid<span class="op">);</span></span><span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Educoder </tag>
            
            <tag> 模拟实训 </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debian系统配置Linux0.11</title>
      <link href="/2021/09/07/Operation%20System/Debian%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AELinux0.11/"/>
      <url>/2021/09/07/Operation%20System/Debian%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AELinux0.11/</url>
      
        <content type="html"><![CDATA[<h2 id="由于系统的更新迭代这篇文章已经过时需要再次更新">由于系统的更新迭代，这篇文章已经过时需要再次更新！</h2><h2 id="前言">前言</h2><p>最近要上操作系统课，课上需要我们配置Linux0.11实验环境，在这个过程中，我遇到了大量的问题，耗费了很多时间。必须写个博客来做总结。刚开始我用OpenEuler，配置了一天，结果还是有问题。于是使用Debian再次尝试配置。</p><h2 id="什么是linux0.11-实验环境">什么是Linux0.11 实验环境</h2><p>Linux0.11实验环境由三个部分组成，第一为VMware，hyper-v等安装在实体机上的虚拟机A，第二为虚拟机中的Linux系统，第三为虚拟机A中Linux操作系统中的bochs虚拟机B。</p><p>程序在客户机上，使用编程软件编好后，使用网络映射，存储到虚拟机A上。在虚拟机A上完成编译后，会生成BIOS文件，这时，使用虚拟机软件bochs，添加BIOS及虚拟硬盘，生成虚拟机B。这样就相当于在Linux环境下，完成了Linux内核的编写和执行。</p><p>为什么这么麻烦，因为bochs是纯软件虚拟，而VMware等虚拟机存在硬件虚拟，不好调试输出。</p><h2 id="debian部署linux0.11">Debian部署Linux0.11</h2><h3 id="第一步安装debian操作系统">第一步：安装Debian操作系统</h3><p><a href="https://www.debian.org/CD/http-ftp/">通过 HTTP/FTP 下载 Debian CD/DVD 映像</a></p><p>最好安装一个图形化界面，如果是只用来做实验的话推荐Xfce，占用资源少</p><p>这一步比较简单，因为Debian在安装上难度和ubuntu差不多。</p><h3 id="第二步安装samba服务器">第二步：安装Samba服务器</h3><ol type="1"><li><p>确保虚拟机网络是NAT模式，至于为什么？原理在这里：<a href="https://www.cnblogs.com/aeolian/p/8882790.html">VMWare虚拟机网络配置</a></p></li><li><p>在虚拟机上使用<strong>ifconfig</strong>命令看看虚拟机的ip地址，但是。。。我们发现没有<strong>ifconfig</strong>这个命令，出错情况如下：</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bash:</span> ifconfig：未找到命令</span></code></pre></div><p>这是因为ifconfig命令要被Linux淘汰了，取而代之的是功能更强的<strong>ip</strong>命令。<a href="https://www.runoob.com/linux/linux-comm-ip.html">Linux ip 命令</a></p><p>ifconfig 现在可以用 ip addr 代替。其他的替代详见下表：</p></li></ol><p><img src="http://www.linuxidc.com/upload/2014_06/14060411029186.png" alt="ifconfig 和 ip命令简要对应" /></p><ol start="3" type="1"><li>客户机和虚拟机之间需要建立网络映射，如果直接ping虚拟机的ip，会发现虚拟机可以ping通，但磁盘映射始终建立不了。这是因为系统的安全问题（想想如果你的文件能被局域网里的坏家伙访问，会是什么结果），我们需要一个媒介，这个媒介就是Samba。通过Samba，我们才能建立两个主机的安全访问。安装命令如下：</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install samba <span class="co">#安装samba</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">whereis</span> samba <span class="co">#查看samba的安装目录</span></span></code></pre></div><p>安装时可能会出现如下的问题</p><div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">更换介质：请把标有</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">“Debian</span> GNU/Linux 11.0.0 _Bullseye_ <span class="at">-</span> Official amd64 DVD Binary-1 20210814-10:04”</span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">的盘片插入驱动器“/media/cdrom/”再按「回车」键</span></span></code></pre></div><p>解决方法：</p><div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 修改/etc/apt/sources.list文件</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> vim /etc/apt/sources.list</span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 注释掉deb cdrom:开头的一行（第一行），然后更新一下</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get update</span></code></pre></div><h3 id="第三步配置samba">第三步：配置samba</h3><p>samba的配置文件在 /etc/samba 目录下，名称为 smb.conf</p><p>先将原来的文件备份<code>sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</code></p><p>使用vi命令，以管理员身份打开 bash <code>sudo vim /etc/samba/smb.conf</code></p><p>仔细阅读带注释的地方，完成个性化的修改，复制到配置文件的最后面</p><div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[global]</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="ex">workgroup</span> = SAMBA</span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">security</span> = user</span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">passdb</span> backend = tdbsam</span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">printing</span> = cups</span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">printcap</span> name = cups</span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">load</span> printers = yes</span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">cups</span> options = raw</span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">log</span> file = /var/log/samba/log.%m</span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="co">#主机名，可修改</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">netbios</span> name = cccs</span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[red_leaves]</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># service introduction</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#无关紧要</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">comment</span> = <span class="st">&quot;This is a share service&quot;</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># share folder</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#共享目录，可修改</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="ex">path</span> = /home/red_leaves</span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># close anonymous access</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="ex">public</span> = yes</span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># writable</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">writable</span> = yes</span></code></pre></div><p>而后启动samba服务</p><div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> /etc/init.d/smbd start</span></code></pre></div><p>为了方便，今后不用再手动打开samba，可以将samba设为开机自启</p><div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable smbd.service</span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable nmbd.service</span></code></pre></div><p>完成之后，创建samba用户</p><div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> smbpasswd <span class="at">-a</span> red_leaves</span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> pdbedit <span class="at">-Lv</span> <span class="co">#查看用户详细信息、</span></span></code></pre></div><p>最后再进行磁盘映射，再输入映射文件夹路径，格式为</p><pre class="shell"><code>\\你的主机名(ip地址)\共享目录</code></pre><p>输入samba的用户名和密码（Linux的用户名和密码也可以）,可以发现成功访问VMware虚拟机的文件</p><p><a href="https://blog.csdn.net/weixin_40806910/article/details/81917077">更复杂的Linux samba的配置和使用</a></p><h3 id="第四步安装bochs">第四步：安装bochs</h3><p>千万要注意，不要使用apt yum等命令安装，而且千万不要安装2.6.x版本，2.6.x存在中断表等bug，（bochs黑屏不显示，报hardware error错误），要在<a href="https://bochs.sourceforge.io/">官网</a>下载安装包，手动编译安装。</p><p>课程中要求用gdb，所以这里在./configure选项中中使用gdb</p><div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prefix指定目录，自己随意指定即可,docbook, --enable-disasm被新版的调试器删除了，在编译的时候会出错,要去掉</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 遇到“install: 无法获取&quot;./bochsdbg&quot; 的文件状态(stat): 没有该文件或目录”，需要在make后，将bochs拷贝一份，命名为bochsdbg。在bochs-2.6.9文件夹下打开命令行，键入cp bochs bochsdbg即可。</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./configure</span> <span class="at">--with-x11</span> <span class="at">--enable-gdb-stub</span> <span class="at">--enable-pci</span> <span class="at">--enable-pcidev</span> <span class="at">--enable-plugins</span> <span class="at">--enable-ne2000</span> <span class="at">--enable-pnic</span> <span class="at">--disable-docbook</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> bochs bochsdbg</span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> make install</span></code></pre></div><p>安装时报错“fatal error: X11/Xlib.h: 没有那个文件或目录”，说明缺少c++运行库，安装即可</p><div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install build-essential</span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install xorg-<span class="pp">*</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libgtk2.0-dev</span></code></pre></div><h4 id="补充">补充</h4><p>要想利用win机器向共享文件夹复制内容，需要在Linux中对共享文件夹提权</p><div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 777 共享文件夹名 <span class="at">-R</span></span></code></pre></div><h3 id="第五步编译linux0.11内核代码中的文件">第五步：编译Linux0.11内核代码中的文件</h3><p>在这里，我遇到了一个让我头疼的问题。</p><p>在linux目录下make编译时，如图所示<img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/shixun/48d70c44bc63ba09.png" alt="image" /></p><p>这些报错，我在StackOverflow上查询到的结果是32位指令和64位指令不兼容。试了网上所有的方法，都不管用。后来，我才知道这个代码是上个世纪写的。。。太古老了，现代的编译器和操作系统已经无法支持它的编译了。。。于是，我在github上，找到了大佬根据现代amd64Linux修改的代码，终于可以运行了。我把它fork到了我的仓库。<a href="https://github.com/RedLeaves699/Hack-Linux-0.11">点此进入</a></p><p>接着运行虚拟机即可。文件是现成的，不需要自己写，唯一需要改的地方可能是下面注释的地方</p><hr /><p>实验环境在<a href="https://pan.baidu.com/s/1UNkwMJ6GFx0Mn-xT6J_ZKA">这里</a>下载，提取码y29a</p><p>[备用站][redleaves.ys168.com](http://redleaves.ys168.com/) 的实验材料目录</p><div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">megs:</span> 16</span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">romimage:</span> file=/usr/local/share/bochs/BIOS-bochs-latest <span class="co">#BIOS-bochs-latest的位置</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># with the LGPL BIOS, X windows can be used</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">vgaromimage:</span> file=/usr/local/share/bochs/VGABIOS-lgpl-latest <span class="co">#VGABIOS-lgpl-latest的位置</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">boot:</span> floppy</span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">floppya:</span> type=1_44</span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">floppya:</span> 1_44=<span class="st">&quot;Linux/Image&quot;</span>, status=inserted <span class="co">#虚拟软盘（本例中为启动盘）的位置</span></span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="ex">floppyb:</span> type=1_44</span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ex">floppyb:</span> 1_44=vvfat:<span class="st">&quot;b/&quot;</span>, status=inserted</span><span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="ex">ata0:</span> enabled=1, ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14</span><span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="ex">ata0-master:</span> type=disk, path=<span class="st">&quot;images/hdc-0.11.img&quot;</span>, mode=flat <span class="co">#虚拟硬盘的位置</span></span><span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="ex">log:</span> bochsout.txt</span><span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="ex">panic:</span> action=ask</span><span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="ex">error:</span> action=report</span><span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="ex">info:</span> action=report</span><span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="ex">debug:</span> action=ignore</span><span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="ex">pci:</span> enabled=1, chipset=i440fx</span><span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="ex">vga:</span> extension=vbe, update_freq=15</span><span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="ex">keyboard:</span> serial_delay=250, paste_delay=100000</span><span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="ex">cpu:</span> ips=15000000</span><span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="ex">clock:</span> sync=slowdown</span><span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="ex">mouse:</span> enabled=0</span></code></pre></div><p>执行<code>sudo ./run</code>后，可以看到虚拟机正常开启。</p><p>如果是黑屏的，要在虚拟机B的控制台加一个c（continue），至此，Debian系统实验环境配置正式完成。</p><h3 id="第六步使用gdb调试">第六步：使用GDB调试</h3><p>下载第五步提到的实验环境，在两个终端分别运行./mygdb, ./rungdb脚本即可开始对内核的调试</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> 实训 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 实验环境配置 </tag>
            
            <tag> Debian </tag>
            
            <tag> Linux0.11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Node.js和hexo搭建GitHub博客（以windows为例）</title>
      <link href="/2021/09/02/Front/%E4%BD%BF%E7%94%A8hexo%E5%92%8Cnode.js%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2021/09/02/Front/%E4%BD%BF%E7%94%A8hexo%E5%92%8Cnode.js%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="第一步安装node.js">第一步：安装node.js</h2><p><a href="https://zhuanlan.zhihu.com/p/47822968">什么是 Nodejs ?</a></p><p><a href="https://nodejs.org/zh-cn/download/">点此前往官网下载</a></p><h2 id="第二步安装hexo">第二步：安装hexo</h2><p>在<strong>git bash</strong>中，键入<strong>npm install hexo -g</strong>命令即可，安装时间比较长，在我安装的时候没显示安装进度，执行这一步，需要一个稳定的网络。</p><h2 id="第三步初始化博客文件夹">第三步：初始化博客文件夹</h2><p>新建一个空文件夹，cd到新文件夹，执行<strong>hexo init</strong>命令，这时hexo会生成很多文件，这些文件是未来生成博客时的重要组件，注意这一步也需要联网。</p><h2 id="第四步加载博客模板">第四步：加载博客模板</h2><p>在网上寻找博客模板，每个模板都有自己的特点，所以模板的使用方法需要自己参考模板的readme.md文件。</p><h2 id="第五步运行hexo">第五步：运行hexo</h2><p>模板已经加载完毕，现在要在本地运行查看效果。</p><p>依次输入以下两条命令，一个是生成网页文件，一个是运行本地服务器</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hexo</span> g <span class="co">#生成网页文件</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hexo</span> s <span class="co">#运行本地服务器</span></span></code></pre></div><h2 id="第六步访问本地网页查看效果">第六步：访问本地网页，查看效果</h2><p>访问 <a href="https://localhost:4000" class="uri">https://localhost:4000</a> 进入网站主页</p><h2 id="第七步将本地网页部署在github上">第七步：将本地网页部署在Github上</h2><p>经过前面的操作，我们已经在本地搭好了博客，接下来，我们要把博客传送到GitHub上。</p><p>先要配置博客目录下（不是博客主题目录）的_config.yml文件，填写deploy选项，注意，<strong>每个字段冒号后都有一个空格</strong></p><div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deploy</span><span class="kw">:</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> git</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">repository</span><span class="kw">:</span><span class="at"> https://github.com/sample/sample.github.io.git</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">branch</span><span class="kw">:</span><span class="at"> master</span></span></code></pre></div><p>然后执行npm命令安装hexo-deployer-git插件</p><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install hexo-deployer-git <span class="at">--save</span></span></code></pre></div><p>运行hexo g生成，再运行hexo d提交</p><div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hexo</span> g</span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">hexo</span> d</span></code></pre></div><p>等等，我们是不是忘了什么？</p><p>hexo d命令是提交到Github上的，意味着需要身份验证，我们上面的操作好像没有验证身份。。。</p><p>所以会报unable to access错，类似下面这样</p><div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">unable</span> to access <span class="st">&#39;https://github.com/*/*.github.io.git/&#39;</span>: Couldn<span class="st">&#39;t resolve host &#39;</span>github.com</span></code></pre></div><p>验证身份的方法：在deploy的repository中输入（不包含大括号）</p><p>respository: <a href="https://%7BGithub用户名%7D:%7BGithub令牌或SSH密钥%7D/sample/sample.github.io.git" class="uri">https://{Github用户名}:{Github令牌或SSH密钥}/sample/sample.github.io.git</a></p><div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">respository</span><span class="kw">:</span><span class="at"> https://username:token@github.com/RedLeaves699/RedLeaves699.github.io.git</span></span></code></pre></div><p>注意GitHub现在不能密码认证了，<a href="https://github.blog/changelog/2021-08-12-git-password-authentication-is-shutting-down">详情见此</a>。</p><p>修改完毕后再hexo g，hexo d提交，发现可以成功提交了。如果还出问题，那就是hexo git冲突的问题。</p><h2 id="extend01解决markdown与mathjax渲染冲突">Extend01：解决MarkDown与MathJax渲染冲突</h2><h3 id="方法一">方法一</h3><p>添加MathJax后写几个公式发现渲染出了很多问题。原因是hexo-renderer-marked会把一些特殊的latex符号转换为相应的html标签，比如在markdown语法中，下划线<code>_</code>代表斜体，会被转化为<code>&lt;em&gt;</code>标签，<code>\\</code>也会被转义成一个<code>\</code>。而Latex格式书写的数学公式下划线_ 表示角标，<code>\\</code>表示公式换行，有特殊的含义，所以MathJax引擎在渲染数学公式的时候就会出错。</p><p>解决方法:更换Hexo的MarkDown渲染引擎，用hexo-renderer-kramed 替换默认的hexo-renderer-marked引擎，并作出部分修改</p><p>针对二次转义的问题，我们只要不让inline.js去转义\,{,}在MathJax中有特殊用途的字符就行了。</p><p>编辑._modules.js 脚本：</p><div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>【第一步】</span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>将escape<span class="op">:</span> <span class="ss">/</span><span class="sc">^\\([\\`*&#123;&#125;\[\]()# +\-.!_&gt;])</span><span class="ss">/</span><span class="op">,</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>替换为escape<span class="op">:</span> <span class="ss">/</span><span class="sc">^\\([`*\[\]()#$+\-.!_&gt;])</span><span class="ss">/</span><span class="op">,</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>这一步取消了对\\<span class="op">,</span>\&#123;<span class="op">,</span>\&#125;<span class="fu">的转义</span>(escape)</span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>【第二步】</span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>em<span class="op">:</span> <span class="ss">/</span><span class="sc">^\b</span><span class="ss">_</span><span class="sc">((?</span><span class="ss">:</span><span class="sc">[^_]|</span><span class="ss">__</span><span class="sc">)+?)</span><span class="ss">_</span><span class="sc">\b|</span><span class="ss">^</span><span class="sc">\*((?</span><span class="ss">:</span><span class="sc">\*\*|[\s\S])+?)\*(?</span><span class="ss">!</span><span class="sc">\*)</span><span class="ss">/</span><span class="op">,</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>替换为em<span class="op">:</span><span class="ss">/</span><span class="sc">^\*((?</span><span class="ss">:</span><span class="sc">\*\*|[\s\S])+?)\*(?</span><span class="ss">!</span><span class="sc">\*)</span><span class="ss">/</span><span class="op">,</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>这一步取消了对斜体标记_和\<span class="op">*</span>的转义</span></code></pre></div><h3 id="方法二">方法二</h3><p>换用Pandoc引擎，例如，如果之前安装的引擎是hexo-renderer-marked，那么，需要卸载再安装hexo-renderer-pandoc。Pandoc的语法要求比hexo-renderer-marked严格，要重新检查博客的状态。比如说Pandoc插入行内图片时要加一个<code>\</code>，否则和某些主题混用时，会出现图像标题显示两遍的情况。</p><div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> uninstall hexo-renderer-marked <span class="at">--save</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install hexo-renderer-pandoc <span class="at">--save</span></span></code></pre></div><p>Pandoc的渲染语法<a href="https://www.bookstack.cn/read/mba811-Writing/Pandoc-01.md">请看这里</a>。</p><h2 id="extend-02解决hexo-renderer-pandoc图片caption出现多次的问题">Extend 02：解决hexo-renderer-pandoc图片caption出现多次的问题</h2><p>问题如图所示</p><p><img src="https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/others/front/figcaptionproblem.png" alt="Pandoc出现的问题" /></p><p>出现问题的html代码如下</p><div class="sourceCode" id="cb9"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;figure&gt;</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;div_img&quot;</span><span class="kw">&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;https://cdn.jsdelivr.net/gh/redleaves699/image-host/images/技术与分享.PNG&quot;</span><span class="ot"> alt=</span><span class="st">&quot;关于博客一个很好的回答&quot;</span><span class="kw">&gt;&lt;div</span><span class="ot"> class=</span><span class="st">&quot;img_alt&quot;</span><span class="kw">&gt;&lt;span&gt;</span>关于博客一个很好的回答<span class="kw">&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;figcaption</span><span class="ot"> aria-hidden=</span><span class="st">&quot;false&quot;</span><span class="kw">&gt;</span>关于博客一个很好的回答<span class="kw">&lt;/figcaption&gt;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/figure&gt;</span></span></code></pre></div><p>问题的源头很简单：hexo-renderer-pandoc 将 Markdown 文件渲染成 HTML 时，会对图片进行渲染，然后生成一个 figcaption 的标签。</p><h3 id="解决方法">解决方法</h3><p>编辑根目录配置文件 <code>_config.yml</code>，添加如下内容：</p><div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pandoc</span><span class="kw">:</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">extensions</span><span class="kw">:</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="st">&#39;-implicit_figures&#39;</span></span></code></pre></div><h3 id="参考内容">参考内容</h3><p><a href="https://blog.csdn.net/qq_32767041/article/details/105084853">15wylu的csdn博客</a></p><p><a href="https://github.com/wzpan/hexo-renderer-pandoc/issues/34">Pandoc issue34</a></p><h2 id="extend03创建404页面">Extend03：创建404页面</h2><ol type="1"><li>hexo创建404页面，新建的页面文件在<code>/source/404/index.md</code>目录下</li></ol><pre><code>hexo new page 404</code></pre><ol start="2" type="1"><li>在顶部插入一行，写上 <code>enlink: /404</code>，这表示指定该页固定链接为 <code>http://"主页"/404.html</code></li></ol><pre><code>---title: 404enlink: /404date: 2016-09-27 11:31:01------## 页面未找到！</code></pre><h3 id="参考内容-1">参考内容</h3><p><a href="http://yelog.org/2017/02/25/hexo-create-404-page/">3-hexo主题开发者的博客</a></p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> 网页前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端 </tag>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>各种语言实现随机数和计时</title>
      <link href="/2021/08/17/Programming%20Language/%E5%90%84%E7%A7%8D%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%92%8C%E8%AE%A1%E6%97%B6/"/>
      <url>/2021/08/17/Programming%20Language/%E5%90%84%E7%A7%8D%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%92%8C%E8%AE%A1%E6%97%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="c语言生成随机数">C语言生成随机数</h2><h3 id="生成方法">生成方法</h3><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="dt">void</span> rand<span class="op">()</span> <span class="co">//按照某个公式生成一个数</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> srand<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> seed<span class="op">)</span> <span class="co">//修改随机数种子</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>srand<span class="op">((</span><span class="dt">unsigned</span> <span class="dt">int</span> <span class="op">)</span>time<span class="op">(</span>NULL<span class="op">)</span> <span class="co">//time（NULL）随毫秒变化，种子变化极快，生成多个种子</span></span></code></pre></div><h3 id="限制范围">限制范围</h3><p>生成<span class="math inline">\((min，max)\)</span>之间的随机数</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rand <span class="op">%</span> <span class="op">(</span>max <span class="op">-</span> min <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">+</span> min</span></code></pre></div><h3 id="代码">代码</h3><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">//生成(min，max)之间的随机数</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> generate_random<span class="op">(</span><span class="dt">int</span> minn<span class="op">,</span> <span class="dt">int</span> maxx<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rand<span class="op">()</span> <span class="op">%</span> <span class="op">(</span>maxx <span class="op">-</span> minn <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">+</span> minn<span class="op">;</span><span class="co">//</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> test<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">(</span>NULL<span class="op">));</span><span class="co">//生成随机数种子</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> read<span class="op">();</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        a<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> generate_random<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">10000</span><span class="op">);</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    Print<span class="op">(</span>a<span class="op">[</span>i<span class="op">]);</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="c语言计时器">C语言计时器</h2><p>clock()函数返回值是时钟打点数，要换算成秒，需要除以CLK_TCK或者 CLK_PER_SEC。</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> st0 <span class="op">=</span> clock<span class="op">();</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    merge_sort<span class="op">(</span>std<span class="op">,</span> n<span class="op">);</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> ed0 <span class="op">=</span> clock<span class="op">();</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;std time = %.3f</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(</span>ed0 <span class="op">-</span> st0<span class="op">)</span> <span class="op">/</span> CLOCKS_PER_SEC<span class="op">);</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="python-语言实现随机数">Python 语言实现随机数</h2><p>Python语言生成随机数十分便利，也不需要我们设置随机数种子之类的。下面就是生成0-9之间整数随机数的代码：</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a> </span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(random.randint(<span class="dv">0</span>,<span class="dv">9</span>))</span></code></pre></div><p>random更详细的参考如下：</p><div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机整数：</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.randint(<span class="dv">1</span>,<span class="dv">50</span>)</span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机选取0到100间的偶数：</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.randrange(<span class="dv">0</span>, <span class="dv">101</span>, <span class="dv">2</span>)</span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机浮点数：</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.random()</span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.uniform(<span class="dv">1</span>, <span class="dv">10</span>)</span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机字符：</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.choice(<span class="st">&#39;abcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()&#39;</span>)</span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 多个字符中生成指定数量的随机字符：</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.sample(<span class="st">&#39;zyxwvutsrqponmlkjihgfedcba&#39;</span>,<span class="dv">5</span>)</span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 从a-zA-Z0-9生成指定数量的随机字符：</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>ran_str <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(random.sample(string.ascii_letters <span class="op">+</span> string.digits, <span class="dv">8</span>))</span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> ran_str</span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 多个字符中选取指定数量的字符组成新字符串：</span></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> <span class="st">&#39;&#39;</span>.join(random.sample([<span class="st">&#39;z&#39;</span>,<span class="st">&#39;y&#39;</span>,<span class="st">&#39;x&#39;</span>,<span class="st">&#39;w&#39;</span>,<span class="st">&#39;v&#39;</span>,<span class="st">&#39;u&#39;</span>,<span class="st">&#39;t&#39;</span>,<span class="st">&#39;s&#39;</span>,<span class="st">&#39;r&#39;</span>,<span class="st">&#39;q&#39;</span>,<span class="st">&#39;p&#39;</span>,<span class="st">&#39;o&#39;</span>,<span class="st">&#39;n&#39;</span>,<span class="st">&#39;m&#39;</span>,<span class="st">&#39;l&#39;</span>,<span class="st">&#39;k&#39;</span>,<span class="st">&#39;j&#39;</span>,<span class="st">&#39;i&#39;</span>,<span class="st">&#39;h&#39;</span>,<span class="st">&#39;g&#39;</span>,<span class="st">&#39;f&#39;</span>,<span class="st">&#39;e&#39;</span>,<span class="st">&#39;d&#39;</span>,<span class="st">&#39;c&#39;</span>,<span class="st">&#39;b&#39;</span>,<span class="st">&#39;a&#39;</span>], <span class="dv">5</span>))</span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机选取字符串：</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.choice([<span class="st">&#39;剪刀&#39;</span>, <span class="st">&#39;石头&#39;</span>, <span class="st">&#39;布&#39;</span>])</span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 打乱排序</span></span><span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>items <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">0</span>]</span><span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> random.shuffle(items)</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> 基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程语言 </tag>
            
            <tag> 随机数 </tag>
            
            <tag> 计时 </tag>
            
            <tag> 实用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>百年未有之大变局</title>
      <link href="/2021/07/26/%E7%99%BE%E5%B9%B4/"/>
      <url>/2021/07/26/%E7%99%BE%E5%B9%B4/</url>
      
        <content type="html"><![CDATA[<p>百年未有之大变局，概括起来说，就是当前国际格局和国际体系正在发生深刻调整，全球治理体系正在发生深刻变革， 国际力量对比正在发生近代以来最具革命性的变化，世界范围内正在呈现出影响人类历史进程和趋向的重大态势。 《习近平 新时代中国特色社会主义思想学习问答》第42页，第二段</p>]]></content>
      
      
      <categories>
          
          <category> 感想随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 政治历史 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A - Alice and Bob</title>
      <link href="/2021/07/26/Algorithm/A%20-%20Alice%20and%20Bob/"/>
      <url>/2021/07/26/Algorithm/A%20-%20Alice%20and%20Bob/</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要">前情提要</h2><p>填表法和刷表法的速度相差能有多大？将近百倍！</p><h2 id="题目原文">题目原文</h2><p>Alice and Bob like playing games. There are two piles of stones with numbers n and m. Alice and Bob take turns to operate, each operation can take away <span class="math inline">\(k(k&gt;0)\)</span> stonesfrom one pile and take away <span class="math inline">\(s \times k(s \geq 0)\)</span> stones from another pile. Alice plays first. The person who cannot perform the operation loses the game.</p><p>Please determine who will win the game if both Alice and Bob play the game optimally.</p><h3 id="思路一-原始思路-动态规划">思路一 原始思路 : 动态规划</h3><p>博弈论动态规划(又称暴力SG函数法)，令<span class="math inline">\(f[i][j]\)</span>为当前局面的状态为第一堆还剩<span class="math inline">\(i\)</span>个，第二堆还剩<span class="math inline">\(j\)</span>个(今后再描述状态会使用<span class="math inline">\((i, j)\)</span>表示)，遇到这个状态的人是否会赢，将赢的情况记为<span class="math inline">\(N\)</span>，输的情况记为<span class="math inline">\(P\)</span>。很明显，<span class="math inline">\(f[0][0] = P\)</span>，因为两堆石子都取完了，遇到这个局面的人就输了。与此相反，假设状态为<span class="math inline">\((0, i)\)</span>，说明这个人可以将<span class="math inline">\(i\)</span>个石子全取走，使得下一个人的状态为<span class="math inline">\(f[0][0] = P\)</span>，所以遇到这个状态的人赢了，将局面<span class="math inline">\((i, j)\)</span>记为<span class="math inline">\(N\)</span>。</p><p>这时，我们使用动态规划的方法，考虑状态<span class="math inline">\(f[i][j]\)</span>，考虑先手(这里的先后手是相对的)所有可能的取法，比如说先手在左面一堆取了一个石子，留给后手的状态就是<span class="math inline">\(f[i - 1][j]\)</span>，如果<span class="math inline">\(f[i - 1][j] = P\)</span>，说明当前先手留给后手的状态是后手必败，先手必胜。反之，<span class="math inline">\(f[i - 1][j] = N\)</span>，则为先手败，后手胜。</p><p>先手的操作有很多种，所以我们列举出所有的转移，无非是两种情况 :</p><ol type="1"><li>先手无论怎么取，都不存在一种取法<span class="math inline">\((i - k, i - s *k)\)</span> 或 <span class="math inline">\((i - s* k, j)\)</span>，使得后手在这种情况下为失败<span class="math inline">\(P\)</span>，那么就表明情况<span class="math inline">\((i, j)\)</span>下先手必败。</li><li>先手的取法中，存在一种取法<span class="math inline">\((i - k, i - s *k)\)</span> 或 <span class="math inline">\((i - s* k, j)\)</span>，使得后手在这种情况下为失败<span class="math inline">\(P\)</span>，那么，先手就会赢(先手选择最优方案， 一定是让ta赢)</li></ol><p>按这种思路，我们得到了如下代码，代码中使用的是填表法，复杂度(O<span class="math inline">\((n^3log(n))\)</span>)</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">//(n^3 log n)</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> MAXN <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define P </span><span class="dv">1</span><span class="pp"> </span><span class="co">//先手不赢</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N </span><span class="dv">0</span><span class="pp"> </span><span class="co">//先手赢</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> f<span class="op">[</span>MAXN<span class="op">+</span><span class="dv">10</span><span class="op">][</span>MAXN<span class="op">+</span><span class="dv">10</span><span class="op">];</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    f<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> P<span class="op">;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        f<span class="op">[</span>i<span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> f<span class="op">[</span><span class="dv">0</span><span class="op">][</span>i<span class="op">]</span>  <span class="op">=</span> N<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>i<span class="op">)&#123;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> neg <span class="op">=</span> N<span class="op">;</span><span class="co">//统计所有可能状态中是否有P状态</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> k <span class="op">&lt;=</span> j<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> s <span class="op">*</span> k <span class="op">&lt;=</span> i<span class="op">;</span> <span class="op">++</span>s<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                    neg <span class="op">|=</span> f<span class="op">[</span>i <span class="op">-</span> s <span class="op">*</span> k<span class="op">][</span>j <span class="op">-</span> k<span class="op">];</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> k <span class="op">&lt;=</span> i<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> s <span class="op">*</span> k <span class="op">&lt;=</span> j<span class="op">;</span> <span class="op">++</span>s<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                    neg <span class="op">|=</span> f<span class="op">[</span>i <span class="op">-</span> k<span class="op">][</span>j <span class="op">-</span> s <span class="op">*</span> k<span class="op">];</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>neg<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> P<span class="op">;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span> <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> N<span class="op">;</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> T<span class="op">;</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>T<span class="op">);</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>T<span class="op">--)</span> <span class="op">&#123;</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> f<span class="op">[</span>x<span class="op">][</span>y<span class="op">]</span> <span class="op">==</span> N<span class="op">?</span><span class="st">&quot;Alice&quot;</span><span class="op">:</span><span class="st">&quot;Bob&quot;</span><span class="op">);</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="思路二-基于思路一的优化">思路二 : 基于思路一的优化</h3><p>经过上面一通严谨的分析，我们发现在我们枚举的全部后手状态中，只有f[...][...] = P这个结果对于断定<span class="math inline">\(f[i][j]\)</span>的值是有帮助的。这也是这句话存在的意义。</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>neg <span class="op">|=</span> f<span class="op">[</span>i <span class="op">-</span> s <span class="op">*</span> k<span class="op">][</span>j <span class="op">-</span> k<span class="op">];</span><span class="co">//统计所有可能状态中是否有P状态</span></span></code></pre></div><p>这句话是有优化空间的。我们能否倒过来想一下，如果我在状态<span class="math inline">\((i - k, i - s *k)\)</span> 或 <span class="math inline">\((i - s* k, j)\)</span>已经知道遇到这两种情况必输，那么，是不是情况<span class="math inline">\((i, j)\)</span>，就是必赢的？对，我们可以不用笨笨的在<span class="math inline">\((i,j)\)</span>逆推全部情况！而是可以用刷表法，当且仅当<span class="math inline">\(f[i][j] = P\)</span>时，我们才会从<span class="math inline">\((i, j)\)</span>推<span class="math inline">\((i + k, i + s *k)\)</span> 或 <span class="math inline">\((i + s* k, j)\)</span>，从而节省大量的时间！</p><p>刷表法的代码，仍然不够通过测试。</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">//(n^2 log n)</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> MAXN <span class="op">=</span> <span class="dv">5000</span><span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define P </span><span class="dv">0</span><span class="pp"> </span><span class="co">//后手赢</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define N </span><span class="dv">1</span><span class="pp"> </span><span class="co">//先手赢</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> f<span class="op">[</span>MAXN <span class="op">+</span> <span class="dv">10</span><span class="op">][</span>MAXN <span class="op">+</span> <span class="dv">10</span><span class="op">];</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>f<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">==</span> P<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> k <span class="op">+</span> j <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> s <span class="op">*</span> k <span class="op">+</span> i <span class="op">&lt;=</span>MAXN<span class="op">;</span> <span class="op">++</span>s<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                        f<span class="op">[</span>i <span class="op">+</span> s <span class="op">*</span> k<span class="op">][</span>j <span class="op">+</span> k<span class="op">]</span> <span class="op">=</span> N<span class="op">;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> k <span class="op">+</span> i <span class="op">&lt;=</span> MAXN<span class="op">;</span> <span class="op">++</span>k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> s <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> s <span class="op">*</span> k <span class="op">+</span> j <span class="op">&lt;=</span>MAXN<span class="op">;</span> <span class="op">++</span>s<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                        f<span class="op">[</span>i <span class="op">+</span> k<span class="op">][</span>j <span class="op">+</span> s <span class="op">*</span> k<span class="op">]</span> <span class="op">=</span> N<span class="op">;</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&#125;</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> T<span class="op">;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>T<span class="op">);</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>T<span class="op">--)</span> <span class="op">&#123;</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> f<span class="op">[</span>x<span class="op">][</span>y<span class="op">]</span> <span class="op">==</span> N<span class="op">?</span><span class="st">&quot;Alice&quot;</span><span class="op">:</span><span class="st">&quot;Bob&quot;</span><span class="op">);</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h3 id="再优化">再优化</h3><p><span class="math inline">\(n= 5000\)</span> 的情况下，跑<span class="math inline">\(n^2\)</span>的算法是极其危险的，题目可能会卡常，要注意细节。<span class="math inline">\(f[i][j]\)</span>的值只有<span class="math inline">\(0,1\)</span>两种情况，所以把<span class="math inline">\(f[i][j]\)</span>的声明由int改为bool就会<strong>减少几百毫秒</strong>的运行时间，和4倍的空间，至此，程序终于通过了。</p><h3 id="扩展-sg函数的知识">扩展 : SG函数的知识</h3><p><a href="https://oi-wiki.org/math/game-theory/"><font color = "blue" face = "KaiTi"> -&gt; 博弈论 OI Wiki</font></a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2021牛客暑期多校第一场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>拓扑排序</title>
      <link href="/2021/07/26/Algorithm/Toposort/"/>
      <url>/2021/07/26/Algorithm/Toposort/</url>
      
        <content type="html"><![CDATA[<h2 id="根据dfs的拓扑排序">1, 根据dfs的拓扑排序</h2><p>dfs可以找出天然的拓扑序，只是在最后需要倒转一下，想想为什么(因为最后一层先输出)</p><p>遍历时，把遍历过程中的点的标记置为-1，如果再次访问到标记为-1的点，说明有环路，不能拓扑排序</p><p>返回时，把遍历完的点置为1，表示这些点遍历完毕，没有环路，未来不用遍历了</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> dfs<span class="op">(</span><span class="dt">int</span> u<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>ans<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    flag<span class="op">[</span>u<span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> v <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>v<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>G<span class="op">[</span>u<span class="op">][</span>v<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>flag<span class="op">[</span>v<span class="op">]</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> false<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>flag<span class="op">[</span>v<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>dfs<span class="op">(</span>v<span class="op">,</span> n<span class="op">,</span> ans<span class="op">))</span> <span class="cf">return</span> false<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    flag<span class="op">[</span>u<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    ans<span class="op">[</span>cnt<span class="op">++]</span> <span class="op">=</span> u<span class="op">;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> true<span class="op">;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> toposort<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>ans<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>G<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>G<span class="op">));</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>flag<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>flag<span class="op">));</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;%d%d&quot;</span><span class="op">,</span> <span class="op">&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        G<span class="op">[</span>x<span class="op">][</span>y<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>flag<span class="op">[</span>i<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>dfs<span class="op">(</span>i<span class="op">,</span> n<span class="op">,</span> ans<span class="op">))</span> <span class="cf">return</span> false<span class="op">;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    reverse<span class="op">(</span>ans<span class="op">,</span> ans <span class="op">+</span> cnt<span class="op">);</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> true<span class="op">;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="根据bfs的拓扑排序">2, 根据bfs的拓扑排序</h2><p>原理为不停维护入度为0的点，让其入队，直到所有的点都被遍历到</p><p>如果有环路，那么那个点不会入队，入度不可能被减为1，所以判断环路的条件就是是否遍历了所有点</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> G<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">],</span> in<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> toposort<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>ans<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    std<span class="op">::</span>queue<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> q<span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>in<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> q<span class="op">.</span>push<span class="op">(</span>i<span class="op">);</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>q<span class="op">.</span>empty<span class="op">())</span> <span class="op">&#123;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> u <span class="op">=</span> q<span class="op">.</span>front<span class="op">();</span>q<span class="op">.</span>pop<span class="op">();</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>cnt<span class="op">++]</span> <span class="op">=</span> u<span class="op">;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> v <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> v <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>v<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>G<span class="op">[</span>u<span class="op">][</span>v<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                in<span class="op">[</span>v<span class="op">]--;</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>in<span class="op">[</span>v<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> q<span class="op">.</span>push<span class="op">(</span>v<span class="op">);</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cnt <span class="op">==</span> n<span class="op">;</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> m<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>ans<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>G<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>G<span class="op">));</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>in<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>in<span class="op">));</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;%d%d&quot;</span><span class="op">,</span> <span class="op">&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        G<span class="op">[</span>x<span class="op">][</span>y<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        in<span class="op">[</span>y<span class="op">]++;</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> toposort<span class="op">(</span>n<span class="op">,</span> m<span class="op">,</span> ans<span class="op">);</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="根据层序的拓扑排序">3, 根据层序的拓扑排序</h2><p>经典题目《车站分级》中的排序方式，可以找出拓扑序的层数</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> toposort<span class="op">(</span><span class="dt">int</span> G<span class="op">[][</span>MAXN<span class="op">],</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>in<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tmp<span class="op">[</span>MAXN<span class="op">],</span> book<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    memset<span class="op">(</span>book<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>book<span class="op">));</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> depth <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> p <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> p <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>p<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>in<span class="op">[</span>p<span class="op">]</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>book<span class="op">[</span>p<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                tmp<span class="op">[</span>cnt<span class="op">++]</span> <span class="op">=</span> p<span class="op">;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                book<span class="op">[</span>p<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>cnt <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cnt<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> MAXN <span class="op">&amp;&amp;</span> out<span class="op">[</span>tmp<span class="op">[</span>i<span class="op">]]</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>G<span class="op">[</span>tmp<span class="op">[</span>i<span class="op">]][</span>j<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                    in<span class="op">[</span>j<span class="op">]--;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                    out<span class="op">[</span>tmp<span class="op">[</span>i<span class="op">]]--;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">++</span>depth<span class="op">;</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> depth<span class="op">;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div><h2 id="拓扑排序经典题目">4, 拓扑排序经典题目</h2><p><a href="https://vjudge.net/problem/UVA-10305">UVa 10305 Ordering Tasks</a></p><p><a href="https://vjudge.net/problem/%E8%AE%A1%E8%92%9C%E5%AE%A2-T2076">NOIP 2013 普及组T4 车站分级</a></p><p><a href="https://www.luogu.com.cn/problem/P3243">HNOI2015 菜肴制作</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 理论 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> toposort </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在markdown中插入图片</title>
      <link href="/2021/07/26/Markdown/MarkdownImage/"/>
      <url>/2021/07/26/Markdown/MarkdownImage/</url>
      
        <content type="html"><![CDATA[<h2 id="一base64格式">一，base64格式</h2><p>另一个坑：不能有空格！ 包括可替换文本；资源标签。</p><div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="al">![image][image id]</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>you can write your document here </span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">image id</span><span class="co">]</span>:data:image/png;base64, ...your image&#39;s base64</span></code></pre></div><h2 id="二-网址本地文件格式">二， 网址,本地文件格式</h2><div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="al">![avatar](http://baidu.com/pic/doge.png)</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="al">![avatar](/home/picture/1.png)</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>markdown 字体，字号，颜色</title>
      <link href="/2021/07/26/Markdown/MarkdownFont/"/>
      <url>/2021/07/26/Markdown/MarkdownFont/</url>
      
        <content type="html"><![CDATA[<h2 id="效果实例">1.效果实例</h2><p><font size = 4 face="HEI" color = "red">黑体</font></p><p><font size = 5 face="KAI" color = "(0,255,255)">楷体</font></p><p><font size = 6 face="GB18030 Bitmap" color = "#00FFFF">扩展字体</font></p><h2 id="markdown代码">2.markdown代码</h2><div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 使用 &lt;font&gt; 标签的修改字体，字号，颜色</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>这里是默认字体</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span><span class="ot"> size</span> <span class="ot">=</span> <span class="st">4</span><span class="ot"> face=</span><span class="st">&quot;HEI&quot;</span><span class="ot"> color</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span><span class="kw">&gt;</span>黑体<span class="kw">&lt;/font&gt;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span><span class="ot"> size</span> <span class="ot">=</span> <span class="st">5</span><span class="ot"> face=</span><span class="st">&quot;KAI&quot;</span><span class="ot"> color</span> <span class="ot">=</span> <span class="st">(0,255,255)</span><span class="kw">&gt;</span>楷体<span class="kw">&lt;/font&gt;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span><span class="ot"> size</span> <span class="ot">=</span> <span class="st">6</span><span class="ot"> face=</span><span class="st">&quot;GB18030 Bitmap&quot;</span><span class="ot"> color</span> <span class="ot">=</span> <span class="st">&quot;#00FFFF&quot;</span><span class="kw">&gt;</span>扩展字体<span class="kw">&lt;/font&gt;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;style&gt;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>p &#123;<span class="kw">font-size</span>: <span class="dv">2</span><span class="dt">rem</span><span class="op">;</span>&#125;</span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/style&gt;</span></span></code></pre></div><h2 id="常用字体集锦">3.常用字体集锦</h2><table><thead><tr class="header"><th style="text-align: center;">字体名称</th><th style="text-align: center;">对应markdown表示</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">黑体</td><td style="text-align: center;"><code>&lt;font face='SimHei'&gt;</code></td></tr><tr class="even"><td style="text-align: center;">宋体</td><td style="text-align: center;"><code>&lt;font face='SimSun'&gt;</code></td></tr><tr class="odd"><td style="text-align: center;">新宋体</td><td style="text-align: center;"><code>&lt;font face='NSimSun'&gt;</code></td></tr><tr class="even"><td style="text-align: center;">仿宋</td><td style="text-align: center;"><code>&lt;font face='FangSong'&gt;</code></td></tr><tr class="odd"><td style="text-align: center;">楷体</td><td style="text-align: center;"><code>&lt;font face='KaiTi'&gt;</code></td></tr><tr class="even"><td style="text-align: center;">仿宋_GB2312</td><td style="text-align: center;"><code>&lt;font face='FangSong_GB2312'&gt;</code></td></tr><tr class="odd"><td style="text-align: center;">楷体_GB2312</td><td style="text-align: center;"><code>&lt;font face='KaiTi_GB2312'&gt;</code></td></tr><tr class="even"><td style="text-align: center;">微软雅黑</td><td style="text-align: center;"><code>&lt;font face='Microsoft YaHei'&gt;</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>G - League of Legends</title>
      <link href="/2021/07/26/Algorithm/G%20-%20League%20of%20Legends/"/>
      <url>/2021/07/26/Algorithm/G%20-%20League%20of%20Legends/</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要">前情提要</h2><p>什么时候进行单调队列优化？代码中包含区间处理的大量细节。</p><h2 id="题目原文">题目原文</h2><p>ZLOIers love playing League of Legends, but they seldom have time to play together.</p><p>When summer vacation came, each of them scheduled some free time for it, which could be described as an interval <span class="math inline">\([a_i,b_i)\)</span>(minute).</p><p>Now the <span class="math inline">\({n}\)</span> ZLOIers plan to play in <span class="math inline">\(k\)</span> groups. Each group will play together when all the players in it are free. Each ZLOIer joins exactly one group, and each group has at least one ZLOIer. The number of people in each group does not necessarily need to be equal.</p><p>Since they don't have a full plan of groups yet, they want you to maximize the total time the <span class="math inline">\({k}\)</span> groups can play.You should tell them maximum total time.</p><p>Note that a group must play at least <span class="math inline">\({1}\)</span> minute, and the total time is not accumulated by each person, but by each group.</p><h2 id="题目大意">题目大意</h2><p>给定<span class="math inline">\(n\)</span>个区间，要求将它们分成<span class="math inline">\(k\)</span>组，每组之间有交，最大化每组交长度之和</p><h2 id="解题思路">解题思路</h2><p>题目中<strong>最大化每组交长度之和</strong>这句告诉我们，这是一个最优化问题，要想到搜索和动态规划</p><p>那么，应该如何动态规划？</p><h3 id="先考虑特殊情况处理如下排布的区间">先考虑特殊情况——处理如下排布的区间</h3><p>大概形状如下</p><pre class="n"><code>-------------    ------------      -------------         ------------</code></pre><p>设<span class="math inline">\(dp[i][j]\)</span>为前<span class="math inline">\(i\)</span>个线段，分为<span class="math inline">\(j\)</span>组，得到的最大交区间的和，可以得到递推式</p><p>刷表递推 <span class="math display">\[dp[i][j]+b[i]-a[k]\rightarrow dp[k][j+1]\ \ (b[i] &gt;= a[k])\]</span></p><p>填表递推 <span class="math display">\[dp[i][j]=dp[k][j-1]+b[k+1]-a[i]\ \ (b[i] &gt;= a[k])\]</span></p><p>时间复杂度是<span class="math inline">\(O(n^3)\)</span>的。题目中的数据<span class="math inline">\(n\leq 5000\)</span>，这样的方法不够解决问题。</p><p>我们发现在填表递推的式子中，<span class="math inline">\(dp[k][j-1]+b[k+1]\)</span>这一项实际上在寻找<span class="math inline">\(dp[1][j-1]+b[k+1] \sim dp[i-1][j-1]+b[k+1]\)</span>的最大值。这样就可以用单调队列优化，从而实现在<span class="math inline">\(O(1)\)</span>的时间里找到最大值<span class="math inline">\(dp[k][j-1]+b[k+1]\)</span>出现的位置<span class="math inline">\(k\)</span>。循环少了一重，复杂度变为<span class="math inline">\(O(n^2)\)</span>。</p><p>注意一点，使用单调队列优化时，要把定义的i,j反过来，即定义<span class="math inline">\(dp[i][j]\)</span>为前<span class="math inline">\(j\)</span>个线段，分为<span class="math inline">\(i\)</span>组，得到的最大交区间的和。</p><p>这样一个特殊化的问题至此解决了。</p><h3 id="再考虑更多细节处理大区间">再考虑更多细节——处理大区间</h3><p>我们通过动手画图观察到，大区间(能够包含其它区间的区间)有时不会影响结果，有时又可以把他们独立算一段，使最终结果变得大一些。总结一下，大区间的处理方式就两种</p><p>  1.归属到一个被它包含的区间所在的组，不影响答案   2.独自一组，长度直接算入答案</p><p>最后对大区间的处理可以独立处理，方法类似于前缀和，详见代码。</p><h3 id="预处理区间">预处理区间</h3><p>细节见代码，主要操作是把特殊区间和大区间分开，依据代码实现模拟即可看懂，比较巧妙。必须学会这种方法。</p><h2 id="代码实现">代码实现</h2><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstring&gt;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;functional&gt;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> MAXN <span class="op">=</span> <span class="fl">5e3</span> <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> interval <span class="op">&#123;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> l<span class="op">,</span> r<span class="op">;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="kw">operator</span> <span class="op">&lt;(</span><span class="at">const</span> interval <span class="op">&amp;</span>i<span class="op">)</span><span class="at">const</span> <span class="op">&#123;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> l <span class="op">==</span> i<span class="op">.</span>l <span class="op">?</span> r <span class="op">&gt;</span> i<span class="op">.</span>r <span class="op">:</span> l <span class="op">&lt;</span> i<span class="op">.</span>l<span class="op">;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>vt<span class="op">[</span>MAXN<span class="op">],</span> v<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> len<span class="op">[</span>MAXN<span class="op">],</span> dp<span class="op">[</span>MAXN<span class="op">][</span>MAXN<span class="op">];</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">,</span> K<span class="op">;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>K<span class="op">);</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>vt<span class="op">[</span>i<span class="op">].</span>l<span class="op">,</span> <span class="op">&amp;</span>vt<span class="op">[</span>i<span class="op">].</span>r<span class="op">);</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>sort<span class="op">(</span>vt <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> vt <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> n<span class="op">);</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> nn <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> prev_r <span class="op">=</span> <span class="fl">1e9</span><span class="op">;</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> n<span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">1</span><span class="op">;</span> <span class="op">--</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>prev_r <span class="op">&lt;=</span> vt<span class="op">[</span>i<span class="op">].</span>r<span class="op">)</span> len<span class="op">[++</span>cnt<span class="op">]</span> <span class="op">=</span> vt<span class="op">[</span>i<span class="op">].</span>r <span class="op">-</span> vt<span class="op">[</span>i<span class="op">].</span>l<span class="op">;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> prev_r <span class="op">=</span> vt<span class="op">[</span>i<span class="op">].</span>r<span class="op">,</span> v<span class="op">[++</span>nn<span class="op">]</span> <span class="op">=</span> vt<span class="op">[</span>i<span class="op">];</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>reverse<span class="op">(</span>v <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> v <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> nn<span class="op">);</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>sort<span class="op">(</span>len <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> len <span class="op">+</span> <span class="dv">1</span> <span class="op">+</span> cnt<span class="op">,</span> <span class="bu">std::</span>greater<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> <span class="op">());</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>fill_n<span class="op">(&amp;</span>dp<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">],</span> MAXN <span class="op">*</span> MAXN<span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">);</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    dp<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> K<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>deque<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> dq<span class="op">;</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;=</span> nn<span class="op">;</span> <span class="op">++</span>j<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(~</span>dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">])</span> <span class="op">&#123;</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="op">(!</span>dq<span class="op">.</span>empty<span class="op">()</span> <span class="op">&amp;&amp;</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>dq<span class="op">.</span>back<span class="op">()]</span> <span class="op">+</span> v<span class="op">[</span>dq<span class="op">.</span>back<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">].</span>r <span class="op">&lt;=</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">+</span> v<span class="op">[</span>j<span class="op">].</span>r<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                    dq<span class="op">.</span>pop_back<span class="op">();</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">&#125;</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                dq<span class="op">.</span>push_back<span class="op">(</span>j <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(!</span>dq<span class="op">.</span>empty<span class="op">()</span> <span class="op">&amp;&amp;</span> v<span class="op">[</span>dq<span class="op">.</span>front<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">].</span>r <span class="op">&lt;=</span> v<span class="op">[</span>j<span class="op">].</span>l<span class="op">)</span> dq<span class="op">.</span>pop_front<span class="op">();</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>dq<span class="op">.</span>empty<span class="op">())</span> <span class="op">&#123;</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                dp<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> dp<span class="op">[</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">][</span>dq<span class="op">.</span>front<span class="op">()]</span> <span class="op">+</span> v<span class="op">[</span>dq<span class="op">.</span>front<span class="op">()</span> <span class="op">+</span> <span class="dv">1</span><span class="op">].</span>r <span class="op">-</span> v<span class="op">[</span>j<span class="op">].</span>l<span class="op">;</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">&#125;</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> tmp <span class="op">=</span> <span class="bu">std::</span>min<span class="op">(</span>K<span class="op">,</span> cnt<span class="op">);</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> tmp<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> len<span class="op">[</span>i<span class="op">];</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(~</span>dp<span class="op">[</span>K <span class="op">-</span> i<span class="op">][</span>nn<span class="op">])</span>ans <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>ans<span class="op">,</span> sum <span class="op">+</span> dp<span class="op">[</span>K <span class="op">-</span> i<span class="op">][</span>nn<span class="op">]);</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">);</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2021牛客暑期多校第二场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>K - Stack</title>
      <link href="/2021/07/26/Algorithm/K%20-%20Stack/"/>
      <url>/2021/07/26/Algorithm/K%20-%20Stack/</url>
      
        <content type="html"><![CDATA[<h2 id="题目原文">题目原文</h2><p>YT had a magic permutation <span class="math inline">\(a_{1},a_{2},\cdots, a_{n}\)</span>, and he constructed a sequence <span class="math inline">\(b_{1},b_{2},\cdots b_{n}\)</span> by the following pseudo code:</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Stk is an empty stack</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">=</span> <span class="dv">1</span> to n <span class="op">:</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span> Stk is <span class="kw">not</span> empty <span class="op">)</span> <span class="kw">and</span> <span class="op">(</span> Stk<span class="ch">&#39;s</span><span class="er"> top &gt; a[i] ) :</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        pop Stk</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    push a<span class="op">[</span>i<span class="op">]</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    b<span class="op">[</span>i<span class="op">]=</span>Stk<span class="ch">&#39;s</span><span class="er"> size</span></span></code></pre></div><p>But he somehow forgot the permutation <span class="math inline">\(a\)</span>, and only got some <span class="math inline">\(k\)</span> elements of <span class="math inline">\(b_{i}\)</span>.</p><p>Construct a permutation <span class="math inline">\(a\)</span> satisfying these <span class="math inline">\(b_{i}\)</span>, or determine no such permutation exists.</p><p>Here a permutation refers to a sequence that contains all integers from <span class="math inline">\(1\)</span> to <span class="math inline">\({n}\)</span> exactly once.</p><h2 id="题目大意">题目大意</h2><p>定义条件A为：位置<span class="math inline">\(pos\)</span>之前（包括该位置）有<span class="math inline">\(x\)</span>个数不小于这个位置上的数<span class="math inline">\(a[pos]\)</span>。现在知道多个位置满足条件A,将这些要求记为<span class="math inline">\((pos, x)\)</span>，能否构造一个序列，满足给定的全部要求？</p><h2 id="解题思路">解题思路</h2><p>先考虑什么时候不能，不能的情况其实只有一种，就是<span class="math inline">\(b[i]\)</span>的需求大于提供的<span class="math inline">\(i\)</span>个位置。</p><p>再考虑可行的情况下，如何解决安排的问题。由离散数学的知识，小于等于(或大于)是一个偏序，很多个小于等于情况可以抽象为偏序关系，继而可以得到关系图，偏序的关系图是有向无环的(DAG)，所以想到根据题目条件建立关系图后，用拓扑排序的思想解题。</p><p>关系图的节点是谁？只能是位置，因为我们知道的条件是关于位置的。如何知道这个位置(上的数)和其他位置(上的数)的关系？可以<strong>模拟位置序列的插入</strong>。</p><p>1234567...，将这些属于位置的编号，按照伪代码的方式压栈弹栈，<strong>注意，当某个位置有需求时，需要将栈的大小弹至b[i]规定的大小。此时，这个位置上的数必大于等于于栈顶元素，小于最后一次弹出的数</strong>，这样就建立了关系图， <span class="math display">\[a[栈顶数的位置] \leq a[位置pos] &lt; a[刚弹出的数的位置]\]</span></p><p>可以抽象出这样的关系图(代码中的抽象关系)</p><p><span class="math display">\[刚弹出的数的位置 \rightarrow pos \rightarrow 栈顶数的位置\]</span></p><p>由此，拓扑排序第一层就是最大层，此后的数越来越小</p><p>实现的详情见代码注释</p><h2 id="编程实现">编程实现</h2><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;queue&gt;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stack&gt;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;vector&gt;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> MAXN <span class="op">=</span> <span class="fl">1e6</span> <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b<span class="op">[</span>MAXN<span class="op">],</span> in<span class="op">[</span>MAXN<span class="op">],</span> next<span class="op">[</span>MAXN<span class="op">],</span> ans<span class="op">[</span>MAXN<span class="op">];</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Print<span class="op">(</span><span class="bu">std::</span>vector<span class="op"> &lt;</span><span class="dt">int</span><span class="op">&gt;</span> <span class="op">&amp;</span>v<span class="op">,</span> <span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> v<span class="op">.</span>size<span class="op">();</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        ans<span class="op">[</span>v<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> n <span class="op">-</span> i<span class="op">;</span><span class="co">//在相应位置由大到小填入数字</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n <span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">1</span><span class="op">)</span>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">[</span>i<span class="op">]);</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> printf<span class="op">(</span><span class="st">&quot; </span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">[</span>i<span class="op">]);</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>queue<span class="op"> &lt;</span><span class="dt">int</span><span class="op">&gt;</span> q<span class="op">;</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op"> &lt;</span><span class="dt">int</span><span class="op">&gt;</span> v<span class="op">;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> toposort<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">&#123;</span>  </span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>in<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> q<span class="op">.</span>push<span class="op">(</span>i<span class="op">);</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>q<span class="op">.</span>empty<span class="op">())</span> <span class="op">&#123;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> t <span class="op">=</span> q<span class="op">.</span>front<span class="op">();</span>q<span class="op">.</span>pop<span class="op">();</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.</span>push_back<span class="op">(</span>t<span class="op">);</span><span class="co">//按照拓扑序放置位置序</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        in<span class="op">[</span>next<span class="op">[</span>t<span class="op">]]--;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>in<span class="op">[</span>next<span class="op">[</span>t<span class="op">]]</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            q<span class="op">.</span>push<span class="op">(</span>next<span class="op">[</span>t<span class="op">]);</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    Print<span class="op">(</span>v<span class="op">,</span> n<span class="op">);</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>stack<span class="op"> &lt;</span><span class="dt">int</span><span class="op">&gt;</span> s<span class="op">;</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> solve<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n<span class="op">,</span> k<span class="op">;</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">,</span> <span class="op">&amp;</span>k<span class="op">);</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> k<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> pos<span class="op">;</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>pos<span class="op">);</span>scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>b<span class="op">[</span>pos<span class="op">]);</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> t<span class="op">;</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>b<span class="op">[</span>i<span class="op">])</span> <span class="op">&#123;</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>b<span class="op">[</span>i<span class="op">]</span> <span class="op">&gt;</span> i<span class="op">)</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(</span>s<span class="op">.</span>size<span class="op">()</span> <span class="op">&amp;&amp;</span> s<span class="op">.</span>size<span class="op">()</span> <span class="op">&gt;=</span> b<span class="op">[</span>i<span class="op">])</span> t <span class="op">=</span> s<span class="op">.</span>top<span class="op">(),</span> s<span class="op">.</span>pop<span class="op">();</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            next<span class="op">[</span>t<span class="op">]</span> <span class="op">=</span> i<span class="op">;</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(!</span>s<span class="op">.</span>empty<span class="op">())</span> next<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> s<span class="op">.</span>top<span class="op">();</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        s<span class="op">.</span>push<span class="op">(</span>i<span class="op">);</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        in<span class="op">[</span>next<span class="op">[</span>i<span class="op">]]++;</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    toposort<span class="op">(</span>n<span class="op">);</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>solve<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> puts<span class="op">(</span><span class="st">&quot;-1&quot;</span><span class="op">);</span></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2021牛客暑期多校第二场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>F - Girlfriend</title>
      <link href="/2021/07/20/Algorithm/F%20-%20Girlfriend/"/>
      <url>/2021/07/20/Algorithm/F%20-%20Girlfriend/</url>
      
        <content type="html"><![CDATA[<h2 id="题目描述">题目描述</h2><p>给出四个空间点<span class="math inline">\(A,B,C,D\)</span>和<span class="math inline">\(k_{1},k_{2}\)</span>，求关于动点<span class="math inline">\(P_{1},P_{2}\)</span>且满足<span class="math inline">\(|AP_{1}| \geq k_{1}|BP_{1}|, |CP_{2}| \geq k_{2}|DP_{2}|\)</span>的两个点的轨迹方程<span class="math inline">\(\Gamma_{P1},\Gamma_{P2}\)</span>，并求出它们的交体积。</p><h2 id="解题思路">解题思路</h2><p>首先进行轨迹方程的推导。设<span class="math inline">\(A(x_{1}, y_{1}, z_{1}), B(x_{2}, y_{2}, z_{2})\)</span>，由题目条件得： <span class="math display">\[(x-x_{1})^2+(y-y_{1})^2+(z-z_{1})^2 \geq k^2((x-x_{2})^2+(y-y_{2})^2+(z-z_{2})^2)\]</span> 配方后，化简得： <span class="math display">\[(x-\frac{k^2 x_{2}-x_{1}}{k^2-1})^2 + (y-\frac{k^2 y_{2}-y_{1}}{k^2-1})^2 + (z-\frac{k^2 z_{2}-z_{1}}{k^2-1})^2 \leq (\frac{k^2 x_{2}-x_{1}}{k^2-1})^2-\frac{x_{2}^2k^2-x_{1}}{k^2-1} + (\frac{k^2 y_{2}-y_{1}}{k^2-1})^2-\frac{y_{2}^2k^2-y_{1}}{k^2-1} + (\frac{k^2 z_{2}-z_{1}}{k^2-1})^2-\frac{z_{2}^2k^2-z_{1}}{k^2-1}\]</span> 得到圆心： <span class="math display">\[(\frac{k^2 x_{2}-x_{1}}{k^2-1},\frac{k^2 y_{2}-y_{1}}{k^2-1},\frac{k^2 z_{2}-z_{1}}{k^2-1})\]</span> ，半径： <span class="math display">\[\sqrt{(\frac{k^2 x_{2}-x_{1}}{k^2-1})^2-\frac{x_{2}^2k^2-x_{1}}{k^2-1} + (\frac{k^2 y_{2}-y_{1}}{k^2-1})^2-\frac{y_{2}^2k^2-y_{1}}{k^2-1} + (\frac{k^2 z_{2}-z_{1}}{k^2-1})^2-\frac{z_{2}^2k^2-z_{1}}{k^2-1}}\]</span> 然后算两个球的交体积。用微积分分别算出两个部分的体积，下面这个积分是绿色区域的体积：</p><p><span class="math display">\[\int_{0}^h\pi(R^2-(Rcos\alpha+x)^2)dx = \pi (Rh^2-\frac{h^3}{3})\]</span> <img src="data:image/png;base64,/9j/4AAQSkZJRgABAQEAeAB4AAD/4QBmRXhpZgAATU0AKgAAAAgABgESAAMAAAABAAEAAAMBAAUAAAABAAAAVgMDAAEAAAABAAAAAFEQAAEAAAABAQAAAFERAAQAAAABAAASdFESAAQAAAABAAASdAAAAAAAAYagAACxj//bAEMAAgEBAgEBAgICAgICAgIDBQMDAwMDBgQEAwUHBgcHBwYHBwgJCwkICAoIBwcKDQoKCwwMDAwHCQ4PDQwOCwwMDP/bAEMBAgICAwMDBgMDBgwIBwgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIAgcDmgMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/AP38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooprShTQA6iq+o6rb6Pp095dzRWtnaxtNPPM4jjhRQSzMx4VQASSeAK+N/2oP+Dg79kf9lCz1D+2vi/oPiLU9OcRNpfhdjrN3NI1u06Knk5jwwAXeXEau6q7Lk4APtDOKaZFHevww/aI/wCD2HwnNJDpnwR+Bvi7xJqWpWxit7nxZfQ6ebe9ZtsSCzszctcocg4E8LEnaB/FXIH/AILO/wDBUr9pg/2l8O/2a/8AhGtO0v8A0S8h/wCENuz50x+bd/psgfhSBhOB35NAH9AG7mjNfgB/wgf/AAWw+Ia/8JDba0dDt9e/4mUWm/bfDlr/AGcs37wQeVMDLH5YbbskJZduCSRQP+CNH/BWb47n/hK/EH7V3/CG6xq/z3Ojf8LN1rT/ALEU/dqPI0u2ayTcqK37liDuy3zlhQB+/wDQWwK/AH/hwX/wVO/6PU/8y94u/wDkSkP/AARz/wCCtH7Pn/FXeG/2qf8AhONa0niDRf8AhZer6l9sEv7lz5GrWy2L7EkaT98wK7NyZkCAgH7/ABcCgOCa/AE2n/Baz4B/8VZfSnxra6XxJo2/w/qX2vzf3QPkW22Z9hcP8jDbs3HKhhVbV/8AgvR/wUq/ZJ0q6h+KH7M9vrEs0L6lFfXHhG/jhsraNSJC7WcvlhV2liXIIGTnbigD+ggHIor8Uf2ff+D2b4N+KrSSP4mfCH4ieCbxrtIrdtBvbTxBa+SQN0szym0kTaxPyJFKSoyCSdtfoP8Asxf8Fsf2Wf2vbmwtfBPxm8IzapqUbSQabqc7aVenE624UxXIjYO0jIET7zh1Kgg5oA+p6Kb5mPUULIGNADqKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACkZtorzj9qH9rL4efsXfCS88dfFDxbpPg3wvZusJvL6TaZ5mDMsMKDLzSsEciONSxCscYBI/Fn9pb/g5L/aI/4KF/HLVPhV+wr8NdUuLG3vRaQ+MpNN+2Xt3GUkH2kxTILfT4XKuyG53OViBby2ZolAP19/a//wCCkvwP/YM8PzX/AMVviR4b8KyRBGGnvP8AaNSlDrIyFLSINOwYRSYITBKEZzX5AfGT/g7J+MH7ZHxLfwB+xz8BdY1DUpmSWDUdatTquqSwbrcM7WNuTBaoJWeJnknlUrJG2Y2O0an/AAT/AP8Ag0Ek8U61H8SP2uvHOpeKvFWuXn9saj4Y0rUHnNxNMGlm/tHU2JknnaWQmTyCBuRiJ5Q+R+0P7On7M3w//ZM+Fmm+C/hr4P0HwX4Z0tAsFjpdqsKswREMsrffmmdY03yyFpJCuWZjzQB+Gngz/ggj+3R/wVm0/SdZ/a6/aA1Lwj4Qmjh1K38MzStqF5DcIFWNm0uDyLC1lNvPcqZtzTo3yPEQ7FfsT9mf/g0i/ZJ+CMVw3ifS/FXxVubiOWIt4g1Z7eKNWaMqVSz8nDpsIDbuRI+Qfl2/qDsGelAXFAHDfBL9mH4bfs06Neab8Ofh94H+H+n6hOtzdW3hvQrXSobmZV2iSRYEQO4UY3MCccZruPL5+8adRQA3yhnPU0Km2nUUAFNaIMadRQA3yse1Hle9OooA8j/aX/YH+Cv7ZFg0PxS+FngXxxILF9OhvNV0eGW/soHJLJb3W0T2/wAxLAxOhDHIIPNfnv8AtT/8GfP7MXxs1ea/8D6h4y+Et1IkgS10u7GoaermJEjPlXO+TaroXZRKCxkcblG3b+slBXNAH8++p/8ABLj/AIKVf8Ea4If+Gefi1c/GX4Y6ZPCtp4egkMrQxmRXdTo94Xjt0ee4m3fYZ3ZlVpJCn8Pbfsdf8Hg03gTxta/D/wDay+EuueBtc0+JLbUvEOk20qSwXB8ja93pMyrLCjRtJK7xPI3+rVICGyv7o7BnpXj/AO2T+wR8If2+/hw3hf4teA9B8YWChxaXNzBs1DSmcxs0lpdLia3ZjDEGMbrvVAr7lypAL/7MH7bHwn/bU8NXmrfCn4geGfHdjpsixXh0q8EslkzAlRLHw8e7DY3KM7WxnBx6ijblzX8+n7Y//BqZ8Xf2NfiCvxb/AGLfiVrcmqaLJNdW+hT6kdL8QWCuwQRWV6hWK5UwySK8c5hJjjK5naXZXpP7C/8AwdTeKvhD8aB8If23vAN18N9dtfPil8WQabNbCCZZCI1u7DYx8p9siC5t2Zdyx5j2M8sYB+4dFc38J/iz4b+Onw60bxf4P1zTfEnhfxBbLeadqdhMs1vdxN/ErD0IIIOCpBBAIIrpKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACignApolBoAcTivzN/4LUf8HIPw1/4JsaJq3gnwPPbfEL42XVlcJaWdlLHcaT4ZuUlEP8AxM5VkDLIrCZhbRhpCbcrJ5AdHPzX/wAFmf8Agv58QPjf+0RZfsr/ALEs9/rfjzVr59I1bxPogjkmnuArCSz0+VvkjWNQ7S3mVEYjJV0VGkr3P/giv/wbM+Ef+Cfep6X8TPi5eaX8RvjhZ3NzPBNbSyXGhaGWcCKW3WaNJJrkKpbz5EXa0zBUyiysAfG/7N//AAQ1/ae/4Lk/F3R/jj+2Z4y1Lwn4Hv7Jp9J0S3KRazJbSMJYILa12GGwtSJHJeXdcHy1BjPmecn7lfsofsX/AAr/AGHfh2fCfwn8C6D4H0JpPNni0+A+deyZOJLidy007gHAaV3IUBQQoAHpwjO7OafQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABXzr/AMFA/wDgln8FP+CmHgV9H+KXgvT9S1O3tpINK8RWyC31nRSySKphuVwxRWlMnkyboWcKzRsVBH0VRQB/N/8AH79g39rj/g2J8cap8VPgH401D4ifAdnMms2l5CZLO2ErlEGpaesmC6KkKi/g2HJwfKVzG363/wDBJv8A4LkfB3/grD4KH/CO3T+D/iDYrFFqng7WrqEX3nGDzZHsmVv9MtlKTASqqOBEWkii3KD9m+UfXj0r8V/+CsX/AAbDXlj8Qovjx+xjfJ8PfiVomoza/ceGIbxrO1mmVDKraS6qVtpzMm0W77bdhOQHgWMRuAftYDmivyN/4IM/8HEsP7UzSfBH9o+8tvBfx18NyvYR32qxrpcfiZ4m8t4ZI2CLBqCMCrw7VDkEooIZF/XAyqKAHUUA5FFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQBDqV/b6Vp1xdXU0Nra20bSzTSuEjiRRlmZjwFABJJ4Ar+ff/grF/wAFZPiV/wAFr/2lI/2QP2PVur/wfqFw1v4l8T20jww65FG4WaR51B8nSYtw3yYzcEqqhlZEm6n/AIL1f8Fqtf8A22fiLN+xZ+yjYP471nxhctoXibVtPSOddTfky6fZu3yCJArNPdMVRVjbDKiu9fo3/wAET/8Agkf4b/4JL/so2Phry9F1b4ma8i3fjPxJZQv/AMTK6ySlvE8n7z7Lbq3lxghA5DymONpWUAGb/wAEc/8Aghv8Mf8AgkN4M1K40Oebxd8R/E1rDba34rv7dEnMSqjPaWiDP2e1aZTIUBLORH5jyeVHs+3FG0UAbRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFIy7xS0UAfmT/wXI/4N0PAv/BTHStc+InghLbwj8eFs4hDf7vK07xIYQwWG9QD/WMhWMXA+dRHEG3IoUeB/wDBB7/gvR4m8N/Ew/sm/tdzah4b+Knhu7GheH/EGvfu59SmT5F03UJWP/H1jb5NySVuVIDMZSjXH7ZFc1+Zv/BxV/wQ80n/AIKWfATUPHPgLQrVfj54PtFfSZopFtv+EmtUYGTT7hiMO/l7zAzEbZNql1R2IAP0yHAor8kP+Dfb/gv/AP8ADWBt/wBn748t/wAIr8ePCxfS7Sa/g+wjxR9n+R4XiYL5OoxlWEkO0b9pZQCHRf1voAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoooJxQAUbuax/H3xA0P4WeCNW8S+JNWsND8P6DaSX2o6jezLDbWUEalnkkdsBVVQSSa/Hn/AIKGf8Hcng/wX4ouPh7+y74SvvjB43upJLGDXZYJV0iO5DKqC1t0Hn35P73keUmRGytMrHAB+zu8E18p/tHf8Fv/ANlH9llbpPFvxv8ABa3lmsTyWWk3DaxdkSNtUiK0EjN6nA+UDJwMV+QXh7/gnt/wUk/4LwIniL4yfEK6+DPwr1dbDGi309xptpe2u4zrNBolscTyRuscm++eJiZI9khCYj+xP2Tf+DPX9mn4LWdlc/Ea88VfFzWI4x9oS8vG0rTJJDAqSbYbZllC+ZvdAZiVyoJbaSQDk/jn/wAHpf7PXgqx1q38B/D34peOtY0+8+z2D3sNpouk6pEswRp1nM01xGjRhpEV7UOflV1jJJXxm8/4PEPi98c1Rfgv+yrcam+lknWPNv73xB5Qf/UY+yW8PlZ2S/f3bscY2nP7EfAz/gmh+z3+zPfaLfeA/gj8K/C+seHrQWNjq9l4ZtF1aKLyfJbdemM3EjvGWV3eRnk3NvZixz7NY6Pb6YW+z29vb+Zjd5UQTdjpnH1NAH4Ff8RR/wC2mf8Amz9f/Cd12tBP+Dyn4gfBLTbXTvi7+ynqWleJroNcxAa5c6HFcW5YqjJBdWcshwVZSwcqSpwBjA/e9hkVTvtEtdSdWuLa2uGXgGWIOQPbIoA/Jn4Gf8HlX7LnxGvdDsfF2g/FT4d3d5aCTU7280mDUtJ024EJd4lltZ3upkMgMaSC1UsWVnSIbtv3n+y//wAFTP2ef2xpLW3+HPxd8E+ItSvIbaaPTV1BbfUP9IRnjjNvLtk83Ctuj27kKkMAeKzvjn/wR+/Zd/aQstbj8XfAP4V3t34kvDf6lqdn4fg03Vru4MwneVr61WK63vICXYSgybmDbgzA/n7+1R/wZkfBP4l6pc6p8KPH3i74U300xmitbiJdc0613TlyEVnin2pG3loDMSNilix3EgH7Ib19aXeM1/PBoHw0/wCCqn/BDPw8h064j+PHwx0u2tbZbO1vbjxXY6ZFGo2w28Moi1C1jjht/KxHGtuomAUFypX7H/4Jo/8AB198CP2v7bTfDvxUZfgr8QJhFbsdSm8zw/qUpVizQ3n/ACwGUPyXIQDzI1WSU5IAP1YLgd6/K7/g5h/4LR3P7BPwdt/g78MLzVl+OXxQs1Npe6bhZPDGnPJ5TXCtgsbqch4YFjAZD5ku9GjiWX7f/wCCiv7b3hn/AIJ4fsh+Mvip4murRV0GzddMspZ0jk1fUHVvs9pErOhdnYZKqdwRJGH3TX46/wDBt1+wX4g/4KM/tYeNP25vj0uqalqr+JGvfCKSvcw293fgt5lzH5mS1naKIre3jWRkQxMhAEKggH2j/wAG23/BGiP/AIJpfsyr428aafZyfGj4oWUF5qsktmy3fhqwcLLHpG+QB1cNtkuAqoGmVUPmC3ikP6WYxRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAfjD/wc5f8ABJTXb8237ZHwMnm8O/FD4Xi3vfEUGi2cqahq8EMiiPU4nhBzc2ikGQuuGto2JkH2dY5PsT/ghP8A8FbdH/4KxfsgW+tXCtY/EnwTHbaT41smVFSW8MWRfQBMAQXJWR1XAMbLJH8wRXf7aY4Ffzd/8FGf2aNc/wCDaT/grB4E/aK+EdrqC/BbxxeT2t7pgu5riNFl5v8ASpVDR70KEXFqs0jDzbdWJJgzQB/SIDkUVzHwY+L/AIb+P/wr0Hxr4P1az13wz4ms47/T761mWWKeJxxhlJGQcqwzlWUg8g109ABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAjHatfJv/AAVJ/wCCyfwf/wCCUfw1j1TxzqEuteKdRPl6R4T0eWKTVr99pId0Zh5NuON0z8AH5VdiEPmX/BdD/gul4R/4JLfCFtJ0p9P8TfGzxNalvD3h12LxWEZJU6hfbSClupB2JkPO67Vwolki+Gf+CPP/AAb4eIP21/Gk37U/7a0mteKPEnjS+h17TPDGrNtk1ABldJ9Si2gLAyKiR2ShY1hCqyhNsQAPGfAvwQ/bY/4OoNb0HxN491iz+HX7NOn65Pc2YjAtdPBSRIZRZ2ygzX90kTyRxz3H7lClygkjZpI3/av/AIJw/wDBIL4G/wDBMLwHbWXw58I6e3iiS0Ftqni6/hW41zV8+UZA07AtFC7wxv5EWyIMitt3ZY/TNhZQ2NqsEMMcMMQ2okahVUegA4AqwBgUAN8v5s/jTqKKACiiigAooooAKKKKAGeXtOdx4r89v+Cx/wDwQ1/Zt/bb+FviTx54st7P4T+MtJtTf3XjzRLFRMUiQr/ptuuFvFwVGSBNiNFWRQNp/Qt/umvxw/4OEf8AgpPYT3l98M9N1C4h8J+A5RfeKri33Kb69RT5dou19sqR+YCUYY88JyDFkcOY45YWj7TeWyXdvZH2XAvCNXiLNI4NS5KUU51ZvaFOOspPptou7aR8G/tOfDGx+Kn7H3w4+GWs+KvFFn4J0HVobrSNIi1iQWyXElswk8q3mZkMhQSlMqzIZJ2HM05f9t/+CWP7bfwB8dfB/wAM/C34YaTD8MT4T02K2s/B12qxeUufnNvPuIuy0rMzSFvPkZzJKoZzn8hPh3BY/GH9nvwu2uaZY3ln4j8OWNzd2UieZCRNaxsygHnjeQCDkdiDXz7+0Fpfij9jm1i1y2j1Lxv8O1dVuJZ7gy6zoTHPLykfvoST8rtyv3CVBUn1vECrLL87p4XCRjb2NJuG124K7T7t7p7+p+b+EHiPwVnksVwzxROph8V9Yr+xxV3OMouo3GnUp6WUVpHladtFZKx/WJ5/P44pyPuNfhh/wTq/4OEfFHhPwbBBq11N8XPBOn3EdvNdz3Eg1vTTL5zrG88v+sdgkjIk2CVgcBwoyn6//s1/tjfDf9rHRTfeBPFWn6yyoZJ7MkwX1qAQD5lu4EiAFl5Ix8y88jPi4PNKOIfIvdmt4vRr5dfkfqXFXh3m2RwWKmlWw0vhrU3z05L1XwvbSVn6nqVFFFekfBhRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAARkV4H/wAFMP2DvC//AAUd/Yz8YfC3xLp2m3c2q2r3GhXt2vzaLqsaN9lvI5AC8bIzFWZAS0UksZDpI6N75TZvu/jQB+Dn/BsD/wAFANb/AGOfj34v/YS+NhuND8SaHrl7H4QSdZJoo71DLJe2AmMhRIpNhubfYixytJOd5eaJZP3kVtyg1+En/B2B+wbrnwQ+JHgf9tv4WC603xJ4X1OwsfFk9mfJa1liZV03UWMUasfmVbWSR5c4azjUYyV/Xj/gnz+2Fo37fn7Fvw5+MGhxfZbTxvpCXVxa/vD9gvY2aC8tgzohcQ3UU8QkChZBHvXKsCQD2SiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAAtivjX/AILaf8FZfDv/AASb/ZMvPEklzY3HxG8URz2XgjRp4WuF1G8QLvllRXQ/Z4PMjaRty/fRRlnUH6o+LHxN0H4K/DXXvGHirUodH8N+F9Pn1XVL2VWdbW2gRpJJNqgs2FUkKoLE4ABJAr+dX9gH4Y+Kv+DoL/grr4k+NHxTi1LS/gr8K3tby20B5Ib+yhAlU2eiBZcKyziKae5kWFg4jZGEfnxFQD3D/ggH/wAEY9b/AGyPHcH7bP7VF9P488SeNLo674Y0rVlEn2tw22PUrpCoTy1CKLa3QCJI1jYAKI1X92Yw275qZbWcdlDHFDHHFDGoRI0G1UUcAAdAB0wOlTUAFFFFABRRRQAUUUUAFFFFABTWbAOfXigOCazvFXirTfBfh6+1fWL610zS9Mha5uru6lEUNvGoyzsx4AA70paLUqMZSajFXb2Pnz/gp1+3La/sQfs6XGoWs0LeNPEXmaf4dtWPzNLgeZc42sNkCuHO4bWJRergH+Xn9qrxNqn7Un7VOg/C+4vb67N9qK6x4g1BpTcXN5LNGbmSaR+csIpHdm3H5pWLDK4H6ueKPie3/BQj9pL4lfHjx1bqnwU+COmXGtTaffXYt457K3EsllpxV/Nj867eNfPC5QB2GSTGH/Mn/gnNpmsfF/4gfEb42eKrma98S+NtTuvPuPs0dvHdTXM4u7uYJGqxgtKVAWNEVcMAMEBePh3AvOM0hWkv3cX7q72+KXz2R/QGMwceHMup8H0P97xPLUxcusIW5oUFby1n5tdNvtjw3ptvo/h/T7O0t4bWzs7WOC3giQJHBGqKqoqgAKqgAAAAACrF3aQ6haS29zDDc29wjRSwyoJI5kYYZWVuGUjgg8EcYOabpX/IPt/+uS/yFTd66fHRKPFHu9KVL/0k/wAhKzcMdinHS1ap/wCls+E/jH8JfEn/AATF+Ma/Fz4aWum6v8P7+VbTXfDOqxm70+WCSRW+xXcROZbV3VDHID5kMqROrpKkUlfrR8NP2HNK/at+E/h39pL9h/x1qWm2OoK7jQdQvJNN1bSLkFzcWKzliA8bGOEwTO0MiZbz5Iypk+dvEnhrTfGWhXel6xY2uqaXqERhurW4TfHOh6qR/IjBBwQQQDXiv/BH39tjxF/wQ/8A+ClqfDTxNrF5cfAv4r3UVtIb248uzsZJpI0g1ZUUPtliKmCXGwSJ8z/6uMp8jldajmUPYYpe/HaWzt690f2b4E+OGc4WEsBGteaXvQmuanVht70H7ra2b0bWt9z9Q/2Xv+C5+t/CHXpPAv7SHh3WbPV9LkNtNrlrp/l3MBQrHm6swAWBKysZYAckALEQcr+lHw9+JOg/FjwhZ694Z1jT9c0fUI1lt7uzmWWOQMoYcg8HBGQcEZ5Ariv2nP2O/h9+174LfRfHPh+z1Aop+y6hHGseoaaSVJa3nwXjLbFBAOGAwwI4r83viX/wTp+Pv/BMLxw3jb4D+ItY8X+G0UzX9lFH++wo27byyDhbxP3kjK8Y3JhjhCA7en7TG4L+L+9p90veS819r1Wp/SzwPCXFvvYGSy3Gv/l3J3w9R/3J70m30leOyR+t+eB/nFEkgjjJJ2qoySfSvhL9i7/guP4J+M1+3hz4oWsHwz8XRT/Zkedn/s27kBcMm9hm3kUqFZJsZYgKxJKr9wLqlrrWgC8s7mG6tbqATQTwyCSKVGXKsrDIZSCCCOCDXpUcdRr0nUoyvZfP5rc/N+IuE81yPF/U81ounLo3rGS7xkrxkvNNo4v4e/tYfDn4q65Z6b4d8YaPqt7qUTy2ccUhH2xVwWMRYASYBzhSTjnoCa9CJ3GvgL9mvWtX8Q/CH9lXw34u03S/DfhUTWuraHrtpevevql7bW8phsJQ0UQspZUeRwQ0yusMkYYMwz9+pyP1rWhWdRXf9adhcSZPTy7EeypttXktWn8M5RTutNbardPRkg6UUUV0HzwUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAeX/to/sseH/22/2W/HHwp8UJD/Y3jbSZdOeV7dLg2Up+aG5RH48yGVY5UPBDRqQQQCPxv/4NB/2p9W+EfxL+NH7JXjm+j03WvCOp3GraJpV5F5N0tzBM1rqkAOMFkZIH8osWH71lBCuR+70ke81/PX/wXp0XUP8AglB/wX3+Dv7V/h+aaDTPHU0FzrElxYiW1ha3gTTNQhQhWJ83TpFJAXzA0jsp3FdoB/QtRVfTdTh1bT7e6t2ZobqNZYyUKkqwBBIIBHBHBAIqxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFNkbatOrP8W+KdN8D+F9R1rWL610vR9HtZb6+vLmQRw2kESF5JXY8KqqpYk8AAmgD8S/+Dtz9tTxF8TtY+HH7GPwzs21jxX8R7+z1TXbeFod8+6cJptgGdv3ZecGeRnEYVYYDvKNKB+n3/BLn/gnxoP/AATG/Yu8K/CXRL5tYl0kSXmraq0RhOrX8x3TziMs3lqThVQE4RFBJOSfxh/4IG/De8/4LH/8Ft/i5+2B4s0+HSNB8C36anpmlLPL5i31yj2+nQ71QJKttZ2zmVtyFpTAfLKSMF/oij+5QA6iiigAooooAKKKKACiiigApr9KdTX6UARu2z6V+ZP/AAWu/bD1r4oeN9J/Zr+GbXGoa9rF1Amvx2U5jlupJFJh0tiwChHDxzOQ+MKithS4b7B/4KLftlWX7Ef7N2qeJ1ezm8SXg+w+H7Cchvtt23QlNys0cYy77TkKvuAflT/gh3+xNfRW19+0B4887U/Eni7zv7CkvpPtExhlfM2oOZFLrPM6sqvu3GJnzxLXh5nUlXqLL6Ls5K8n2j/m9j9i8O8vwuT4KpxtmsVKFF8uHg9qle107dY017z7uyvofNn/AAcKGx/4JZf8EMPDPwR8Pa9bt4o+KfiGKw1aZbmS0vNStkRrvULiKNHyYRIlnbOh3J5dyoYFmBPxd+yX8MZPhF+zl4R0S4hjgvksVu71RB5Lieb96yyDqXTeIyTyfLHQYA9M/wCDsbxkv7QP/BWn4M/CcSao1n4e0O2N1ZXs7x6a73l08jyQhHJDPDEkbuFVj5SDJCgiuVA4UbVAwB6Dt+lfqPA+BhT56kVZRSivL+lY8/hGpXx+MxObYyXNUm23J9ZSd5M6zSf+PG3/AOuS/wAhVj+KoNK/5B9v/wBcl/kKn/ir4bx2/wCSof8A16p/+kn+WeK/37Ff9fqv/pbAmvCf+ChP7MsP7R3wFvGtbdpfE3hmOTUNIZWwz8AzQkZAO9EGM8hlXHUq3vBGaFZo3VlJVlIIIPQ1+R4XEToVY1obo9DJ80r5djaeOw7tKDv690/JrRn2t/wauf8ABQ+X9sz/AIJ0WfgfXLprnxn8C1t/DF2WjijaXTNjDTX2pjO2GFoCzKGY2xLF2LMf01255zX8tf8AwTK+LX/Dsj/g4O8N/ZprXRfAnxYdtCvYA0UNqtpqJUomXixGsV/FC6rFtIWNY9+1nU/1Lovy81+t0Kyq041Y7NJn9vZdjqeMwtPF0vhmlJfNXPmD9tD/AIJQ/Cv9sS31DVLjSYfDHja6VnXxDpcSxS3EuxlU3UYwlwMlSSw8zEaqHAGD8M3Vz+1B/wAEXb+1iv7pfHXweW5a3jRZHutNWHdvIXcPO06UxIx28wBpJMGVgXr9hSg21DdWsVxbvHLEkscnDo67lYe4Nedi8opVpe1ptwn3X6rZ/M/VOHfEzH4DDf2XmUI4zBdaVXXl6Xpz1lTa6OOi7Hxj+xl+1z+zz+3L8GtF+F9jpb+G5vD8NpNbeFdVupIbi0eB0MUlndrJumMcuNro6zdCyJuxX2hEuxFHoMcnPFfBv7Zv/BCnwP8AG7ULzxF8N7m3+G/iSRd62UFsF0WeQBQCIY8G3JAYExcbm3FCc7vC/Av/AAUW/aB/4Jf+KovAvx08N6h408M2t21va61NcSS3FyhZ23219IMXSkfMiTBZFVCh2bcJzQzCthPdx8bL+eK0fqt1+R9FiuC8t4mj9Y4OxLlU1k8NWlaqm9ZOnNvlq3fpK1m7vQ/WyivJ/wBlz9tD4e/theDrXVvBPiC3u7iS3W4utJnZI9S0w/LuSeEMSpVmALKWQ5BVmVlJ9VBPrXuU6kJxU4O6fU/IMdgMTgq8sLjKbp1IuzjJNNPzTH0UwscUqfdqzkHUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAV+ZH/AAdkfsiWf7SH/BJzX/FkGmy3Xif4Pala+JdOktbFJ7k2ryLa30RkILx24gm+0ybTgmxiLcJkfpvXnX7WfwMtf2m/2Y/iF8Pby2tbuDxp4fvdH8q6nlggdpoGRN8kX7xVDFSSmWABwD0oA+Yv+DdP9q61/a1/4JCfB6+VbeHU/A+lp4G1OCFJQsMumKttCS0gAdpLRbWZihZA0zKDlSB9xV+HH/BlZ8Vprf4XfHj4WXd1rF1deEtftNURWkL6bbJOksDeTlsrI8lszMPLXIVDkngfuPQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAGa+Bv8Ag5j/AGoJ/wBlz/gj/wDEi60/Uk03WfGjW3hLT2F3JbTytdv++WFkIYuLWO4YrnBRHzkZB+93+4a/CH/g9W+J+ueLI/2b/gr4Zvzqlz4m1XUdbu/DNnDHPe3d2v2ay0uUKFMw3G51GJFUhZGL5DFF2gH2R/wa0/siD9lv/gkj4N1S6tZrXWvipPL4yvFljkjYxT7Y7Q7WdlIa1ihdWQIGWRSVzlj+jFc/8JvhhofwR+F3hvwX4Xsf7L8M+ENKtdE0myE0kws7S2hSGGLfIzO22NFXc7FjjJJOTXQUAFFFFABRRRQAUUUUAFFFFAAWxVHxBrdn4d0W61G/uYbSx0+F7m5nlbbHDEilndj2UKCSfQVZdWI/XrX5wf8ABc/9s24/sew+AngT+0NS8V+KJ4JdZTS5d8wtyW8uwCRtv86Z/LZlYYMQxhhJlePHYyGFoOtPpt5vovmfUcG8K4niHNqWV4Z25neUntCC1lNvRJRWutu3U8XvrrWf+C4P/BRb7PHJqEfwe8Bu3zKT5MVgJGCybW8t0mvzEBjHmIi/9MiR+vfhrw5p/hDw5p+kaVZ22naXpdtHZ2dpbRCOG1hjUJHGiDhVVQFAHAAArxT/AIJ3/sYaf+xJ+zfpfhtFtZvEl8iX/iG9iUN9pvXQb0V9iM0MZyke8Z2jJAJIHvCvyB3rnyvBypQdWtrUnrL9F6JHveIvFWHzLFU8typcuBwq9nRj3/mqP+9UfvN9rI/lV/a88S6d+0p/wcefHjxFptvI2n+EdWvLOaPU41Ewn06GDSJHiVS64F0heNiyny8MQjfIPaAK+Q/2APHN9+0T+1d8cvit4hFuPFXirUZtQvRZoYbTzdRvZru52Rksyr5kS7QWO1cjJPNfXh+7X7NwlT5cApd5P9Ee/wAE0VHK+b+Zt/dodbpX/Hhb/wDXJf5Ck1a//svTLq62+Z9niaXbnG7apOM/hRpX/HlB/wBcl/kKr+Lf+RX1T/r1l/8AQDX5T47/APJUP/r1T/8AST/KqnTjUzavCezrzT9HUZesrj7Zp9rPt2/areKfb1270V8Z9s4zT25rk9YsodA8J6HqVrGEvof7Obzj9+QSeUjozdWQrIy7ScBcDoAK6+8h+z3UiL91WKjP1r8XpSckrn6p4tcC5bkeNxGLyWpJ4f65jMMoSjyum8NKm7KTqVHOHLWioyk4zbi+aOzfyD/wV28GXln8MfCPxD0OS+0/xD4L1uNI9RsP3VxZxyZeObzlxIhiuIothB+V5yRgkV/Td+wF+0xb/tj/ALEnwq+KMM2lyTeNvC9hqd8mn3Bnt7S9eFRd2yuSTmG4E0TBiWDRMG5Br+ff9t7wavj39kzx5p/2KTUJl0x7q3hj3bvNhIlVhtOTtK7sdPl5r9Fv+DQz49f8LW/4JMweGbjV21C++HPiW/0kWxtfKGnW0xW6ijDhFEmWmlfduZhvwSAFA/SOF8Q6mD5H9lv7nqfpHhBmLxGRuhLelNx+TtJfmz9UD0prCnUV9IfqhGRisP4i/DjQ/i34Ov8Aw94l0qx1vRdUhaC6tLuISRyIwKn3BwThhgjqCDzW9J1qPeENEopqz2Lp1J05qdNtSWqa0afk+jPzJ/ah/wCCGutfDDxNbePP2bdevNL17S7s3cejXmpeTJAAS6izumByQwRfKuDtZeWkypDwfs2/8FufFXwO8by+Af2mfDuqaVqWnQwxvrFtphjvoWIXbJd2i9VdCXL26n5uFjIPyfp7ncK83/aO/ZC+HX7WXhptL8eeFtM1tY1Itrwp5V9YklSWhuFxJHnauQG2sFwwZcivDqZTKjL2mAlyPrH7L+XT1X3H65gfEyhmdCOX8aUPrdNK0a0Xy4imr9JvSaX8s/vOo+FvxY8N/GvwRaeI/Cet6f4h0O+LCG9sphLE5UlWGR0IYEEHkV0kbfLX5H/Fj/gmv8fv+CaWqXXjr4D+NdW8SaBFLGbvT7SMm+2bWBa5siGgu4Vyw3riRPMVlQbWkX3r9jL/AILneDfjVr0fhX4macPhv4p3SQ/a55R/ZEsyMF8hmfElvMckbJF25jI3hiiGsPm6U/YYyPs5+fwv0e3yepzZ14X1J4aWbcLV1jsKrt8qtVpr/p5Teqt/NG6dr6I+991LWf4f8RWHirSLXUNMvLfULG7XzILi3kEkUy56qw4I9xWhXtLVH5XKLi3GSs1uFFFFBIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH8+v/BJzw7p//BP3/g7Y+O3wrvrCzgj+IVvr9n4ctvDsCrpulQXjWviS0idGEXlJFp8DQlYkYJNtRcx/vB/QVX4A/t0/8Y1f8Hk/wc8TeG8yal4/Oi/2ot9++iX7ZaT6LN5SrtK4tI1K5LYkyxyvyV+/iyBjQA6iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigBG+7X4Ff8FwYbP9pz/g5v/ZX+HtjcXWlah4ZGh/bLq4t1khYjUJtQXywr7mygCHdtwx7gZP77EZFfz/8A7fRz/wAHkPwT/wC4F/6TT0Afv9Gcg/WnU1BgfjTqACiiigAooooAKKKKACiiigDxz9uD9rrR/wBiv9nrVvG2qCC4u1YWWkWEkjIdUvnVmjgBVSRlUdycYCxsSQBmviD/AIIvfsi6z8d/iZq37S3xRe413VNTupn0GS/RX+13JYLJqK4OF8ra8ESbFVAG2gBI9uf/AMFHvgr8W/24v297TwZrGlS6T8JPBN1bLFqMDRqv2a6jR7i6BLb5Jz5bRhEyYgqHaN5Lfol4T8f+D/AfhvT9G0eOLS9J0q3S0s7O2sjDDbRIoVURFUKqgAAAAAV+Y5hx5w5RzWdDM8dSpOg7ck5qL5rbtN9Ft95+2TqR4c4Sjg8taqYvMI81WcHzezoactK62lPea7e676Nd4IsVw/7T3xD1D4Pfs2/EPxdpK2r6t4W8Malq9ktzGZIWnt7WSWPeoKkruQZAIJGeR1q9/wALs0H/AJ+pv/Ad/wDCvP8A9q/xbafFP9lz4leGdEaS71rxF4V1TS7CBl8lZriezliiQu+FXLso3MQBnJIHNegvFTg5u39p0P8AwZH/ADPyD+z8V/z7l9x/LT/wSI0WFvAXjbWsyfbL7U4baQbv3exI2dcD1zK2efT0r6+61m/8E7P+CNH7R/wA+GOvab4s+Htvpl5famLqGNfEmlXG+PyVXOYrlgPmBGCc19Bf8O4vjMP+ZQj/APB1Yf8Ax6v1HI/GLgWhgqdKebYdSW/72L1u+qdj9j4aqU6OV0qc3yuzunvuzzvS+LG3/wCuS/yFSXdrHfWskMq7o5lMbrnG4EYIqj8RNQb4L65/YeuQyJq1kXt7q3gZZfIeNzEwLg7D86OAVJ+79M4P/C6tL/597/8A74T/AOKr5Hxfz/Ls14g+t5dWjVpunTXNF3Tajrr5H8E4L6Nfilj51cxwOS15U6lScoSSirxc21JXkn5p280dNe6Nb6jp0NnNHvtoBEI0DHjyipTnOeNi9euOc1euHErb9xLsSXyMc5//AFVxf/C6tLz/AMe9/wD98J/8VVA/HLP/ADC//Jn/AOwr8t9pTWx9lT+i34351GcauVVprnlN+1rUo/vKnLz1F7WtFSnU5IqpJXb5Y8z+E7XXfDsfi/Qr7R5pXhh1a2lsnkQAtGsqFCwB7gNnn0r0f/gyU+J0c/wq/aC8Aixk36Frmm639tMwKzrdQz24i8vHylfsRbduO7zMYG35vBrf48eRPHJ/ZWdjBsfauuP+AV7h/wAGr/hrw/8AsVfGv4vaDq3iC61LUPiVY2F3p5XTDHDF9ga7aSNiJHO5lugy5ULiJ8kEqD9LkGeYHAwqyxlVQjZO70Ssndt7LTufp3Af0bfEvhPAYzGcQZa6VFckrqrQqbXTdqdWcusb6eeyZ+7gal+b2rkf+F0+H/8An6m/8B3/AMKX/hdmgf8AP1N/4Dv/AIV0/wDEVeDv+hnQ/wDBkf8AM9L+zsV/z7f3M6xuteB/tTatqXiH9oL4S+AG1rVvD3hfxXLqd3qdxpl9Lp95qctpAjwaelzCVliD75Jm8t0d1tSobbvVvTz8adAb/l6m/wC/D/4VhfEHW/h78V9A/srxRpen+ItM81Zvsmo6Z9qh8xeVfa6kbh2OMjNZ1PFPg+S0zOh/4Mj9253Zfhq9Ct7SpSk1aS22bTSa803dea6bnl37DGv3vij4yfFyGTxtrPirRvBuqQeGtDgvLySYQWkcZlMjsxP2iXzXkgNyxaR1tRuZmDM30yef89a830HWfh34V1aPUNL0nTNNvobBNLSe10vyZEtEOUtwyoCIlPIToD0Fbg+NHh//AJ+pv/Ad/wDClR8UeD4U4wlmlB2/6eR/z/M2zinWxeJdalRcVaKtbtFJvRJatcz03bMf9q/4/Wv7Ln7Pfijx5d2E2qJ4dszOlpEwU3EhIVFJPAUswyewzX5A/s8/sefEz/gsd8afE3xF8Qa1pOiaKuoJBqV75Y3Rg5cW1nAq4IRCPmkK5LgkuxfH6H/8FTtGm/aY/Yr8T+GfCV1eza75lvewWcStH/aAilV2gJIwQRkgEgFlWuU/4JMfs0237D3wc1BvE2uXE/ijxe0N3qGnQK8lnpOxTthUgYaUBsO44JAALBQzeDmXiRwnjcbClUzGj7FJt/vIpX6dbn7LwJnFPhfhDF5rgGo5nUqKnC8XKSp2i5WT0S395qzdlrY+WV0n9qb/AIIrSX0tmtp4y+EcM7zswButKRTIiLI44nsZSoQEAmHMjYMrLvH3T+xj/wAFZPhX+2Q1jpNnqEnhnxtcoqtoGq4jknl2FmFtL9y4QFXxtIfCgtGm4A+13Xxe8N3ts8M0zTRSDa6SWrsrD3BXFfC/7aP/AASY+E/xwnl134Z3tv8ADPxQoZ2t7axlXSb6T5ACYkx9nO1SN0IAJbcUY5LX/wARI4YwWuDzShOH8kqsdv7rv+D0OL+2sm4sfs+KsM8Lin/zE0Ye7J20dakt/OULPuktT9GFlbvt/wAKcz4I+tfmD+zf+0p+1T+xTpGr2/xK8MT/ABW8A+H/ADZn1GPXLWbUrW2i8xnlt3dlnuEYEOqXCCQKu393wq/ptpd8uq6bb3Ue7y7qJZUDdQGAIz7819zwzxhlGf0pVcqrxqcukuVp2b7209D8x4q4Tr5HXVOdWFanL4Z05c0ZWtfTSUWrq6kl5X3LVFFFfTHyoUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAfgB/wck/8AGO//AAXl/ZP+J3h/5/Et9/ZfmpefvbT/AEbVdkeEG1uRM+75ueMY5z+/oTa39K/AL/g6/wD+Ur37If0tv/TxFX7/ANABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAMcKa/Aj/gtY1n+y/wD8HQf7L/xE8u61iTxQuh/aLHesIgY3s2nKUfByACJCCOSCMjII/fZjhTX4Kf8AB554K1b4UfEb9mT45eFNNvLLXPD19qGmzeI1jM8Fnc28tpfaXC6yboQ+8ahIoZcyCOQNuVAAAfvVGMFvrTqyfAnjXSfiT4K0fxFoGpWes6D4gsoNS03ULSQS299bTRrJFNG44ZHRlYEcEEGtagAooooAKKKKACiiigAoNFFAHz9/wUV+F/xC8efs8X998KtYutH8d+H3F/ax21nb3MmsQqrh7LE4Kru3B1YfNujUDhmB8K/4I5ftWaf+2b8J9W0PxiI7zx94PZXvLkyGF9VtZWYx3GyNUjUqwMbKmcbULY3jP3kw2r/OvyM/4KB/C/Vv+CWn7fnh/wCO/gbR5pPCPia+lmu7YSjyJL6cSveWO99xjE8YeVBtAUhtnEeF/OOIuB+HquN/tfG4CjVctKjlShJtbKV3Fu60+Wh+zeHvsc+y3EcJyShiZfvMNU0jJzim5UZS0bVRfCm7KWvY/U4fCHw6f+XFv/AiT/4quK/aR+GUmj/s8+PLrwbpt03i+18O6jNoS2+6eZr9bWQ24SNyyu3mhMKykE4BBBNdr8IvixoPxx+GmjeLvDOoxapoHiC2W6s7mMMu9TwQVYBlZWBVlYBlZSpAIIHSjGQfWu2Phpwc0pRyvDW/680//kT8prYrHUpulVnKMouzTbTTW6a6NM/mf/4J2/8ABYf9o749fD3xFd+LPibLqGpabqS26AaFpUDQxmIHBVLZerbuSO2O1fQn/Dw340D/AJnq4/8ABVp//wAj1+ZX/BKC0m0Pxp8VNNvoZrHUbWa0Sa0uEMVxCyS3SurRsAylWIVgRkE4OCa+z+lfqHD3hLwLXwMJ1Mmwreqv9XpdG/7h+vcKyjXyunOorvVXer0b6ncfErX7r496rb6z4sNrqmreSA91HZw2ckwIBy5gRN59C2SBxXNn4W6H/wA+P/kaT/4qtjSubC3/AOuS/wAhVjvXyPjBkeW5Xn6weW0IUaSpU7RhGMYr3dbRikl9x/nFS8aPEHBVsRhMHnuMp04VaijCOJrRjFc70SU0kvJIwP8AhVuh/wDPj/5Hk/8AiqvnwnpYH/IN0/8A8B0/wrSGcUhr8t5YroYY/wAXuO8dy/Xc6xdTlvbmxNaVr2va83a9le3Yxda0/Q/DGiX2p3ml2r2em28l3OsVrGZGjjQu4UHHzEA4GRz3Fe4/8GiTa1+0z8M/jN448bahpetw2utWeiaTAmjWtldWG2F5pnM8CIzJIskA8skhTCWHLHPy3+2X4zfwD+yt481OG9j0+5TSZYLeVwpzJLiMIAwIJbdtAx1Ir79/4M9/gZ/wrT/glbdeKJrPVLS6+Ifiu91DddcRXMECx2sckAwDsLRyKTk5ZG5GMV9ZkeR4HH4SrTx9GFWEmk4zipJ211TTR+1eEXEmfY3A4ivjsbWqJyUVz1ZyVkr6Jtrqr+nkj9OB8IfD7H/kHt/3/k/+Kpf+FOeHv+ge3/gRJ/8AFV0wVgRTq1/4hjwf/wBCrDf+Caf/AMifrH9oYr/n5L/wJ/5nLj4PeHx/zD2/8CJP/iqP+FPeH/8AoHt/4ESf/FV1FFL/AIhjwf8A9CrD/wDgmn/8iH9oYr/n5L73/mcv/wAKe8P/APQPb/wIk/8AiqD8H/D/APz4H/v/ACf/ABVdNvoZxT/4hjwf/wBCrD/+Caf/AMiDzDFf8/Jfe/8AM5k/CHw7/wA+J/7/AMn/AMVSH4Q+HV/5cT/3/k/+KrjP2nf22Phn+yJ4f+3eOvE9np1w8Ze202LNxqF7jAxHAmXOSyjcQFXOWZVBI/OP4y/8FRfjx/wUE8a3Pg39nnw34k8P6PhkmnsRGNVnQMV3TXhPlWSsJIidjh1YDExUnd52N4F4Iwz5HleHlJ7RjQptv5cp95wpwTxFnsHiaUnRw0firVZOFKK/xPd+Ubu59pftl/tf/BP9ifQpm8STDVPEhKpbeHdLvDNqUzOCwZ0MgEUQAy0jkAAgDczIrfEnhn9pD9qD/god4+X/AIUv4Xtvh/4ThllAv5UWSzVN4UG5vLqOQSMoK5S3jLZEhCsB8vt/7JX/AAQN8K+E7i18RfGTVpvHXiCXy7ifSoZpE02OXb8yySZEtztbAyxRWCDKbWKV9/8AhTwhpvgXw3Y6Loun2Ok6PpcCWtlZWcCwW9pEgwscaKAqqoAAAAArij4U8O4t81fLMPTh/LGjT5vnLl0+R9VV4q4Z4apujk0XmGJ1TrVk/Yx7+zpN+96zv3Vzwz9m79jjxB4K8D31r8VvH158UNU1QKkqNYQabZWigtuSJYER3DggMZGYHGAFBIPv8VuIIlVVVFQAKqjAUDgAVIUYj39aUK2K+6yPhnKMlpOjlOGhRjLdQio3fd2Su/U/HcyzTE4+u6+Jerd7JKMV6RilGO3RIcOlFFFe6eeFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH4Af8HVX/E8/4K7fsi6dY/6bqCizzaW/72cbtYj2/u1y3zYOOOcHHQ1+/wCGya/AH/gql/xPv+DvP9nG30/F9c2Z8Mfaobb99Jb7bq6mfeq5K7YSJDuxhCGPy81+/iIVPNADqKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAAjIr88f+Dor9mM/tJf8EePHr29jDfap8Pbu08Y2LSSzq1sbZmjnkRYgRI/2We5QLICg8wsdpVWX9DqxviL4E0n4p+Adb8L69a/btD8SWE+l6jbea8X2i2njaKVN6MrruRmG5WDDOQQeaAPhL/g2Q/a7b9qr/gkV8PYL28iu9c+Git4KvVDwmSOKzCrZhkjVdgFo1ug3Aswj3MzMSx/QZTkV/PP/AMGznxZ1v/gmv/wVn+N37G3jKTUrq113UrqDSrqYSWsAv9M84pdR20r4SO/siJN673cQ2g+ZPmX+hdPuCgBaKKKACiiigAooooAKKKKAI3GK80/a3/Zj0T9rr4Ca94F1xSsOqRh7W4VmDWN2nzQzjaQTscAlc4ZcqeDXp5XNNkHFRUpxnFwkrp6NHRg8ZWwleGKw0nGcGpRa0aad016M/LH/AII3/tG6z+yx+0V4s/Zn+JF1b2L2t/PHoeVYINRV/wB5BGxQM0dzERPEz7eE45lVR+pg5jr84/8Agun+yFfnTdF+Pvgkw6f4g8EtF/bLwW48+WJZUNveA7CGaB+G83KmNhzhNr/UH/BOH9s+3/be/Zq0zxJIqweItNK6Z4gt1Cqq3qRoXkRQxKxyZEiBuQGxzjJ8TLKjw9WWX1XrHWL7x/zWx+ueImCpZ5gKPHGXxsqz5MTFfYrpayslpGqveXndN3Z/ON8W/Bl18AP+DhD9pjw3rUkNxfeJtd1zUrR7MmSJEv7uLWIQ5YKQwtnCtgECTIBZfnr3M/drH/4OOPhRD+zB/wAF8PBnju2VbKy+J2m6fqF0LG5mkubqUFtPlMqyEKu5Y412RnYUXJAYsDsuuw7fTg4r9o4Prc+ElT/ll+dv8mc/AeI5sBOk/syf4pf8E6vSv+PKD/rkv8hVj+Kq+lf8eNv/ANcl/kKsfxV+Y+O//JUP/r1T/wDST/KnFf77iv8Ar9U/9LY6kJpaMbmA654x61+NknyT/wAFgfiPJo3wF0LwjYvM+qeMNXQmCGJZTPbQKWKH+IM072xXaPm2OMgZDf0q/wDBNj9lWL9in9gf4R/C3yLO3vfB/hmztdV+x3E1xbzak6CW+mjebDlJLuSeQAhQA4AVAAo/nQ/YW+E6/wDBSn/g4R8E6DGs2q+D/hjdHVb+SDz3ghh0zEruSjIYw980UIkVthd4z84bDf1PIdy1+p5Lhfq+EjB7vV/M/srgHJnlmR0aE/ikuaXrLW3yVl8h1FI5whpoY4r1T7IfRWH49+IOi/C7wpe694k1jT9C0TTUEl1fX06wW9upIALu2AMkgfU1+d/7U3/Beu313UJPB/wB8P6p4o17UibW01u5snCF2Qjfa2hXzZWVivMqovytlWXDHjxmYUMKr1pWfRbt+i3Pq+FuCc54hqunldFyjH4pv3acF3nN2irLXe/ZM++vjF8efB37PnhCbXvGniPSfDekwqx869nEZkIIG2NfvSNkqNqAkkgY5FfnL8dv+C1fxE/aP+Jk3w//AGZ/C15NdTTOtrrMliLm/vIUyrXEdrKvl28W5kYPcA7VA3ohYqmF+z9/wR/+LX7ZnjJvHn7SHijX9Nt75PtENlJeJNrUpkYSFSm0w2MQVmAiQBkPy+VGE2n9I/2e/wBlf4e/sueHP7I8B+E9L8O2zgmaSFDJdXRJyTLO5aWU9AN7NgKoGAqgeXzY/G7fuYffN/8AyP5n38qXB3CbftGszxi6LTCwfm9JVWu2kX1sfAP7PH/BCjxH8WPEq+Nv2ivGWpaprGpCK4u9KtNQa6vJcR/6q6vmzynyoVhyo2EJIQVYfpH8OPhf4b+EHhS20Pwroek+HdFtARDZadapbwpkknCqAOSSSepJJrf8taULgYr0sHltDCp+yjq929W/VnwnFXHWc8Qzj/aVW8IaQpxSjTgu0YLRW26u3UZjLCpKTYM0tdx8gFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUVh/EXx1a/DHwDr3iTUI7iXT/Dun3Gp3KQKGmeKGJpHCAkAsVU4BIGe460Afg7+x5/xmT/weh/FLxx4V/0LSPhV/a39rxap+5uJ/wCz9Ji8Mz+QsfmK26+mWRN7JmAFjtfER/f6vwP/AODPvwxqXx+/a1/ah/aI8RWcmpaz4luhZJr8sscEsk9/eS6hfxtawssamRktJCRFtUptjZRvU/vhQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFNlBK8U6igD8Jf+Drb9kXxN+zH8dPhX+298Ld9lrvhXVbPTPEkkTXBaO4ibfp924j+Vbd1R7WYl4wS9ugDGViP13/AGBv22PCH/BQn9kzwf8AFjwZcRnTfE1kkl3ZCQvJo18oAubGUlVJkhl3IW2hXADrlHVj2H7QvwF8M/tQ/BTxP8PvGWmwar4Z8XadLpt/BJEkhCOpAkQOrKJEbDoxBKOisOQK/n+/4JJ/tU+Kv+Ddz/gpt4s/ZN+N98Zvhj4y1KKTS9bh0x4oEvrjyY7TVI3cBzaTRr5MyjzFjlj+VsRSlwD+jSik3c0tABRRRQAUUUUAFFFFABTZBkU6igDP8QaDZ+JtHutN1KytdS06+iaC6tbmFZobmNhhkdGBVlI4IPBr8hfBl/e/8ETP+Clt1pV9Nq83wj8YxCFZpnKxtZyMpjnbPlwtNaS5VnwcQs/3TJgfsVXy/wD8FXf2KIP2z/2Z7y3srfd4w8I+bq+gSJGDJPKImEloTsZvLmXGVXG6SOEn7oFeTmuEnUgq1D+JDWP6r0aP0rw04kw2BxdTKc1f+xYyPs6v93+Sou0oS1v2ufnD/wAHpv7Jtx42/Zr+FPxs0ezjkk8B6xNoGtT2umGS4+x36rJbTzXK8x28NxbtGqv8pk1FdpUsQ/yj8GPiJb/Fz4R+G/E1vt26zp8U8iqrBYpgu2aMbgCQkodc9G25GQcn7w/Zr8Yyf8FNf+CXPxg/ZX8WJHdePtI8OTxeGIr/AMtry+MWXtlH2qTie3uY44ix2CJGh+ZcEj8kf+CVfxVHif4M6l4UuLpZL7wtdloojIzsLaXkFf4dok3jCk4JycbgT9xwFmlOtVTi9Ki/FdPlqjvwOT4nhviHEZHjd+jW018UZLylF3XrbdH2hpQxY2//AFyX+Qqx/FVfSf8Ajxt/+uS/+girB+8a+Z8dv+Sof/Xqn/6Sf5WYr/fsV/1+qf8ApbHZrxr9ur9pS3/Zo+AmoahDeJb+ItYR7HRIw7LI8xADyrt5HlK28tkAHYM5ZQfXtR1G20bT7i8vLqCzs7SNpbi4nkEcUCLyzsx4Cgcknivmj/gnl+yBqn/Bf7/gptGup2d/a/Af4aIt5q8ssU0H2iyWVAtgs8KlVu7xyW2mRCsEcxRiYgG/N8hy361X5pfDHV/5H6J4bcKPN8yVWsv3NK0peb+zH5vV+S80fqh/waY/8E7W/ZU/YNk+K/iDT1h8afHFotVjeQSCe30WPd9iQhwFXzd8lwGQHek0JLNhQv6uRthBk81V0nTLXRNLtrGzhhtbOziWCCGFQscUagKqqB0AAAAHQCvkH9tf/gtD8L/2Urq+0HSZJPHXjK1T57KwcLY2LEKV+0XR+TlW3bIvMb5cME3KT+iYjFUsPD2laSivP9O5/aGQ8OZnnWKWCyqhKrUfSK2XdvaK820j7B1TVrXR9Omury5t7W1t0LyzTSCOONe5ZjwB7mvgz9tL/guv4E+EVpcaH8K2h+IXi1pEhW7QN/Y9oWz0lGDcSAlAEiypLEFwylK+b7z4R/tVf8FkPEUeo68p8B/Dfcz2sV6ZbPSowrso8u1z5t5OFlceayqhEbjenCN96/sgf8ErPhL+x9b2t9puiR+IvF0MaCXxBrCi4uRIEKsYEP7u3Viz8RgMQwDM+1ceP9axmN0wsfZw/nktX/hj+rP1BcM8K8LctXiOt9cxS/5h6MlyRfarVV/nGCv0u1qfEHgH9gr9pL/gqbqNl4y+Mni+78K+Db1TdadaTIA4idldBa6emEhTb0luD5zCKMsJAwcfoV+yN+wH8Nf2KdDmt/Beit/aV9tN7rF/IbrULsru2guRhFAdgFjCLySQWJY+1RDGfrTq7sHldChL2usp/wA0tX/wPkfK8UeJGb5zQ+oJxoYRfDRpLkprtdLWb85X110GYzSxqQadRXpH5+FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABXw//AMHFf7VL/sj/APBIn4ta1Y6tDpfiLxLaQ+FtEJvmtLie4vpVhlFuyEOZo7X7TOFU/dt2J4Br7fZwtfgX/wAHdPxV1b9p79rv9nn9ljwvcX0l9qV5Hqt3aQR3Ege7vphZWcjQhQkpjjFyVZSzKJZV+TJ3AH2T/wAGpP7Kl1+zf/wSR8L61q2mJp2t/FLUrrxU4k077LdGydvJsvMc/NMjwwi4jc4Hl3a4H8TfpZXL/Bb4S6T8B/g54R8D6BbrZ6D4L0az0LTbdXkdYLa1gSCJA0jO5wiKMuzMccsTknqKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK+Cf+C/n/BHzTf8AgrB+yl/xKLeRPi78PIbq+8FXAvhbQ3ckojM+nzhv3ZjnEMe122mOSOMiREMof72ppQE0Afif/wAG4v8AwXDazn0v9j39oaDUvCHxR8GzSaD4a1LXJJUk1V4nYDSbzzmLQ3kX+rhBwkiIsQCSLGs/7YI+41+Y/wDwX9/4ICaP/wAFNvB83xI+HMdp4f8Aj94dtB9lnDrb2/i+GIZS0uXJASdQAIbgkbeI5Ds2ND4L/wAEPf8Ag4//ALNuF/Z1/bA1HUfB3xS8KXS6DpvijxBBLG+qyrKIRZaoxXMF5GSB9olwkqoTK6yjdOAftpRTUJI59adQAUUUUAFFFFABRRRQAVHJFubOakpjN8+O3rQB+T3/AAVV+BuufsBftfeGv2kfhvptnbabqup79ShWVo4TqsiyvMJkVgwju4xIWZfl3h9wDOPM/Jf9umz0H9kv/gsZJ4+8J311/wAKy/aIth4ut5b6CPFpHqsxlu7QtEpQNa6gjoVjOYxGsbscOW/qT/aI+A3h/wDaZ+DOveCfE1rHdaVrlsYjuBLW8o+aKZMEEPHIFdcEcqK/mI/4Kz/s9+JPA3wc8RfDHxhaq3ib4R62dX0p4pfOjihnRVvUhKsqmG6i+x3O51Z0axVFSNp7ivFw+IeVZjGrH+HUaa7Kf+UvzP3TCVp8V8NRr0tcxyuN/wC9Vwyf3uVF/wDkj6ux9MabxYwdP9Wo6+wqZmCKzMyqqjJZjhQPUn068n0rifgf4lWP9mzwVrWsagqr/wAIpp17fX13Ngc2UTySyO3uSSxPPJr5b/an/an8XftOeILjwD8G5Jo/DsMjQax4ojZobe74IaGOYDiDggsvMpGBlD8/v+MmHli+JlU+GPsaTbeyTif5icF8B5vxbntfL8poym5Vql2ot2999t32Xzemqt/Gv4ieNv8Agp58eNP/AGc/gDpLeJpNYuguo6hGuLedYmBeQykYhs4jhnm/jIAXIIEn7h/s1+If2c/+Dfb9j7SfhZZ6tbeIvH6wpe+JLfRc3N/r2r+XHHcXEzE7bWEMNsaSsu2OMhVkdX3fnV/wSw/Z/wDir4A+DepfDL9nvwrIupeK2jTxn44is1hvr2NodrWkl9KTHa2cbiZkSHbM+FOWclW/Sn9iz/gg14S+F94viH4vXFn8Q9fmRZTpQD/2TazsQ8jPkhrts5X96AjAkmMkjb8lhcRP2aw+Vw93+eWi9bbv+uh/ovw/4RcO8E4CNPinEcko6rDUXGVaTfWpL4ad+t7u21mkjwO9+On7UH/BYrxvdaL4LW68B/C2WeR3kiMlnYRwplcXN6q+ZdTESY8iMiNmwSg8syp9cfsVf8EUfhn+y9e6d4h17zPHnjKy2yx3V8nl6fYzbGVzDag7WyWOGm8wrtQrsYEn7C0nR7TRNOhtLG1t7O0t12xQ28YjjjGegUYA/CrUf3a9DC5PCM/bYhupPu9l6LZBn3ilja+GeV5HSjgcJazp0tJTXepU0lNtb3sn2EWHaB7dqUxZNOor2D8vEUYpaKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAxfiH460n4YeCNY8Sa/ex6bofh+xm1HULyQFltreJDJI5CgscKpOACTjABJr8C/wDggLoOuf8ABWD/AILufGX9sDxQuoyeG/Bk14/h1pFWIRTXSNY6dZkLCI5VttKEocgpJ5gt5G3F3J+pv+Dur9v2H9nn9gy3+DOhzXDeNPjhcLaOLS7MM9jpNvLFLcsQjByLhxHbBCpSSOS5BOV2t9Mf8EF/+Ce15/wTa/4Jt+DfBWuFj4y14t4n8TJmNlsr+7VCbVTGWVhBGsURcO6u8cjqQrgAA+0BwKKAeKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAEb7pr4K/4K6f8G+3we/4KuW1x4jvFk8B/FxIYYbfxjpsZka6ihWRUgvLYusdxHhx8/yzqIolEoRTG33tRQB/OR+zF/wVN/am/wCDcT4iWfwV/ag8D6n43+E8U8zaXqltd/ariOGSZts2n3zN5c0J8qaQWlx5cw8z5jDjZX7kfsM/8FEvhF/wUS+EOmeLvhb4u03WYry1E93pMk0cer6K/AeC7tgxeKRGIUnlGyrI7oyO3f8Ax2+Ang/9pn4X6v4K8e+HNL8VeFtdtpLW90+/i3pIroyFlYYaOQKzbZEKuhOVYEA1+Lf7Z3/BpX4i+DHjHUPiR+xh8UPEPgfxFZi5u7Tw7e6zNZ3EWWDpa2OpxlZEAGUQXJYkrHvn+9JQB+6e9fWlzX89nhb/AIOSv21P+Ccus/8ACM/tYfAW68RJps7QTa1PpbaBdXapcTxySpcQI1hcKW2JHJAixskSsDJ5m8/oZ+y7/wAHPf7G/wC0xLZWsnxJm+HOtXzzqmneNtOk0sRLErPvkvF8yxQOqnYGuAzHC7dxVSAfoPRXH/D79oPwH8WbbTZvC/jTwr4ij1i1S+sf7N1WC5N3A6CRZUCMSylCGBHGDmuuMgA70AOopC2BSb/rQA6g4rzj4o/th/Cf4JaHf6l4w+JngPwxY6XOLa8m1PXrW2W1lMnl+W+9xtbf8uDyDxXwV+13/wAHZX7J37OP26x8J65r3xg8QWst1atbeGtPeKwinhZUG+9uRHFJDIS2yW2+0KwQt0KFgD9OmKleor8nf+DkHU/gvZxeE7zVviB4T0v4qxyx6IvhaSf7Rf65ZXRYr5kKFvJSPbK3myqsbCQoX3NEp+QdS/4K9f8ABRz/AILH28XhP4B/Cm6+FXhXXpYoZ/E2kWk9ubaMwM779ZutsUCMkscoMCJcHZGI2YuUf6N/4J9/8Gh/gH4b6/Z+Nf2kvFV98YvGRMN3Lo9vcTQaIk4Q71nlYi4vArldpYxKwj+eNlcoOXGYWGJoujPZ/g+j+R9BwrxJishzSlmuE+Km9U9pRekovykm0/XufDHxy8F+FYv2b/Bui65cW2l+GbKXTrRbe71P7HZTBLVo4ILiR3UNGCFfEj7d0SsxIVq/TT9iP/g3n0bRfDek6l8YLrhrZX/4RHRJRa29lkJiKa5hbLFVDKwgKrkjbIwUM3Zf8Fsf+CIPw/8A2yv2A9f0b4e+DPD/AIT8feDN/iPw02haTBbyajPDBKrae/lwtI0U6OQEj2kzJbsSQhU+R/8ABqp/wVIb9pb9mu6/Z/8AHt5e2/xS+DKG3t11a4/0zVtK811QBZZDM0lmw8iQbFWOM2o6kgepxPLD5zjoY2tF+7ThDlburwjZu22vmZ8B8UZnwlklfJcmcKLrV61WVWEeWq41JuUYc+rioLRctn2Z+qHw4+GmgfCHwjZ6B4Y0bTPD+h6fu+z2Nhbrb28W4lmIVRjJYkk9STmugUjNGzKUKuDXLZJWR4tSpOpN1Kjbk9W27tt7tvdscBiiiigkKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK5f40/FvQ/gL8IvE3jfxLeJY+H/COmXGr6jOzquyCCNpHwWKruwpABIySBmunYZWvwc/4Oj/ANvfXv2q/jT4I/Yg+C0l9q3iDW9XtrjxZ/ZU7yLczsGW20yVbd2YxxZa5uI5YjtMds4x5bUAeZ/8EzfA3i7/AIOMv+C0+t/tKePre3tPhJ8GtQgfStGuNPBWSBHnk0vTc7WikkRsT3LuzEltqhUkTyv6L1+7z1rwT/gmf/wT+8Jf8Ezf2P8Awv8ACnwnsuv7Jja41bVnt4o7nXL+Vi81zKUVS3J8uPfuZIYoo9zBAa98oAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAppiDH/PFOooApa54csPE+mSWOpWVnqFnKVZ7e5hWaJirBlJVgQSGAI9CAa+Ev2oP+DZX9jf9p+O9uG+FsXw/wBavEgjXU/BN5Jo5tViZTiO0G6xy6go7NbFiGJyGww++qKAPwl+Kf8AwZW2fh7VJNU+Ev7QGv8Ah/Uf7Rle2/tfS9zWdk4kAjE9vIjvKA0aFtqKw3naMhRg3X/Buz/wUJ+AGn2eg/CP9sGZvDO17iWJvGGt6CsFwzneFhiWdWBAUl9ykkkbeMn9+CuTSbBQB+AB/wCCIv8AwVcA/wCTuz/4dTxD/wDI1WJf+DaH9uL9pLRYW+Mn7YE013o88g0uA6/rHiCONJFTzHDymHy2Yoo2hTkIDntX78Hmk2DFAH4e/BT/AIMpPAv26y1L4rfGzxl4ovpvPl1eHQ7GGx+1TOXKulxP5z8ZVmLIxYhuRnj71/Zc/wCDfL9kP9kuxtjoXwZ8N+INXhitBLq/isPr95PPbD5blRdF4beV2Jd/s0cKM2PlCqir9nAYooAr2Gl2+lWEFrawxW1raxrFDDEgSOFFGAqqOAoAAAHAAqZIgh4p1FADXTfX4J/8HFP/AATT8Uf8E/8A9pfSf28v2eYdK0ObQdWi1Pxnabg3k6nPOUGpLBJ8skVy0wiuEQht8gk2kPLJH+91Z/irwnpfjrw1qGi65pthrGj6tbSWd9YX1utxa3sEilJIpY3BV0ZSQVYEEEgigD57/wCCVH/BSnwj/wAFSP2Q9B+I3hue3g1hI47DxRo6hlfQ9WWJHntxu5aLLbo5OQ8bKThgyr9KV/Nj8c/gd8cP+DTL9uOD4lfDe41bx5+zT47vBa3tlcybba8jJZhp99tBWG/hXc1vdqoDgNgFGuLev6C/2Uv2nPCf7ZX7PHhD4neB79b/AMM+NNMh1O0zNDJNaF1Be2n8l3RLiF90UsYdvLkjdScrQB6HRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRXgP/BSz/goR4O/4JnfsneJPid4uu7Ay2EDw6HpM90YJfEWolGMFlEVR23OQSWCMERXdsKrEAHgX/Bfr/gsxpP/AASk/Zclt9Av7O4+NXjiF4PB+myW32mO0VXVZ9RuFJCrFErN5YbPmzbFCMizMnzf/wAGvv8AwRnm+BXgZf2oPjBptpqXxY+Jlv8A2t4Xe5nF1caBpl5GztdMANkd5eJLuYgs8cLiMmNpLiKvnb/gkD/wT8+K3/Bdb9sWH9tL9py+ivPANjqfneGNCa3SSw1g2szIllb20m9YtMtpEZG3BnmkWTczyNNKf6FAuDQAirtFLRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB5v+1Z+yz4L/AG0v2ffE3wx+IekjWPCPiu2FvewCQxyIVdZI5o3HKSRyKjq3ZkGQRkH+fvwZ43+OX/Boz+27P4f16HVPiN+y78SL4yI8SDbeKuALm2ywS21WGPCyREiO4QAHgQywf0luMrXmX7W/7IfgP9uP4Ca58NviVodvr/hfXo8SRt8k1pKM+XcQSdYpkJyrjkcg5UkEA1v2d/2j/Av7V3wj0fx18OfFOk+LvCevW6XNnqFhLuVlYZ2SIcPFKpyrxSKskbKyuqspA7gHIr+a741fAn44f8GlH7blr8Rfh3dax8Qf2afHV0tneW15Jtg1CP5mFhf7F2Q6hCu57e7VFDgPhdjXFvX7m/8ABO3/AIKefCP/AIKd/BxfGHwv1ySUQzSQX+iaksdtrGlOhAxPArvhSHRldGZCHA3bgygA+hKKaJATTqACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACgnFN8xa+Mv8Agrd/wXA+EX/BJfwTbr4mluPFXxA1qKY6P4T0mWNrpmSIust25OLW2LmJPMIZ28zMccgSTYAew/8ABQL9v74c/wDBNv8AZx1b4lfEnVls9NsgYdPsISGvtdvCpMdnaxk/PK+DycKihncqisw/C/8AZJ/ZK+Mn/B0/+2c3x2+OhvfCf7O/hK6ez0jSLSVkhnhRwx0yxbgsWIH2q9wGZhtXbtRINL/gnd/wSp+Ln/BxP8ctS/ab/a01vxBpvww1Ccv4e0SwlaxTU41YKttYRtv+y6bGqBDIMyzsGbzGkaSev6Dfhv8ADLQfg74B0fwr4V0nT/D/AIb8P2kdjp2m2MIit7OBAFVEUcAAf4nJoAPhp8NdB+DvgLR/CvhXR9P8P+G/D9rHY6bp1jEIbeygQbURFHAAH/181v0DgUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQBleNvAui/EvwtfaF4i0fS9f0PVIjBeadqVol1a3cZ6rJFICrr7EEV+CH/BQf8A4N6/iv8A8ErPilc/tG/sL+KPEFjbeGLS81DUPDslwt7q2lxNJuaGzSSJkv7NYW5gud8oFsCWuHYbf6BKTYM0AflV/wAEm/8Ag6J+FP7YFrY+B/jZcab8Gfi9bGKwlGpyNb6Jr9yqS+a8M7rss23RY8i6dTumjjjeZiQP1UV8uRX58/8ABV3/AIN0vgd/wUx03VPEFnptr8M/i5dSrc/8Jdo9thdSYb9yX9qGWK4Dl8tLhZw0cf7worRv+Yvh79tT9tb/AINi/iePAvxV0qT4x/A7U76R9G1DUL2W4hmtkJVmsLve7WLs0sTPbXKMAy/IoEhmYA/pCor5G/4Jv/8ABaz4Ef8ABTLwDZXng7xhpuj+MVtUl1bwfq9wttq2lyFkjYKr7RcRCSSNRNDuQmRAdjkxj64Q5XmgBaKKKACiiigAooooAKKKKACiiigAooooAKKKjup1tYGkdljjjBZ3Y4VQOpJPYUASVQ8TeJ9P8GeH9Q1fWL6z0vSdJtpLy9vbyZYLe0hjUu8sjsQqIqgksSAACSa+H/8AgpB/wcRfs5/8E4Uk0nUvE3/CwvHhQMnhjwrJHeT24aNnRrqfPk2ynCDazGXEqMsTJlh+VmheCf21v+Dp34kHWNavpPgv+zbYzypCkUkselnGWjRLcusupXbRXAVrhlS3Cq+PLJETgH0t/wAFaP8Ag6e03Q9SvfhH+x+s3xF+Jeozf2fH4t07TjqFjYzrLKkkdhA0bC/m/dqUlVXtmWUMplHFJ/wSg/4Ng9QPxXX49ftj6pL45+J19qsXiKDw0b9b6zE7R+a7atIyH7TMs7r+5ibyAbfBaeOTYPvH/gmJ/wAEVvgf/wAEtPCGn/8ACF+HbfVviB9h+y6t421OPzdV1NmwZNmSVtYWIAEMOBtRN5kcGRvrsKAaAIdL0u20TTbezs7eG0s7SNYYIIYxHHBGoAVFUcKoAAAHAAqeiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAOlY/j3wFonxP8H6h4f8SaPpmv6Dq0RgvtO1C1S5tbuM9VkjcFWHQ4IPStiigD8g/wBvb/g0D+Df7QXjW88XfBnxFqHwR165Mt0+lW1v9u0Nrpn8xZIYy6yWihi3yROY1AQRxxhcN8u6J+01/wAFOP8Aggd4et9I+IXgyL45fCGxlt7S11ORpddt7GBPKj8uG+tyt3Zq5mihQX8RTdHiFD827+h6mMjFjg4oA/Kb9kX/AIO9v2Yf2gNVt9L8dR+Kvg5qVwWCT6xanUNKZzJEkaG5tgzozeYzbpYkiRYnLSL8ob9KvhD+0F4D+PeiWuqeBvG3hLxppt7FJNbXWh6vb6hDPHHKYndGhdgyrIChIOAwIODxXzh+3B/wQi/Zh/b/ALVpvGvw10/SvEUdrLa2niLwy50fUrTft+c+ViG4ZNoKC5imVMthRvbP5vfHj/gzO1LwJ4kvNW/Z5+PmueG47m2lh+xeIldbp18uJlha8s/L3o8yMzEwgKDH8rlCWAP3hLAUnmL61/PxZ/Df/gst/wAE6r+61DT9Wuvjj4V0cprOoQyalZeKo9SCqA9okdyY9XPCgGK0CFiSUJYk1ZP/AAdJftk/s5/8S/40fsiC01jUv9J00HRdZ8NbrcfK37q4Wdpfn/iVlA6YPWgD+gANmjOa/DLTv+D2jwVpumW9vr/wD8ZWuvW8KRalDBrcCxw3QUCVEDoH2q4YDcA2AMgEkV6z4a/4PNP2Wbvw/p8+qeGfjBp+pTW0b3dpBo9pcx2sxUF41lN0nmKrZUPtXcBnAzgAH66UZ5r8mf8AiMv/AGS/+gH8Zv8Awn7P/wCTKxPiD/wee/szaR4Turnw54N+LevawhT7PY3Wn2mnwzZdQ5ab7RJt2oWYfIclQOM7gAfsBuFJvU96/CvxN/wevaDr2iTWfgX9nrxVqniibb9jtr3W42hkAIaTcIYmk4jDkbR1AJ4zXF61/wAHKv7eX7T2jXlx8Ef2TLmHTLWB7G+vLbwlrPiea0u2UlZEkiEUSOqMjCOSOQEgE7lO2gD+grPNeZ/tBfti/Cn9lbw3d6x8R/iN4N8E6fYv5Ur6vq0Nu5l8l51hRGbe8zxxuyRorO4U7VJxX4g6n/wTu/4K/ft76LJB8UPi0vw80p0GmT2E3iOy0pb60lwZHa30OJopdoyCJysn8I4Jr0L4Ff8ABlt4d1vVb7V/jx8c/GXi/VLxJE/4puKOzmLDyhFK9zeLcM+1FkUoYx95MMAhDAHc/thf8HjnwZ+H2otovwL8H+JvjJrkk8UUF7PBLoul3O4QsfKEiG7dvnljw0EeJIsjehVj8wWPwg/4Ke/8HAWmRXXi7VP+FL/A/wASxrcxwOn/AAj+lXNufsxAjtFLajepIMXEbXLNAxEmyVMqh/Z79kD/AIJE/s4fsG3K3Xwt+E3hnw7qy78avOJdS1QBzEWUXd08syruhRgiuEVgSACTn6ORWDc0AfmH/wAE8f8Ag1M/Z1/Yo8RL4m8YR3fxu8W2swlsJvEdssWlabhXXKWCs0crnfktcGYK0cbRrGy7j+mukaVbaFpVtY2dtb2dnZxLBBBBGI4oI1G1URV4VQoAAGAAO1WaKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKR13ilooAaIgBR5eOjU6igDi9T/AGbvh7rWpXN5eeBPBl1eXkrzzzzaJaySzSOSzOzFCWZmJJJySSSa8l8Rf8EgP2WfF3iK/wBW1T9nv4Q3+papcy3l3czeF7RpLiaRy7ux2cszEk+5r6OooA+Zf+HL/wCyV/0bj8Gv/CVtP/iK2PAH/BKH9mb4V+LLXXvDnwF+Eui6zYhxb3lr4YtEmhDo0b4OzujMp9mNfQVFAHJ+GfgP4I8Fa1FqWi+DvCukajAGEV1ZaRb280e4FTtdEDDIJBweQcV1Xl89adRQAirtFLRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9k=" alt="image" /></p><p>圆的相交体积大小的结论为，其中d为球心距： <span class="math display">\[cos\alpha = \frac{R^2+d^2-r^2}{2Rd}\\cos\beta = \frac{r^2+d^2-R^2}{2rd}\\V=\frac{\pi}{3}((3R-R(1-cos\alpha))R^2(1-cos\alpha)^2+(3r-r(1-cos\beta))r^2(1-cos\beta)^2)\]</span></p><h2 id="代码">代码</h2><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;algorithm&gt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">double</span> ldouble<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define eps </span><span class="fl">1e-9</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> coodinate<span class="op">&#123;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    ldouble x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>cd<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> sphere<span class="op">&#123;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    coodinate c<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    ldouble r<span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>sp<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> ldouble f<span class="op">(</span>ldouble x2<span class="op">,</span> ldouble x1<span class="op">,</span> ldouble k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>x2 <span class="op">*</span> k <span class="op">*</span> k <span class="op">-</span> x1<span class="op">)</span> <span class="op">/</span> <span class="op">(</span>k <span class="op">*</span> k <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> ldouble f2<span class="op">(</span>ldouble x2<span class="op">,</span> ldouble x1<span class="op">,</span> ldouble k<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f<span class="op">(</span>x2<span class="op">,</span> x1<span class="op">,</span> k<span class="op">)</span> <span class="op">*</span> f<span class="op">(</span>x2<span class="op">,</span> x1<span class="op">,</span> k<span class="op">)</span> <span class="op">-</span> <span class="op">(</span>k <span class="op">*</span> k <span class="op">*</span> x2 <span class="op">*</span> x2 <span class="op">-</span> x1 <span class="op">*</span> x1<span class="op">)</span> <span class="op">/</span> <span class="op">(</span>k <span class="op">*</span> k <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>ldouble pi <span class="op">=</span> acosl<span class="op">(-</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>ldouble dis<span class="op">(</span>coodinate p<span class="op">,</span> coodinate q<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    ldouble ans <span class="op">=</span> sqrt<span class="op">((</span>p<span class="op">.</span>x <span class="op">-</span> q<span class="op">.</span>x<span class="op">)*(</span>p<span class="op">.</span>x <span class="op">-</span> q<span class="op">.</span>x<span class="op">)</span> <span class="op">+</span> <span class="op">(</span>p<span class="op">.</span>y <span class="op">-</span> q<span class="op">.</span>y<span class="op">)*(</span>p<span class="op">.</span>y <span class="op">-</span> q<span class="op">.</span>y<span class="op">)</span> <span class="op">+</span> <span class="op">(</span>p<span class="op">.</span>z <span class="op">-</span> q<span class="op">.</span>z<span class="op">)*(</span>p<span class="op">.</span>z <span class="op">-</span> q<span class="op">.</span>z<span class="op">));</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ans<span class="op">;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>ldouble V<span class="op">(</span>ldouble r<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>  <span class="op">(</span>ldouble<span class="op">)</span><span class="dv">4</span> <span class="op">/</span> <span class="dv">3</span> <span class="op">*</span> r <span class="op">*</span> r <span class="op">*</span> r <span class="op">*</span> pi<span class="op">;</span><span class="co">//不加入强制转换结果会算错，详见下面的数据</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> T<span class="op">;</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>T<span class="op">);</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>T<span class="op">--)</span> <span class="op">&#123;</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        ldouble k1<span class="op">,</span> k2<span class="op">,</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">4</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%Lf%Lf%Lf</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>cd<span class="op">[</span>i<span class="op">].</span>x<span class="op">,</span> <span class="op">&amp;</span>cd<span class="op">[</span>i<span class="op">].</span>y<span class="op">,</span> <span class="op">&amp;</span>cd<span class="op">[</span>i<span class="op">].</span>z<span class="op">);</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        scanf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%Lf%Lf</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">&amp;</span>k1<span class="op">,</span> <span class="op">&amp;</span>k2<span class="op">);</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>c <span class="op">=</span> coodinate<span class="op">&#123;</span>f<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>x<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>x<span class="op">,</span> k1<span class="op">),</span> f<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>y<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>y<span class="op">,</span> k1<span class="op">),</span> f<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>z<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>z<span class="op">,</span> k1<span class="op">)&#125;;</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">=</span> sqrtl<span class="op">(</span>f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>x<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>x<span class="op">,</span> k1<span class="op">)</span> <span class="op">+</span> f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>y<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>y<span class="op">,</span> k1<span class="op">)</span> <span class="op">+</span> f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">2</span><span class="op">].</span>z<span class="op">,</span> cd<span class="op">[</span><span class="dv">1</span><span class="op">].</span>z<span class="op">,</span> k1<span class="op">));</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>c <span class="op">=</span> coodinate<span class="op">&#123;</span>f<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>x<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>x<span class="op">,</span> k2<span class="op">),</span> f<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>y<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>y<span class="op">,</span> k2<span class="op">),</span> f<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>z<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>z<span class="op">,</span> k2<span class="op">)&#125;;</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">=</span> sqrtl<span class="op">(</span>f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>x<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>x<span class="op">,</span> k2<span class="op">)</span> <span class="op">+</span> f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>y<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>y<span class="op">,</span> k2<span class="op">)</span> <span class="op">+</span> f2<span class="op">(</span>cd<span class="op">[</span><span class="dv">4</span><span class="op">].</span>z<span class="op">,</span> cd<span class="op">[</span><span class="dv">3</span><span class="op">].</span>z<span class="op">,</span> k2<span class="op">));</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        ldouble d <span class="op">=</span> dis<span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>c<span class="op">,</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>c<span class="op">);</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        ldouble maxr <span class="op">=</span> <span class="bu">std::</span>max<span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r<span class="op">,</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r<span class="op">),</span> minr <span class="op">=</span> <span class="bu">std::</span>min<span class="op">(</span>sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r<span class="op">,</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r<span class="op">);</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">+</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">&lt;=</span> d<span class="op">)</span> ans <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>d <span class="op">+</span> minr <span class="op">&lt;=</span> maxr<span class="op">)</span> <span class="op">&#123;</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">=</span> V<span class="op">(</span>minr<span class="op">);</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span> <span class="cf">else</span> <span class="op">&#123;</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            ldouble cosa <span class="op">=</span> <span class="op">(</span>sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">+</span> d <span class="op">*</span> d <span class="op">-</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> d<span class="op">);</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>            ldouble cosb <span class="op">=</span> <span class="op">(</span>sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">+</span> d <span class="op">*</span> d <span class="op">-</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r<span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="dv">2</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> d<span class="op">);</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            ans <span class="op">=</span> pi <span class="op">/</span> <span class="dv">3</span> <span class="op">*</span> <span class="op">(</span><span class="dv">3</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">-</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosa<span class="op">))</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosa<span class="op">)</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">1</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosa<span class="op">)</span> <span class="op">+</span> </span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                    pi <span class="op">/</span> <span class="dv">3</span> <span class="op">*</span> <span class="op">(</span><span class="dv">3</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">-</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosb<span class="op">))</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosb<span class="op">)</span> <span class="op">*</span> sp<span class="op">[</span><span class="dv">2</span><span class="op">].</span>r <span class="op">*</span> <span class="op">(</span><span class="dv">1</span> <span class="op">-</span> cosb<span class="op">);</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%Lf\n</span><span class="st">&quot;</span><span class="op">,</span> ans<span class="op">);</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co">1</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co">0 0 0</span></span><span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co">600 0 0</span></span><span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co">596 0 0</span></span><span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="co">602 0 0</span></span><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co">2 2</span></span><span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="co">应输出 : 268.083</span></span><span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co">但是不加入强制转换会输出 : 201.062</span></span><span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 题解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2021牛客暑期多校第二场 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021-07-17 关于自己读书的有趣现象</title>
      <link href="/2021/07/17/Essay-2021-7-17/"/>
      <url>/2021/07/17/Essay-2021-7-17/</url>
      
        <content type="html"><![CDATA[<p>  作为学生，课本是一定要读的，暂且不算在文中谈的"读书"。</p><p>  发现了自己很有趣的一个现象，平时自己极度反感别人教自己做事。可现实中，一想读什么书，就要先看看网上的评论，唯恐网上的评论教你的东西少，生怕自己读错书。这种心情是可以理解的，因为看书会消耗人的时间，但是，网上的评论，真的完全客观吗，质量高吗?是否存在幸存者偏差?</p><p>  上大学已经两年了，转眼间就要上大三。随着手机网络的不断发展，我读书的时间已经被不知不觉的占据。视频客户端的推送，让人欲罢不能，贴吧知乎推送的帖子回答，总会有一条让我感兴趣。推送的内容不乏精品，包含各个领域，纷繁复杂。然而，我在看完这些高质量的视频，帖子，回答后，很少能记住，都放进了收藏夹里。快速查看，快速遗忘，是这个时代的特色，久而久之，人的专注力和记忆力都下降了。</p><p>  现代社会，网络耗费了人大量的时间，人就会在不属于网络的时间中患得患失，生怕浪费了一点，因为剩下的时间不多了。</p><p>  如果这本书你觉得适合你阅读，那就尝试着静下心来把它读完。总是关注别人的评论，你就会不停的纠结这本书能不能读，不停上网找评论去支持你想读或不想读的观点，在这种纠结中，你在互联网上消耗的时间会不自觉的变多，这就陷入了互联网浮躁思维的陷阱。</p><p>  静下心来，摆脱外界对你的桎梏，你才能真正收获到阅读的知识和快乐。</p>]]></content>
      
      
      <categories>
          
          <category> 感想随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
